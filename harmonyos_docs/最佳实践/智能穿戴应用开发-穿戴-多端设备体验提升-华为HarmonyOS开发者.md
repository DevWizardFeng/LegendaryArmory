<h1 _ngcontent-kca-c119="" class="doc-title ng-star-inserted" title="智能穿戴应用开发"> 智能穿戴应用开发 </h1>

<div _ngcontent-kca-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section1678415711367">概述<i class="anchor-icon anchor-icon-link" anchorid="section1678415711367" tips="复制节点链接"></i></h2><p>智能穿戴是一种腕部可穿戴设备，提供沟通功能和与移动设备的数据交互功能。</p> </div> <div class="tiledSection"><h3 id="section95631922154916" class="firsth2">设备特点<i class="anchor-icon anchor-icon-link" anchorid="section95631922154916" tips="复制节点链接"></i></h3><p>智能穿戴设备具有以下显著特点：</p> <ul><li>表盘屏幕尺寸较小，多为圆形表盘。</li><li>随腕携带，查看表盘屏幕更为便捷。</li><li>电池容量较小，一般小于1000mAh。</li><li>具备特有表冠旋转交互功能。</li><li>支持更为丰富的传感器。</li></ul> </div> <div class="tiledSection"><h3 id="section3180237124917">主要型号<i class="anchor-icon anchor-icon-link" anchorid="section3180237124917" tips="复制节点链接"></i></h3><p>支持HarmonyOS 5及以上的智能穿戴设备主要有Watch 5。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.1" valign="top" width="29.020000000000003%"><p>产品名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.2" valign="top" width="70.98%"><p>示意图</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="29.020000000000003%"><p>Watch 5</p> </td> <td class="cellrowborder" valign="top" width="70.98%"><p><span><img height="408.975" originheight="800" originwidth="800" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163319.43244417355950607073795332186288:50001231000000:2800:DB4E64334BA986D3C54F6D62885F2759DB31D97A1D40A467D87769E0FD5669BD.png" title="点击放大" width="408.975"></span></p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section13563206193716">硬件说明<i class="anchor-icon anchor-icon-link" anchorid="section13563206193716" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section1459020474491" class="firsth2">屏幕规格信息<i class="anchor-icon anchor-icon-link" anchorid="section1459020474491" tips="复制节点链接"></i></h3><p>以Watch 5设备为例，智能穿戴设备屏幕不支持旋转，屏幕旋转角度为0°，屏幕方向为竖屏，更多屏幕规格信息参考下表。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><tbody><tr><td class="cellrowborder" valign="top" width="20%"><p>屏幕旋转角度(rotation)</p> </td> <td class="cellrowborder" valign="top" width="20%"><p>0（0度）</p> </td> <td class="cellrowborder" valign="top" width="20%"><p>1（90度）</p> </td> <td class="cellrowborder" valign="top" width="20%"><p>2（180度）</p> </td> <td class="cellrowborder" valign="top" width="20%"><p>3（270度）</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="20%"><p>示意图</p> </td> <td class="cellrowborder" valign="top" width="20%"><p><span><img height="273.55957894736844" originheight="1467" originwidth="858" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163319.83172286077532186707277145116066:50001231000000:2800:8117840944ABC6B32666BB6DF0702AF6991BF802F675140A06E0A829DFC3F547.jpg" title="点击放大" width="160"></span></p> </td> <td class="cellrowborder" valign="top" width="20%"><p>NA</p> </td> <td class="cellrowborder" valign="top" width="20%"><p>NA</p> </td> <td class="cellrowborder" valign="top" width="20%"><p>NA</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="20%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-display#orientation10" target="_blank">屏幕方向orientation</a></p> </td> <td class="cellrowborder" valign="top" width="20%"><p>0-PORTRAIT</p> </td> <td class="cellrowborder" valign="top" width="20%"><p>NA</p> </td> <td class="cellrowborder" valign="top" width="20%"><p>NA</p> </td> <td class="cellrowborder" valign="top" width="20%"><p>NA</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="20%"><p>分辨率（px）</p> </td> <td class="cellrowborder" valign="top" width="20%"><p>466 * 466</p> </td> <td class="cellrowborder" valign="top" width="20%"><p>NA</p> </td> <td class="cellrowborder" valign="top" width="20%"><p>NA</p> </td> <td class="cellrowborder" valign="top" width="20%"><p>NA</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="20%"><p>分辨率（vp）</p> </td> <td class="cellrowborder" valign="top" width="20%"><p>233 * 233</p> </td> <td class="cellrowborder" valign="top" width="20%"><p>NA</p> </td> <td class="cellrowborder" valign="top" width="20%"><p>NA</p> </td> <td class="cellrowborder" valign="top" width="20%"><p>NA</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="20%"><p>横纵断点</p> </td> <td class="cellrowborder" valign="top" width="20%"><p>横向断点xs，纵向断点md</p> </td> <td class="cellrowborder" valign="top" width="20%"><p>NA</p> </td> <td class="cellrowborder" valign="top" width="20%"><p>NA</p> </td> <td class="cellrowborder" valign="top" width="20%"><p>NA</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section1669831503719">体验标准<i class="anchor-icon anchor-icon-link" anchorid="section1669831503719" tips="复制节点链接"></i></h2><p>应用体验建议分为功能与兼容性、稳定性、性能、功耗、安全和UX六个部分，详细信息如下所示。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.6.3.1.3.1.1" valign="top" width="50%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.3.1.3.1.2" valign="top" width="50%"><p>简介</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/experience-suggestions-compatibility" target="_blank">应用基础功能和兼容性体验建议</a></p> </td> <td class="cellrowborder" valign="top" width="50%"><p>应用与OS兼容、应用与设备兼容、应用升级兼容、功能体验相关等</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/experience-suggestions-stability" target="_blank">应用稳定性体验建议</a></p> </td> <td class="cellrowborder" valign="top" width="50%"><p>长时间运行故障率（崩溃、冻屏等）、长时间运行内存资源异常</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/performance-experience-suggestions" target="_blank">应用性能体验建议</a></p> </td> <td class="cellrowborder" valign="top" width="50%"><p>时延、帧率流畅体验和内存占用、CPU占用、线程数等资源占用约束</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-power-experience-standards" target="_blank">应用功耗体验建议</a></p> </td> <td class="cellrowborder" valign="top" width="50%"><p>后台任务使用、后台硬件器件资源/软件系统资源占用管控，分布式资源占用等</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/security-privacy-experience-standards" target="_blank">应用安全隐私体验建议</a></p> </td> <td class="cellrowborder" valign="top" width="50%"><p>基础安全、恶意软件、应用安全、隐私合规等</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/experience-suggestions-ux" target="_blank">应用UX体验建议</a></p> </td> <td class="cellrowborder" valign="top" width="50%"><p>设计规范、设计约束的符合性，UX精致体验要求等</p> </td> </tr>  </tbody></table></div> </div> <p>智能穿戴设备主要在UX和性能体验上有着特殊的适配体验和建议。</p> </div> <div class="tiledSection"><h3 id="section18362193985010" class="firsth2">UX体验建议<i class="anchor-icon anchor-icon-link" anchorid="section18362193985010" tips="复制节点链接"></i></h3><p><strong>体验设计标准</strong></p> <ul><li>使用系统控件：利用系统提供的按钮及导航点等标准控件，确保良好基础体验，同时减少设计和开发的工作量。必要时自定义控件样式和大小，以体现品牌特征。</li><li>使用合适的应用架构：根据业务特点采用适宜架构。例如，单一功能类应用采用页面横向或纵向平铺的平级架构，确保主要功能在首屏展示。</li><li>保证页面正常显示：根据智能穿戴设备的屏幕形状合理设计界面，确保界面正常显示，不影响用户使用。</li><li>充分利用表冠和按键交互：除屏幕手势交互外，表冠和按键交互可帮助用户在盲操场景下快速完成特定操作。例如，单击表冠快速开始或暂停运动记录。</li></ul> <p><strong>体验设计差异点</strong></p> <p>智能穿戴设备采用独特的圆形屏幕设计，显示面积远小于手机。开发时需确保应用界面完整适配圆形显示区域，避免内容截断、变形或关键元素被遮挡。</p> <p><strong>应用设计最佳实践</strong></p> <p>根据上述UX体验标准和设计差异点，各垂域应用应根据功能和场景特点进行智能穿戴UX设计。例如，运动健康类应用可充分利用表冠进行运动模式切换或强度调节，更多垂域设计信息和方案可参考<a href="https://developer.huawei.com/consumer/cn/doc/design-guides/practices-overview-0000001746498066" target="_blank">应用设计最佳实践</a>。通用设计场景请参考<a href="https://developer.huawei.com/consumer/cn/doc/design-guides/wearable-0000002164711032" target="_blank">智能穿戴</a>。</p> </div> <div class="tiledSection"><h3 id="section571565015017">性能体验建议<i class="anchor-icon anchor-icon-link" anchorid="section571565015017" tips="复制节点链接"></i></h3><p><strong>体验设计标准</strong></p> <p>优化续航表现。合理控制应用的CPU、传感器及网络资源使用，避免后台频繁唤醒，延长设备续航时间，提升用户使用体验。</p> <p><strong>体验设计差异点</strong></p> <p>为提升智能穿戴设备续航能力并优化用户体验，系统应执行严格功耗管理措施，详情参见<a href="/consumer/cn/doc/best-practices/bpta-smartwatch#section7617165395315">功耗管理优化</a>章节。</p> <p><strong>应用设计最佳实践</strong></p> <p>参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-power-consumption-experience#section818174004918" target="_blank">应用功耗体验设计</a>。</p> </div> <div class="tiledSection"><h2 id="section12325132073711">工程管理<i class="anchor-icon anchor-icon-link" anchorid="section12325132073711" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section7558161517513" class="firsth2">工程配置<i class="anchor-icon anchor-icon-link" anchorid="section7558161517513" tips="复制节点链接"></i></h3><p>开发在智能穿戴设备上的应用，需要在module.json5配置文件的module字段中，为deviceTypes字段设置wearable类型。更多详情可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-structure#devicetype标签" target="_blank">deviceTypes标签</a>。若当前已有适配轻量级智能穿戴的工程，需要迁移适配智能穿戴设备，可以参考<a href="/consumer/cn/doc/best-practices/bpta-smartwatch#section1219382121110">FA工程迁移指导</a>。</p> </div> <div class="tiledSection"><h3 id="section1870515318482">包管理策略<i class="anchor-icon anchor-icon-link" anchorid="section1870515318482" tips="复制节点链接"></i></h3><p>由于应用在智能穿戴设备上的页面设计、功能形态会与其他设备有明显差异，因此推荐独立HAP精准适配的HAP包的管理策略：</p> <ul><li>独立HAP精准适配：智能穿戴设备与其他设备在页面设计、功能形态上存在显著差异，应创建独立HAP包，分别构建面向phone/tablet与wearable等设备的模块化组件，实现设备专属的UX设计、资源优化与体验定制。</li></ul> <p>更多详情可参见<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-layered-architecture-design" target="_blank">分层架构设计</a>的产品定制层相关内容。</p> </div> <div class="tiledSection"><h3 id="section11967172335116">工程调试<i class="anchor-icon anchor-icon-link" anchorid="section11967172335116" tips="复制节点链接"></i></h3><p>智能穿戴设备工程调试规范如下：</p> <ul><li>调试模式：智能穿戴设备推荐使用WiFi无线调试（支持自动签名）。无线调试内容可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-run-device#section9315596477" target="_blank">使用无线调试连接方式</a>。</li><li>调试稳定性：设备熄屏后WiFi调试连接会断开，建议在系统设置中延长自动熄屏时间，确保调试过程稳定。</li><li>设备授权：首次调试时，手表将弹出“信任设备”提示，需点击“信任”以允许IDE连接。</li></ul> </div> <div class="tiledSection"><h2 id="section198811325193715">界面开发<i class="anchor-icon anchor-icon-link" anchorid="section198811325193715" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section659103113525" class="firsth2">圆形屏适配建议<i class="anchor-icon anchor-icon-link" anchorid="section659103113525" tips="复制节点链接"></i></h3><p>智能穿戴设备特殊的圆形表盘，需要在设计智能穿戴设备页面时进行考虑。详情开发指导可参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-multi-device-screen-layout#section1298815351411" target="_blank">圆形屏</a>。</p> </div> <div class="tiledSection"><h2 id="section1074710334374">交互体验<i class="anchor-icon anchor-icon-link" anchorid="section1074710334374" tips="复制节点链接"></i></h2><p>智能穿戴的交互方式为触控屏，常见的操作有点击、双击、长按、拖拽、滑动等，应用可根据这些操作进行功能适配，详情可参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-multi-interaction" target="_blank">多设备交互</a>。除上述触控屏交互方式外，智能穿戴设备还支持表冠交互和智慧手势。</p> </div> <div class="tiledSection"><h3 id="section545914583527" class="firsth2">旋转表冠交互<i class="anchor-icon anchor-icon-link" anchorid="section545914583527" tips="复制节点链接"></i></h3><p>华为智能穿戴的表冠（上键）支持按压与旋转两种交互方式，其旋转操作可触发实时交互响应。系统通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-crown#ondigitalcrown" target="_blank">onDigitalCrown()</a>回调函数处理表冠旋转事件，并已为常用组件内置了表冠交互支持。</p> <p>主要特性：</p> <ul><li>事件响应：旋转操作实时触发onDigitalCrown回调<div class="screenLinkPre"><div _ngcontent-kca-c106="" class="highlight-div"><div _ngcontent-kca-c106="" class="highlight-div-header"><div _ngcontent-kca-c106="" class="highlight-div-header-left"><div _ngcontent-kca-c106="" class="handle-button expand-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kca-c106="" class="highlight-div-header-right"><div _ngcontent-kca-c106="" class="handle-button ai-button"></div><div _ngcontent-kca-c106="" class="handle-button line-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kca-c106="" class="handle-button theme-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kca-c106="" class="handle-button copy-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kca-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" codehub="https://gitee.com/harmonyos_samples/multi-device-interaction/blob/master/wearable/src/main/ets/view/DigitalCrownEvent.ets#L34-L46" data-highlighted="yes"><ol class="linenums"><li>Text(<span class="hljs-keyword">this</span>.count.toString())</li><li>  <span class="hljs-comment">// ...</span></li><li>  .onDigitalCrown((<span class="hljs-keyword">event</span>: CrownEvent) =&gt; {</li><li>    <span class="hljs-keyword">event</span>.stopPropagation();</li><li>    <span class="hljs-keyword">this</span>.count += <span class="hljs-keyword">event</span>.degree;</li><li>  })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/multi-device-interaction/blob/master/wearable/src/main/ets/view/DigitalCrownEvent.ets#L34-L46" target="_blank">DigitalCrownEvent.ets</a></div></div></div></div> </li><li>系统集成：滚动条等组件自动响应表冠旋转方向</li></ul> <p>默认支持表冠交互的组件包括：</p> <ul><li>滑动选择类：Slider、Scroll、ArcSwiper、Refresh</li><li>列表展示类：List、Grid、WaterFlow、ArcList</li><li>时间日期类：DatePicker、TimePicker</li><li>文本选择类：TextPicker</li></ul> <p>开发者可通过开放接口自定义表冠事件处理逻辑，实现更丰富的交互体验。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>关于智能穿戴表冠旋转事件的开发，可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-crown" target="_blank">表冠事件</a>。</p> </div></div></div> </div> <div class="tiledSection"><h3 id="section138971012195317">智慧手势<i class="anchor-icon anchor-icon-link" anchorid="section138971012195317" tips="复制节点链接"></i></h3><p>智慧手势是智能穿戴设备除屏幕交互、表冠交互和按键交互外的独特感知交互方式。在情景障碍，需要单手处理的场景，用户可以使用敲击手指和滑动指关节实现控制和切换选择诉求。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>使用智慧手势功能要确保设备上的智慧手势识别开关已打开。</p> </div></div></div> <p><strong>交互场景</strong></p> <ul><li>提醒场景，需及时处理的控制，如电话、闹钟等。</li><li>高频使用场景的便捷操控，如播控中心“下一首”。</li><li>不方便双手点击操作的场景，如遥控拍照。</li></ul> <p><strong>手势类型</strong></p> <ul><li>捏合确认：拇指和食指快速触碰两下，表示确认当前焦点的操作。常用于确认键、音乐暂停/播放等场景。</li></ul> <p>实现原理：系统识别手势后，会触发组件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-key#onkeyevent" target="_blank">onKeyEvent</a>事件，KeyCode为KEYCODE_ENTER，type为KeyType.Down，应用可以在该条件触发后进行功能执行，如暂停音乐。</p> <p>示例代码：</p> <div class="screenLinkPre"><div _ngcontent-kca-c106="" class="highlight-div"><div _ngcontent-kca-c106="" class="highlight-div-header"><div _ngcontent-kca-c106="" class="highlight-div-header-left"><div _ngcontent-kca-c106="" class="handle-button expand-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kca-c106="" class="highlight-div-header-right"><div _ngcontent-kca-c106="" class="handle-button ai-button"></div><div _ngcontent-kca-c106="" class="handle-button line-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kca-c106="" class="handle-button theme-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kca-c106="" class="handle-button copy-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kca-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" codehub="https://gitee.com/harmonyos_samples/multi-device-interaction/blob/master/wearable/src/main/ets/view/SmartGestureEvent.ets#L77-L83" data-highlighted="yes"><ol class="linenums"><li>.onKeyEvent((<span class="hljs-keyword">event</span>: KeyEvent) =&gt; {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">event</span>.keyCode === KeyCode.KEYCODE_ENTER &amp;&amp; <span class="hljs-keyword">event</span>.type === KeyType.Down) {</li><li>    <span class="hljs-comment">// Trigger the pinching gesture</span></li><li>    <span class="hljs-keyword">this</span>.oneButton1Color = <span class="hljs-string">'#ffe3ba51'</span>;</li><li>    <span class="hljs-keyword">this</span>.oneButton1Text = <span class="hljs-string">'Confirm'</span>;</li><li>  }</li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/multi-device-interaction/blob/master/wearable/src/main/ets/view/SmartGestureEvent.ets#L77-L83" target="_blank">SmartGestureEvent.ets</a></div></div></div></div> <p><span><img height="425.22760000000005" originheight="1280" originwidth="2202" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163319.58541109721749565159101066534600:50001231000000:2800:EE304EF872887849131A8E2C29F0261335CE840C2D3C12BEBDA256A353990A2A.png" title="点击放大" width="731.5"></span></p> <ul><li>滑动切焦：切换当前焦点，以确认下一步操作，通过将拇指沿食指第二关节向指尖快速滑动两下切换焦点，后续再进行确认操作，可以用于切换到取消按钮，或切换到播放下一首按钮上，用于取消消息、切换歌曲等操作场景。</li></ul> <p>实现原理：系统识别手势后，会分别触发失焦组件和获焦组件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-focus-event#onblur" target="_blank">onBlur</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-focus-event#onfocus" target="_blank">onFocus</a>事件，应用可以在该条件触发后进行功能执行，如更改获焦组件的样式为高亮展示。</p> <p>示例代码：</p> <div class="screenLinkPre"><div _ngcontent-kca-c106="" class="highlight-div"><div _ngcontent-kca-c106="" class="highlight-div-header"><div _ngcontent-kca-c106="" class="highlight-div-header-left"><div _ngcontent-kca-c106="" class="handle-button expand-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kca-c106="" class="highlight-div-header-right"><div _ngcontent-kca-c106="" class="handle-button ai-button"></div><div _ngcontent-kca-c106="" class="handle-button line-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kca-c106="" class="handle-button theme-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kca-c106="" class="handle-button copy-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kca-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/multi-device-interaction/blob/master/wearable/src/main/ets/view/SmartGestureEvent.ets#L66-L74" data-highlighted="yes"><ol class="linenums"><li>.onFocus(() =&gt; {</li><li>  <span class="hljs-keyword">this</span>.oneButton1Color = <span class="hljs-string">'#ff57c853'</span>;</li><li>  <span class="hljs-keyword">this</span>.oneButton1Text = <span class="hljs-string">'Hover'</span>;</li><li>  <span class="hljs-keyword">this</span>.oneButton2Text = <span class="hljs-string">'Two'</span>;</li><li>})</li><li>.onBlur(() =&gt; {</li><li>  <span class="hljs-keyword">this</span>.oneButton1Color = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-keyword">this</span>.oneButton1Text = <span class="hljs-string">'One'</span>;</li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/multi-device-interaction/blob/master/wearable/src/main/ets/view/SmartGestureEvent.ets#L66-L74" target="_blank">SmartGestureEvent.ets</a></div></div></div></div> <p><span><img height="425.2143" originheight="1280" originwidth="2202" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163320.38030361297950140199943873225619:50001231000000:2800:5FED2F5B9C7AE94E7239E297268E86312F742A3EA439A97ADA7B1FAC8F654E8D.png" title="点击放大" width="731.5"></span></p> <p>智慧手势交互的前提是组件获焦。可调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-focuscontroller#requestfocus12" target="_blank">requestFocus()</a>方法使目标组件获得焦点，随后手势操作方可生效。示例代码如下，页面渲染后默认使得id为"btn1"的按钮获焦：</p> <div class="screenLinkPre"><div _ngcontent-kca-c106="" class="highlight-div"><div _ngcontent-kca-c106="" class="highlight-div-header"><div _ngcontent-kca-c106="" class="highlight-div-header-left"><div _ngcontent-kca-c106="" class="handle-button expand-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kca-c106="" class="highlight-div-header-right"><div _ngcontent-kca-c106="" class="handle-button ai-button"></div><div _ngcontent-kca-c106="" class="handle-button line-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kca-c106="" class="handle-button theme-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kca-c106="" class="handle-button copy-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kca-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/multi-device-interaction/blob/master/wearable/src/main/ets/view/SmartGestureEvent.ets#L41-L42" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// register a button to get focus by default.</span></li><li><span class="hljs-keyword">this</span>.getUIContext().getFocusController().requestFocus(<span class="hljs-string">'btn1'</span>);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/multi-device-interaction/blob/master/wearable/src/main/ets/view/SmartGestureEvent.ets#L41-L42" target="_blank">SmartGestureEvent.ets</a></div></div></div></div> </div> <div class="tiledSection"><h2 id="section66931739123711">功能开发<i class="anchor-icon anchor-icon-link" anchorid="section66931739123711" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section1674929165315" class="firsth2">消息通知<i class="anchor-icon anchor-icon-link" anchorid="section1674929165315" tips="复制节点链接"></i></h3></div> <p>华为智能穿戴的消息通知来源包括：</p> <ul><li>手机应用通知：应用通过华为运动健康授权消息通知权限后，配对手机的应用通知将同步至穿戴设备。</li><li>手机主动推送：手机应用使用WearEngine接口直接向穿戴设备发送消息通知。</li><li>穿戴设备本地通知：手表应用通过Notification Kit自主发送通知。</li></ul> <p><strong>手机应用通知</strong></p> <p>在华为运动健康APP中，进入消息通知设置界面，为指定手机应用开启通知权限，即可将该应用的消息实时同步至已配对的华为智能穿戴设备。</p> <p><strong>手机主动推送</strong></p> <p>手机应用可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api" target="_blank">WearEngine</a>的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section087562072313" target="_blank">NotifyClient.notify()</a>实现手机向智能穿戴设备主动推送消息通知，开发步骤如下：</p> <ol><li><span>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section552416431386" target="_blank">wearEngine.getNotifyClient()</a>获取Notify客户端类。</span><p></p><div class="screenLinkPre"><div _ngcontent-kca-c106="" class="highlight-div"><div _ngcontent-kca-c106="" class="highlight-div-header"><div _ngcontent-kca-c106="" class="highlight-div-header-left"><div _ngcontent-kca-c106="" class="handle-button expand-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kca-c106="" class="highlight-div-header-right"><div _ngcontent-kca-c106="" class="handle-button ai-button"></div><div _ngcontent-kca-c106="" class="handle-button line-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kca-c106="" class="handle-button theme-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kca-c106="" class="handle-button copy-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kca-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/SmartWatchMapNavigation/blob/master/commons/Communication/src/main/ets/common/utils/CommunicationUtils.ets#L44-L45" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Used to notify message</span></li><li><span class="hljs-variable">notifyClient</span>: <span class="hljs-title class_">wearEngine</span>.<span class="hljs-title class_">NotifyClient</span> | <span class="hljs-title class_">undefined</span>;</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/SmartWatchMapNavigation/blob/master/commons/Communication/src/main/ets/common/utils/CommunicationUtils.ets#L44-L45" target="_blank">CommunicationUtils.ets</a></div></div></div></div> <p>使用当前组件所在Ability的Context，获取Notify模块的客户端。</p> <div class="screenLinkPre"><div _ngcontent-kca-c106="" class="highlight-div"><div _ngcontent-kca-c106="" class="highlight-div-header"><div _ngcontent-kca-c106="" class="highlight-div-header-left"><div _ngcontent-kca-c106="" class="handle-button expand-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kca-c106="" class="highlight-div-header-right"><div _ngcontent-kca-c106="" class="handle-button ai-button"></div><div _ngcontent-kca-c106="" class="handle-button line-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kca-c106="" class="handle-button theme-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kca-c106="" class="handle-button copy-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kca-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/SmartWatchMapNavigation/blob/master/products/phone/src/main/ets/pages/Index.ets#L161-L166" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">connectUtils</span>.<span class="hljs-property">notifyClient</span> = wearEngine.<span class="hljs-title function_">getNotifyClient</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>());</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>,</li><li>    <span class="hljs-string">`Failed to get notify client. Cause code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/SmartWatchMapNavigation/blob/master/products/phone/src/main/ets/pages/Index.ets#L161-L166" target="_blank">Index.ets</a></div></div></div></div> <p></p></li><li><span>通过NotifyClient.notify()实现手机向智能穿戴设备发送模板化通知。</span><p></p><div class="screenLinkPre"><div _ngcontent-kca-c106="" class="highlight-div"><div _ngcontent-kca-c106="" class="highlight-div-header"><div _ngcontent-kca-c106="" class="highlight-div-header-left"><div _ngcontent-kca-c106="" class="handle-button expand-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kca-c106="" class="highlight-div-header-right"><div _ngcontent-kca-c106="" class="handle-button ai-button"></div><div _ngcontent-kca-c106="" class="handle-button line-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kca-c106="" class="handle-button theme-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kca-c106="" class="handle-button copy-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kca-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/SmartWatchMapNavigation/blob/master/commons/Communication/src/main/ets/common/utils/CommunicationUtils.ets#L154-L181" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/*</span></li><li><span class="hljs-comment"> * Method of notifying a message to watch.</span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-title function_">notifyMessage</span>() {</li><li>  <span class="hljs-comment">// Configure the notification content.</span></li><li>  <span class="hljs-comment">// Including the package name of the notification source, notification title, and notification content.</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">type1Notification</span>: <span class="hljs-title class_">wearEngine</span>.<span class="hljs-title class_">Notification</span> = {</li><li>    <span class="hljs-keyword">type</span>: <span class="hljs-title class_">wearEngine</span>.<span class="hljs-title class_">NotificationType</span>.<span class="hljs-title class_">NOTIFICATION_WITHOUT_BUTTONS</span>,</li><li>    <span class="hljs-variable">bundleName</span>: <span class="hljs-string">'com.example.smartwatchmapnavigation'</span>,</li><li>    <span class="hljs-variable">title</span>: <span class="hljs-string">'smartwatchmapnavigation'</span>,</li><li>    <span class="hljs-variable">text</span>: <span class="hljs-string">'walk navigation start'</span>,</li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">options</span>: <span class="hljs-title class_">wearEngine</span>.<span class="hljs-title class_">NotificationOptions</span> = {</li><li>    <span class="hljs-variable">notification</span>: <span class="hljs-title class_">type1Notification</span>,</li><li>    <span class="hljs-variable">onAction</span>: (<span class="hljs-variable">feedback</span>: <span class="hljs-title class_">wearEngine</span>.<span class="hljs-title class_">NotificationFeedback</span>) =&gt; {</li><li>      <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x000</span>, <span class="hljs-variable">TAG</span>,</li><li>        `<span class="hljs-variable">one</span> <span class="hljs-variable">button</span> <span class="hljs-variable">notify</span> <span class="hljs-variable">get</span> <span class="hljs-variable">feedback</span> <span class="hljs-keyword">is</span> ${<span class="hljs-variable">feedback</span>.<span class="hljs-variable">action</span> ? <span class="hljs-variable">feedback</span>.<span class="hljs-variable">action</span> : <span class="hljs-title class_">feedback</span>.<span class="hljs-title class_">errorCode</span>}`);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// Sends a notification to the watch based on notifyClient.</span></li><li>  <span class="hljs-comment">// This method can be invoked only by apps on mobile phones.</span></li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-variable">notifyClient</span>!.<span class="hljs-title function_">notify</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">deviceRandomId</span>, <span class="hljs-variable">options</span>).<span class="hljs-title function_">then</span>(<span class="hljs-variable">result</span> =&gt; {</li><li>    <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x000</span>, <span class="hljs-variable">TAG</span>, `<span class="hljs-variable">Succeeded</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">sending</span> <span class="hljs-variable">notification</span>.`);</li><li>  }).<span class="hljs-keyword">catch</span>((<span class="hljs-variable">error</span>: <span class="hljs-title class_">BusinessError</span>) =&gt; {</li><li>    <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x000</span>, <span class="hljs-variable">TAG</span>, `<span class="hljs-variable">Failed</span> <span class="hljs-variable">to</span> <span class="hljs-variable">send</span> <span class="hljs-variable">notification</span>. <span class="hljs-variable">Code</span> <span class="hljs-keyword">is</span> ${<span class="hljs-variable">error</span>.<span class="hljs-variable">code</span>}, <span class="hljs-variable">message</span> <span class="hljs-keyword">is</span> ${<span class="hljs-variable">error</span>.<span class="hljs-variable">message</span>}`);</li><li>  })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/SmartWatchMapNavigation/blob/master/commons/Communication/src/main/ets/common/utils/CommunicationUtils.ets#L154-L181" target="_blank">CommunicationUtils.ets</a></div></div></div></div> <p></p></li></ol> <p></p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>使用WearEngine的NotifyClient.notify()需要获取WearEngine权限，具体可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/wearengine_apply" target="_blank">申请接入Wear Engine服务</a>。</p> </div></div></div> <p><strong>智能穿戴设备本地通知</strong></p> <p>智能穿戴设备应用可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-notificationmanager" target="_blank">Notification Kit（用户通知服务）</a>实现自主发送通知。</p> <ol><li><span>请求通知授权。</span><p></p><p>可通过requestEnableNotification的错误码判断用户是否授权。若返回的错误码为1600004，即为拒绝授权。</p> <div class="screenLinkPre"><div _ngcontent-kca-c106="" class="highlight-div"><div _ngcontent-kca-c106="" class="highlight-div-header"><div _ngcontent-kca-c106="" class="highlight-div-header-left"><div _ngcontent-kca-c106="" class="handle-button expand-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kca-c106="" class="highlight-div-header-right"><div _ngcontent-kca-c106="" class="handle-button ai-button"></div><div _ngcontent-kca-c106="" class="handle-button line-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kca-c106="" class="handle-button theme-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kca-c106="" class="handle-button copy-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kca-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/Phone_Connection/blob/master/products/phone/src/main/ets/pages/NotifyPage.ets#L30-L50" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>  notificationManager.<span class="hljs-title function_">isNotificationEnabled</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data: <span class="hljs-built_in">boolean</span></span>) =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">"isNotificationEnabled success, data: "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));</li><li>    <span class="hljs-keyword">if</span> (!data) {</li><li>      notificationManager.<span class="hljs-title function_">requestEnableNotification</span>(context).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`[ANS] requestEnableNotification success`</span>);</li><li>      }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-number">1600004</span> == err.<span class="hljs-property">code</span>) {</li><li>          hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>,</li><li>            <span class="hljs-string">`[ANS] requestEnableNotification refused, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>        } <span class="hljs-keyword">else</span> {</li><li>          hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>,</li><li>            <span class="hljs-string">`[ANS] requestEnableNotification failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>        }</li><li>      });</li><li>    }</li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`isNotificationEnabled fail, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>  });</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/Phone_Connection/blob/master/products/phone/src/main/ets/pages/NotifyPage.ets#L30-L50" target="_blank">NotifyPage.ets</a></div></div></div></div> <p></p></li><li><span>构造NotificationRequest对象，并发布通知。</span><p></p><div class="screenLinkPre"><div _ngcontent-kca-c106="" class="highlight-div"><div _ngcontent-kca-c106="" class="highlight-div-header"><div _ngcontent-kca-c106="" class="highlight-div-header-left"><div _ngcontent-kca-c106="" class="handle-button expand-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kca-c106="" class="highlight-div-header-right"><div _ngcontent-kca-c106="" class="handle-button ai-button"></div><div _ngcontent-kca-c106="" class="handle-button line-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kca-c106="" class="handle-button theme-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kca-c106="" class="handle-button copy-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kca-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/Phone_Connection/blob/master/products/phone/src/main/ets/pages/NotifyPage.ets#L56-L77" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">Button</span>(<span class="hljs-string">'发送通知'</span>)</li><li>  .<span class="hljs-title function_">onClick</span>(()=&gt;{</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">notificationRequest</span>: <span class="hljs-title class_">notificationManager</span>.<span class="hljs-title class_">NotificationRequest</span> = {</li><li>      <span class="hljs-variable">id</span>: <span class="hljs-number">1</span>,</li><li>      <span class="hljs-variable">content</span>: {</li><li>        <span class="hljs-comment">// General text type notification.</span></li><li>        <span class="hljs-variable">notificationContentType</span>: <span class="hljs-title class_">notificationManager</span>.<span class="hljs-title class_">ContentType</span>.<span class="hljs-title class_">NOTIFICATION_CONTENT_BASIC_TEXT</span>,</li><li>        <span class="hljs-variable">normal</span>: {</li><li>          <span class="hljs-variable">title</span>: <span class="hljs-string">'test_title'</span>,</li><li>          <span class="hljs-variable">text</span>: <span class="hljs-string">'test_text'</span>,</li><li>          <span class="hljs-variable">additionalText</span>: <span class="hljs-string">'test_additionalText'</span>,</li><li>        }</li><li>      }</li><li>    };</li><li>    <span class="hljs-variable">notificationManager</span>.<span class="hljs-title function_">publish</span>(<span class="hljs-variable">notificationRequest</span>, (<span class="hljs-variable">err</span>: <span class="hljs-title class_">BusinessError</span>) =&gt; {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable">err</span>) {</li><li>        <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable">DOMAIN_NUMBER</span>, <span class="hljs-variable">TAG</span>, `<span class="hljs-variable">Failed</span> <span class="hljs-variable">to</span> <span class="hljs-variable">publish</span> <span class="hljs-variable">notification</span>. <span class="hljs-variable">Code</span> <span class="hljs-keyword">is</span> ${<span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>}, <span class="hljs-variable">message</span> <span class="hljs-keyword">is</span> ${<span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>}`);</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable">DOMAIN_NUMBER</span>, <span class="hljs-variable">TAG</span>, <span class="hljs-string">'Succeeded in publishing notification.'</span>);</li><li>    });</li><li>  })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/Phone_Connection/blob/master/products/phone/src/main/ets/pages/NotifyPage.ets#L56-L77" target="_blank">NotifyPage.ets</a></div></div></div></div> <p></p></li></ol> <div class="tiledSection"><h3 id="section986045772310">手机与智能穿戴设备互联通信<i class="anchor-icon anchor-icon-link" anchorid="section986045772310" tips="复制节点链接"></i></h3><p>手机与智能穿戴设备的互联通信是智能穿戴设备的核心开发场景，开发者可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api" target="_blank">WearEngine</a>提供的标准化接口实现跨设备交互，具体开发流程如下：</p> <ol><li><span>通过wearEngine.getDeviceClient()获取Device模块的客户端用于获取连接设备。</span><p></p><div class="screenLinkPre"><div _ngcontent-kca-c106="" class="highlight-div"><div _ngcontent-kca-c106="" class="highlight-div-header"><div _ngcontent-kca-c106="" class="highlight-div-header-left"><div _ngcontent-kca-c106="" class="handle-button expand-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kca-c106="" class="highlight-div-header-right"><div _ngcontent-kca-c106="" class="handle-button ai-button"></div><div _ngcontent-kca-c106="" class="handle-button line-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kca-c106="" class="handle-button theme-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kca-c106="" class="handle-button copy-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kca-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/Phone_Connection/blob/master/commons/utils/src/main/ets/utils/ConnectUtil.ets#L35-L176" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConnectUtil</span> {</li><li>  <span class="hljs-comment">// Peer communication device entity class object</span></li><li>  <span class="hljs-variable">device</span>?: <span class="hljs-title class_">wearEngine</span>.<span class="hljs-title class_">Device</span>;</li><li>  <span class="hljs-comment">// Unique ID of the peer communication device.</span></li><li>  <span class="hljs-variable">deviceRandomId</span>?: <span class="hljs-title class_">string</span>;</li><li>  <span class="hljs-comment">// Used to obtain linked devices</span></li><li>  <span class="hljs-variable">deviceClient</span>?: <span class="hljs-title class_">wearEngine</span>.<span class="hljs-title class_">DeviceClient</span>;</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-variable">context</span>: <span class="hljs-title class_">Context</span>) {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">canIUse</span>(<span class="hljs-string">'SystemCapability.Health.WearEngine'</span>)) {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">deviceClient</span> = <span class="hljs-variable">wearEngine</span>.<span class="hljs-title function_">getDeviceClient</span>(<span class="hljs-variable">context</span>);</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/Phone_Connection/blob/master/commons/utils/src/main/ets/utils/ConnectUtil.ets#L35-L176" target="_blank">ConnectUtil.ets</a></div></div></div></div> <p></p></li><li><span>通过Device客户端获取当前已连接且支持wearEngine能力集的设备。</span><p></p><div class="screenLinkPre"><div _ngcontent-kca-c106="" class="highlight-div"><div _ngcontent-kca-c106="" class="highlight-div-header"><div _ngcontent-kca-c106="" class="highlight-div-header-left"><div _ngcontent-kca-c106="" class="handle-button expand-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kca-c106="" class="highlight-div-header-right"><div _ngcontent-kca-c106="" class="handle-button ai-button"></div><div _ngcontent-kca-c106="" class="handle-button line-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kca-c106="" class="handle-button theme-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kca-c106="" class="handle-button copy-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kca-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" codehub="https://gitee.com/harmonyos_samples/Phone_Connection/blob/master/commons/utils/src/main/ets/utils/ConnectUtil.ets#L69-L83" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Obtains the information about the peer device connected to the peer device</span></li><li><span class="hljs-comment">// and listens on the communication between the peer device and the peer device.</span></li><li><span class="hljs-function"><span class="hljs-keyword">async</span> <span class="hljs-title">getConnectedDevices</span>(): Promise&lt;<span class="hljs-keyword">void</span>&gt;</span> {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">if</span> (canIUse(<span class="hljs-string">'SystemCapability.Health.WearEngine'</span>)) {</li><li>      <span class="hljs-keyword">let</span> devices: wearEngine.Device[] = <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.deviceClient?.getConnectedDevices() <span class="hljs-keyword">as</span> wearEngine.Device[];</li><li>      <span class="hljs-keyword">this</span>.device = devices[<span class="hljs-number">0</span>];</li><li>      <span class="hljs-keyword">this</span>.deviceRandomId = devices[<span class="hljs-number">0</span>].randomId;</li><li>    }</li><li>    <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.registerMessageReceiver();</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    hilog.error(<span class="hljs-number">0x0000</span>, TAG, <span class="hljs-string">'getConnectedDevices is err'</span> + JSON.stringify(err));</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/Phone_Connection/blob/master/commons/utils/src/main/ets/utils/ConnectUtil.ets#L69-L83" target="_blank">ConnectUtil.ets</a></div></div></div></div> <p></p></li><li><span>通过获取P2P模块的客户端用于互联通信。</span><p></p><div class="screenLinkPre"><div _ngcontent-kca-c106="" class="highlight-div"><div _ngcontent-kca-c106="" class="highlight-div-header"><div _ngcontent-kca-c106="" class="highlight-div-header-left"><div _ngcontent-kca-c106="" class="handle-button expand-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kca-c106="" class="highlight-div-header-right"><div _ngcontent-kca-c106="" class="handle-button ai-button"></div><div _ngcontent-kca-c106="" class="handle-button line-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kca-c106="" class="handle-button theme-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kca-c106="" class="handle-button copy-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kca-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/Phone_Connection/blob/master/commons/utils/src/main/ets/utils/ConnectUtil.ets#L36-L175" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConnectUtil</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-comment">// Used to p2p</span></li><li>  <span class="hljs-variable">p2pClient</span>?: <span class="hljs-title class_">wearEngine</span>.<span class="hljs-title class_">P2pClient</span>;</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-variable">context</span>: <span class="hljs-title class_">Context</span>) {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">canIUse</span>(<span class="hljs-string">'SystemCapability.Health.WearEngine'</span>)) {</li><li>      <span class="hljs-comment">// ...</span></li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">p2pClient</span> = <span class="hljs-variable">wearEngine</span>.<span class="hljs-title function_">getP2pClient</span>(<span class="hljs-variable">context</span>);</li><li>    }</li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/Phone_Connection/blob/master/commons/utils/src/main/ets/utils/ConnectUtil.ets#L36-L175" target="_blank">ConnectUtil.ets</a></div></div></div></div> <p></p></li><li><span>订阅对端设备应用向本侧发送消息的事件。</span><p></p><div class="screenLinkPre"><div _ngcontent-kca-c106="" class="highlight-div"><div _ngcontent-kca-c106="" class="highlight-div-header"><div _ngcontent-kca-c106="" class="highlight-div-header-left"><div _ngcontent-kca-c106="" class="handle-button expand-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kca-c106="" class="highlight-div-header-right"><div _ngcontent-kca-c106="" class="handle-button ai-button"></div><div _ngcontent-kca-c106="" class="handle-button line-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kca-c106="" class="handle-button theme-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kca-c106="" class="handle-button copy-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kca-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" codehub="https://gitee.com/harmonyos_samples/Phone_Connection/blob/master/commons/utils/src/main/ets/utils/ConnectUtil.ets#L102-L138" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Callback Method for Listening to Peer Communication.</span></li><li><span class="hljs-keyword">private</span> onMsgCallback: Callback&lt;wearEngine.P2pMessage&gt; = (data: wearEngine.P2pMessage): <span class="hljs-keyword">void</span> =&gt; {</li><li>  <span class="hljs-comment">// Decodes the intercepted content into a character string.</span></li><li>  <span class="hljs-keyword">let</span> decoder: util.TextDecoder = util.TextDecoder.create();</li><li>  <span class="hljs-keyword">if</span> (canIUse(<span class="hljs-string">'SystemCapability.Health.WearEngine'</span>)) {</li><li>    <span class="hljs-keyword">let</span> str: <span class="hljs-built_in">string</span> = decoder.decodeToString(data.content);</li><li>    promptAction.openToast({</li><li>      message: <span class="hljs-string">'message: '</span> + str,</li><li>      duration: <span class="hljs-number">2000</span></li><li>    });</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// Listening to the communication between the peer end.</span></li><li><span class="hljs-function"><span class="hljs-keyword">async</span> <span class="hljs-title">registerMessageReceiver</span>(): Promise&lt;<span class="hljs-keyword">void</span>&gt;</span> {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">if</span> (canIUse(<span class="hljs-string">'SystemCapability.Health.WearEngine'</span>)) {</li><li>      <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.p2pClient?.registerMessageReceiver(<span class="hljs-keyword">this</span>.deviceRandomId, appParam, <span class="hljs-keyword">this</span>.onMsgCallback);</li><li>      hilog.info(<span class="hljs-number">0x0000</span>, TAG, <span class="hljs-string">'registerMessageReceiver is ok'</span>);</li><li>    }</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    hilog.error(<span class="hljs-number">0x0000</span>, TAG, <span class="hljs-string">'registerMessageReceiver is err '</span>, JSON.stringify(err));</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// Disabling the Interception of Peer Communication。</span></li><li><span class="hljs-function"><span class="hljs-keyword">async</span> <span class="hljs-title">unregisterMessageReceiver</span>(): Promise&lt;<span class="hljs-keyword">void</span>&gt;</span> {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">if</span> (canIUse(<span class="hljs-string">'SystemCapability.Health.WearEngine'</span>)) {</li><li>      <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.p2pClient?.unregisterMessageReceiver(<span class="hljs-keyword">this</span>.deviceRandomId, appParam, <span class="hljs-keyword">this</span>.onMsgCallback);</li><li>      hilog.info(<span class="hljs-number">0x0000</span>, TAG, <span class="hljs-string">'unregisterMessageReceiver is ok'</span>);</li><li>    }</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    hilog.error(<span class="hljs-number">0x0000</span>, TAG, <span class="hljs-string">'unregisterMessageReceiver is err '</span>, JSON.stringify(err));</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/Phone_Connection/blob/master/commons/utils/src/main/ets/utils/ConnectUtil.ets#L102-L138" target="_blank">ConnectUtil.ets</a></div></div></div></div> <p></p></li><li><span>向对端设备发送消息。</span><p></p><div class="screenLinkPre"><div _ngcontent-kca-c106="" class="highlight-div"><div _ngcontent-kca-c106="" class="highlight-div-header"><div _ngcontent-kca-c106="" class="highlight-div-header-left"><div _ngcontent-kca-c106="" class="handle-button expand-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kca-c106="" class="highlight-div-header-right"><div _ngcontent-kca-c106="" class="handle-button ai-button"></div><div _ngcontent-kca-c106="" class="handle-button line-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kca-c106="" class="handle-button theme-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kca-c106="" class="handle-button copy-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kca-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/Phone_Connection/blob/master/commons/utils/src/main/ets/utils/ConnectUtil.ets#L86-L98" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Method of sending messages to the peer end</span></li><li><span class="hljs-keyword">async</span> <span class="hljs-title function_">sendMessage</span>(<span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">p2pMessage</span>: wearEngine.<span class="hljs-property">P2pMessage</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getP2pMessage</span>(message);</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">canIUse</span>(<span class="hljs-string">'SystemCapability.Health.WearEngine'</span>)) {</li><li>      <span class="hljs-keyword">let</span> value = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">p2pClient</span>?.<span class="hljs-title function_">sendMessage</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">deviceRandomId</span>, appParam, p2pMessage);</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'sendMessage value is'</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(value))</li><li>    }</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'sys sendMessage is err '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/Phone_Connection/blob/master/commons/utils/src/main/ets/utils/ConnectUtil.ets#L86-L98" target="_blank">ConnectUtil.ets</a></div></div></div></div> <p></p></li></ol> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ul><li>使用WearEngine实现互联通信功能需要获取WearEngine权限，具体可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/wearengine_apply" target="_blank">申请接入Wear Engine服务</a>。</li><li>手机端与智能穿戴端应用实现与对端互连通信的原理一致，详细开发方案可参考<a href="https://gitee.com/harmonyos_samples/Phone_Connection" target="_blank">实现手机手表互联通信与手表心率监听</a>。</li></ul> </div></div></div> </div> <div class="tiledSection"><h3 id="section7617165395315">功耗管理优化<i class="anchor-icon anchor-icon-link" anchorid="section7617165395315" tips="复制节点链接"></i></h3><p>为提升智能穿戴设备续航能力并给用户带来更持久、更流畅的使用体验，可以采取以下措施：</p> <ul><li>显示优化配置<ol><li>默认启用深色主题模式降低显示能耗 。<p><span><img height="356.307" originheight="1786" originwidth="4000" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163320.78892341641769551577157203749692:50001231000000:2800:D7D8CB7B8DDCC58F51CA30035E82E8D07DA3316C3735DAEFF6357D601220603D.png" title="点击放大" width="798"></span></p> </li><li>仅允许视频、游戏、导航等必要场景保持屏幕常亮 。</li></ol> </li><li>后台应用管理<ol><li>关键服务类应用（闹钟、日程提醒、邮件、IM类应用）可依据实际需求启动。</li><li>除被前台应用拉起的情况外，闹钟、日程提醒、邮件、IM类应用按需自启，禁止非必要应用以任何形式自启动。</li></ol> </li><li>定位服务规范<ol><li>后台GPS仅对导航、运动健康等核心功能开放。</li><li>严禁非用户交互场景在后台调用定位服务。</li></ol> </li></ul> <p>若应用设计导航、视频等需要保持应用常亮，可以根据如下步骤实现：</p> <ol><li><span>设定应用屏幕常亮首先需要在EntryAbility获取window实例。</span><p></p><div class="screenLinkPre"><div _ngcontent-kca-c106="" class="highlight-div"><div _ngcontent-kca-c106="" class="highlight-div-header"><div _ngcontent-kca-c106="" class="highlight-div-header-left"><div _ngcontent-kca-c106="" class="handle-button expand-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kca-c106="" class="highlight-div-header-right"><div _ngcontent-kca-c106="" class="handle-button ai-button"></div><div _ngcontent-kca-c106="" class="handle-button line-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kca-c106="" class="handle-button theme-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kca-c106="" class="handle-button copy-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kca-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/SmartWatchMapNavigation/blob/master/products/wearable/src/main/ets/wearableability/WearableAbility.ets#L40-L86" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-variable">windowStage</span>: <span class="hljs-title class_">window</span>.<span class="hljs-title class_">WindowStage</span>): <span class="hljs-title class_">void</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">windowClass</span>: <span class="hljs-title class_">window</span>.<span class="hljs-title class_">Window</span> | <span class="hljs-title class_">undefined</span> = <span class="hljs-variable">undefined</span>;</li><li>  <span class="hljs-variable">window</span>.<span class="hljs-title function_">getLastWindow</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">context</span>, (<span class="hljs-variable">err</span>: <span class="hljs-title class_">BusinessError</span>, <span class="hljs-variable">data</span>: <span class="hljs-title class_">window</span>.<span class="hljs-title class_">Window</span>) =&gt; {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-variable">errCode</span>: <span class="hljs-title class_">number</span> = <span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>;</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">errCode</span>) {</li><li>      <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable">TAG</span>, <span class="hljs-string">'Failed to obtain the top window. Cause: '</span> + <span class="hljs-variable">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable">err</span>));</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable">windowClass</span> = <span class="hljs-variable">data</span>;</li><li>    <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable">TAG</span>, <span class="hljs-string">'Succeeded in obtaining the top window. Data: '</span> + <span class="hljs-variable">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable">data</span>));</li><li>    <span class="hljs-variable">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'windowClass'</span>, <span class="hljs-variable">windowClass</span>);</li><li>  });</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/SmartWatchMapNavigation/blob/master/products/wearable/src/main/ets/wearableability/WearableAbility.ets#L40-L86" target="_blank">WearableAbility.ets</a></div></div></div></div> <p></p></li><li><span>调用window的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setwindowkeepscreenon9" target="_blank">setWindowKeepScreenOn()</a>接口，设置屏幕常亮。详细的接口信息请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setwindowkeepscreenon9-1" target="_blank">窗口管理</a>。</span><p></p><div class="screenLinkPre"><div _ngcontent-kca-c106="" class="highlight-div"><div _ngcontent-kca-c106="" class="highlight-div-header"><div _ngcontent-kca-c106="" class="highlight-div-header-left"><div _ngcontent-kca-c106="" class="handle-button expand-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kca-c106="" class="highlight-div-header-right"><div _ngcontent-kca-c106="" class="handle-button ai-button"></div><div _ngcontent-kca-c106="" class="handle-button line-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kca-c106="" class="handle-button theme-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kca-c106="" class="handle-button copy-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kca-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/SmartWatchMapNavigation/blob/master/products/wearable/src/main/ets/view/NavigationPageView.ets#L37-L108" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Window object obtained from EntryAbility, which is used to ensure that the screen is steady on during navigation.</span></li><li><span class="hljs-meta">@StorageLink</span>(<span class="hljs-string">'windowClass'</span>) <span class="hljs-attr">windowClass</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">Window</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li><span class="hljs-comment">// ...</span></li><li>
</li><li><span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">windowClass</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowClass</span>.<span class="hljs-title function_">setWindowKeepScreenOn</span>(<span class="hljs-literal">true</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">const</span> <span class="hljs-attr">errCode</span>: <span class="hljs-built_in">number</span> = err.<span class="hljs-property">code</span>;</li><li>      <span class="hljs-keyword">if</span> (errCode) {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>,</li><li>          <span class="hljs-string">`Failed to set the screen to be always on. Cause code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'Succeeded in setting the screen to be always on.'</span>);</li><li>    });</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/SmartWatchMapNavigation/blob/master/products/wearable/src/main/ets/view/NavigationPageView.ets#L37-L108" target="_blank">NavigationPageView.ets</a></div></div></div></div> <p></p></li></ol> </div> <div class="tiledSection"><h2 id="section10795204419379">常见问题<i class="anchor-icon anchor-icon-link" anchorid="section10795204419379" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section881461015413" class="firsth2">同步/异步接口无法正常调用或功能异常<i class="anchor-icon anchor-icon-link" anchorid="section881461015413" tips="复制节点链接"></i></h3><p><strong>问题现象</strong></p> <p>迁移项目后，原项目中的同步/异步接口无法正常调用或功能异常。</p> <p><strong>解决方案</strong></p> <p>需要改写接口调用方式，以<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-huks#huksgeneratekeyitem9" target="_blank">huks.generateKeyItem()</a>接口为例，原项目中：</p> <div _ngcontent-kca-c106="" class="highlight-div"><div _ngcontent-kca-c106="" class="highlight-div-header"><div _ngcontent-kca-c106="" class="highlight-div-header-left"><div _ngcontent-kca-c106="" class="handle-button expand-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kca-c106="" class="highlight-div-header-right"><div _ngcontent-kca-c106="" class="handle-button ai-button"></div><div _ngcontent-kca-c106="" class="handle-button line-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kca-c106="" class="handle-button theme-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kca-c106="" class="handle-button copy-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kca-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li>huks.generateKeyItem(<span class="hljs-built_in">alias</span>, options, callback);</li></ol></pre></div></div> <p>迁移项目后，改写为：</p> <div _ngcontent-kca-c106="" class="highlight-div"><div _ngcontent-kca-c106="" class="highlight-div-header"><div _ngcontent-kca-c106="" class="highlight-div-header-left"><div _ngcontent-kca-c106="" class="handle-button expand-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kca-c106="" class="highlight-div-header-right"><div _ngcontent-kca-c106="" class="handle-button ai-button"></div><div _ngcontent-kca-c106="" class="handle-button line-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kca-c106="" class="handle-button theme-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kca-c106="" class="handle-button copy-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kca-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> huks.generateKeyItem(<span class="hljs-keyword">alias</span>, options);</li><li>  <span class="hljs-comment">// Result of successful processing.</span></li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-comment">// Capture and handle exceptions.</span></li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h3 id="section4963111216546">FA工程迁移后，无法与手机侧通信<i class="anchor-icon anchor-icon-link" anchorid="section4963111216546" tips="复制节点链接"></i></h3><p><strong>问题现象</strong></p> <p>完成项目迁移后，原项目有与手机侧通信交互的功能，但是新项目该功能无法使用。</p> <p><strong>问题原因</strong></p> <p>应用使用指纹信息来验证进行应用间的通信，迁移后应查询新应用的APP ID并在配置文件中更改值。</p> <p><strong>解决方案</strong></p> <p>通过"hdc shell bm dump –n YourBundleName | grep appIdentifier"获取穿戴侧应用的APP ID，在两侧应用的配置文件中更改fingerprint。</p> </div> <div class="tiledSection"><h3 id="section1748314426272">一多应用中如何区分智能穿戴设备<i class="anchor-icon anchor-icon-link" anchorid="section1748314426272" tips="复制节点链接"></i></h3></div> <p><strong>问题现象</strong></p> <p>智能穿戴设备与手机、平板等设备差异较大，在一多应用中如何区分智能穿戴设备与其他设备。</p> <p><strong>解决方案</strong></p> <p>可以通过在工程架构中创建单独的模块进行区分。在product层为智能穿戴单独创建HAP包独立开发。详情可以参考<a href="/consumer/cn/doc/best-practices/bpta-smartwatch#section1870515318482">包管理策略</a>。</p> <div class="tiledSection"><h3 id="section1247213533386">手表应用发布注意事项<i class="anchor-icon anchor-icon-link" anchorid="section1247213533386" tips="复制节点链接"></i></h3><p><strong>问题现象</strong></p> <p>手表应用在涉及到智能穿戴设备与轻量级智能穿戴设备时，应用发布的常见问题以及注意事项。</p> <ol><li>手表应用在发布时，仅可选择“手表”设备，无法对智能穿戴与轻量级智能穿戴做区分。<p><span><img height="312.83196" originheight="465" originwidth="863" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163320.43455291381503681676445678977768:50001231000000:2800:FA1B2C6EB5D08411E49C2C93C0750A026CD45A5199D6B67F5C1C7E2368898DB8.png" title="点击放大" width="577.5525"></span></p> </li><li>应用涉及两种穿戴设备时，应用发布是否需要上传两个对应的发布包。</li></ol> <p><strong>解决方案</strong></p> <ol><li>点击确认后跳转至发布页，可在发布页具体选择设备类型。<p><span><img height="357.20139329050676" originheight="510" originwidth="1323" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163320.49049581068963144892177210619193:50001231000000:2800:86E4EB2B735BD0657B6D8BF17D6B2262D518C59073E09E103DCE39CF6EEE0E14.png" title="点击放大" width="920"></span></p> </li><li>智能穿戴支持ArkTS与JS，轻量级智能穿戴仅支持JS，若应用发布包支持在智能穿戴与轻量级智能穿戴上运行，则无需对应用发布包做区分，若应用发布包仅支持某一种穿戴设备，则需要分别为智能穿戴设备与轻量级智能穿戴设备创建AppID，并上传其对应的发布包。</li><li>APP创建流程可参考<a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-create-app-0000002247955506" target="_blank">创建HarmonyOS应用</a>。</li></ol> </div> <div class="tiledSection"><h2 id="section1219382121110">附：FA工程迁移指导<i class="anchor-icon anchor-icon-link" anchorid="section1219382121110" tips="复制节点链接"></i></h2></div> <p>智能穿戴设备兼容FA模型，本章节提供了如何将使用JS构建的<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-lite-wearable-guide" target="_blank">轻量级智能穿戴</a>项目迁移到智能穿戴设备上继续使用，实现功能的延续与适配。</p> <p>以<a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/tree/master/LiteWearable" target="_blank">轻量级智能穿戴开发实践同源工程</a>为例，按照如下步骤，可以将使用JS构建的项目迁移到智能穿戴设备上：</p> <ol><li><span>使用DevEco Studio创建项目。</span><p></p><p><span><img height="534.9659" originheight="655" originwidth="980" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163320.38363675282381987677496185712031:50001231000000:2800:E04401F94EDDE8D56F54DC69185644C1DDC35D4C637DDE614166131F015AA468.png" title="点击放大" width="798"></span></p> <p><span><img height="533.3566" originheight="655" originwidth="980" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163320.60891618905618127681054058741017:50001231000000:2800:775B086A117DD4470BEBA3CEC39B8960FD777384011BC7AA2AE0848DF75200B3.png" title="点击放大" width="798"></span></p> <p>工程名目录右键选择“New”-&gt;“Module”创建模块。</p> <p><span><img height="182.6622" originheight="293" originwidth="1280" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163320.90686720037933323701451045424034:50001231000000:2800:24582BC3DF29D2B1112C2BDF783041DF1F43253BE8C365C1DABEAF8E5AF34743.png" title="点击放大" width="798"></span></p> <p>选择“Empty Ability”，点击“Next”进入下一步。</p> <p><span><img height="533.3566" originheight="655" originwidth="980" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163320.12015335015247271047678934827660:50001231000000:2800:7A0EA9513364F2BF7E86DF08C62D3636D2E08A8ED8DB656D53C2330302F24FC9.png" title="点击放大" width="798"></span></p> <p>默认配置无需修改，点击“Next”进入下一步。</p> <p><span><img height="533.3566" originheight="655" originwidth="980" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163320.37804543793604514656296350699569:50001231000000:2800:54BE2587301720FA70ECE62E868F6C8C506A7880382ACDA6D4AA60E37853CCB9.png" title="点击放大" width="798"></span></p> <p>为了兼容智能穿戴，需要修改Ability name为“HiWearMainAbility”。点击“Finish”完成智能穿戴兼容模块创建。</p> <p><span><img height="533.3566" originheight="655" originwidth="980" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163320.29829620564039134905191909850012:50001231000000:2800:1AA5B3EACD06561E10A17E80DFE1037A6FCB5E4498395DFB12501249C6E129D9.png" title="点击放大" width="798"></span></p> <p>删除工程默认创建的entry模块，此时实现轻量级智能穿戴项目迁移的基础框架创建完成。</p> <p><span><img height="478.29460000000006" originheight="766" originwidth="1278" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163320.54244140379816430497436493423480:50001231000000:2800:0EE859C3A20E817AE9A9ADEBEDF540EECA0E10401D100C3BBC6C09BCB9929F38.png" title="点击放大" width="798"></span></p> <p></p></li><li><span>将原轻量级智能穿戴项目/entry/src/main/js目录下的代码文件及资源文件按对应位置迁移至新工程。</span><p></p><p><span><img height="608.9272" originheight="905" originwidth="1186" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163321.63317783549910508445708368765650:50001231000000:2800:1EDDDF2F01A6E62E56237AC5D76FFDFC0B67B548A3F0ECB089EF2F761031AAA3.png" title="点击放大" width="798"></span></p> <p></p></li><li><span>修改适配智能穿戴所需的配置文件。</span><p></p><p>迁移的文件后需要修改config.json。修改资源文件的引用；pages目录下如果有新页面文件需添加至config.json；修改页面设计基线宽度为466。</p> <p><span><img height="728.0686" originheight="1166" originwidth="1278" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163321.67393218916494443102036350706321:50001231000000:2800:429DE7F1C05272BB494A19CEB0FE695D6D12CF2583379D68B7BF527DD2097532.png" title="点击放大" width="798"></span></p> <p>config.json文件中补充所需的权限。如果原项目中使用了震动功能，需添加震动权限。</p> <p><span><img height="571.1552" originheight="914" originwidth="1277" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163321.21946011128235806786982423142216:50001231000000:2800:B4DFEE5A86DCB04CD69172A75B9E528EDAFAB7792D24618218AA4B9A82D8B006.png" title="点击放大" width="798"></span></p> <p></p></li><li><span>代码适配。由于轻量级智能穿戴和智能穿戴的同步/异步机制不同，因此在迁移时时，需要对相关接口进行修改。以Huks接口为例，说明如何进行这些修改。</span><p></p><div _ngcontent-kca-c106="" class="highlight-div"><div _ngcontent-kca-c106="" class="highlight-div-header"><div _ngcontent-kca-c106="" class="highlight-div-header-left"><div _ngcontent-kca-c106="" class="handle-button expand-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kca-c106="" class="highlight-div-header-right"><div _ngcontent-kca-c106="" class="handle-button ai-button"></div><div _ngcontent-kca-c106="" class="handle-button line-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kca-c106="" class="handle-button theme-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kca-c106="" class="handle-button copy-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kca-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li>huks.generateKeyItem(<span class="hljs-built_in">alias</span>, options, callback);</li></ol></pre></div></div> <p>在轻量级智能穿戴设备上，回调将同步执行。但在智能穿戴设备上是异步的，因此需要更改书写样式增加await，保证代码同轻量级智能穿戴设备一样同步执行，代码如下所示：</p> <div _ngcontent-kca-c106="" class="highlight-div"><div _ngcontent-kca-c106="" class="highlight-div-header"><div _ngcontent-kca-c106="" class="highlight-div-header-left"><div _ngcontent-kca-c106="" class="handle-button expand-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kca-c106="" class="highlight-div-header-right"><div _ngcontent-kca-c106="" class="handle-button ai-button"></div><div _ngcontent-kca-c106="" class="handle-button line-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kca-c106="" class="handle-button theme-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kca-c106="" class="handle-button copy-button"><div _ngcontent-kca-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kca-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> huks.generateKeyItem(<span class="hljs-keyword">alias</span>, options);</li><li>  <span class="hljs-comment">// Result of successful processing.</span></li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-comment">// Capture and handle exceptions.</span></li><li>}</li></ol></pre></div></div> <p></p></li></ol> </div> <div></div></div>