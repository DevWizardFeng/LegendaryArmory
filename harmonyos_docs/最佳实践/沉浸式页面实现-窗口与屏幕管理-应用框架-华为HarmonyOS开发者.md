<h1 _ngcontent-uuw-c119="" class="doc-title ng-star-inserted" title="沉浸式页面实现"> 沉浸式页面实现 </h1>

<div _ngcontent-uuw-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section1777254815915">概述<i class="anchor-icon anchor-icon-link" anchorid="section1777254815915" tips="复制节点链接"></i></h2><p>沉浸式模式通常指让应用的界面更加专注于内容，不希望用户被无关元素干扰。在移动端应用中，全屏窗口元素包括状态栏、应用界面和导航栏（如下图），沉浸式页面开发常通过将应用页面延伸到状态栏和导航栏的方式，来达到以下目的：</p> <ul><li>使页面和避让区域的色调统一，为用户提供更好的视觉体验。</li><li>最大程度利用屏幕可视区域，使页面获得更大的布局空间。</li><li>提供完全沉浸的体验，让用户沉浸其中，不被其他事物所干扰。</li></ul> <p>本文将介绍沉浸式页面的实现方案、原理以及提供以下常见沉浸式页面开发场景下一些适配问题的解决方案。</p> <ul><li><a href="/consumer/cn/doc/best-practices/bpta-immersive#section199711126181118">顶部或底部背景延伸场景</a></li><li><a href="/consumer/cn/doc/best-practices/bpta-immersive#section391124571116">顶部图片延伸场景</a></li><li><a href="/consumer/cn/doc/best-practices/bpta-immersive#section19529135371110">滚动列表底部延伸场景</a></li><li><a href="/consumer/cn/doc/best-practices/bpta-immersive#section584841611122">全屏沉浸式场景</a></li><li><a href="/consumer/cn/doc/best-practices/bpta-immersive#section106421629151215">挖孔区避让场景</a></li><li><a href="/consumer/cn/doc/best-practices/bpta-immersive#section15457154011128">深色背景下状态栏颜色适配场景</a></li></ul> <p><span><img height="555.610559" originheight="2925" originwidth="2270" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163011.05912479175756028567218119677812:50001231000000:2800:D0CC2705B82080C31C17AA6414E6E5D6E4AC5BFCCC5F21789815B2B3B3E6C65A.png" title="点击放大" width="432.011265"></span></p> </div> <div class="tiledSection"><h2 id="section1148712550918">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section1148712550918" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section126941741123410" class="firsth2">关键技术<i class="anchor-icon anchor-icon-link" anchorid="section126941741123410" tips="复制节点链接"></i></h3><p>沉浸式页面开发通常分为以下两步：</p> <ol><li>实现沉浸式效果。<ul><li>方案一：使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setwindowlayoutfullscreen9" target="_blank">Window.setWindowLayoutFullScreen()</a>方法设置窗口为全屏模式。</li><li>方案二：设置组件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-expand-safe-area#expandsafearea" target="_blank">expandSafeArea</a>属性，扩展组件的安全区域到状态栏和导航栏，从而实现沉浸式。</li></ul> </li><li>处理避让区域和页面内容的适配问题。<p>由于避让区本身是有内容展示，如状态栏中的电量、时间等系统信息，或是手势交互，如导航条点击或上滑，在实现应用页面沉浸式效果后，往往会和避让区域产生UI元素的遮挡、视觉上的违和或交互上的冲突等问题，开发者可以针对不同场景选择以下方式对避让区和应用页面进行适配。</p> <ul><li>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setwindowsystembarenable9" target="_blank">Window.setWindowSystemBarEnable()</a>方法或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setspecificsystembarenabled11" target="_blank">Window.setSpecificSystemBarEnabled()</a>方法设置状态栏和导航栏的显隐。</li><li>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setwindowsystembarproperties9" target="_blank">Window.setWindowSystemBarProperties()</a>方法设置状态栏和导航栏的样式。</li><li>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#getwindowavoidarea9" target="_blank">Window.getWindowAvoidArea()</a>方法获取避让区域的高度，据此设置应用页面内容的上下padding实现避让状态栏和导航栏。</li><li>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-display#getcutoutinfo9-1" target="_blank">Display.getCutoutInfo()</a>方法获取挖孔区域宽高和位置信息，设置对应避让元素的margin实现挖孔区避让。</li></ul> </li></ol> </div> <div class="tiledSection"><h3 id="section1052895593418">实现沉浸式效果方案对比<i class="anchor-icon anchor-icon-link" anchorid="section1052895593418" tips="复制节点链接"></i></h3><p>一般来说，整个应用（所有页面）都需要沉浸式效果，可以选择设置窗口全屏方案统一实现，针对具体页面的避让场景设置padding；单个页面或者仅需要将背景延伸到状态栏和导航栏，页面内容（子组件）希望避让状态栏和导航栏，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-expand-safe-area#expandsafearea" target="_blank">expandSafeArea</a>属性扩展对应组件安全区域来实现沉浸式效果更为方便。以下对两种方案的差异进行详细的说明。</p> <ul><li>方案一：设置窗口全屏模式<ul><li>页面的所有组件布局范围从安全区域扩展为整个窗口（包括状态栏和导航栏），见下图。</li><li>页面内容需根据状态栏和导航栏高度合理避让处理。</li></ul> </li><li>方案二：扩展组件安全区域<ul><li>该属性只将当前组件延伸到状态栏和导航栏，不影响其他组件的布局范围，其他组件仍在安全区域内进行布局，见下图。</li><li>由于其他组件在安全区域内进行布局，无需进行额外的避让处理。</li><li>该属性有一定使用限制，详见<a href="/consumer/cn/doc/best-practices/bpta-immersive#section5694443101520">expandSafeArea属性限制</a>。</li></ul> </li></ul>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.4.4.1.4.1.1" valign="top" width="31.36%"><p>原始布局</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.4.1.4.1.2" valign="top" width="37.68%"><p>方案一：设置窗口全屏模式布局</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.4.1.4.1.3" valign="top" width="30.959999999999997%"><p>方案二：扩展组件安全区域布局</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="31.36%"><p><span><img height="387.4780939888179" originheight="1214" originwidth="818" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163011.33259687233188123858545793593613:50001231000000:2800:00AC983545A86764684F9733439E9464BDB70F21326E3E0B09A006E85904C617.png" title="点击放大" width="264.512"></span></p> </td> <td class="cellrowborder" valign="top" width="37.68%"><p><span><img height="406.7110419384642" originheight="1223" originwidth="960" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163011.05404805673737556897711946507195:50001231000000:2800:1E15360533F82C99B8F4307F7F5EEEAEEC622BED385D2A0BAE5933381D648A89.png" title="点击放大" width="322.656"></span></p> </td> <td class="cellrowborder" valign="top" width="30.959999999999997%"><p><span><img height="387.0813829941275" originheight="1217" originwidth="810" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163011.02475743301975184496931691406598:50001231000000:2800:E06D5920DAE5EE29B5E1FF6598464FBCC47E1E49E516045E1F152D6321874844.png" title="点击放大" width="260.832"></span></p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section199711126181118">顶部或底部背景延伸场景<i class="anchor-icon anchor-icon-link" anchorid="section199711126181118" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section14471124914161" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section14471124914161" tips="复制节点链接"></i></h3><p>页面背景需要延伸到状态栏和导航条区域，页面内容在安全区展示。</p> <p><span><img height="547.1487" originheight="2258" originwidth="1093" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163011.67361632394948928362138950364659:50001231000000:2800:E2A67719C78D3159E108E28F6336795324E6B9623DDBA98EB0F2CCE24F87B4ED.png" title="点击放大" width="266"></span></p> </div> <div class="tiledSection"><h3 id="section13863585160">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section13863585160" tips="复制节点链接"></i></h3><ul><li>方案一：使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-expand-safe-area#expandsafearea" target="_blank">expandSafeArea</a>属性扩展背景组件安全区域。<p>给设置背景色的组件设置expandSafeArea([SafeAreaType.SYSTEM], [SafeAreaEdge.TOP, SafeAreaEdge.BOTTOM])，使背景色延伸到状态栏和导航条。由于<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-expand-safe-area#expandsafearea" target="_blank">expandSafeArea</a>属性不影响子组件的布局，所以Tabs组件内的内容默认在安全区域布局，避让状态栏和导航条。</p> <div class="screenLinkPre"><div _ngcontent-uuw-c106="" class="highlight-div"><div _ngcontent-uuw-c106="" class="highlight-div-header"><div _ngcontent-uuw-c106="" class="highlight-div-header-left"><div _ngcontent-uuw-c106="" class="handle-button expand-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uuw-c106="" class="highlight-div-header-right"><div _ngcontent-uuw-c106="" class="handle-button ai-button"></div><div _ngcontent-uuw-c106="" class="handle-button line-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uuw-c106="" class="handle-button theme-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uuw-c106="" class="handle-button copy-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uuw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" codehub="https://gitee.com/harmonyos_samples/Immersive/blob/master/features/shopping/src/main/ets/views/Index.ets#L49-L63" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// features/shopping/src/main/ets/views/Index.ets</span></li><li><span class="hljs-selector-tag">Tabs</span>({ barPosition: BarPosition.End }) {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>.<span class="hljs-built_in">backgroundColor</span>(<span class="hljs-string">'#F1F3F5'</span>)</li><li>.<span class="hljs-built_in">expandSafeArea</span>([SafeAreaType.SYSTEM], [SafeAreaEdge.TOP, SafeAreaEdge.BOTTOM])</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/Immersive/blob/master/features/shopping/src/main/ets/views/Index.ets#L49-L63" target="_blank">Index.ets</a></div></div></div></div> </li><li>方案二：使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setwindowlayoutfullscreen9" target="_blank">Window.setWindowLayoutFullScreen()</a>方法设置窗口全屏模式。<ol><li>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setwindowlayoutfullscreen9" target="_blank">Window.setWindowLayoutFullScreen()</a>方法设置窗口全屏模式。通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#getwindowavoidarea9" target="_blank">Window.getWindowAvoidArea()</a>方法获取状态栏和导航栏高度，并用状态变量avoidArea记录。使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#onavoidareachange9" target="_blank">avoidAreaChange</a>事件监听避让区域的变化，变化时更新状态变量avoidArea。<div class="screenLinkPre"><div _ngcontent-uuw-c106="" class="highlight-div"><div _ngcontent-uuw-c106="" class="highlight-div-header"><div _ngcontent-uuw-c106="" class="highlight-div-header-left"><div _ngcontent-uuw-c106="" class="handle-button expand-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uuw-c106="" class="highlight-div-header-right"><div _ngcontent-uuw-c106="" class="handle-button ai-button"></div><div _ngcontent-uuw-c106="" class="handle-button line-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uuw-c106="" class="handle-button theme-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uuw-c106="" class="handle-button copy-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uuw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/Immersive/blob/master/features/shopping/src/main/ets/views/ShoppingFullScreen.ets#L33-L66" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// features/shopping/src/main/ets/views/ShoppingFullScreen.ets</span></li><li>context = <span class="hljs-keyword">this</span>.getUIContext()?.getHostContext() <span class="hljs-keyword">as</span> common.UIAbilityContext;</li><li><span class="hljs-keyword">private</span> windowClass = <span class="hljs-keyword">this</span>.context.windowStage.getMainWindowSync();</li><li><span class="hljs-meta">@State</span> avoidArea: AvoidArea = { topRectHeight: <span class="hljs-number">0</span>, bottomRectHeight: <span class="hljs-number">0</span> };</li><li>
</li><li>onShown() {</li><li>  <span class="hljs-keyword">this</span>.windowClass.setWindowLayoutFullScreen(<span class="hljs-literal">true</span>);</li><li>  <span class="hljs-keyword">this</span>.setAvoidArea()</li><li>  <span class="hljs-keyword">this</span>.windowClass.on(<span class="hljs-string">'avoidAreaChange'</span>, <span class="hljs-keyword">this</span>.onAvoidAreaChange)</li><li>}</li><li>
</li><li><span class="hljs-comment">// ...</span></li><li>
</li><li>setAvoidArea() {</li><li>  <span class="hljs-comment">// status bar area</span></li><li>  <span class="hljs-keyword">const</span> statusBarArea = <span class="hljs-keyword">this</span>.windowClass.getWindowAvoidArea(statusBarType);</li><li>  <span class="hljs-keyword">this</span>.avoidArea.topRectHeight = statusBarArea.topRect.height;</li><li>  <span class="hljs-comment">// navigation bar area</span></li><li>  <span class="hljs-keyword">const</span> navBarArea = <span class="hljs-keyword">this</span>.windowClass.getWindowAvoidArea(navBarType);</li><li>  <span class="hljs-keyword">this</span>.avoidArea.bottomRectHeight = navBarArea.bottomRect.height;</li><li>}</li><li>
</li><li>onAvoidAreaChange = (<span class="hljs-keyword">data</span>: window.AvoidAreaOptions) =&gt; {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">data</span>.type === statusBarType) {</li><li>    <span class="hljs-keyword">this</span>.avoidArea.topRectHeight = <span class="hljs-keyword">data</span>.area.topRect.height;</li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">data</span>.type === navBarType) {</li><li>    <span class="hljs-keyword">this</span>.avoidArea.bottomRectHeight = <span class="hljs-keyword">data</span>.area.bottomRect.height;</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/Immersive/blob/master/features/shopping/src/main/ets/views/ShoppingFullScreen.ets#L33-L66" target="_blank">ShoppingFullScreen.ets</a></div></div></div></div> </li><li>给Tabs组件设置上下padding分别为状态栏和导航栏的高度，让内容避让状态栏和导航条，仅在安全区域显示。<div class="screenLinkPre"><div _ngcontent-uuw-c106="" class="highlight-div"><div _ngcontent-uuw-c106="" class="highlight-div-header"><div _ngcontent-uuw-c106="" class="highlight-div-header-left"><div _ngcontent-uuw-c106="" class="handle-button expand-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uuw-c106="" class="highlight-div-header-right"><div _ngcontent-uuw-c106="" class="handle-button ai-button"></div><div _ngcontent-uuw-c106="" class="handle-button line-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uuw-c106="" class="handle-button theme-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uuw-c106="" class="handle-button copy-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uuw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/Immersive/blob/master/features/shopping/src/main/ets/views/ShoppingFullScreen.ets#L95-L112" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// features/shopping/src/main/ets/views/ShoppingFullScreen.ets</span></li><li><span class="hljs-title function_">Tabs</span>({ <span class="hljs-variable">barPosition</span>: <span class="hljs-title class_">BarPosition</span>.<span class="hljs-title class_">End</span> }) {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#F1F3F5'</span>)</li><li>.<span class="hljs-title function_">padding</span>({</li><li>  <span class="hljs-variable">top</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">avoidArea</span>.<span class="hljs-title class_">topRectHeight</span> + <span class="hljs-string">'px'</span>,</li><li>  <span class="hljs-variable">bottom</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">avoidArea</span>.<span class="hljs-title class_">bottomRectHeight</span> + <span class="hljs-string">'px'</span></li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/Immersive/blob/master/features/shopping/src/main/ets/views/ShoppingFullScreen.ets#L95-L112" target="_blank">ShoppingFullScreen.ets</a></div></div></div></div> </li></ol> </li></ul> </div> <div class="tiledSection"><h2 id="section391124571116">顶部图片延伸场景<i class="anchor-icon anchor-icon-link" anchorid="section391124571116" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section49553711711" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section49553711711" tips="复制节点链接"></i></h3><p>页面顶部的图片要延伸到状态栏中去，形成沉浸式效果。顶部的返回按钮等交互组件，要合理避让状态栏。</p> <p><span><img height="546.7763" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163011.16338034622677563472054262724553:50001231000000:2800:8803C5D07C84AE26ED20BFFF8BF9B40E482B6A25CD1876D9A58224430924B0C7.gif" title="点击放大" width="266"></span></p> </div> <div class="tiledSection"><h3 id="section86747120174">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section86747120174" tips="复制节点链接"></i></h3><ol><li>设置图片expandSafeArea([SafeAreaType.SYSTEM], [SafeAreaEdge.TOP])，扩展图片上方的安全区域。由于<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-expand-safe-area#expandsafearea" target="_blank">expandSafeArea</a>属性不影响兄弟组件的布局，顶部的按钮区域默认避让状态栏。</li><li>设置Swiper组件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-sharp-clipping#clip12" target="_blank">clip</a>属性为false，不裁剪内部组件。在设置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-expand-safe-area#expandsafearea" target="_blank">expandSafeArea</a>属性的组件的父组件是滚动类容器时，需配合<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-sharp-clipping#clip12" target="_blank">clip</a>属性使用。</li></ol> <div class="screenLinkPre"><div _ngcontent-uuw-c106="" class="highlight-div"><div _ngcontent-uuw-c106="" class="highlight-div-header"><div _ngcontent-uuw-c106="" class="highlight-div-header-left"><div _ngcontent-uuw-c106="" class="handle-button expand-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uuw-c106="" class="highlight-div-header-right"><div _ngcontent-uuw-c106="" class="handle-button ai-button"></div><div _ngcontent-uuw-c106="" class="handle-button line-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uuw-c106="" class="handle-button theme-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uuw-c106="" class="handle-button copy-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uuw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/Immersive/blob/master/features/shopping/src/main/ets/views/detail/Banner.ets#L32-L41" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// features/shopping/src/main/ets/views/detail/Banner.ets</span></li><li><span class="hljs-title class_">Swiper</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">swiperController</span>) {</li><li>  <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable constant_">BANNER_IMAGES</span>, <span class="hljs-function">(<span class="hljs-params">image: Resource</span>) =&gt;</span> {</li><li>    <span class="hljs-title class_">Image</span>(image)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">expandSafeArea</span>([<span class="hljs-title class_">SafeAreaType</span>.<span class="hljs-property">SYSTEM</span>], [<span class="hljs-title class_">SafeAreaEdge</span>.<span class="hljs-property">TOP</span>])</li><li>  }, <span class="hljs-function">(<span class="hljs-params">image: Resource</span>) =&gt;</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(image))</li><li>}</li><li>.<span class="hljs-title function_">clip</span>(<span class="hljs-literal">false</span>)</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/Immersive/blob/master/features/shopping/src/main/ets/views/detail/Banner.ets#L32-L41" target="_blank">Banner.ets</a></div></div></div></div> </div> <div class="tiledSection"><h2 id="section19529135371110">滚动列表底部延伸场景<i class="anchor-icon anchor-icon-link" anchorid="section19529135371110" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section6941182316173" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section6941182316173" tips="复制节点链接"></i></h3><p>在列表滚动场景中，滚动时内容可与导航条区域重合，滚动到底部时，底部内容需避让导航条。</p> <p><span><img height="546.7763" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163012.74622944614715117878316217215739:50001231000000:2800:22B5E9E2A8FBB5B2C62369186BCC2493A3FF06D49DB295B0DB3388AF2F5231F2.gif" title="点击放大" width="266"></span></p> </div> <div class="tiledSection"><h3 id="section13471029181718">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section13471029181718" tips="复制节点链接"></i></h3><ol><li>设置列表组件ListexpandSafeArea([SafeAreaType.SYSTEM], [SafeAreaEdge.BOTTOM])，扩展列表底部到安全区域。此时List组件显示区域扩大，滚动时列表内容可在导航条区域显示。<div class="screenLinkPre"><div _ngcontent-uuw-c106="" class="highlight-div"><div _ngcontent-uuw-c106="" class="highlight-div-header"><div _ngcontent-uuw-c106="" class="highlight-div-header-left"><div _ngcontent-uuw-c106="" class="handle-button expand-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uuw-c106="" class="highlight-div-header-right"><div _ngcontent-uuw-c106="" class="handle-button ai-button"></div><div _ngcontent-uuw-c106="" class="handle-button line-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uuw-c106="" class="handle-button theme-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uuw-c106="" class="handle-button copy-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uuw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/Immersive/blob/master/features/shopping/src/main/ets/views/detail/FaqList.ets#L83-L105" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// features/shopping/src/main/ets/views/detail/FaqList.ets</span></li><li><span class="hljs-built_in">List</span>() {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li><span class="hljs-selector-class">.layoutWeight</span>(<span class="hljs-number">1</span>)</li><li><span class="hljs-selector-class">.scrollBar</span>(BarState.Off)</li><li><span class="hljs-selector-class">.expandSafeArea</span>([SafeAreaType.SYSTEM], [SafeAreaEdge.BOTTOM])</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/Immersive/blob/master/features/shopping/src/main/ets/views/detail/FaqList.ets#L83-L105" target="_blank">FaqList.ets</a></div></div></div></div> </li><li>将滚动到底部的提示添加在列表项末尾，由于设置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-expand-safe-area#expandsafearea" target="_blank">expandSafeArea</a>属性不影响子组件的布局，所以滚动到底部时提示文字默认会避让导航条。<div class="screenLinkPre"><div _ngcontent-uuw-c106="" class="highlight-div"><div _ngcontent-uuw-c106="" class="highlight-div-header"><div _ngcontent-uuw-c106="" class="highlight-div-header-left"><div _ngcontent-uuw-c106="" class="handle-button expand-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uuw-c106="" class="highlight-div-header-right"><div _ngcontent-uuw-c106="" class="handle-button ai-button"></div><div _ngcontent-uuw-c106="" class="handle-button line-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uuw-c106="" class="handle-button theme-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uuw-c106="" class="handle-button copy-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uuw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/Immersive/blob/master/features/shopping/src/main/ets/views/detail/FaqList.ets#L87-L99" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// features/shopping/src/main/ets/views/detail/FaqList.ets</span></li><li><span class="hljs-title class_">ForEach</span>(<span class="hljs-title function_">getFaqData</span>(), <span class="hljs-function">(<span class="hljs-params">faq: Faq</span>) =&gt;</span> {</li><li>  <span class="hljs-title class_">ListItem</span>() {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title class_">FaqItem</span>(faq)</li><li>  }</li><li>}, <span class="hljs-function">(<span class="hljs-params">faq: Faq</span>) =&gt;</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(faq))</li><li><span class="hljs-title class_">ListItem</span>() {</li><li>  <span class="hljs-title class_">Text</span>($r(<span class="hljs-string">'app.string.faq_list_all'</span>))</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>    .<span class="hljs-title function_">opacity</span>(<span class="hljs-number">0.6</span>)</li><li>    .<span class="hljs-title function_">padding</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">10</span> })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/Immersive/blob/master/features/shopping/src/main/ets/views/detail/FaqList.ets#L87-L99" target="_blank">FaqList.ets</a></div></div></div></div> </li></ol> </div> <div class="tiledSection"><h2 id="section584841611122">全屏沉浸式场景<i class="anchor-icon anchor-icon-link" anchorid="section584841611122" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section13573133181714" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section13573133181714" tips="复制节点链接"></i></h3><p>在一些视频播放或游戏类的沉浸式页面中，为了更好的观看或操作体验，往往需要隐藏状态栏和导航栏。</p> <p><span><img height="546.7497" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163012.65559443363880125978164635680539:50001231000000:2800:C9EC0F830FAC6B13A9887308D35FF561206A573941257EABC8EBA096393F5EB1.gif" title="点击放大" width="266"></span></p> </div> <div class="tiledSection"><h3 id="section813019373176">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section813019373176" tips="复制节点链接"></i></h3><p>在页面显示或隐藏时，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setwindowlayoutfullscreen9" target="_blank">Window.setWindowLayoutFullScreen()</a>方法设置窗口是否为全屏模式，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setwindowsystembarenable9" target="_blank">Window.setWindowSystemBarEnable()</a>方法设置状态栏和导航条显隐。</p> <div class="screenLinkPre"><div _ngcontent-uuw-c106="" class="highlight-div"><div _ngcontent-uuw-c106="" class="highlight-div-header"><div _ngcontent-uuw-c106="" class="highlight-div-header-left"><div _ngcontent-uuw-c106="" class="handle-button expand-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uuw-c106="" class="highlight-div-header-right"><div _ngcontent-uuw-c106="" class="handle-button ai-button"></div><div _ngcontent-uuw-c106="" class="handle-button line-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uuw-c106="" class="handle-button theme-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uuw-c106="" class="handle-button copy-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uuw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/Immersive/blob/master/products/default/src/main/ets/pages/VideoPlayer.ets#L22-L61" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// products/default/src/main/ets/pages/VideoPlayer.ets</span></li><li>context = <span class="hljs-keyword">this</span>.getUIContext()?.getHostContext() <span class="hljs-keyword">as</span> common.UIAbilityContext;</li><li><span class="hljs-keyword">private</span> windowClass = <span class="hljs-keyword">this</span>.context.windowStage.getMainWindowSync();</li><li><span class="hljs-comment">// ...</span></li><li>
</li><li>onShown() {</li><li>  <span class="hljs-keyword">this</span>.windowClass.setWindowLayoutFullScreen(<span class="hljs-literal">true</span>);</li><li>  <span class="hljs-keyword">this</span>.windowClass.setWindowSystemBarEnable([]);</li><li>}</li><li>
</li><li>onHidden() {</li><li>  <span class="hljs-keyword">this</span>.windowClass.setWindowLayoutFullScreen(<span class="hljs-literal">false</span>);</li><li>  <span class="hljs-keyword">this</span>.windowClass.setWindowSystemBarEnable([<span class="hljs-string">'status'</span>, <span class="hljs-string">'navigation'</span>]);</li><li>}</li><li>
</li><li>build() {</li><li>  NavDestination() {</li><li>    Column() {</li><li>      Video({ src: $rawfile(<span class="hljs-string">'video.mp4'</span>) })</li><li>        <span class="hljs-comment">// ...</span></li><li>    }</li><li>    .height(<span class="hljs-string">'100%'</span>)</li><li>    .width(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>  .hideTitleBar(<span class="hljs-literal">true</span>)</li><li>  .onShown(() =&gt; <span class="hljs-keyword">this</span>.onShown())</li><li>  .onHidden(() =&gt; <span class="hljs-keyword">this</span>.onHidden())</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/Immersive/blob/master/products/default/src/main/ets/pages/VideoPlayer.ets#L22-L61" target="_blank">VideoPlayer.ets</a></div></div></div></div> </div> <div class="tiledSection"><h2 id="section106421629151215">挖孔区避让场景<i class="anchor-icon anchor-icon-link" anchorid="section106421629151215" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section6866614171618" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section6866614171618" tips="复制节点链接"></i></h3><p>在一些需要最大程度利用屏幕可视区域的场景，需要在状态栏显示一些重要信息或操作按钮时，不仅需要隐藏原始的状态栏和导航栏，还需要针对不同挖孔区域的信息进行避让。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.18.3.1.3.1.1" valign="top" width="34.81%"><p>挖孔区域在中间（Mate 60 Pro）</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.18.3.1.3.1.2" valign="top" width="65.19%"><p>挖孔区域在侧边（Mate X5）</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="34.81%"><p><span><img height="595.84" originheight="2523" originwidth="1126" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163012.20002978927148460573104927709147:50001231000000:2800:FF0D0A35FACF015F7AB143A2B9B9BB05EE0EC4F15DB28D9A66F954ED9F3C8247.png" title="点击放大" width="266"></span></p> </td> <td class="cellrowborder" valign="top" width="65.19%"><p><span><img height="595.84" originheight="2475" originwidth="2221" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163012.51587044944443233674857132418973:50001231000000:2800:B368C742445A4F14D9912B516E7EA3D4EB3F4D4DA1AE94AD1856DBF045157072.png" title="点击放大" width="534.7265"></span></p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h3 id="section352182031613">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section352182031613" tips="复制节点链接"></i></h3><ol><li>设置全屏并隐藏状态栏和导航栏。<div class="screenLinkPre"><div _ngcontent-uuw-c106="" class="highlight-div"><div _ngcontent-uuw-c106="" class="highlight-div-header"><div _ngcontent-uuw-c106="" class="highlight-div-header-left"><div _ngcontent-uuw-c106="" class="handle-button expand-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uuw-c106="" class="highlight-div-header-right"><div _ngcontent-uuw-c106="" class="handle-button ai-button"></div><div _ngcontent-uuw-c106="" class="handle-button line-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uuw-c106="" class="handle-button theme-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uuw-c106="" class="handle-button copy-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uuw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/Immersive/blob/master/products/default/src/main/ets/pages/MiniGame.ets#L28-L94" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// products/default/src/main/ets/pages/MiniGame.ets</span></li><li>context = <span class="hljs-keyword">this</span>.getUIContext()?.getHostContext() <span class="hljs-keyword">as</span> common.UIAbilityContext;</li><li><span class="hljs-keyword">private</span> windowClass = <span class="hljs-keyword">this</span>.context.windowStage.getMainWindowSync();</li><li><span class="hljs-comment">// ...</span></li><li>
</li><li>turnOnImmersive() {</li><li>  <span class="hljs-keyword">this</span>.windowClass.setWindowLayoutFullScreen(<span class="hljs-literal">true</span>);</li><li>  <span class="hljs-keyword">this</span>.windowClass.setWindowSystemBarEnable([]);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/Immersive/blob/master/products/default/src/main/ets/pages/MiniGame.ets#L28-L94" target="_blank">MiniGame.ets</a></div></div></div></div> </li><li>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-display#getcutoutinfo9-1" target="_blank">Display.getCutoutInfo()</a>方法获取挖孔区域的宽高和位置信息。<div class="screenLinkPre"><div _ngcontent-uuw-c106="" class="highlight-div"><div _ngcontent-uuw-c106="" class="highlight-div-header"><div _ngcontent-uuw-c106="" class="highlight-div-header-left"><div _ngcontent-uuw-c106="" class="handle-button expand-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uuw-c106="" class="highlight-div-header-right"><div _ngcontent-uuw-c106="" class="handle-button ai-button"></div><div _ngcontent-uuw-c106="" class="handle-button line-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uuw-c106="" class="handle-button theme-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uuw-c106="" class="handle-button copy-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uuw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" codehub="https://gitee.com/harmonyos_samples/Immersive/blob/master/products/default/src/main/ets/pages/MiniGame.ets#L58-L63" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// products/default/src/main/ets/pages/MiniGame.ets</span></li><li><span class="hljs-function"><span class="hljs-keyword">async</span> <span class="hljs-title">getCutoutInfo</span>()</span> {</li><li>  <span class="hljs-keyword">const</span> displayClass = display.getDefaultDisplaySync();</li><li>  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> displayClass.getCutoutInfo();</li><li>  <span class="hljs-keyword">return</span> res.boundingRects;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/Immersive/blob/master/products/default/src/main/ets/pages/MiniGame.ets#L58-L63" target="_blank">MiniGame.ets</a></div></div></div></div> </li><li>计算页面顶部两侧按钮的左右边距，记录在状态变量statusBarMargin中。<ul><li>通过比较挖孔区域距屏幕左侧边缘和右侧边缘的距离，判断挖孔区域在屏幕左侧、右侧还是中间。</li><li>挖孔在中间无需计算两侧按钮左右边距，默认为0。</li><li>挖孔在左边，则左侧按钮左边距 = 挖孔距屏幕左侧边缘的距离 + 挖孔区域的宽度。</li><li>挖孔在右侧，则右侧按钮右边距 = 挖孔距屏幕右侧边缘的距离 + 挖孔区域的宽度。</li></ul> <div class="screenLinkPre"><div _ngcontent-uuw-c106="" class="highlight-div"><div _ngcontent-uuw-c106="" class="highlight-div-header"><div _ngcontent-uuw-c106="" class="highlight-div-header-left"><div _ngcontent-uuw-c106="" class="handle-button expand-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uuw-c106="" class="highlight-div-header-right"><div _ngcontent-uuw-c106="" class="handle-button ai-button"></div><div _ngcontent-uuw-c106="" class="handle-button line-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uuw-c106="" class="handle-button theme-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uuw-c106="" class="handle-button copy-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uuw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/Immersive/blob/master/products/default/src/main/ets/pages/MiniGame.ets#L34-L87" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// products/default/src/main/ets/pages/MiniGame.ets</span></li><li>@<span class="hljs-title function_">State</span> <span class="hljs-variable">statusBarMargin</span>: <span class="hljs-title class_">StatusBarMargin</span> = { <span class="hljs-variable">left</span>: <span class="hljs-number">0</span>, <span class="hljs-variable">right</span>: <span class="hljs-number">0</span> };</li><li>
</li><li><span class="hljs-comment">// ...</span></li><li>
</li><li><span class="hljs-variable">async</span> <span class="hljs-title function_">setStatusBarMargin</span>(<span class="hljs-variable">windowWidth</span>: <span class="hljs-title class_">number</span>) {</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-variable">cutoutInfo</span> = <span class="hljs-variable">await</span> <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getCutoutInfo</span>();</li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-variable">statusBarMargin</span> = <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getStatusBarMargin</span>(<span class="hljs-variable">cutoutInfo</span>, <span class="hljs-variable">windowWidth</span>);</li><li>}</li><li>
</li><li><span class="hljs-title function_">getStatusBarMargin</span>(<span class="hljs-variable">cutoutInfo</span>: <span class="hljs-title class_">display</span>.<span class="hljs-title class_">Rect</span>[], <span class="hljs-variable">windowWidth</span>: <span class="hljs-title class_">number</span>): <span class="hljs-title class_">StatusBarMargin</span> {</li><li>  <span class="hljs-keyword">if</span> (!<span class="hljs-variable">cutoutInfo</span> || <span class="hljs-variable">cutoutInfo</span>.<span class="hljs-variable">length</span> === <span class="hljs-number">0</span>) {</li><li>    <span class="hljs-keyword">return</span> { <span class="hljs-variable">left</span>: <span class="hljs-number">0</span>, <span class="hljs-variable">right</span>: <span class="hljs-number">0</span> };</li><li>  }</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-variable">cutoutRect</span> = <span class="hljs-variable">cutoutInfo</span>[<span class="hljs-number">0</span>];</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-variable">cutoutLeftGap</span> = <span class="hljs-variable">cutoutRect</span>.<span class="hljs-variable">left</span>;</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-variable">cutoutWidth</span> = <span class="hljs-variable">cutoutRect</span>.<span class="hljs-variable">width</span>;</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-variable">cutoutRightGap</span> = <span class="hljs-variable">windowWidth</span> - <span class="hljs-variable">cutoutLeftGap</span> - <span class="hljs-variable">cutoutWidth</span>;</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-variable">Math</span>.<span class="hljs-title function_">abs</span>(<span class="hljs-variable">cutoutLeftGap</span> - <span class="hljs-variable">cutoutRightGap</span>) &lt;= <span class="hljs-number">10</span>) {</li><li>    <span class="hljs-keyword">return</span> { <span class="hljs-variable">left</span>: <span class="hljs-number">0</span>, <span class="hljs-variable">right</span>: <span class="hljs-number">0</span> };</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-variable">cutoutLeftGap</span> &lt; <span class="hljs-title class_">cutoutRightGap</span>) {</li><li>    <span class="hljs-keyword">return</span> { <span class="hljs-variable">left</span>: <span class="hljs-title class_">cutoutLeftGap</span> + <span class="hljs-title class_">cutoutWidth</span>, <span class="hljs-variable">right</span>: <span class="hljs-number">0</span> };</li><li>  }</li><li>  <span class="hljs-keyword">return</span> { <span class="hljs-variable">left</span>: <span class="hljs-number">0</span>, <span class="hljs-variable">right</span>: <span class="hljs-title class_">cutoutRightGap</span> + <span class="hljs-title class_">cutoutWidth</span> };</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/Immersive/blob/master/products/default/src/main/ets/pages/MiniGame.ets#L34-L87" target="_blank">MiniGame.ets</a></div></div></div></div> </li><li>根据状态变量statusBarMargin设置对应顶部按钮组件的左右margin值。<div class="screenLinkPre"><div _ngcontent-uuw-c106="" class="highlight-div"><div _ngcontent-uuw-c106="" class="highlight-div-header"><div _ngcontent-uuw-c106="" class="highlight-div-header-left"><div _ngcontent-uuw-c106="" class="handle-button expand-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uuw-c106="" class="highlight-div-header-right"><div _ngcontent-uuw-c106="" class="handle-button ai-button"></div><div _ngcontent-uuw-c106="" class="handle-button line-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uuw-c106="" class="handle-button theme-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uuw-c106="" class="handle-button copy-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uuw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/Immersive/blob/master/products/default/src/main/ets/pages/MiniGame.ets#L114-L123" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// products/default/src/main/ets/pages/MiniGame.ets</span></li><li><span class="hljs-built_in">Row</span>() {</li><li>  <span class="hljs-built_in">Image</span>($r('app.media.game_props'))</li><li>    <span class="hljs-selector-class">.width</span>(<span class="hljs-number">80</span>)</li><li>    <span class="hljs-selector-class">.margin</span>({ left: this.statusBarMargin.left + 'px' })</li><li>  <span class="hljs-built_in">Blank</span>()</li><li>  <span class="hljs-built_in">Image</span>($r('app.media.game_pause'))</li><li>    <span class="hljs-selector-class">.width</span>(<span class="hljs-number">48</span>)</li><li>    <span class="hljs-selector-class">.margin</span>({ right: this.statusBarMargin.right + 'px' })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/Immersive/blob/master/products/default/src/main/ets/pages/MiniGame.ets#L114-L123" target="_blank">MiniGame.ets</a></div></div></div></div> </li></ol> </div> <div class="tiledSection"><h2 id="section15457154011128">深色背景下状态栏颜色适配场景<i class="anchor-icon anchor-icon-link" anchorid="section15457154011128" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section153861605182" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section153861605182" tips="复制节点链接"></i></h3><p>在某些将深色背景延伸到状态栏的沉浸式页面中，需要设置状态栏时间文字、信号图标、电量图标等内容为浅色进行适配，避免状态栏内容不清晰，以此提升用户的视觉体验。</p> <p><span><img height="549.2235000000001" originheight="2258" originwidth="1093" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163012.29478147735595423006003900906929:50001231000000:2800:2F6F1BEACB37A75E13F74709AEB2C698AC305D9E127097129492E9401B7DDF4A.png" title="点击放大" width="266"></span></p> </div> <div class="tiledSection"><h3 id="section821087161816">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section821087161816" tips="复制节点链接"></i></h3><ol><li>设置背景图片组件expandSafeArea([SafeAreaType.SYSTEM], [SafeAreaEdge.TOP, SafeAreaEdge.BOTTOM])，扩展安全区域到状态栏和导航栏，实现沉浸式效果。<div class="screenLinkPre"><div _ngcontent-uuw-c106="" class="highlight-div"><div _ngcontent-uuw-c106="" class="highlight-div-header"><div _ngcontent-uuw-c106="" class="highlight-div-header-left"><div _ngcontent-uuw-c106="" class="handle-button expand-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uuw-c106="" class="highlight-div-header-right"><div _ngcontent-uuw-c106="" class="handle-button ai-button"></div><div _ngcontent-uuw-c106="" class="handle-button line-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uuw-c106="" class="handle-button theme-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uuw-c106="" class="handle-button copy-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uuw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/Immersive/blob/master/products/default/src/main/ets/pages/MusicPlayer.ets#L48-L55" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">Column</span>() {</li><li>  <span class="hljs-comment">// products/default/src/main/ets/pages/MusicPlayer.ets</span></li><li>  <span class="hljs-built_in">Image</span>(this.getBackGroundImage())</li><li>    <span class="hljs-selector-class">.expandSafeArea</span>([SafeAreaType.SYSTEM], [SafeAreaEdge.TOP, SafeAreaEdge.BOTTOM])</li><li>    <span class="hljs-selector-class">.objectFit</span>(ImageFit.Fill)</li><li>}</li><li><span class="hljs-selector-class">.height</span>('<span class="hljs-number">100%</span>')</li><li><span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/Immersive/blob/master/products/default/src/main/ets/pages/MusicPlayer.ets#L48-L55" target="_blank">MusicPlayer.ets</a></div></div></div></div> </li><li>在页面显示或隐藏时，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setwindowsystembarproperties9" target="_blank">Window.setWindowSystemBarProperties()</a>方法设置状态栏内容的颜色。<div class="screenLinkPre"><div _ngcontent-uuw-c106="" class="highlight-div"><div _ngcontent-uuw-c106="" class="highlight-div-header"><div _ngcontent-uuw-c106="" class="highlight-div-header-left"><div _ngcontent-uuw-c106="" class="handle-button expand-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uuw-c106="" class="highlight-div-header-right"><div _ngcontent-uuw-c106="" class="handle-button ai-button"></div><div _ngcontent-uuw-c106="" class="handle-button line-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uuw-c106="" class="handle-button theme-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uuw-c106="" class="handle-button copy-button"><div _ngcontent-uuw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uuw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/Immersive/blob/master/products/default/src/main/ets/pages/MusicPlayer.ets#L33-L61" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">onShown</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowClass</span>.<span class="hljs-title function_">setWindowSystemBarProperties</span>({</li><li>    <span class="hljs-attr">statusBarContentColor</span>: <span class="hljs-string">'#FFFFFF'</span></li><li>  });</li><li>}</li><li>
</li><li><span class="hljs-title function_">onHidden</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowClass</span>.<span class="hljs-title function_">setWindowSystemBarProperties</span>({</li><li>    <span class="hljs-attr">statusBarContentColor</span>: <span class="hljs-string">'#000000'</span></li><li>  });</li><li>}</li><li>
</li><li><span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">NavDestination</span>() {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// products/default/src/main/ets/pages/MusicPlayer.ets</span></li><li>      <span class="hljs-title class_">Image</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getBackGroundImage</span>())</li><li>        .<span class="hljs-title function_">expandSafeArea</span>([<span class="hljs-title class_">SafeAreaType</span>.<span class="hljs-property">SYSTEM</span>], [<span class="hljs-title class_">SafeAreaEdge</span>.<span class="hljs-property">TOP</span>, <span class="hljs-title class_">SafeAreaEdge</span>.<span class="hljs-property">BOTTOM</span>])</li><li>        .<span class="hljs-title function_">objectFit</span>(<span class="hljs-title class_">ImageFit</span>.<span class="hljs-property">Fill</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>  .<span class="hljs-title function_">hideTitleBar</span>(<span class="hljs-literal">true</span>)</li><li>  .<span class="hljs-title function_">onShown</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onShown</span>())</li><li>  .<span class="hljs-title function_">onHidden</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onHidden</span>())</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/Immersive/blob/master/products/default/src/main/ets/pages/MusicPlayer.ets#L33-L61" target="_blank">MusicPlayer.ets</a></div></div></div></div> </li></ol> </div> <div class="tiledSection"><h2 id="section1557315421419">常见问题<i class="anchor-icon anchor-icon-link" anchorid="section1557315421419" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section969953483419" class="firsth2">在A页面跳转B页面时使用setWindowLayoutFullScreen()方法让页面变沉浸式，在B页面的aboutToDisappear生命周期中退出沉浸式，回到A页面，A页面会由沉浸式效果过渡为非沉浸式效果<i class="anchor-icon anchor-icon-link" anchorid="section969953483419" tips="复制节点链接"></i></h3><ul><li>单个页面实现沉浸式，优先考虑使用expandSafeArea属性扩展安全区域的方案实现，该方案只会影响当前组件的布局。可参考<a href="/consumer/cn/doc/best-practices/bpta-immersive#section199711126181118">顶部或底部背景延伸场景</a>。</li><li>若必须使用setWindowLayoutFullScreen()方法实现沉浸式，可在NavDestination组件的onShown生命周期中进入沉浸式，onHidden生命周期中退出沉浸式。如果使用的是Router进行路由，可在组件的onPageShow生命周期中进入沉浸式，onPageHide生命周期中退出沉浸式，避免aboutToDisappear延迟执行产生过渡效果。可参考<a href="/consumer/cn/doc/best-practices/bpta-immersive#section584841611122">全屏沉浸式场景</a>。</li></ul> </div> <div class="tiledSection"><h3 id="section5694443101520">给组件设置了expandSafeArea属性不生效<i class="anchor-icon anchor-icon-link" anchorid="section5694443101520" tips="复制节点链接"></i></h3><p>设置expandSafeArea属性常会触碰以下限制，导致组件并没有扩展安全区域。</p> <ul><li>设置expandSafeArea属性进行组件绘制扩展时，组件不能设置固定宽高尺寸。可尝试用百分比或padding改变组件宽高。</li><li>设置expandSafeArea属性的组件需与安全区域边界重合。</li><li>当设置expandSafeArea属性的组件的父组件是滚动类容器，需设置父组件的clip属性，不裁剪内部组件。可参考<a href="/consumer/cn/doc/best-practices/bpta-immersive#section391124571116">顶部图片延伸场景</a>。</li></ul> <p>更多限制场景可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-expand-safe-area#expandsafearea" target="_blank">API参考中expandSafeArea章节的说明部分</a>。</p> </div> <div class="tiledSection"><h3 id="section111113715226">某些场景下没有使用setWindowLayoutFullScreen()方法或expandSafeArea属性，页面也延伸到了状态栏或导航栏<i class="anchor-icon anchor-icon-link" anchorid="section111113715226" tips="复制节点链接"></i></h3><p>在页面中使用了以下组件，且满足<a href="/consumer/cn/doc/best-practices/bpta-immersive#section5694443101520">expandSafeArea属性生效条件</a>，则会有默认的扩展安全区域行为。开发者可重写该属性覆盖默认行为。</p> <ul><li>Navigation组件和NavDestination组件默认扩展安全区域至状态栏和导航栏，相当于默认设置了expandSafeArea([SafeAreaType.SYSTEM],  [SafeAreaEdge.TOP, SafeAreaEdge.BOTTOM])属性。</li><li>Tabs组件默认扩展安全区域至导航栏，相当于默认设置了expandSafeArea([SafeAreaType.SYSTEM], [SafeAreaEdge.BOTTOM])属性。</li></ul> </div> <div class="tiledSection"><h2 id="section9811711171410">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section9811711171410" tips="复制节点链接"></i></h2><ul><li><a href="https://gitee.com/harmonyos_samples/Immersive" target="_blank">沉浸式页面开发</a></li></ul> </div> </div> <div></div></div>