<h1 _ngcontent-pjt-c119="" class="doc-title ng-star-inserted" title="浏览进度接续"> 浏览进度接续 </h1>

<div _ngcontent-pjt-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section16664175110413">概述<i class="anchor-icon anchor-icon-link" anchorid="section16664175110413" tips="复制节点链接"></i></h2><p>在日常生活中，随着个人设备数量的不断增加，用户在使用某个应用时，如果有更合适的设备在附近，可以利用接续功能将应用无缝切换到新设备上继续当前操作。本文主要针对长列表进度、媒体播放进度和Web浏览进度三个场景，实现了浏览进度的高效接续，提供给用户一种无缝的设备切换体验和浏览连贯性保障，确保用户在切换设备时能够轻松恢复之前的浏览进度，极大地提升了使用的便捷性和连贯性，实现了真正的无缝接续。</p> <ul><li><a href="/consumer/cn/doc/best-practices/bpta-application-continue-progess#section16702516134216">长列表进度接续</a>：可以让用户从上次离开的位置继续浏览，无需从头开始，精准定位到之前的条目附近，节省时间并减少操作成本，提升浏览体验。</li><li><a href="/consumer/cn/doc/best-practices/bpta-application-continue-progess#section12439210434">媒体播放进度接续</a>：从源设备当前播放的位置继续播放视频，保持播放进度、画面质量和音频设置的一致性，确保用户的观影体验不被打断。支持在线视频平台的剧集、电影以及本地存储的视频文件，实现流畅的接续播放。</li><li><a href="/consumer/cn/doc/best-practices/bpta-application-continue-progess#section3512987460">Web浏览进度接续</a>：能够快速定位到源设备浏览的网页位置，确保用户浏览的连续性，避免重复查找信息的不便，提高信息获取的效率。</li></ul> </div> <div class="tiledSection"><h2 id="section20515684319">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section20515684319" tips="复制节点链接"></i></h2><p>接续过程底层依赖分布式框架和软总线，开发者只需要启用接续、保存数据和恢复数据，具体运作机制可参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-continuation-overview#section13558148125311" target="_blank">运作机制</a>。</p> <p><span><img height="418.76380000000006" originheight="551" originwidth="1050" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163243.19199381938414596173737724974793:50001231000000:2800:6CDC77481C76EB60C4EB712133D4C9E0E0DAF96282397F6360638E26B10315A4.png" title="点击放大" width="798"></span></p> </div> <div class="tiledSection"><h2 id="section054887144213">开发流程<i class="anchor-icon anchor-icon-link" anchorid="section054887144213" tips="复制节点链接"></i></h2><p>进度接续的核心在于确保进度数据在不同设备间的精确传输与同步。在实际开发过程中，开发者会遇到各种复杂的接续需求，首要任务是深入分析哪些数据对接续控制至关重要。在源设备启动接续时，应保存数据；在目标设备接续时，需准确恢复数据，以确保进度的连续性和设备间数据的一致性。</p> <p>本章节将介绍如何配置应用以使用接续能力，以及如何保存和恢复数据以实现应用的无缝接续。具体场景包括<a href="/consumer/cn/doc/best-practices/bpta-application-continue-progess#section16702516134216">长列表进度接续</a>、<a href="/consumer/cn/doc/best-practices/bpta-application-continue-progess#section12439210434">媒体播放进度接续</a>和<a href="/consumer/cn/doc/best-practices/bpta-application-continue-progess#section3512987460">Web浏览进度接续</a>。</p> <ol><li id="li6149192715494">启用接续<p>在module.json5文件的abilities中，将continuable标签配置为“true”，表示该UIAbility可以被迁移。配置为“false”的UIAbility将被系统识别为不可迁移，且该配置的默认值为“false”。</p> <div class="screenLinkPre"><div _ngcontent-pjt-c106="" class="highlight-div"><div _ngcontent-pjt-c106="" class="highlight-div-header"><div _ngcontent-pjt-c106="" class="highlight-div-header-left"><div _ngcontent-pjt-c106="" class="handle-button expand-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pjt-c106="" class="highlight-div-header-right"><div _ngcontent-pjt-c106="" class="handle-button ai-button"></div><div _ngcontent-pjt-c106="" class="handle-button line-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pjt-c106="" class="handle-button theme-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pjt-c106="" class="handle-button copy-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pjt-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/continue-progress/blob/master/entry/src/main/module.json5#L2-L83" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"module"</span>: {</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-string">"abilities"</span>: [</li><li>      {</li><li>        <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-string">"continuable"</span>: <span class="hljs-keyword">true</span></li><li>      }</li><li>    ],</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/continue-progress/blob/master/entry/src/main/module.json5#L2-L83" target="_blank">module.json5</a></div></div></div></div> </li><li id="li1745816354491">源端保存迁移数据<p>当对端点击接续图标时，源端将触发UIAbility中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability#oncontinue" target="_blank">onContinue()</a>接口。在此接口中，开发者可以将需要迁移的数据以键值对形式保存至wantParam中，并返回AbilityConstant.OnContinueResult.AGREE，标识应用同意迁移，从而将数据迁移至对端。</p> <div class="screenLinkPre"><div _ngcontent-pjt-c106="" class="highlight-div"><div _ngcontent-pjt-c106="" class="highlight-div-header"><div _ngcontent-pjt-c106="" class="highlight-div-header-left"><div _ngcontent-pjt-c106="" class="handle-button expand-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pjt-c106="" class="highlight-div-header-right"><div _ngcontent-pjt-c106="" class="handle-button ai-button"></div><div _ngcontent-pjt-c106="" class="handle-button line-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pjt-c106="" class="handle-button theme-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pjt-c106="" class="handle-button copy-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pjt-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/continue-progress/blob/master/entry/src/main/ets/entryability/EntryAbility.ets#L95-L126" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-title function_">onContinue</span>(<span class="hljs-attr">wantParam</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Object</span>&gt;): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">OnContinueResult</span>&gt; {</li><li>  <span class="hljs-comment">// 1.1 Retrieve the data to be connected and transmit it via wantParam.</span></li><li>  <span class="hljs-keyword">let</span> continueIndex = <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'continueIndex'</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>;</li><li>  wantParam.<span class="hljs-property">continueIndex</span> = continueIndex;</li><li>  <span class="hljs-keyword">let</span> currentOffset = <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'currentOffset'</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>;</li><li>  wantParam.<span class="hljs-property">currentOffset</span> = currentOffset;</li><li>  <span class="hljs-keyword">let</span> continueHeight = <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'listItemHeight'</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>;</li><li>  wantParam.<span class="hljs-property">continueHeight</span> = continueHeight;</li><li>  <span class="hljs-keyword">let</span> currentTime = <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'currentTime'</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>;</li><li>  wantParam.<span class="hljs-property">continueTime</span> = currentTime;</li><li>  <span class="hljs-keyword">let</span> videoIndex = <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'videoIndex'</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>;</li><li>  wantParam.<span class="hljs-property">continueItem</span> = videoIndex;</li><li>  <span class="hljs-keyword">let</span> flag = <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'flag'</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">boolean</span>;</li><li>  wantParam.<span class="hljs-property">flag</span> = flag;</li><li>  <span class="hljs-keyword">let</span> url = <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'pageUrl'</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;</li><li>  wantParam.<span class="hljs-property">pageUrl</span> = url;</li><li>  <span class="hljs-keyword">let</span> distance = <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'scrollDistance'</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>;</li><li>  wantParam.<span class="hljs-property">scrollDistance</span> = distance;</li><li>  <span class="hljs-keyword">let</span> breakpoint = <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">get</span>(<span class="hljs-title class_">BreakpointConstants</span>.<span class="hljs-property">BREAKPOINT_NAME</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;</li><li>  wantParam.<span class="hljs-property">breakpoint</span> = breakpoint;</li><li>  <span class="hljs-keyword">let</span> pageInfos = <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'pageInfos'</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">NavPathStack</span>;</li><li>  <span class="hljs-keyword">let</span> pageArr = pageInfos.<span class="hljs-title function_">getAllPathName</span>();</li><li>  <span class="hljs-keyword">let</span> currentPage = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-keyword">if</span> (pageArr.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {</li><li>    currentPage = pageArr[pageArr.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>];</li><li>  }</li><li>  <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'continue'</span>, <span class="hljs-literal">false</span>);</li><li>  wantParam.<span class="hljs-property">currentPage</span> = currentPage;</li><li>
</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">OnContinueResult</span>.<span class="hljs-property">AGREE</span>;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/continue-progress/blob/master/entry/src/main/ets/entryability/EntryAbility.ets#L95-L126" target="_blank">EntryAbility.ets</a></div></div></div></div> </li><li id="li631218439498">对端恢复数据<p>在源端保存数据并同意迁移后，对端可启动应用，并在UIAbility中的onCreate()或onNewWant()生命周期回调中恢复数据。如果Ability的启动原因为LaunchReason.CONTINUATION，开发者可以从want.parameters中获取保存的键值对数据。</p> <div class="screenLinkPre"><div _ngcontent-pjt-c106="" class="highlight-div"><div _ngcontent-pjt-c106="" class="highlight-div-header"><div _ngcontent-pjt-c106="" class="highlight-div-header-left"><div _ngcontent-pjt-c106="" class="handle-button expand-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pjt-c106="" class="highlight-div-header-right"><div _ngcontent-pjt-c106="" class="handle-button ai-button"></div><div _ngcontent-pjt-c106="" class="handle-button line-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pjt-c106="" class="handle-button theme-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pjt-c106="" class="handle-button copy-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pjt-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/continue-progress/blob/master/entry/src/main/ets/entryability/EntryAbility.ets#L30-L50" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">onCreate</span>(want: Want, launchParam: AbilityConstant.LaunchParam): void {</li><li>  GlobalContext<span class="hljs-selector-class">.getContext</span>()<span class="hljs-selector-class">.setObject</span>('abilityWant', want);</li><li>  GlobalContext<span class="hljs-selector-class">.getContext</span>()<span class="hljs-selector-class">.setObject</span>('context', this.context);</li><li>  if (want.parameters) {</li><li>    if (want.parameters.currentTime) {</li><li>      GlobalContext<span class="hljs-selector-class">.getContext</span>()<span class="hljs-selector-class">.setObject</span>('currentTime', want.parameters.currentTime);</li><li>    }</li><li>  }</li><li>  try {</li><li>    this<span class="hljs-selector-class">.context</span><span class="hljs-selector-class">.getApplicationContext</span>()<span class="hljs-selector-class">.setColorMode</span>(ConfigurationConstant.ColorMode.COLOR_MODE_NOT_SET);</li><li>  } catch (e) {</li><li>    hilog<span class="hljs-selector-class">.error</span>(<span class="hljs-number">0</span>x000, 'progress', `setColorMode error ${JSON.stringify(e)}`);</li><li>  }</li><li>  if (launchParam.launchReason === AbilityConstant.LaunchReason.CONTINUATION) {</li><li>    if (want.parameters) {</li><li>      this<span class="hljs-selector-class">.continueRestore</span>(want);</li><li>    }</li><li>  }</li><li>  hilog<span class="hljs-selector-class">.info</span>(DOMAIN, 'testTag', '%{public}s', 'Ability onCreate');</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/continue-progress/blob/master/entry/src/main/ets/entryability/EntryAbility.ets#L30-L50" target="_blank">EntryAbility.ets</a></div></div></div></div> <p>可将恢复数据的方法提取为公共方法，以便于在UIAbility的onCreate()或onNewWant()中调用。</p> <div class="screenLinkPre"><div _ngcontent-pjt-c106="" class="highlight-div"><div _ngcontent-pjt-c106="" class="highlight-div-header"><div _ngcontent-pjt-c106="" class="highlight-div-header-left"><div _ngcontent-pjt-c106="" class="handle-button expand-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pjt-c106="" class="highlight-div-header-right"><div _ngcontent-pjt-c106="" class="handle-button ai-button"></div><div _ngcontent-pjt-c106="" class="handle-button line-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pjt-c106="" class="handle-button theme-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pjt-c106="" class="handle-button copy-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pjt-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/continue-progress/blob/master/entry/src/main/ets/entryability/EntryAbility.ets#L67-L91" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">continueRestore</span>(<span class="hljs-params">want: Want</span>) {</li><li>  <span class="hljs-keyword">if</span> (!want.<span class="hljs-property">parameters</span>) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'EntryAbility'</span>, <span class="hljs-string">'missing sessionId'</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-keyword">let</span> currentPage = want.<span class="hljs-property">parameters</span>.<span class="hljs-property">currentPage</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'currentPage'</span>, currentPage);</li><li>  want.<span class="hljs-property">parameters</span>.<span class="hljs-property">continueIndex</span> &amp;&amp; <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'continueWaterOffset'</span>, want.<span class="hljs-property">parameters</span>.<span class="hljs-property">continueIndex</span>);</li><li>  want.<span class="hljs-property">parameters</span>.<span class="hljs-property">currentOffset</span> &amp;&amp; <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'continueOffset'</span>, want.<span class="hljs-property">parameters</span>.<span class="hljs-property">currentOffset</span>);</li><li>  want.<span class="hljs-property">parameters</span>.<span class="hljs-property">continueHeight</span> &amp;&amp; <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'continueHeight'</span>, want.<span class="hljs-property">parameters</span>.<span class="hljs-property">continueHeight</span>);</li><li>  <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'continueEntry'</span>, <span class="hljs-literal">true</span>);</li><li>  <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'setCurrentOffset'</span>, <span class="hljs-literal">true</span>);</li><li>  want.<span class="hljs-property">parameters</span>.<span class="hljs-property">continueTime</span> &amp;&amp; <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'currentTime'</span>, want.<span class="hljs-property">parameters</span>.<span class="hljs-property">continueTime</span>);</li><li>  want.<span class="hljs-property">parameters</span>.<span class="hljs-property">continueItem</span> &amp;&amp; <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'videoIndex'</span>, want.<span class="hljs-property">parameters</span>.<span class="hljs-property">continueItem</span>);</li><li>  want.<span class="hljs-property">parameters</span>.<span class="hljs-property">continueItem</span> &amp;&amp; <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'videoSelect'</span>, want.<span class="hljs-property">parameters</span>.<span class="hljs-property">continueItem</span>);</li><li>  want.<span class="hljs-property">parameters</span>.<span class="hljs-property">flag</span> &amp;&amp; <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'flag'</span>, want.<span class="hljs-property">parameters</span>.<span class="hljs-property">flag</span>);</li><li>  <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'continue'</span>, <span class="hljs-literal">true</span>);</li><li>  <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'continueRestore'</span>, <span class="hljs-literal">true</span>);</li><li>  want.<span class="hljs-property">parameters</span>.<span class="hljs-property">pageUrl</span> &amp;&amp; <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'pageUrl'</span>, want.<span class="hljs-property">parameters</span>.<span class="hljs-property">pageUrl</span>);</li><li>  want.<span class="hljs-property">parameters</span>.<span class="hljs-property">scrollDistance</span> &amp;&amp; <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'scrollDistance'</span>, want.<span class="hljs-property">parameters</span>.<span class="hljs-property">scrollDistance</span>);</li><li>  want.<span class="hljs-property">parameters</span>.<span class="hljs-property">breakpoint</span> &amp;&amp; <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'continueBreakpoint'</span>, want.<span class="hljs-property">parameters</span>.<span class="hljs-property">breakpoint</span>);</li><li>
</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">restoreWindowStage</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>());</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/continue-progress/blob/master/entry/src/main/ets/entryability/EntryAbility.ets#L67-L91" target="_blank">EntryAbility.ets</a></div></div></div></div> </li></ol> </div> <div class="tiledSection"><h2 id="section16702516134216">长列表进度接续<i class="anchor-icon anchor-icon-link" anchorid="section16702516134216" tips="复制节点链接"></i></h2><p><span><img height="391.6052" originheight="1060" originwidth="2160" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163243.42917905468735172921562398278554:50001231000000:2800:FCF189EDF82681452E7FE89E3727E2B3627C1A71CDD14BA6CD124F0A4F108340.gif" title="点击放大" width="798"></span></p> <p>长列表通常用于存储大量信息，可以通过List、Grid、Scroll、WaterFlow等组件进行封装。系统提供了分布式迁移标识，以便在使用这些组件时恢复进度状态，调用起来非常方便。使用方法如下：</p> <div class="screenLinkPre"><div _ngcontent-pjt-c106="" class="highlight-div"><div _ngcontent-pjt-c106="" class="highlight-div-header"><div _ngcontent-pjt-c106="" class="highlight-div-header-left"><div _ngcontent-pjt-c106="" class="handle-button expand-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pjt-c106="" class="highlight-div-header-right"><div _ngcontent-pjt-c106="" class="handle-button ai-button"></div><div _ngcontent-pjt-c106="" class="handle-button line-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pjt-c106="" class="handle-button theme-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pjt-c106="" class="handle-button copy-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pjt-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/continue-progress/blob/master/entry/src/main/ets/view/longlist/WaterFlowView.ets#L123-L209" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">WaterFlow</span>({ <span class="hljs-variable">footer</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">footStyle</span>, <span class="hljs-variable">scroller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">waterFlowScroller</span> }) {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>.<span class="hljs-title function_">restoreId</span>(<span class="hljs-number">1</span>)</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/continue-progress/blob/master/entry/src/main/ets/view/longlist/WaterFlowView.ets#L123-L209" target="_blank">WaterFlowView.ets</a></div></div></div></div> <p>使用分布式迁移标识可以快速实现接续。然而，该方法存在局限性，具体支持的场景和版本详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-restoreid" target="_blank">分布式迁移标识</a>的说明。若需在开发中进行更多自定义设置以提升用户体验，可参考以下步骤。</p> <p><span><img height="387.86098400000003" originheight="456" originwidth="571" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163243.29666888550807995348398280869147:50001231000000:2800:05D2B1C9D27A87D46DE8BA078096ADFB29AA851A6AC4ECE4F8A6A8424D3F17FB.jpg" title="点击放大" width="482.812876"></span></p> <ol><li><a href="/consumer/cn/doc/best-practices/bpta-application-continue-progess#li6149192715494">启用接续</a>。</li><li>在Scroll组件的onDidScroll()接口中监听长列表的浏览进度变化。<div class="screenLinkPre"><div _ngcontent-pjt-c106="" class="highlight-div"><div _ngcontent-pjt-c106="" class="highlight-div-header"><div _ngcontent-pjt-c106="" class="highlight-div-header-left"><div _ngcontent-pjt-c106="" class="handle-button expand-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pjt-c106="" class="highlight-div-header-right"><div _ngcontent-pjt-c106="" class="handle-button ai-button"></div><div _ngcontent-pjt-c106="" class="handle-button line-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pjt-c106="" class="handle-button theme-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pjt-c106="" class="handle-button copy-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pjt-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/continue-progress/blob/master/entry/src/main/ets/view/longlist/HomeContent.ets#L192-L223" data-highlighted="yes"><ol class="linenums"><li>Scroll(<span class="hljs-keyword">this</span>.scroller) {</li><li>  <span class="hljs-comment">// ...</span></li><li>.onDidScroll((xOffset: number, yOffset: number, scrollState: ScrollState) =&gt; {</li><li>  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.setCurrentOffset) {</li><li>    <span class="hljs-keyword">this</span>.currentOffset = <span class="hljs-keyword">this</span>.scroller.currentOffset().yOffset;</li><li>  }</li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/continue-progress/blob/master/entry/src/main/ets/view/longlist/HomeContent.ets#L192-L223" target="_blank">HomeContent.ets</a></div></div></div></div> </li><li>在UIAbility的onContinue()回调中，将进度相关数据保存到wantParam中，参考<a href="/consumer/cn/doc/best-practices/bpta-application-continue-progess#li1745816354491">保存迁移数据</a>。</li><li>在UIAbility的onNewWant()和onCreate()回调中，从want.parameters中恢复数据，参考<a href="/consumer/cn/doc/best-practices/bpta-application-continue-progess#li631218439498">恢复数据</a>。</li><li>在onDidBuild()事件中恢复浏览状态。<div class="screenLinkPre"><div _ngcontent-pjt-c106="" class="highlight-div"><div _ngcontent-pjt-c106="" class="highlight-div-header"><div _ngcontent-pjt-c106="" class="highlight-div-header-left"><div _ngcontent-pjt-c106="" class="handle-button expand-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pjt-c106="" class="highlight-div-header-right"><div _ngcontent-pjt-c106="" class="handle-button ai-button"></div><div _ngcontent-pjt-c106="" class="handle-button line-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pjt-c106="" class="handle-button theme-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pjt-c106="" class="handle-button copy-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pjt-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/continue-progress/blob/master/entry/src/main/ets/view/longlist/HomeContent.ets#L107-L114" data-highlighted="yes"><ol class="linenums"><li>onDidBuild(): void {</li><li>  hilog.info(<span class="hljs-number">0x000</span>, <span class="hljs-string">'progress'</span>, `onDidBuild ${<span class="hljs-keyword">this</span>.setCurrentOffset} ${<span class="hljs-keyword">this</span>.continueOffset}`);</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.setCurrentOffset) {</li><li>    <span class="hljs-keyword">this</span>.scroller.scrollTo({ xOffset: <span class="hljs-number">0</span>, yOffset: <span class="hljs-keyword">this</span>.continueOffset });</li><li>    <span class="hljs-keyword">this</span>.setCurrentOffset = <span class="hljs-literal">false</span>;</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/continue-progress/blob/master/entry/src/main/ets/view/longlist/HomeContent.ets#L107-L114" target="_blank">HomeContent.ets</a></div></div></div></div> </li></ol> </div> <div class="tiledSection"><h2 id="section12439210434">媒体播放进度接续<i class="anchor-icon anchor-icon-link" anchorid="section12439210434" tips="复制节点链接"></i></h2><p><span><img height="391.6052" originheight="1060" originwidth="2160" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163243.19730319478314450453924362884609:50001231000000:2800:CBAB8AA4C81A0187E5C8CF89A0DCCC95CB665798A863C96E2550DB6147F1934B.gif" title="点击放大" width="798"></span></p> <p>媒体播放接续的内容主要包括播放列表中的集数、播放状态和进度。此外，还可以接续其他播放设置，以进一步提升用户体验。</p> <p></p> <p><span><img height="384.709815" originheight="456" originwidth="571" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163244.01701776256611175236103375358768:50001231000000:2800:982921A455E7FA6266D6EBA5DE49693A90A7C55CF5CC02F00B11D259918A4FA0.jpg" title="点击放大" width="480.37511900000004"></span></p> <ol><li><a href="/consumer/cn/doc/best-practices/bpta-application-continue-progess#li6149192715494">启用接续</a>。</li><li>使用avPlayer.on('timeUpdate')接口来监听媒体播放进度的变化。<div class="screenLinkPre"><div _ngcontent-pjt-c106="" class="highlight-div"><div _ngcontent-pjt-c106="" class="highlight-div-header"><div _ngcontent-pjt-c106="" class="highlight-div-header-left"><div _ngcontent-pjt-c106="" class="handle-button expand-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pjt-c106="" class="highlight-div-header-right"><div _ngcontent-pjt-c106="" class="handle-button ai-button"></div><div _ngcontent-pjt-c106="" class="handle-button line-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pjt-c106="" class="handle-button theme-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pjt-c106="" class="handle-button copy-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pjt-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/continue-progress/blob/master/entry/src/main/ets/viewmodel/video/AvPlayManager.ets#L182-L188" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">this</span>.avPlayer.on(<span class="hljs-string">'timeUpdate'</span>, (time: number) =&gt; {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isSliderAction) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-keyword">this</span>.currentTime = time;</li><li>  AppStorage.<span class="hljs-keyword">set</span>(<span class="hljs-string">'currentTime'</span>, <span class="hljs-keyword">this</span>.currentTime)</li><li>});</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/continue-progress/blob/master/entry/src/main/ets/viewmodel/video/AvPlayManager.ets#L182-L188" target="_blank">AvPlayManager.ets</a></div></div></div></div> </li><li>在UIAbility的onContinue()回调中，将当前播放时间this.time保存到wantParam中，参考<a href="/consumer/cn/doc/best-practices/bpta-application-continue-progess#li1745816354491">保存迁移数据</a>。</li><li>在UIAbility中的onNewWant()和onCreate()回调中，从want.parameters中恢复数据，参考<a href="/consumer/cn/doc/best-practices/bpta-application-continue-progess#li631218439498">恢复数据</a>。</li><li>在avPlayer初始化完成后，当播放状态变为“playing”时，调用seek()接口以恢复其状态。<div class="screenLinkPre"><div _ngcontent-pjt-c106="" class="highlight-div"><div _ngcontent-pjt-c106="" class="highlight-div-header"><div _ngcontent-pjt-c106="" class="highlight-div-header-left"><div _ngcontent-pjt-c106="" class="handle-button expand-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pjt-c106="" class="highlight-div-header-right"><div _ngcontent-pjt-c106="" class="handle-button ai-button"></div><div _ngcontent-pjt-c106="" class="handle-button line-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pjt-c106="" class="handle-button theme-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pjt-c106="" class="handle-button copy-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pjt-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/continue-progress/blob/master/entry/src/main/ets/viewmodel/video/AvPlayManager.ets#L135-L139" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.<span class="hljs-keyword">continue</span>) {</li><li>  <span class="hljs-keyword">this</span>.videoSeek(continueTime);</li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-keyword">continue</span> = <span class="hljs-literal">false</span>;</li><li>  AppStorage.<span class="hljs-keyword">set</span>(<span class="hljs-string">'continue'</span>, <span class="hljs-literal">false</span>);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/continue-progress/blob/master/entry/src/main/ets/viewmodel/video/AvPlayManager.ets#L135-L139" target="_blank">AvPlayManager.ets</a></div></div></div></div> </li></ol> </div> <div class="tiledSection"><h2 id="section3512987460">Web浏览进度接续<i class="anchor-icon anchor-icon-link" anchorid="section3512987460" tips="复制节点链接"></i></h2><p><span><img height="391.6052" originheight="1060" originwidth="2160" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163244.23111914370338580330660572084999:50001231000000:2800:C5E0AB2DDF0A7675D761DBF556AC8A111035393520550F82BC86519660111688.gif" title="点击放大" width="798"></span></p> <p>系统提供的Web组件用于在应用程序中展示Web页面内容。当Web组件加载大量信息时，保持浏览进度的连续性尤为重要。为了实现内容的连续展示，需要像处理长列表一样，通过传递当前的滚动位置来维持这一连续性。这可以通过使用runJavaScript()接口来获取和恢复滚动位置来实现。</p> <p><span><img height="393.85290000000003" originheight="456" originwidth="571" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163244.21438614942462026795961736702302:50001231000000:2800:A338F5160CD4A14A30AFF11F0668CA20DE1FB092562E62A5E910017F804C96E4.jpg" title="点击放大" width="491.79037600000004"></span></p> <ol><li><a href="/consumer/cn/doc/best-practices/bpta-application-continue-progess#li6149192715494">启用接续</a>。</li><li>使用onTouch()事件监听屏幕滑动，并通过runJavaScript()接口获取页面滚动条距离顶部的距离。</li><li>在onContinue()回调中，将this.scrollDistance保存到wantParam中，参考<a href="/consumer/cn/doc/best-practices/bpta-application-continue-progess#li1745816354491">保存迁移数据</a>。</li><li>在onNewWant()和onCreate()回调中，从want.parameters中恢复数据，参考<a href="/consumer/cn/doc/best-practices/bpta-application-continue-progess#li631218439498">恢复数据</a>。</li><li>在onPageEnd()回调中调用runJavaScript()接口以恢复进度。<div class="screenLinkPre"><div _ngcontent-pjt-c106="" class="highlight-div"><div _ngcontent-pjt-c106="" class="highlight-div-header"><div _ngcontent-pjt-c106="" class="highlight-div-header-left"><div _ngcontent-pjt-c106="" class="handle-button expand-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pjt-c106="" class="highlight-div-header-right"><div _ngcontent-pjt-c106="" class="handle-button ai-button"></div><div _ngcontent-pjt-c106="" class="handle-button line-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pjt-c106="" class="handle-button theme-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pjt-c106="" class="handle-button copy-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pjt-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/continue-progress/blob/master/entry/src/main/ets/view/web/WebPageComponent.ets#L120-L165" data-highlighted="yes"><ol class="linenums"><li>Web({ src: <span class="hljs-keyword">this</span>.pageUrl, controller: <span class="hljs-keyword">this</span>.controller })</li><li><span class="hljs-comment">// ...</span></li><li>  .onPageEnd(async () =&gt; {</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.pageUrl.includes(<span class="hljs-string">'product_list'</span>) &amp;&amp; <span class="hljs-keyword">this</span>.continueRestore) {</li><li>      <span class="hljs-keyword">this</span>.controller.runJavaScript(<span class="hljs-string">'javascript:document.getElementById("productList").scrollTop = '</span> +</li><li>      <span class="hljs-keyword">this</span>.scrollDistance);</li><li>    }</li><li>    <span class="hljs-keyword">this</span>.pageUrl = <span class="hljs-keyword">this</span>.controller.getUrl();</li><li>    let result =</li><li>      await <span class="hljs-keyword">this</span>.controller.runJavaScript(<span class="hljs-string">'javascript:document.getElementById("productList").scrollTop'</span>);</li><li>    <span class="hljs-keyword">this</span>.scrollDistance = Number(result);</li><li>  })</li><li>  <span class="hljs-comment">// ...</span></li><li>  .onTouch(async (event: TouchEvent) =&gt; {</li><li>    <span class="hljs-keyword">if</span> (event.type === TouchType.Up) {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.pageUrl.includes(<span class="hljs-string">'product_list'</span>)) {</li><li>        let result =</li><li>          await <span class="hljs-keyword">this</span>.controller.runJavaScript(<span class="hljs-string">'javascript:document.getElementById("productList").scrollTop'</span>);</li><li>        <span class="hljs-keyword">this</span>.scrollDistance = Number(result);</li><li>      }</li><li>    }</li><li>  })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/continue-progress/blob/master/entry/src/main/ets/view/web/WebPageComponent.ets#L120-L165" target="_blank">WebPageComponent.ets</a></div></div></div></div> </li></ol> </div> <div class="tiledSection"><h2 id="section95424410162">常见问题<i class="anchor-icon anchor-icon-link" anchorid="section95424410162" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h2 id="section4284459184616">打开任意可接续应用后，对端未显示接续图标<i class="anchor-icon anchor-icon-link" anchorid="section4284459184616" tips="复制节点链接"></i></h2><p>在打开系统浏览器、已有内容的备忘录笔记界面或新开发的应用界面后，对端均未出现接续图标，可以按照以下步骤进行排查：</p> <ol><li>检查蓝牙是否已开启；</li><li>检查接续功能是否已开启：设置-&gt;多设备协同-&gt;接续；</li><li>检查是否已登录相同的华为账号；</li><li>通过命令行检查组网是否成功；<div _ngcontent-pjt-c106="" class="highlight-div"><div _ngcontent-pjt-c106="" class="highlight-div-header"><div _ngcontent-pjt-c106="" class="highlight-div-header-left"><div _ngcontent-pjt-c106="" class="handle-button expand-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pjt-c106="" class="highlight-div-header-right"><div _ngcontent-pjt-c106="" class="handle-button ai-button"></div><div _ngcontent-pjt-c106="" class="handle-button line-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pjt-c106="" class="handle-button theme-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pjt-c106="" class="handle-button copy-button"><div _ngcontent-pjt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pjt-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li>hidumper -s 4700 -a <span class="hljs-string">"buscenter -l remote_device_info"</span></li></ol></pre></div></div> <p>执行完成后，RemoteDeviceInfo中列出的设备即为已成功与当前设备组网的设备。如下图所示，该设备已与两台其他设备成功组网。</p> <p class="msonormal"><span><img originheight="737" originwidth="635" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163244.95283430866951286989967566976749:50001231000000:2800:95F1D0F1E461FBADF319A3CD34FF4DF376C30EDD996A03D9D25E873C348F9592.png" width="635" height="737"></span></p> </li></ol> </div> <div class="tiledSection"><h2 id="section23113415474">1分钟以上无任何操作，图标将自动消失；再次操作应用时，图标将重新出现<i class="anchor-icon anchor-icon-link" anchorid="section23113415474" tips="复制节点链接"></i></h2><p>图标显隐是系统的一项特性。根据当前的策略，图标在源端最后一次触屏操作后的1分钟内保持显示。如果超过1分钟没有进行任何操作，图标将自动隐藏，以减少对用户的干扰。同样地，当锁屏时，图标将在10秒后自动消失，这也是系统正常运行的一部分。</p> </div> <div class="tiledSection"><h2 id="section8578144333413">打开新接入的应用后，对端不出现图标<i class="anchor-icon anchor-icon-link" anchorid="section8578144333413" tips="复制节点链接"></i></h2><p>仅当应用配置了continuable标签，并且处于获焦且可接续状态时，才会发送接续广播，使得对端显示接续图标。可以按照以下步骤排查：</p> <ol><li>确认两端均已安装应用；</li><li>检查应用是否已将continuable标签设置为true；</li><li>确认应用是否已调用setMissionContinueState()接口将自身的迁移状态设置为false。</li></ol> </div> <div class="tiledSection"><h2 id="section2065945415163">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section2065945415163" tips="复制节点链接"></i></h2></div> <ul><li><a href="https://gitee.com/harmonyos_samples/continue-progress" target="_blank">浏览进度接续开发实践</a></li></ul> </div> <div></div></div>