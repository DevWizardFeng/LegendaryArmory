<h1 _ngcontent-iio-c119="" class="doc-title ng-star-inserted" title="深色模式适配"> 深色模式适配 </h1>

<div _ngcontent-iio-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section1755912412277">概述<i class="anchor-icon anchor-icon-link" anchorid="section1755912412277" tips="复制节点链接"></i></h2><p>深色模式（Dark Mode）又称为暗色模式，是与日常应用使用过程中的浅色模式（Light Mode）相对应的一种UI主题。深色模式最早来源于人机交互领域的研究和实践，该模式并非简单地将页面背景变为黑色，文字内容变为白色，而是提供一整套适配深色模式的应用配色主题。深色模式相较浅色模式更加柔和，能减少亮度对用户眼睛造成的刺激和疲劳，此外深色模式能在一定程度上降低应用功耗，提升续航表现。</p> <p>应用深色模式适配，需遵循基本的UX设计原则，保障应用页面内容的易读性、舒适性和一致性，具体可参考<a href="https://developer.huawei.com/consumer/cn/doc/design-guides/dark-mode-0000001823255497#section727953335811" target="_blank">深色模式设计原则</a>。应用适配过程主要包含字体颜色、元素背景色等颜色资源的适配，媒体资源如图片图标的适配，以及系统状态栏的适配，此外需要对一些特殊情况如使用了Web组件加载的Web页面进行处理。</p> <p>本文主要将介绍深色模式的适配过程，同时会列举出适配过程中的常见问题及解决方案。</p> </div> <div class="tiledSection"><h2 id="section124751846192719">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section124751846192719" tips="复制节点链接"></i></h2><p>当系统切换到深色模式后，应用内可能会出现部分内容切换到深色主题的情况，例如状态栏、弹窗背景色、系统控件等，会导致应用内页面效果错乱。</p> <p>为应对上述情况，需要对应用进行深色模式下的内容适配，目前该适配主要依靠<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/resource-categories-and-access#资源目录" target="_blank">资源目录</a>。当系统对应的设置项发生变化后（如系统语言、深浅色模式等），应用会自动加载对应资源目录下的资源文件。</p> <p>系统为深色模式预留了dark目录，该目录在应用创建时默认不存在，在进行深色模式适配时，需要开发者在src/main/resources中手动创建出dark目录，将深色模式所需的资源放置到该目录下。对于浅色模式所需的资源，可以放入默认存在的src/main/resources/base目录下。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>在进行资源定义时，需要在base目录与dark目录中定义同名的资源。例如在base/element/color.json文件中定义text_color为黑色，在dark/element/color.json文件中定义text_color为白色，那么当深浅色切换时，应用内使用了$('app.color.text_color')作为颜色值的元素会自动切换到对应的颜色，而无需使用其他逻辑判断进行控制。</p> </div></div></div> <p>一般情况下深浅色模式切换不会导致应用界面产生结构上的变化，而是页面结构一致但是采用不同的主题配色、配图等，使得整个应用在切换到深色模式后依然保持自然美观，以下为深色模式适配的UX示例。</p> <div class="fignone"><span class="figcap"><b>图1 </b>深色模式适配UX示例图</span><br><span><img height="592.302942194531" originheight="2475" originwidth="3835" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162951.77473893363730834451979080170311:50001231000000:2800:3EC2234E34DEDE65DE48D5EEB23C326AFB2FCBE16C8C7EA88BFB8A9A18073129.png" title="点击放大" width="920"></span></div> <p>从上图中可以看到，在应用进行深色模式适配过程中主要的适配项有<a href="/consumer/cn/doc/best-practices/bpta-dark-mode-adaptation#section1292642062514">颜色资源适配</a>、<a href="/consumer/cn/doc/best-practices/bpta-dark-mode-adaptation#section07671855272">媒体资源适配</a>、<a href="/consumer/cn/doc/best-practices/bpta-dark-mode-adaptation#section1618831013284">状态栏适配</a>，除此之外若应用内使用了Web组件加载的Web页面，那么还需对<a href="/consumer/cn/doc/best-practices/bpta-dark-mode-adaptation#section157048320276">Web页面适配深色模式</a>，具体适配方案可点击对应链接跳转到具体章节查看。</p> <p>目前业内应用向用户提供的深浅色模式切换有以下两种常见方式。</p> <ul><li>应用跟随系统深浅色模式切换<p>实现上，需要开发者使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-applicationcontext#applicationcontextsetcolormode11" target="_blank">setColorMode()</a>方法将<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-configurationconstant#colormode" target="_blank">ColorMode</a>设置为COLOR_MODE_NOT_SET（未设置颜色模式），然后应用在运行过程中就可以自动感知到系统颜色模式切换，若应用完成了深浅色模式适配，将自动切换到对应的颜色模式。</p> </li><li>应用内提供手动控制深浅色的开关供用户自行选择<p>实现上，切换深色模式需要调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-applicationcontext#applicationcontextsetcolormode11" target="_blank">setColorMode()</a>方法将<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-configurationconstant#colormode" target="_blank">ColorMode</a>设置为COLOR_MODE_DARK（深色模式），切换浅色模式需要将<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-configurationconstant#colormode" target="_blank">ColorMode</a>设置为COLOR_MODE_LIGHT（浅色模式），这样就可以完成对应用深浅色的手动控制。</p> </li></ul> <p>综上分析，深色模式适配内容如下表所示。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表1 </b>深色模式适配内容</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.2.12.2.4.1.1" valign="top" width="33.33333333333333%"><p>适配项</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.12.2.4.1.2" valign="top" width="33.33333333333333%"><p>适配内容</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.12.2.4.1.3" valign="top" width="33.33333333333333%"><p>适配方式</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>颜色资源适配</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>组件背景色，字体颜色等</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><ol><li>使用受支持的系统资源</li><li>使用color.json资源文件</li></ol> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>媒体资源适配</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>应用内使用到的图片、图标等</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><ol><li>SVG类型图标可使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-image#fillcolor" target="_blank">fillColor()</a>属性</li><li>使用media资源目录</li></ol> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>状态栏适配</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>深浅模式下不同的状态栏表现，包括状态栏的背景色以及状态栏内时间等内容的字体颜色</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><ol><li><a href="/consumer/cn/doc/best-practices/bpta-dark-mode-adaptation#li11588855163020">对应用背景色进行深浅色适配</a></li><li><a href="/consumer/cn/doc/best-practices/bpta-dark-mode-adaptation#li6588125519306">根据当前深浅色状态动态设置状态栏字体颜色</a></li></ol> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>Web内容适配</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>应用内使用Web组件加载的Web页面</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/web-set-dark-mode" target="_blank">Web组件设置深色模式</a></p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section128661451172714">深色模式适配<i class="anchor-icon anchor-icon-link" anchorid="section128661451172714" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section1292642062514" class="firsth2">颜色资源适配<i class="anchor-icon anchor-icon-link" anchorid="section1292642062514" tips="复制节点链接"></i></h3></div> <div class="p">颜色资源适配是将页面元素的颜色抽离到限定词目录中，让应用在不同的深浅色模式下使用不同限定词目录中的颜色值，从而达成应用页面元素在深浅色下不同的颜色表现。若应用适配代码存在错误，那么在切换到深色模式后，页面元素会由于对比度过低导致用户识别困难，以下为颜色资源适配错误的效果示例。 <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表2 </b>颜色资源适配深色模式错误效果示例</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.1.2.3.1.1" valign="top" width="50%"><p>浅色模式</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.1.2.3.1.2" valign="top" width="50%"><p>深色模式</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%"><p></p> <p><span><img height="607.4908" originheight="2257" originwidth="1087" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162951.05922547756346492518668220672949:50001231000000:2800:6F19EBC234143FCABBAACD71E4BD65343A1E43AB28760E7F0E002931BBF790B4.png" title="点击放大" width="292.6"></span></p> </td> <td class="cellrowborder" valign="top" width="50%"><p><span><img height="607.4908" originheight="2257" originwidth="1087" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162951.50050134974446708719017879599568:50001231000000:2800:9CADD959BAD970F8B3AC8D5144E0ED877F34229C585C79976D4376F334D22034.png" title="点击放大" width="292.6"></span></p> <p></p> </td> </tr>  </tbody></table></div> </div> </div> <p>上述页面效果在浅色模式下显示正常，但是当切换到深色模式后 ，弹窗内文字与弹窗背景色不满足背景色对比度不低于5:1，用户识别弹窗内容困难。上述效果的关键问题在于使用自定义弹窗时，若未手动指定弹窗背景色，系统默认对弹窗背景色做了深浅色适配，但是弹窗内的具体内容特别是开发者的自定义内容无法自动适配深色模式，于是当系统切换到深色模式下，弹窗背景色自动深色，而弹窗内容保持与浅色模式一致的颜色，导致内容无法看清，该类问题对应解决方案有以下两种。</p> <ul><li>方式一：使用系统资源（优先建议）。使用受支持的系统资源会自动适配深色模式，开发者可查看<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/resource-categories-and-access#系统资源" target="_blank">系统资源</a>获取受支持的系统资源。</li><li>方式二：使用自定义主题，若开发者需要定制在深浅色模式下不同的颜色表现，就需要使用自定义主题，以下为具体实现步骤参考。<ol><li>在src/main/resources/base/element/color.json文件中定义页面元素在浅色模式下的颜色值，此处定义了弹窗内文字在浅色模式下颜色为黑色。<div _ngcontent-iio-c106="" class="highlight-div"><div _ngcontent-iio-c106="" class="highlight-div-header"><div _ngcontent-iio-c106="" class="highlight-div-header-left"><div _ngcontent-iio-c106="" class="handle-button expand-button"><div _ngcontent-iio-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iio-c106="" class="highlight-div-header-right"><div _ngcontent-iio-c106="" class="handle-button ai-button"></div><div _ngcontent-iio-c106="" class="handle-button line-button"><div _ngcontent-iio-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iio-c106="" class="handle-button theme-button"><div _ngcontent-iio-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iio-c106="" class="handle-button copy-button"><div _ngcontent-iio-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iio-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"color"</span>: [</li><li>    {</li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"text_color"</span>,</li><li>      <span class="hljs-string">"value"</span>: <span class="hljs-string">"#000000"</span></li><li>    }</li><li>  ]</li><li>}</li></ol></pre></div></div> </li><li>在src/main/resources/dark/element/color.json文件中定义页面元素在深色模式下的颜色值（若有不存在的目录或文件需自行创建），此处定义了弹窗内文字在深色模式下颜色为白色。<div _ngcontent-iio-c106="" class="highlight-div"><div _ngcontent-iio-c106="" class="highlight-div-header"><div _ngcontent-iio-c106="" class="highlight-div-header-left"><div _ngcontent-iio-c106="" class="handle-button expand-button"><div _ngcontent-iio-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iio-c106="" class="highlight-div-header-right"><div _ngcontent-iio-c106="" class="handle-button ai-button"></div><div _ngcontent-iio-c106="" class="handle-button line-button"><div _ngcontent-iio-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iio-c106="" class="handle-button theme-button"><div _ngcontent-iio-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iio-c106="" class="handle-button copy-button"><div _ngcontent-iio-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iio-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"color"</span>: [</li><li>    {</li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"text_color"</span>,</li><li>      <span class="hljs-string">"value"</span>: <span class="hljs-string">"#FFFFFF"</span></li><li>    }</li><li>  ]</li><li>}</li></ol></pre></div></div> </li><li>在代码中引用自定义的颜色资源值，使用$r加载自定义颜色资源，系统将自动在应用深浅色变化时，加载对应限定词目录下的资源文件，从而改变页面元素的颜色完成深浅色适配。<div class="screenLinkPre"><div _ngcontent-iio-c106="" class="highlight-div"><div _ngcontent-iio-c106="" class="highlight-div-header"><div _ngcontent-iio-c106="" class="highlight-div-header-left"><div _ngcontent-iio-c106="" class="handle-button expand-button"><div _ngcontent-iio-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iio-c106="" class="highlight-div-header-right"><div _ngcontent-iio-c106="" class="handle-button ai-button"></div><div _ngcontent-iio-c106="" class="handle-button line-button"><div _ngcontent-iio-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iio-c106="" class="handle-button theme-button"><div _ngcontent-iio-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iio-c106="" class="handle-button copy-button"><div _ngcontent-iio-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iio-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/FitForDarkMode/entry/src/main/ets/pages/CustomDialogPositiveExample.ets#L17-L96" data-highlighted="yes"><ol class="linenums"><li>@<span class="hljs-title function_">Entry</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">customDialogComponentId</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">promptAction</span> = <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getPromptAction</span>();</li><li>
</li><li>  @<span class="hljs-title function_">Builder</span></li><li>  <span class="hljs-title function_">customDialogPositiveExample</span>() {</li><li>    <span class="hljs-title function_">Column</span>() {</li><li>      <span class="hljs-title function_">Text</span>(<span class="hljs-string">'授权成功'</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>($<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.color.text_color'</span>))</li><li>        <span class="hljs-comment">// ...</span></li><li>      <span class="hljs-title function_">Text</span>(<span class="hljs-string">'授权码：441132'</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>($<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.color.text_color'</span>))</li><li>
</li><li>      <span class="hljs-title function_">Row</span>({ <span class="hljs-variable">space</span>: <span class="hljs-number">8</span> }) {</li><li>        <span class="hljs-title function_">Button</span>(<span class="hljs-string">'复制'</span>, { <span class="hljs-variable">buttonStyle</span>: <span class="hljs-title class_">ButtonStyleMode</span>.<span class="hljs-title class_">TEXTUAL</span> })</li><li>          .<span class="hljs-title function_">fontColor</span>($<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.color.text_color'</span>))</li><li>          <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-title function_">Button</span>(<span class="hljs-string">'确定'</span>, { <span class="hljs-variable">buttonStyle</span>: <span class="hljs-title class_">ButtonStyleMode</span>.<span class="hljs-title class_">TEXTUAL</span> })</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/FitForDarkMode/entry/src/main/ets/pages/CustomDialogPositiveExample.ets#L17-L96" target="_blank">CustomDialogPositiveExample.ets</a></div></div></div></div> </li></ol> </li></ul>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表3 </b>颜色资源完成深色模式适配效果示例</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.8.2.3.1.1" valign="top" width="50%"><p>浅色模式</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.2.3.1.2" valign="top" width="50%"><p>深色模式</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%"><p></p> <p><span><img height="607.4908" originheight="2257" originwidth="1087" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162951.60386306034663612125040658909300:50001231000000:2800:8C9B1EE037DA0061834E054E76499A1E3C79BEB293B0A4C27DEDF27050021058.png" title="点击放大" width="292.6"></span></p> </td> <td class="cellrowborder" valign="top" width="50%"><p><span><img height="607.4908" originheight="2257" originwidth="1087" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162951.13531651454095632481020044213236:50001231000000:2800:5843C8F8C040B6CE706CC753D5F26DB53F51DE1EDF0C1AE073DEF5F35041CC70.png" title="点击放大" width="292.6"></span></p> </td> </tr>  </tbody></table></div> </div> <div class="tiledSection"><h3 id="section07671855272">媒体资源适配<i class="anchor-icon anchor-icon-link" anchorid="section07671855272" tips="复制节点链接"></i></h3></div> <p>媒体资源适配即在深浅模式下采用不同颜色表现的图片或图标等媒体资源，从而达成更好的用户体验，以下为应用内的图标未适配深色模式的效果示例，未适配内容以黄虚线框出。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表4 </b>应用内图标未适配深色模式效果示例</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.11.2.3.1.1" valign="top" width="50%"><p>浅色模式</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.2.3.1.2" valign="top" width="50%"><p>深色模式</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%"><p></p> <p><span><img height="607.4908" originheight="2257" originwidth="1087" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162951.56574851848629875017666966386803:50001231000000:2800:A474F3A937FD45FE36885BE3325EAE1F5D6E5F20C5B081178972A2CCE1D2A01E.png" title="点击放大" width="292.6"></span></p> </td> <td class="cellrowborder" valign="top" width="50%"><p></p> <p><span><img height="607.4908" originheight="2257" originwidth="1087" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162951.88618693580807107257537316643518:50001231000000:2800:F4CA80A365F969799BB05D32FE159F20F6C5C101248863E0B8E09B3A6E04D350.png" title="点击放大" width="292.6"></span></p> </td> </tr>  </tbody></table></div> </div> <p>上述错误示例效果的关键问题在于对于应用内的图标并未做深色模式下的适配，于是图标的颜色与应用浅色时一致，而两者对比度过低，导致切换到深色模式后应用内图标无法看清，媒体资源的适配有以下两种方式。</p> <ul><li>方式一：若适配简单图标并且图标格式为SVG类型，那么只需要结合<a href="/consumer/cn/doc/best-practices/bpta-dark-mode-adaptation#section1292642062514">颜色资源适配</a>并使用Image组件的fillColor属性（若使用Symbol则使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-common-components-symbol" target="_blank">SymbolGlyph</a>的fontColor属性），在不同的深浅色下设置为不同的填充色即可完成深色模式的适配。</li><li>方式二：若需要适配图片或适配图标，但图标不为SVG类型，那么就需要使用资源目录的方式进行深色模式的适配，具体实现步骤参考如下。<ol><li>在src/main/resources/base/media目录中放入浅色模式下的图片资源，并按需重命名。</li><li>在src/main/resources/dark/media目录中放入深色模式下的图片资源（若有不存在的目录需自行创建），并保证资源名称与上一步放入的资源名称一致。</li><li>在代码中使用Image组件加载对应的图片资源，此处放入资源名称为bell。<div class="screenLinkPre"><div _ngcontent-iio-c106="" class="highlight-div"><div _ngcontent-iio-c106="" class="highlight-div-header"><div _ngcontent-iio-c106="" class="highlight-div-header-left"><div _ngcontent-iio-c106="" class="handle-button expand-button"><div _ngcontent-iio-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iio-c106="" class="highlight-div-header-right"><div _ngcontent-iio-c106="" class="handle-button ai-button"></div><div _ngcontent-iio-c106="" class="handle-button line-button"><div _ngcontent-iio-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iio-c106="" class="handle-button theme-button"><div _ngcontent-iio-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iio-c106="" class="handle-button copy-button"><div _ngcontent-iio-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iio-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/FitForDarkMode/entry/src/main/ets/pages/FitDarkIcon.ets#L2-L24" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Component</span></li><li>struct Home {</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    Scroll() {</li><li>      <span class="hljs-built_in">Column</span>() {</li><li>        <span class="hljs-comment">// ...</span></li><li>
</li><li>        <span class="hljs-built_in">Stack</span>({ alignContent: Alignment.TopStart }) {</li><li>          <span class="hljs-built_in">Image</span>($r('app.media.bell'))</li><li>            <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')</li><li>            <span class="hljs-selector-class">.borderRadius</span>(<span class="hljs-number">12</span>)</li><li>            <span class="hljs-selector-class">.objectFit</span>(ImageFit.Cover)</li><li>
</li><li>          <span class="hljs-comment">// ...</span></li><li>        }</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/FitForDarkMode/entry/src/main/ets/pages/FitDarkIcon.ets#L2-L24" target="_blank">FitDarkIcon.ets</a></div></div></div></div> </li></ol> </li></ul>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表5 </b>应用内图标完成深色模式适配效果示例</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.14.2.3.1.1" valign="top" width="50%"><p>浅色模式</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.14.2.3.1.2" valign="top" width="50%"><p>深色模式</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%"><p><span><img height="607.4908" originheight="2257" originwidth="1087" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162951.99438325905404564616189878559648:50001231000000:2800:A85420683056480D04B1CF8A3CD37A82B86039398B10C5FECA7DB02DDD5D928F.png" title="点击放大" width="292.6"></span></p> </td> <td class="cellrowborder" valign="top" width="50%"><p></p> <p><span><img height="607.4908" originheight="2258" originwidth="1087" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162952.48310484208776862072125953334391:50001231000000:2800:D4F78FC8F0C9852B9A6697BE60AB2E1283A7C362A69D074BABA166763D6D1910.png" title="点击放大" width="292.6"></span></p> </td> </tr>  </tbody></table></div> </div> <div class="tiledSection"><h3 id="section1618831013284">状态栏适配<i class="anchor-icon anchor-icon-link" anchorid="section1618831013284" tips="复制节点链接"></i></h3></div> <p>状态栏适配即在深浅色模式下，采用不同的状态栏背景色与字体颜色。若应用未启用沉浸式，那么默认情况下，浅色模式下状态栏为白底黑字，深色模式下状态栏为黑底白字。当应用启用了沉浸式，状态栏背景色与应用背景色保持一致，而状态栏文字会默认在浅色模式下保持黑色，而在深色模式下保持白色，若应用在浅色模式下设置了深色背景或在深色模式下设置了浅色背景，都会造成状态栏背景色与状态栏字体颜色对比度过低而显示异常。错误效果示例如下图，应用设置了沉浸式并在浅色模式下具有纯黑色的背景色，导致状态栏的日期电量等文本内容无法看清。</p> <div class="fignone"><span class="figcap"><b>图2 </b>状态栏适配错误效果</span><br><span><img height="608.0494" originheight="2259" originwidth="1087" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162952.84676127475153211542023842390521:50001231000000:2800:DA8F7CAEBB9049CF1BCD2E64AE5438022BBCB01CDB5EBE9A66A21DBBEEE6CDD8.png" title="点击放大" width="292.6"></span></div> <p>上述错误效果的主要问题在于页面的背景色固定为黑色，当系统切换到浅色模式后，状态栏文字默认切换到黑色，此时状态栏背景色与文字颜色一致，于是状态栏中的文字就不可见了，此类问题修改方案有以下两种。</p> <ul><li id="li11588855163020"><a name="ZH-CN_TOPIC_0000002522906865__li11588855163020"></a><a name="li11588855163020"></a>若背景色可以做深浅色适配，则采用<a href="/consumer/cn/doc/best-practices/bpta-dark-mode-adaptation#section1292642062514">颜色资源适配</a>的方案对应用背景色进行适配，背景色适配时需考虑到状态栏文字在深浅色模式下的默认表现。<div class="screenLinkPre"><div _ngcontent-iio-c106="" class="highlight-div"><div _ngcontent-iio-c106="" class="highlight-div-header"><div _ngcontent-iio-c106="" class="highlight-div-header-left"><div _ngcontent-iio-c106="" class="handle-button expand-button"><div _ngcontent-iio-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iio-c106="" class="highlight-div-header-right"><div _ngcontent-iio-c106="" class="handle-button ai-button"></div><div _ngcontent-iio-c106="" class="handle-button line-button"><div _ngcontent-iio-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iio-c106="" class="handle-button theme-button"><div _ngcontent-iio-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iio-c106="" class="handle-button copy-button"><div _ngcontent-iio-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iio-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" codehub="https://gitee.com/harmonyos_samples/fit-for-dark-mode/blob/master/entry/src/main/ets/pages/Index.ets#L24-L134" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// src/main/ets/pages/Index.ets</span></li><li><span class="hljs-variable">@Entry</span></li><li><span class="hljs-variable">@Component</span></li><li>struct Index {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-selector-tag">build</span>() {</li><li>    <span class="hljs-selector-tag">Navigation</span>(this.navPathStack) {</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    .<span class="hljs-built_in">backgroundColor</span>($<span class="hljs-built_in">r</span>(<span class="hljs-string">'app.color.app_background_color'</span>))</li><li>    .<span class="hljs-built_in">hideTitleBar</span>(true)</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/fit-for-dark-mode/blob/master/entry/src/main/ets/pages/Index.ets#L24-L134" target="_blank">Index.ets</a></div></div></div></div> </li><li id="li6588125519306"><a name="ZH-CN_TOPIC_0000002522906865__li6588125519306"></a><a name="li6588125519306"></a>若背景色无法做深浅色适配，或做了深浅色适配，但是沉浸式颜色与默认的状态栏文字颜色对比度较低，这种情况下需要获取当前的深浅色并动态设置状态栏字体颜色。<ol><li>在EntryAbility中获取并维护当前深浅色状态，在onCreate时将当前colorMode放在AppStorage中，并在配置变化的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-ability#abilityonconfigurationupdate" target="_blank">onConfigurationUpdate()</a>回调中动态更新深浅色状态。<div class="screenLinkPre"><div _ngcontent-iio-c106="" class="highlight-div"><div _ngcontent-iio-c106="" class="highlight-div-header"><div _ngcontent-iio-c106="" class="highlight-div-header-left"><div _ngcontent-iio-c106="" class="handle-button expand-button"><div _ngcontent-iio-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iio-c106="" class="highlight-div-header-right"><div _ngcontent-iio-c106="" class="handle-button ai-button"></div><div _ngcontent-iio-c106="" class="handle-button line-button"><div _ngcontent-iio-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iio-c106="" class="handle-button theme-button"><div _ngcontent-iio-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iio-c106="" class="handle-button copy-button"><div _ngcontent-iio-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iio-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/fit-for-dark-mode/blob/master/entry/src/main/ets/entryability/EntryAbility.ets#L21-L76" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">export</span> <span class="hljs-variable">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-variable">extends</span> <span class="hljs-variable">UIAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-variable">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-variable">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-title class_">LaunchParam</span>): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-variable">AppStorage</span>.<span class="hljs-variable">setOrCreate</span>&lt;<span class="hljs-title class_">ConfigurationConstant</span>.<span class="hljs-title class_">ColorMode</span>&gt;(<span class="hljs-string">'currentColorMode'</span>, <span class="hljs-keyword">this</span>.<span class="hljs-variable">context</span>.<span class="hljs-variable">config</span>.<span class="hljs-variable">colorMode</span>);</li><li>    <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Ability onCreate'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-title function_">onConfigurationUpdate</span>(<span class="hljs-variable">newConfig</span>: <span class="hljs-title class_">Configuration</span>): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-variable">currentColorMode</span>: <span class="hljs-title class_">ConfigurationConstant</span>.<span class="hljs-title class_">ColorMode</span> | <span class="hljs-title class_">undefined</span> = <span class="hljs-variable">AppStorage</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'currentColorMode'</span>);</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">currentColorMode</span> !== <span class="hljs-variable">newConfig</span>.<span class="hljs-variable">colorMode</span>) {</li><li>      <span class="hljs-variable">AppStorage</span>.<span class="hljs-variable">setOrCreate</span>&lt;<span class="hljs-title class_">ConfigurationConstant</span>.<span class="hljs-title class_">ColorMode</span>&gt;(<span class="hljs-string">'currentColorMode'</span>, <span class="hljs-variable">newConfig</span>.<span class="hljs-variable">colorMode</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/fit-for-dark-mode/blob/master/entry/src/main/ets/entryability/EntryAbility.ets#L21-L76" target="_blank">EntryAbility.ets</a></div></div></div></div> </li><li>在页面内监听深浅色模式状态变量的变化，并根据变化后的深浅色模式来动态设置状态栏文本颜色。<div class="screenLinkPre"><div _ngcontent-iio-c106="" class="highlight-div"><div _ngcontent-iio-c106="" class="highlight-div-header"><div _ngcontent-iio-c106="" class="highlight-div-header-left"><div _ngcontent-iio-c106="" class="handle-button expand-button"><div _ngcontent-iio-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iio-c106="" class="highlight-div-header-right"><div _ngcontent-iio-c106="" class="handle-button ai-button"></div><div _ngcontent-iio-c106="" class="handle-button line-button"><div _ngcontent-iio-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iio-c106="" class="handle-button theme-button"><div _ngcontent-iio-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iio-c106="" class="handle-button copy-button"><div _ngcontent-iio-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iio-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/fit-for-dark-mode/blob/master/entry/src/main/ets/pages/Index.ets#L26-L135" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct Index {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-meta">@StorageProp(<span class="hljs-string">'currentColorMode'</span>)</span> <span class="hljs-meta">@Watch(<span class="hljs-string">'onCurrentColorModeChange'</span>)</span> currentColorMode: ConfigurationConstant.ColorMode =</li><li>    ConfigurationConstant.ColorMode.COLOR_MODE_NOT_SET;</li><li>  <span class="hljs-keyword">private</span> windowObj: window.Window | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>
</li><li>  aboutToAppear(): void {</li><li>    window.getLastWindow(<span class="hljs-keyword">this</span>.getUIContext().getHostContext(), (err: BusinessError, <span class="hljs-keyword">data</span>) =&gt; {</li><li>      <span class="hljs-keyword">this</span>.windowObj = <span class="hljs-keyword">data</span>;</li><li>    })</li><li>  }</li><li>
</li><li>  onCurrentColorModeChange(): void {</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.windowObj) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.currentColorMode === ConfigurationConstant.ColorMode.COLOR_MODE_LIGHT) {</li><li>      <span class="hljs-keyword">this</span>.windowObj?.setWindowSystemBarProperties({</li><li>        statusBarContentColor: <span class="hljs-string">'#000000'</span></li><li>      })</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.currentColorMode === ConfigurationConstant.ColorMode.COLOR_MODE_DARK) {</li><li>      <span class="hljs-keyword">this</span>.windowObj?.setWindowSystemBarProperties({</li><li>        statusBarContentColor: <span class="hljs-string">'#FFFFFF'</span></li><li>      })</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  build() {</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/fit-for-dark-mode/blob/master/entry/src/main/ets/pages/Index.ets#L26-L135" target="_blank">Index.ets</a></div></div></div></div> </li></ol> </li></ul> <div class="fignone"><span class="figcap"><b>图3 </b>状态栏适配深色模式后效果</span><br><span><img height="607.4908" originheight="2257" originwidth="1087" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162952.08581386378986660037781322536303:50001231000000:2800:29E12111CC34044436DB7E5A5F8737B58CA9CD2DC11AFC1D7622782B5C0CF99C.png" title="点击放大" width="292.6"></span></div> <div class="tiledSection"><h3 id="section157048320276">Web页面适配深色模式<i class="anchor-icon anchor-icon-link" anchorid="section157048320276" tips="复制节点链接"></i></h3></div> <p>Web页面的内容不会自动跟随系统颜色模式进行切换。</p> <p>若需要Web内容进行深浅色适配，就需要在Web页面内通过媒体查询的方式单独设置深色模式下的页面样式，并通过Web组件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-attributes#darkmode9" target="_blank">darkMode()</a>属性来控制Web页面是否启用深色模式。</p> <p>具体实现开发者可参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/web-set-dark-mode" target="_blank">Web组件设置深色模式</a>。</p> <div class="tiledSection"><h2 id="section571692092810">常见问题<i class="anchor-icon anchor-icon-link" anchorid="section571692092810" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section1833113215279" class="firsth2">开发者自定义的弹窗无法跟随或只有部分内容跟随系统深浅色变换<i class="anchor-icon anchor-icon-link" anchorid="section1833113215279" tips="复制节点链接"></i></h3><p><strong>可能原因</strong></p> <p>若自定义弹窗未手动指定背景色，那么系统默认对弹窗的背景色做了深色模式适配，但弹窗内的内容特别是自定义的内容，无法自动跟随系统深色模式的切换发生变化。</p> <p><strong>解决措施</strong></p> <p>参考上述适配过程对弹窗内容进行适配。</p> </div> <div class="tiledSection"><h3 id="section9268253192617">媒体资源适配时显示文件已存在<i class="anchor-icon anchor-icon-link" anchorid="section9268253192617" tips="复制节点链接"></i></h3><p><strong>问题现象</strong></p> <p>当开发者适配媒体资源时（如图片图标等），出现对应资源在另外的目录已存在的弹窗。</p> <p><strong>解决措施</strong></p> <p>直接点击弹窗内的“continue”按钮即可，并不会导致适配错误。</p> </div> <div class="tiledSection"><h2 id="section1880162511287">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section1880162511287" tips="复制节点链接"></i></h2><ul><li><a href="https://gitee.com/harmonyos_samples/fit-for-dark-mode" target="_blank">深色模式适配</a></li></ul> </div> </div></div>