<h1 _ngcontent-rkf-c119="" class="doc-title ng-star-inserted" title="生态应用相机实现系统级相机体验"> 生态应用相机实现系统级相机体验 </h1>

<div _ngcontent-rkf-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section1673321310914">概述<i class="anchor-icon anchor-icon-link" anchorid="section1673321310914" tips="复制节点链接"></i></h2><p>本文针对三方相机开发场景，基于HarmonyOS提供的相机开放能力，实现系统相机级别的效果和能力，比如分辨率、动图、视频防抖、连续变焦等。</p> </div> <div class="tiledSection"><h2 id="section871414322101">效果展示<i class="anchor-icon anchor-icon-link" anchorid="section871414322101" tips="复制节点链接"></i></h2><p>以下是系统相机与使用了部分相机开放能力的三方相机在连续变焦、视频防抖、照片高动态HDR相关场景下的效果对比。经过实际测试，这些场景下三方相机已经可以实现与系统相机相近的效果。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表1 </b>系统相机与三方相机对比</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.2.3.2.4.1.1" valign="top" width="12.14121412141214%"><p>功能</p> </th> <th align="center" class="cellrowborder" id="mcps1.3.2.3.2.4.1.2" valign="top" width="43.974397439743974%"><p>系统相机</p> </th> <th align="center" class="cellrowborder" id="mcps1.3.2.3.2.4.1.3" valign="top" width="43.884388438843885%"><p>三方相机</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="12.14121412141214%"><p>连续变焦</p> </td> <td align="center" class="cellrowborder" valign="top" width="43.974397439743974%"><p><span><img originheight="576" originwidth="324" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163027.91248707387496751194924014048498:50001231000000:2800:CAF050AF185028ABC82F8EAB6F6F246C499D8E243ABF50DB395828E28E4E7E3D.gif" width="324" height="576"></span></p> </td> <td align="center" class="cellrowborder" valign="top" width="43.884388438843885%"><p><span><img originheight="576" originwidth="324" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163027.26955254900162327647249636827256:50001231000000:2800:71F2732E86AF031913D777AB7B017ADF62828D6BD24C950B347373EF5721C385.gif" width="324" height="576"></span></p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>视频防抖：开启前</p> </td> <td align="center" class="cellrowborder" colspan="2" valign="top"><p><span><img originheight="576" originwidth="324" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163027.55956849049896662628087476690579:50001231000000:2800:A924DFE04A6EEF57F5A5D71536CBD612DD2941A7F78770DCE3659593DEC9A995.gif" width="324" height="576"></span></p> <p></p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="12.14121412141214%"><p>视频防抖：开启后</p> </td> <td align="center" class="cellrowborder" valign="top" width="43.974397439743974%"><p><span><img originheight="576" originwidth="324" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163028.45663563180147850863026420428466:50001231000000:2800:D5FCC00484B3307038DD2B06924BE9960DED4858A7D897565C64A85CDFBD340C.gif" width="324" height="576"></span></p> </td> <td align="center" class="cellrowborder" valign="top" width="43.884388438843885%"><p><span><img originheight="576" originwidth="324" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163028.79452515369469797456473851925513:50001231000000:2800:D648D17D7FB41215AF129DF21F1CA76DD8A6A27E45FF298B1588837C78713236.gif" width="324" height="576"></span></p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="12.14121412141214%"><p>照片HDR：主摄</p> </td> <td align="center" class="cellrowborder" valign="top" width="43.974397439743974%"><p><span><img originheight="528" originwidth="399" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163028.65588854357827457966731141797496:50001231000000:2800:B53D3A0961A93C2E301C0F935BBE44A597748686D19ACFB864471437E87FF7AD.png" width="380.5644564456445" height="503.604092740101"></span></p> </td> <td align="center" class="cellrowborder" valign="top" width="43.884388438843885%"><p><span><img originheight="528" originwidth="399" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163028.40004305064887759641334685281481:50001231000000:2800:EED161BB9DBF90B3822E65170B7E25F9ECDEB753B6CCF530DB717134B715A85B.png" width="379.7363736373637" height="502.50828391109786"></span></p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="12.14121412141214%"><p>照片HDR：广角</p> </td> <td align="center" class="cellrowborder" valign="top" width="43.974397439743974%"><p><span><img originheight="529" originwidth="395" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163028.22235987791668941252883324787566:50001231000000:2800:8AD1AC118100AB87E99732C9E17D665B35D8C56C828A3BE18C0F4B075C174120.png" width="380.5644564456445" height="509.667335341129"></span></p> </td> <td align="center" class="cellrowborder" valign="top" width="43.884388438843885%"><p><span><img originheight="529" originwidth="395" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163028.72783842315792700203475208966368:50001231000000:2800:95C730DC4E478EEFB90344B1DE6A3C3309F549AA541F02FFE813BA6FE0DF9456.png" width="379.7363736373637" height="508.55833330168457"></span></p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="12.14121412141214%"><p>照片HDR：长焦</p> </td> <td align="center" class="cellrowborder" valign="top" width="43.974397439743974%"><p><span><img originheight="530" originwidth="395" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163028.85019865388025621385625998223836:50001231000000:2800:C19C27B11E948AF5AE01AE813DEAF547739D9639554C37DEB1926EE3340D4496.png" width="380.5644564456445" height="510.63078966124453"></span></p> </td> <td align="center" class="cellrowborder" valign="top" width="43.884388438843885%"><p><span><img originheight="530" originwidth="395" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163028.48344702613181087627894548732332:50001231000000:2800:3BCA67B08DED2245BB232F15168FE51ADF2A734DA3C19E3CA07E011AEDA7BFE9.png" width="379.7363736373637" height="509.51969120962724"></span></p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section178037121418">场景使用说明<i class="anchor-icon anchor-icon-link" anchorid="section178037121418" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section574712813714" class="firsth2">适用范围<i class="anchor-icon anchor-icon-link" anchorid="section574712813714" tips="复制节点链接"></i></h3><p>本场景主要适用于第三方应用调用系统相机能力，实现系统级相机效果。</p> <p>限制版本Developer Beta1及以上。</p> </div> <div class="tiledSection"><h3 id="section134928719381">场景优势<i class="anchor-icon anchor-icon-link" anchorid="section134928719381" tips="复制节点链接"></i></h3><p>通过调用相机开放能力，三方相机可以实现部分系统级相机的体验和能力。当前支持的部分场景如下：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><tbody><tr><td class="cellrowborder" valign="top" width="33.333333333333336%"><p>场景分类</p> </td> <td class="cellrowborder" valign="top" width="33.64646464646464%"><p>三方相机</p> </td> <td class="cellrowborder" valign="top" width="33.02020202020202%"><p>系统相机</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.333333333333336%"><p>多摄连续变焦（画面亮度，颜色一致）</p> </td> <td class="cellrowborder" valign="top" width="33.64646464646464%"><p>支持</p> </td> <td class="cellrowborder" valign="top" width="33.02020202020202%"><p>支持</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.333333333333336%"><p>视频防抖</p> </td> <td class="cellrowborder" valign="top" width="33.64646464646464%"><p>支持</p> </td> <td class="cellrowborder" valign="top" width="33.02020202020202%"><p>支持</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.333333333333336%"><p>照片高动态HDR</p> </td> <td class="cellrowborder" valign="top" width="33.64646464646464%"><p>支持</p> </td> <td class="cellrowborder" valign="top" width="33.02020202020202%"><p>支持</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section84411331386">场景分析<i class="anchor-icon anchor-icon-link" anchorid="section84411331386" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section10661161143918" class="firsth2">典型场景<i class="anchor-icon anchor-icon-link" anchorid="section10661161143918" tips="复制节点链接"></i></h3> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><tbody><tr><td class="cellrowborder" valign="top" width="21.25%"><p>场景名称</p> </td> <td class="cellrowborder" valign="top" width="26.52%"><p>描述</p> </td> <td class="cellrowborder" valign="top" width="52.23%"><p>实现方案</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="21.25%"><p>拍照</p> </td> <td class="cellrowborder" valign="top" width="26.52%"><p>照片拍摄</p> </td> <td class="cellrowborder" valign="top" width="52.23%"><p>Camera kit</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="21.25%"><p>录像</p> </td> <td class="cellrowborder" valign="top" width="26.52%"><p>视频录制</p> </td> <td class="cellrowborder" valign="top" width="52.23%"><p>AVRecorder和Camera kit</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="21.25%"><p>动态照片</p> </td> <td class="cellrowborder" valign="top" width="26.52%"><p>动态照片拍摄以及预览</p> </td> <td class="cellrowborder" valign="top" width="52.23%"><p>Camera kit和MovingPhotoView组件</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section1162333411399">场景实现<i class="anchor-icon anchor-icon-link" anchorid="section1162333411399" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section1778074211398" class="firsth2">场景整体介绍<i class="anchor-icon anchor-icon-link" anchorid="section1778074211398" tips="复制节点链接"></i></h3><p><strong>原理介绍</strong></p> <p>三方相机开放能力采用与系统相机统一底层接口调用方式，使最终的拍摄保持系统级效果。</p> <p><span><img originheight="447" originwidth="387" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163028.30415851870169790500695333927689:50001231000000:2800:793A13D4E299E8C8C902E8FFC8EF7478F96782965BAA4C1AB2630DA4900137A3.png" width="387" height="447"></span></p> <p><strong>整体流程</strong></p> <p>本场景解决方案按照如下流程实现三方相机效果，推荐开发者参考相同流程进行接入，以保证更好体验：</p> <p><span><img originheight="142" originwidth="858" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163028.24157747123259046576572159671929:50001231000000:2800:BEEA69F9C9832B6F05B5CA8E746B375C5BC6E67E606CA49A50A16CAAEF8473A6.png" width="858" height="142"></span></p> </div> <div class="tiledSection"><h3 id="section1355085015614">拍照<i class="anchor-icon anchor-icon-link" anchorid="section1355085015614" tips="复制节点链接"></i></h3><p>如图1所示，应用可以点击底部圆形按钮拍摄照片，同时可以调节变焦，闪光灯等参数。</p> <div class="fignone"><span class="figcap"><b>图1 </b>拍照界面</span></div> <p><span><img height="563.6274" originheight="695" originwidth="328" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163028.32838448964918367225414637303366:50001231000000:2800:1024635251B32D19192DD921F4AB612A232A969C99AB612D0E4452DCFC027D01.png" title="点击放大" width="266"></span></p> <p><strong>时序图</strong></p> <p><span><img originheight="538" originwidth="521" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163028.42535486826759697886722447418800:50001231000000:2800:7140C0719EEB69148A6F23FAF2F1381562E5A69EDA6B033740C136F8A4E74E84.png" width="521" height="538"></span></p> </div> <p><strong>关键点说明</strong></p> <p>需要获得将照片存入图库的权限。</p> <p><strong>关键代码片段</strong></p> <p>1、创建CameraManager对象，需要通过UIContext创建，用来对相机进行操作。</p> <div class="screenLinkPre"><div _ngcontent-rkf-c106="" class="highlight-div"><div _ngcontent-rkf-c106="" class="highlight-div-header"><div _ngcontent-rkf-c106="" class="highlight-div-header-left"><div _ngcontent-rkf-c106="" class="handle-button expand-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rkf-c106="" class="highlight-div-header-right"><div _ngcontent-rkf-c106="" class="handle-button ai-button"></div><div _ngcontent-rkf-c106="" class="handle-button line-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rkf-c106="" class="handle-button theme-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rkf-c106="" class="handle-button copy-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rkf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L42-L42" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-variable">cameraManager</span>: <span class="hljs-title class_">camera</span>.<span class="hljs-title class_">CameraManager</span> = <span class="hljs-variable">camera</span>.<span class="hljs-title function_">getCameraManager</span>(<span class="hljs-variable">context</span>);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L42-L42" target="_blank">CameraShooter.ets</a></div></div></div></div> <p>2、获取相机列表，系统会提供前置和后置相机，供开发者选择切换。</p> <div class="screenLinkPre"><div _ngcontent-rkf-c106="" class="highlight-div"><div _ngcontent-rkf-c106="" class="highlight-div-header"><div _ngcontent-rkf-c106="" class="highlight-div-header-left"><div _ngcontent-rkf-c106="" class="handle-button expand-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rkf-c106="" class="highlight-div-header-right"><div _ngcontent-rkf-c106="" class="handle-button ai-button"></div><div _ngcontent-rkf-c106="" class="handle-button line-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rkf-c106="" class="handle-button theme-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rkf-c106="" class="handle-button copy-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rkf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L50-L50" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-variable">cameraArray</span>: <span class="hljs-title class_">camera</span>.<span class="hljs-title class_">CameraDevice</span>[] = <span class="hljs-variable">cameraManager</span>.<span class="hljs-title function_">getSupportedCameras</span>();</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L50-L50" target="_blank">CameraShooter.ets</a></div></div></div></div> <p>3、选择摄像头，创建输入流，作为预览流和拍照流的提供方。</p> <div class="screenLinkPre"><div _ngcontent-rkf-c106="" class="highlight-div"><div _ngcontent-rkf-c106="" class="highlight-div-header"><div _ngcontent-rkf-c106="" class="highlight-div-header-left"><div _ngcontent-rkf-c106="" class="handle-button expand-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rkf-c106="" class="highlight-div-header-right"><div _ngcontent-rkf-c106="" class="handle-button ai-button"></div><div _ngcontent-rkf-c106="" class="handle-button line-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rkf-c106="" class="handle-button theme-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rkf-c106="" class="handle-button copy-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rkf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-python" codehub="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L56-L57" data-highlighted="yes"><ol class="linenums"><li>cameraInput = cameraManager.createCameraInput(cameraArray[cameraPosition]);</li><li><span class="hljs-keyword">await</span> cameraInput.<span class="hljs-built_in">open</span>();</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L56-L57" target="_blank">CameraShooter.ets</a></div></div></div></div> <p>4、获取相机设备支持的输出流能力，此处指定NORMAL_PHOTO获取的是照片流，用来创建拍照输出流和预览输出流。</p> <div class="screenLinkPre"><div _ngcontent-rkf-c106="" class="highlight-div"><div _ngcontent-rkf-c106="" class="highlight-div-header"><div _ngcontent-rkf-c106="" class="highlight-div-header-left"><div _ngcontent-rkf-c106="" class="handle-button expand-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rkf-c106="" class="highlight-div-header-right"><div _ngcontent-rkf-c106="" class="handle-button ai-button"></div><div _ngcontent-rkf-c106="" class="handle-button line-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rkf-c106="" class="handle-button theme-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rkf-c106="" class="handle-button copy-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rkf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L61-L62" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-variable">cameraOutputCap</span>: <span class="hljs-title class_">camera</span>.<span class="hljs-title class_">CameraOutputCapability</span> =</li><li>  <span class="hljs-variable">cameraManager</span>.<span class="hljs-title function_">getSupportedOutputCapability</span>(<span class="hljs-variable">cameraArray</span>[<span class="hljs-variable">cameraPosition</span>], <span class="hljs-variable">camera</span>.<span class="hljs-variable">SceneMode</span>.<span class="hljs-variable">NORMAL_PHOTO</span>);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L61-L62" target="_blank">CameraShooter.ets</a></div></div></div></div> <p>5、创建预览输出流，通过surfaceId绑定显示组件XComponent。</p> <div class="screenLinkPre"><div _ngcontent-rkf-c106="" class="highlight-div"><div _ngcontent-rkf-c106="" class="highlight-div-header"><div _ngcontent-rkf-c106="" class="highlight-div-header-left"><div _ngcontent-rkf-c106="" class="handle-button expand-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rkf-c106="" class="highlight-div-header-right"><div _ngcontent-rkf-c106="" class="handle-button ai-button"></div><div _ngcontent-rkf-c106="" class="handle-button line-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rkf-c106="" class="handle-button theme-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rkf-c106="" class="handle-button copy-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rkf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L71-L88" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-variable">previewProfilesArray</span>: <span class="hljs-title class_">camera</span>.<span class="hljs-title class_">Profile</span>[] = <span class="hljs-variable">cameraOutputCap</span>.<span class="hljs-variable">previewProfiles</span>;</li><li><span class="hljs-variable">previewOutput</span> = <span class="hljs-variable">cameraManager</span>.<span class="hljs-title function_">createPreviewOutput</span>(<span class="hljs-variable">previewProfile</span>, <span class="hljs-variable">surfaceId</span>);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L71-L88" target="_blank">CameraShooter.ets</a></div></div></div></div> <p>6、创建拍照输出流，可以输出照片文件。</p> <div class="screenLinkPre"><div _ngcontent-rkf-c106="" class="highlight-div"><div _ngcontent-rkf-c106="" class="highlight-div-header"><div _ngcontent-rkf-c106="" class="highlight-div-header-left"><div _ngcontent-rkf-c106="" class="handle-button expand-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rkf-c106="" class="highlight-div-header-right"><div _ngcontent-rkf-c106="" class="handle-button ai-button"></div><div _ngcontent-rkf-c106="" class="handle-button line-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rkf-c106="" class="handle-button theme-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rkf-c106="" class="handle-button copy-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rkf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L75-L95" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-variable">photoProfilesArray</span>: <span class="hljs-title class_">camera</span>.<span class="hljs-title class_">Profile</span>[] = <span class="hljs-variable">cameraOutputCap</span>.<span class="hljs-variable">photoProfiles</span>.<span class="hljs-title function_">slice</span>().<span class="hljs-title function_">reverse</span>();</li><li>
</li><li><span class="hljs-variable">photoOutPut</span> = <span class="hljs-variable">cameraManager</span>.<span class="hljs-title function_">createPhotoOutput</span>(<span class="hljs-variable">photoProfile</span>);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L75-L95" target="_blank">CameraShooter.ets</a></div></div></div></div> <p>7、创建相机会话，用于控制修改拍照参数。</p> <div class="screenLinkPre"><div _ngcontent-rkf-c106="" class="highlight-div"><div _ngcontent-rkf-c106="" class="highlight-div-header"><div _ngcontent-rkf-c106="" class="highlight-div-header-left"><div _ngcontent-rkf-c106="" class="handle-button expand-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rkf-c106="" class="highlight-div-header-right"><div _ngcontent-rkf-c106="" class="handle-button ai-button"></div><div _ngcontent-rkf-c106="" class="handle-button line-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rkf-c106="" class="handle-button theme-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rkf-c106="" class="handle-button copy-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rkf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-ini" codehub="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L103-L103" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">photoSession</span> = cameraManager.createSession(camera.SceneMode.NORMAL_PHOTO) as camera.PhotoSession<span class="hljs-comment">;</span></li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L103-L103" target="_blank">CameraShooter.ets</a></div></div></div></div> <p>8、开始配置会话，向会话中添加各路输入输出流，之后可以拍照。</p> <div class="screenLinkPre"><div _ngcontent-rkf-c106="" class="highlight-div"><div _ngcontent-rkf-c106="" class="highlight-div-header"><div _ngcontent-rkf-c106="" class="highlight-div-header-left"><div _ngcontent-rkf-c106="" class="handle-button expand-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rkf-c106="" class="highlight-div-header-right"><div _ngcontent-rkf-c106="" class="handle-button ai-button"></div><div _ngcontent-rkf-c106="" class="handle-button line-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rkf-c106="" class="handle-button theme-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rkf-c106="" class="handle-button copy-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rkf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L109-L115" data-highlighted="yes"><ol class="linenums"><li>photoSession<span class="hljs-selector-class">.beginConfig</span>();</li><li>photoSession<span class="hljs-selector-class">.addInput</span>(cameraInput);</li><li>photoSession<span class="hljs-selector-class">.addOutput</span>(previewOutput);</li><li>photoSession<span class="hljs-selector-class">.addOutput</span>(photoOutPut);</li><li>photoSession<span class="hljs-selector-class">.setColorSpace</span>(colorSpaceManager.ColorSpace.DISPLAY_P3);</li><li>await photoSession<span class="hljs-selector-class">.commitConfig</span>();</li><li>await photoSession<span class="hljs-selector-class">.start</span>();</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L109-L115" target="_blank">CameraShooter.ets</a></div></div></div></div> <p>9、调节闪光灯，通过FLASH_MODE_CLOSE设置为关闭，目前支持关闭、自动、常亮、打开。</p> <div class="screenLinkPre"><div _ngcontent-rkf-c106="" class="highlight-div"><div _ngcontent-rkf-c106="" class="highlight-div-header"><div _ngcontent-rkf-c106="" class="highlight-div-header-left"><div _ngcontent-rkf-c106="" class="handle-button expand-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rkf-c106="" class="highlight-div-header-right"><div _ngcontent-rkf-c106="" class="handle-button ai-button"></div><div _ngcontent-rkf-c106="" class="handle-button line-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rkf-c106="" class="handle-button theme-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rkf-c106="" class="handle-button copy-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rkf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L122-L122" data-highlighted="yes"><ol class="linenums"><li>photoSession<span class="hljs-selector-class">.setFlashMode</span>(camera.FlashMode.FLASH_MODE_CLOSE);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L122-L122" target="_blank">CameraShooter.ets</a></div></div></div></div> <p>10、调节自动变焦模式，通过FOCUS_MODE_CONTINUOUS_AUTO设置为自动模式。目前支持连续自动对焦、自动对焦、手动对焦。</p> <div class="screenLinkPre"><div _ngcontent-rkf-c106="" class="highlight-div"><div _ngcontent-rkf-c106="" class="highlight-div-header"><div _ngcontent-rkf-c106="" class="highlight-div-header-left"><div _ngcontent-rkf-c106="" class="handle-button expand-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rkf-c106="" class="highlight-div-header-right"><div _ngcontent-rkf-c106="" class="handle-button ai-button"></div><div _ngcontent-rkf-c106="" class="handle-button line-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rkf-c106="" class="handle-button theme-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rkf-c106="" class="handle-button copy-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rkf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L130-L130" data-highlighted="yes"><ol class="linenums"><li>photoSession<span class="hljs-selector-class">.setFocusMode</span>(camera.FocusMode.FOCUS_MODE_CONTINUOUS_AUTO);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L130-L130" target="_blank">CameraShooter.ets</a></div></div></div></div> <p>11、调节相机焦距，超出范围则只保留支持范围的值。</p> <div class="screenLinkPre"><div _ngcontent-rkf-c106="" class="highlight-div"><div _ngcontent-rkf-c106="" class="highlight-div-header"><div _ngcontent-rkf-c106="" class="highlight-div-header-left"><div _ngcontent-rkf-c106="" class="handle-button expand-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rkf-c106="" class="highlight-div-header-right"><div _ngcontent-rkf-c106="" class="handle-button ai-button"></div><div _ngcontent-rkf-c106="" class="handle-button line-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rkf-c106="" class="handle-button theme-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rkf-c106="" class="handle-button copy-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rkf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L151-L151" data-highlighted="yes"><ol class="linenums"><li>photoSession<span class="hljs-selector-class">.setZoomRatio</span>(zoom);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L151-L151" target="_blank">CameraShooter.ets</a></div></div></div></div> <p>12、点击拍照，通过QUALITY_LEVEL_HIGH选择高质量模式。</p> <div class="screenLinkPre"><div _ngcontent-rkf-c106="" class="highlight-div"><div _ngcontent-rkf-c106="" class="highlight-div-header"><div _ngcontent-rkf-c106="" class="highlight-div-header-left"><div _ngcontent-rkf-c106="" class="handle-button expand-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rkf-c106="" class="highlight-div-header-right"><div _ngcontent-rkf-c106="" class="handle-button ai-button"></div><div _ngcontent-rkf-c106="" class="handle-button line-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rkf-c106="" class="handle-button theme-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rkf-c106="" class="handle-button copy-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rkf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L166-L171" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-variable">settings</span>: <span class="hljs-title class_">camera</span>.<span class="hljs-title class_">PhotoCaptureSetting</span> = {</li><li>  <span class="hljs-variable">quality</span>: <span class="hljs-title class_">camera</span>.<span class="hljs-title class_">QualityLevel</span>.<span class="hljs-title class_">QUALITY_LEVEL_HIGH</span>,</li><li>  <span class="hljs-variable">rotation</span>: <span class="hljs-title class_">curRotation</span> ? <span class="hljs-title class_">getPhotoRotation</span>(<span class="hljs-title class_">photoOutPut</span>, <span class="hljs-title class_">curRotation</span>) : <span class="hljs-title class_">camera</span>.<span class="hljs-title class_">ImageRotation</span>.<span class="hljs-title class_">ROTATION_0</span>,</li><li>  <span class="hljs-variable">mirror</span>: <span class="hljs-title class_">isFront</span></li><li>};</li><li><span class="hljs-variable">photoOutPut</span>.<span class="hljs-title function_">capture</span>(<span class="hljs-variable">settings</span>);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L166-L171" target="_blank">CameraShooter.ets</a></div></div></div></div> <p>13、保存图片，此处需要调用系统图库接口photoAccessHelper。</p> <div class="screenLinkPre"><div _ngcontent-rkf-c106="" class="highlight-div"><div _ngcontent-rkf-c106="" class="highlight-div-header"><div _ngcontent-rkf-c106="" class="highlight-div-header-left"><div _ngcontent-rkf-c106="" class="handle-button expand-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rkf-c106="" class="highlight-div-header-right"><div _ngcontent-rkf-c106="" class="handle-button ai-button"></div><div _ngcontent-rkf-c106="" class="handle-button line-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rkf-c106="" class="handle-button theme-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rkf-c106="" class="handle-button copy-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rkf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L218-L231" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">function</span> <span class="hljs-title function_">setPhotoOutputCb</span>(<span class="hljs-variable">photoOutput</span>: <span class="hljs-title class_">camera</span>.<span class="hljs-title class_">PhotoOutput</span>): <span class="hljs-title class_">void</span> {</li><li>  <span class="hljs-variable">photoOutput</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'photoAssetAvailable'</span>,</li><li>    <span class="hljs-variable">async</span> (<span class="hljs-variable">_err</span>: <span class="hljs-title class_">BusinessError</span>, <span class="hljs-variable">photoAsset</span>: <span class="hljs-title class_">photoAccessHelper</span>.<span class="hljs-title class_">PhotoAsset</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">void</span>&gt; =&gt; {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-variable">accessHelper</span>: <span class="hljs-title class_">photoAccessHelper</span>.<span class="hljs-title class_">PhotoAccessHelper</span> =</li><li>        <span class="hljs-variable">photoAccessHelper</span>.<span class="hljs-title function_">getPhotoAccessHelper</span>(<span class="hljs-variable">currentContext</span>);</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-variable">assetChangeRequest</span>: <span class="hljs-title class_">photoAccessHelper</span>.<span class="hljs-title class_">MediaAssetChangeRequest</span> =</li><li>        <span class="hljs-variable">new</span> <span class="hljs-variable">photoAccessHelper</span>.<span class="hljs-title function_">MediaAssetChangeRequest</span>(<span class="hljs-variable">photoAsset</span>);</li><li>      <span class="hljs-variable">assetChangeRequest</span>.<span class="hljs-title function_">saveCameraPhoto</span>();</li><li>      <span class="hljs-variable">await</span> <span class="hljs-variable">accessHelper</span>.<span class="hljs-title function_">applyChanges</span>(<span class="hljs-variable">assetChangeRequest</span>);</li><li>      <span class="hljs-variable">uri</span> = <span class="hljs-variable">photoAsset</span>.<span class="hljs-variable">uri</span>;</li><li>      <span class="hljs-variable">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'photoUri'</span>, <span class="hljs-variable">await</span> <span class="hljs-variable">photoAsset</span>.<span class="hljs-title function_">getThumbnail</span>());</li><li>    });</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L218-L231" target="_blank">CameraShooter.ets</a></div></div></div></div> <p>14、预览图片，应用将跳转进入系统图库应用进行预览，需要传入对应的图库uri。</p> <div class="screenLinkPre"><div _ngcontent-rkf-c106="" class="highlight-div"><div _ngcontent-rkf-c106="" class="highlight-div-header"><div _ngcontent-rkf-c106="" class="highlight-div-header-left"><div _ngcontent-rkf-c106="" class="handle-button expand-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rkf-c106="" class="highlight-div-header-right"><div _ngcontent-rkf-c106="" class="handle-button ai-button"></div><div _ngcontent-rkf-c106="" class="handle-button line-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rkf-c106="" class="handle-button theme-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rkf-c106="" class="handle-button copy-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rkf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L238-L247" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">export</span> <span class="hljs-variable">function</span> <span class="hljs-title function_">previewPhoto</span>(<span class="hljs-variable">context</span>: <span class="hljs-title class_">Context</span>): <span class="hljs-title class_">void</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">photoContext</span> = <span class="hljs-variable">context</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">common</span>.<span class="hljs-variable">UIAbilityContext</span>;</li><li>  <span class="hljs-variable">photoContext</span>.<span class="hljs-title function_">startAbility</span>({</li><li>    <span class="hljs-variable">parameters</span>: { <span class="hljs-variable">uri</span>: <span class="hljs-title class_">uri</span> },</li><li>    <span class="hljs-variable">action</span>: <span class="hljs-string">'ohos.want.action.viewData'</span>,</li><li>    <span class="hljs-variable">bundleName</span>: <span class="hljs-string">'com.huawei.hmos.photos'</span>,</li><li>    <span class="hljs-variable">abilityName</span>: <span class="hljs-string">'com.huawei.hmos.photos.MainAbility'</span></li><li>  })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L238-L247" target="_blank">CameraShooter.ets</a></div></div></div></div> <p><strong>API使用链接</strong></p> <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-camera" target="_blank">相机管理</a></p> <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-photoaccesshelper" target="_blank">相册管理模块</a></p> <div class="tiledSection"><h3 id="section1192635723415">录像<i class="anchor-icon anchor-icon-link" anchorid="section1192635723415" tips="复制节点链接"></i></h3><p>用户在应用界面上点击按钮开始录制，再次点击红色按钮结束录制，同时可以调节变焦、闪光灯、分辨率、视频防抖等参数。</p> <div class="fignone"><span class="figcap"><b>图2 </b>录像界面</span></div> <p></p> <p><span><img height="563.6274" originheight="695" originwidth="328" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163029.69469193872814267055607151506631:50001231000000:2800:90CB320BFDF30790D8DBDAF87E2539A256147978BC5FC68381741960AF554059.png" title="点击放大" width="266"></span></p> <p><strong>时序图</strong></p> <p><span><img originheight="614" originwidth="522" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163029.64506859128055264737189400949042:50001231000000:2800:1F7E0BC1BA3DA9BEE2C531551E0A4493A47D29A54951E7C78AFCB2C4173B998A.png" width="522" height="614"></span></p> <p><strong>关键点说明</strong></p> <p>需要获得将照片存入图库的权限。</p> <p><strong>关键代码片段</strong></p> <p>1、创建CameraManager对象，需要通过UIContext创建，用来对相机进行操作。</p> <div class="screenLinkPre"><div _ngcontent-rkf-c106="" class="highlight-div"><div _ngcontent-rkf-c106="" class="highlight-div-header"><div _ngcontent-rkf-c106="" class="highlight-div-header-left"><div _ngcontent-rkf-c106="" class="handle-button expand-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rkf-c106="" class="highlight-div-header-right"><div _ngcontent-rkf-c106="" class="handle-button ai-button"></div><div _ngcontent-rkf-c106="" class="handle-button line-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rkf-c106="" class="handle-button theme-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rkf-c106="" class="handle-button copy-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rkf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L42-L42" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-variable">cameraManager</span>: <span class="hljs-title class_">camera</span>.<span class="hljs-title class_">CameraManager</span> = <span class="hljs-variable">camera</span>.<span class="hljs-title function_">getCameraManager</span>(<span class="hljs-variable">context</span>);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L42-L42" target="_blank">CameraShooter.ets</a></div></div></div></div> <p>2、获取相机列表，系统会提供前置和后置相机，供开发者选择切换。</p> <div class="screenLinkPre"><div _ngcontent-rkf-c106="" class="highlight-div"><div _ngcontent-rkf-c106="" class="highlight-div-header"><div _ngcontent-rkf-c106="" class="highlight-div-header-left"><div _ngcontent-rkf-c106="" class="handle-button expand-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rkf-c106="" class="highlight-div-header-right"><div _ngcontent-rkf-c106="" class="handle-button ai-button"></div><div _ngcontent-rkf-c106="" class="handle-button line-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rkf-c106="" class="handle-button theme-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rkf-c106="" class="handle-button copy-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rkf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/VideoRecorder.ets#L43-L43" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-variable">cameraArray</span>: <span class="hljs-title class_">camera</span>.<span class="hljs-title class_">CameraDevice</span>[] = <span class="hljs-variable">cameraManager</span>.<span class="hljs-title function_">getSupportedCameras</span>();</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/VideoRecorder.ets#L43-L43" target="_blank">VideoRecorder.ets</a></div></div></div></div> <p>3、选择摄像头，创建输入流，作为预览流和拍照流的提供方。</p> <div class="screenLinkPre"><div _ngcontent-rkf-c106="" class="highlight-div"><div _ngcontent-rkf-c106="" class="highlight-div-header"><div _ngcontent-rkf-c106="" class="highlight-div-header-left"><div _ngcontent-rkf-c106="" class="handle-button expand-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rkf-c106="" class="highlight-div-header-right"><div _ngcontent-rkf-c106="" class="handle-button ai-button"></div><div _ngcontent-rkf-c106="" class="handle-button line-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rkf-c106="" class="handle-button theme-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rkf-c106="" class="handle-button copy-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rkf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" codehub="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/VideoRecorder.ets#L150-L156" data-highlighted="yes"><ol class="linenums"><li>cameraInput = cameraManager.createCameraInput(cameraArray[cameraPosition]);</li><li><span class="hljs-comment">// ...</span></li><li><span class="hljs-keyword">await</span> cameraInput.open();</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/VideoRecorder.ets#L150-L156" target="_blank">VideoRecorder.ets</a></div></div></div></div> <p>4、获取相机设备支持的输出流能力，此处指定NORMAL_VIDEO获取的是视频流，用来创建视频输出流和视频预览输出流。</p> <div class="screenLinkPre"><div _ngcontent-rkf-c106="" class="highlight-div"><div _ngcontent-rkf-c106="" class="highlight-div-header"><div _ngcontent-rkf-c106="" class="highlight-div-header-left"><div _ngcontent-rkf-c106="" class="handle-button expand-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rkf-c106="" class="highlight-div-header-right"><div _ngcontent-rkf-c106="" class="handle-button ai-button"></div><div _ngcontent-rkf-c106="" class="handle-button line-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rkf-c106="" class="handle-button theme-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rkf-c106="" class="handle-button copy-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rkf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/VideoRecorder.ets#L53-L55" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Obtains the output stream capability supported by the camera.</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">cameraOutputCap</span>: <span class="hljs-title class_">camera</span>.<span class="hljs-title class_">CameraOutputCapability</span> =</li><li>  <span class="hljs-variable">cameraManager</span>.<span class="hljs-title function_">getSupportedOutputCapability</span>(<span class="hljs-variable">cameraArray</span>[<span class="hljs-variable">cameraPosition</span>], <span class="hljs-variable">camera</span>.<span class="hljs-variable">SceneMode</span>.<span class="hljs-variable">NORMAL_VIDEO</span>);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/VideoRecorder.ets#L53-L55" target="_blank">VideoRecorder.ets</a></div></div></div></div> <p>5、创建预览输出流，通过surfaceId绑定显示组件XComponent。</p> <div class="screenLinkPre"><div _ngcontent-rkf-c106="" class="highlight-div"><div _ngcontent-rkf-c106="" class="highlight-div-header"><div _ngcontent-rkf-c106="" class="highlight-div-header-left"><div _ngcontent-rkf-c106="" class="handle-button expand-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rkf-c106="" class="highlight-div-header-right"><div _ngcontent-rkf-c106="" class="handle-button ai-button"></div><div _ngcontent-rkf-c106="" class="handle-button line-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rkf-c106="" class="handle-button theme-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rkf-c106="" class="handle-button copy-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rkf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/VideoRecorder.ets#L62-L166" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-variable">previewProfilesArray</span>: <span class="hljs-title class_">camera</span>.<span class="hljs-title class_">Profile</span>[] = <span class="hljs-variable">cameraOutputCap</span>.<span class="hljs-variable">previewProfiles</span>;</li><li>
</li><li><span class="hljs-comment">// Create previewOutput with target previewProfile from previewProfilesArray</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">previewOutput</span>: <span class="hljs-title class_">camera</span>.<span class="hljs-title class_">PreviewOutput</span> | <span class="hljs-title class_">undefined</span> = <span class="hljs-variable">cameraManager</span>.<span class="hljs-title function_">createPreviewOutput</span>(<span class="hljs-variable">previewProfile</span>, <span class="hljs-variable">surfaceId</span>);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/VideoRecorder.ets#L62-L166" target="_blank">VideoRecorder.ets</a></div></div></div></div> <p>6、创建视频输出流，可以输出视频文件。</p> <div class="screenLinkPre"><div _ngcontent-rkf-c106="" class="highlight-div"><div _ngcontent-rkf-c106="" class="highlight-div-header"><div _ngcontent-rkf-c106="" class="highlight-div-header-left"><div _ngcontent-rkf-c106="" class="handle-button expand-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rkf-c106="" class="highlight-div-header-right"><div _ngcontent-rkf-c106="" class="handle-button ai-button"></div><div _ngcontent-rkf-c106="" class="handle-button line-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rkf-c106="" class="handle-button theme-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rkf-c106="" class="handle-button copy-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rkf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/VideoRecorder.ets#L73-L135" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-variable">videoProfile</span>: <span class="hljs-title class_">undefined</span> | <span class="hljs-title class_">camera</span>.<span class="hljs-title class_">VideoProfile</span> = <span class="hljs-variable">videoProfilesArray</span>.<span class="hljs-title function_">find</span>((<span class="hljs-variable">profile</span>: <span class="hljs-title class_">camera</span>.<span class="hljs-title class_">VideoProfile</span>) =&gt; {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-variable">previewProfile</span> &amp;&amp; <span class="hljs-variable">cameraPosition</span> === <span class="hljs-number">1</span>) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">profile</span>.<span class="hljs-variable">size</span>.<span class="hljs-variable">width</span> &gt;= <span class="hljs-number">1080</span> &amp;&amp; <span class="hljs-variable">profile</span>.<span class="hljs-variable">size</span>.<span class="hljs-variable">height</span> &gt;= <span class="hljs-number">1080</span> &amp;&amp;</li><li>      <span class="hljs-variable">profile</span>.<span class="hljs-variable">size</span>.<span class="hljs-variable">height</span> === (<span class="hljs-variable">previewProfile</span>.<span class="hljs-variable">size</span>.<span class="hljs-variable">height</span> / <span class="hljs-variable">previewProfile</span>.<span class="hljs-variable">size</span>.<span class="hljs-variable">width</span>) * <span class="hljs-variable">profile</span>.<span class="hljs-variable">size</span>.<span class="hljs-variable">width</span> &amp;&amp;</li><li>      <span class="hljs-variable">profile</span>.<span class="hljs-variable">frameRateRange</span>.<span class="hljs-variable">max</span> === <span class="hljs-number">30</span>;</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-variable">previewProfile</span> &amp;&amp; <span class="hljs-variable">qualityLevel</span> === <span class="hljs-number">0</span>) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">profile</span>.<span class="hljs-variable">size</span>.<span class="hljs-variable">width</span> &lt;= <span class="hljs-number">1920</span> &amp;&amp; <span class="hljs-title class_">profile</span>.<span class="hljs-title class_">size</span>.<span class="hljs-title class_">width</span> &gt;= <span class="hljs-number">1080</span> &amp;&amp; <span class="hljs-variable">profile</span>.<span class="hljs-variable">size</span>.<span class="hljs-variable">height</span> &gt;= <span class="hljs-number">1080</span> &amp;&amp;</li><li>      <span class="hljs-variable">profile</span>.<span class="hljs-variable">size</span>.<span class="hljs-variable">height</span> === (<span class="hljs-variable">previewProfile</span>.<span class="hljs-variable">size</span>.<span class="hljs-variable">height</span> / <span class="hljs-variable">previewProfile</span>.<span class="hljs-variable">size</span>.<span class="hljs-variable">width</span>) * <span class="hljs-variable">profile</span>.<span class="hljs-variable">size</span>.<span class="hljs-variable">width</span> &amp;&amp;</li><li>      <span class="hljs-variable">profile</span>.<span class="hljs-variable">frameRateRange</span>.<span class="hljs-variable">max</span> === <span class="hljs-number">60</span>;</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-variable">previewProfile</span> &amp;&amp; <span class="hljs-variable">qualityLevel</span> === <span class="hljs-number">1</span> &amp;&amp; <span class="hljs-variable">cameraPosition</span> === <span class="hljs-number">0</span>) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">profile</span>.<span class="hljs-variable">size</span>.<span class="hljs-variable">width</span> &lt;= <span class="hljs-number">4096</span> &amp;&amp; <span class="hljs-title class_">profile</span>.<span class="hljs-title class_">size</span>.<span class="hljs-title class_">width</span> &gt;= <span class="hljs-number">3000</span> &amp;&amp;</li><li>      <span class="hljs-variable">profile</span>.<span class="hljs-variable">size</span>.<span class="hljs-variable">height</span> === (<span class="hljs-variable">previewProfile</span>.<span class="hljs-variable">size</span>.<span class="hljs-variable">height</span> / <span class="hljs-variable">previewProfile</span>.<span class="hljs-variable">size</span>.<span class="hljs-variable">width</span>) * <span class="hljs-variable">profile</span>.<span class="hljs-variable">size</span>.<span class="hljs-variable">width</span> &amp;&amp;</li><li>      <span class="hljs-variable">profile</span>.<span class="hljs-variable">frameRateRange</span>.<span class="hljs-variable">max</span> === <span class="hljs-number">60</span>;</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-variable">undefined</span>;</li><li>})</li><li>
</li><li><span class="hljs-variable">videoOutput</span> = <span class="hljs-variable">cameraManager</span>.<span class="hljs-title function_">createVideoOutput</span>(<span class="hljs-variable">videoProfile</span>, <span class="hljs-variable">videoSurfaceId</span>);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/VideoRecorder.ets#L73-L135" target="_blank">VideoRecorder.ets</a></div></div></div></div> <p>7、创建相机会话，用于控制修改视频参数。</p> <div class="screenLinkPre"><div _ngcontent-rkf-c106="" class="highlight-div"><div _ngcontent-rkf-c106="" class="highlight-div-header"><div _ngcontent-rkf-c106="" class="highlight-div-header-left"><div _ngcontent-rkf-c106="" class="handle-button expand-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rkf-c106="" class="highlight-div-header-right"><div _ngcontent-rkf-c106="" class="handle-button ai-button"></div><div _ngcontent-rkf-c106="" class="handle-button line-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rkf-c106="" class="handle-button theme-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rkf-c106="" class="handle-button copy-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rkf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-ini" codehub="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/VideoRecorder.ets#L141-L141" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">videoSession</span> = cameraManager.createSession(camera.SceneMode.NORMAL_VIDEO) as camera.VideoSession<span class="hljs-comment">;</span></li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/VideoRecorder.ets#L141-L141" target="_blank">VideoRecorder.ets</a></div></div></div></div> <p>8、开始配置会话，向会话中添加各路输入输出流，之后可以开始录像。</p> <div class="screenLinkPre"><div _ngcontent-rkf-c106="" class="highlight-div"><div _ngcontent-rkf-c106="" class="highlight-div-header"><div _ngcontent-rkf-c106="" class="highlight-div-header-left"><div _ngcontent-rkf-c106="" class="handle-button expand-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rkf-c106="" class="highlight-div-header-right"><div _ngcontent-rkf-c106="" class="handle-button ai-button"></div><div _ngcontent-rkf-c106="" class="handle-button line-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rkf-c106="" class="handle-button theme-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rkf-c106="" class="handle-button copy-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rkf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/VideoRecorder.ets#L147-L177" data-highlighted="yes"><ol class="linenums"><li>videoSession<span class="hljs-selector-class">.beginConfig</span>();</li><li>
</li><li>videoSession<span class="hljs-selector-class">.addInput</span>(cameraInput);</li><li>
</li><li>videoSession<span class="hljs-selector-class">.addOutput</span>(previewOutput);</li><li>videoSession<span class="hljs-selector-class">.addOutput</span>(videoOutput);</li><li>await videoSession<span class="hljs-selector-class">.commitConfig</span>();</li><li><span class="hljs-comment">// ...</span></li><li>await videoSession<span class="hljs-selector-class">.start</span>();</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/VideoRecorder.ets#L147-L177" target="_blank">VideoRecorder.ets</a></div></div></div></div> <p>9、通过avRecorder开始录像。</p> <div class="screenLinkPre"><div _ngcontent-rkf-c106="" class="highlight-div"><div _ngcontent-rkf-c106="" class="highlight-div-header"><div _ngcontent-rkf-c106="" class="highlight-div-header-left"><div _ngcontent-rkf-c106="" class="handle-button expand-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rkf-c106="" class="highlight-div-header-right"><div _ngcontent-rkf-c106="" class="handle-button ai-button"></div><div _ngcontent-rkf-c106="" class="handle-button line-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rkf-c106="" class="handle-button theme-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rkf-c106="" class="handle-button copy-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rkf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" codehub="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/VideoRecorder.ets#L221-L221" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">await</span> avRecorder.start();</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/VideoRecorder.ets#L221-L221" target="_blank">VideoRecorder.ets</a></div></div></div></div> <p>10、通过avRecorder停止录像。</p> <div class="screenLinkPre"><div _ngcontent-rkf-c106="" class="highlight-div"><div _ngcontent-rkf-c106="" class="highlight-div-header"><div _ngcontent-rkf-c106="" class="highlight-div-header-left"><div _ngcontent-rkf-c106="" class="handle-button expand-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rkf-c106="" class="highlight-div-header-right"><div _ngcontent-rkf-c106="" class="handle-button ai-button"></div><div _ngcontent-rkf-c106="" class="handle-button line-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rkf-c106="" class="handle-button theme-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rkf-c106="" class="handle-button copy-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rkf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-vbnet" codehub="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/VideoRecorder.ets#L231-L231" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">await</span> avRecorder.<span class="hljs-keyword">stop</span>();</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/VideoRecorder.ets#L231-L231" target="_blank">VideoRecorder.ets</a></div></div></div></div> <p>11、保存视频，注意需要将文件uri转化为fd赋值给AVRecorderConfig。</p> <div class="screenLinkPre"><div _ngcontent-rkf-c106="" class="highlight-div"><div _ngcontent-rkf-c106="" class="highlight-div-header"><div _ngcontent-rkf-c106="" class="highlight-div-header-left"><div _ngcontent-rkf-c106="" class="handle-button expand-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rkf-c106="" class="highlight-div-header-right"><div _ngcontent-rkf-c106="" class="handle-button ai-button"></div><div _ngcontent-rkf-c106="" class="handle-button line-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rkf-c106="" class="handle-button theme-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rkf-c106="" class="handle-button copy-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rkf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/VideoRecorder.ets#L27-L125" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-variable">file</span>: <span class="hljs-title class_">fileIo</span>.<span class="hljs-title class_">File</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">options</span>: <span class="hljs-title class_">photoAccessHelper</span>.<span class="hljs-title class_">CreateOptions</span> = {</li><li>  <span class="hljs-variable">title</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title class_">now</span>().<span class="hljs-title class_">toString</span>()</li><li>};</li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">accessHelper</span>: <span class="hljs-title class_">photoAccessHelper</span>.<span class="hljs-title class_">PhotoAccessHelper</span> = <span class="hljs-variable">photoAccessHelper</span>.<span class="hljs-title function_">getPhotoAccessHelper</span>(<span class="hljs-variable">context</span>);</li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">videoUri</span>: <span class="hljs-title class_">string</span> = <span class="hljs-variable">await</span> <span class="hljs-variable">accessHelper</span>.<span class="hljs-title function_">createAsset</span>(<span class="hljs-variable">photoAccessHelper</span>.<span class="hljs-variable">PhotoType</span>.<span class="hljs-variable">VIDEO</span>, <span class="hljs-string">'mp4'</span>, <span class="hljs-variable">options</span>);</li><li><span class="hljs-variable">file</span> = <span class="hljs-variable">fileIo</span>.<span class="hljs-title function_">openSync</span>(<span class="hljs-variable">videoUri</span>, <span class="hljs-variable">fileIo</span>.<span class="hljs-variable">OpenMode</span>.<span class="hljs-variable">READ_WRITE</span> | <span class="hljs-variable">fileIo</span>.<span class="hljs-variable">OpenMode</span>.<span class="hljs-variable">CREATE</span>);</li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">aVRecorderConfig</span>: <span class="hljs-title class_">media</span>.<span class="hljs-title class_">AVRecorderConfig</span> = {</li><li>  <span class="hljs-variable">audioSourceType</span>: <span class="hljs-title class_">media</span>.<span class="hljs-title class_">AudioSourceType</span>.<span class="hljs-title class_">AUDIO_SOURCE_TYPE_MIC</span>,</li><li>  <span class="hljs-variable">videoSourceType</span>: <span class="hljs-title class_">media</span>.<span class="hljs-title class_">VideoSourceType</span>.<span class="hljs-title class_">VIDEO_SOURCE_TYPE_SURFACE_YUV</span>,</li><li>  <span class="hljs-variable">profile</span>: <span class="hljs-title class_">aVRecorderProfile</span>,</li><li>  <span class="hljs-variable">url</span>: `<span class="hljs-title class_">fd</span>:<span class="hljs-comment">//${file.fd.toString()}`,</span></li><li>  <span class="hljs-variable">rotation</span>: <span class="hljs-title class_">cameraPosition</span> === <span class="hljs-number">0</span> ? <span class="hljs-number">90</span> : <span class="hljs-number">270</span>,</li><li>  <span class="hljs-variable">location</span>: { <span class="hljs-variable">latitude</span>: <span class="hljs-number">30</span>, <span class="hljs-variable">longitude</span>: <span class="hljs-number">130</span> }</li><li>};</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/VideoRecorder.ets#L27-L125" target="_blank">VideoRecorder.ets</a></div></div></div></div> <p>12、预览视频，应用将跳转进入系统图库应用进行预览，需要传入对应的图库uri。</p> <div class="screenLinkPre"><div _ngcontent-rkf-c106="" class="highlight-div"><div _ngcontent-rkf-c106="" class="highlight-div-header"><div _ngcontent-rkf-c106="" class="highlight-div-header-left"><div _ngcontent-rkf-c106="" class="handle-button expand-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rkf-c106="" class="highlight-div-header-right"><div _ngcontent-rkf-c106="" class="handle-button ai-button"></div><div _ngcontent-rkf-c106="" class="handle-button line-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rkf-c106="" class="handle-button theme-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rkf-c106="" class="handle-button copy-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rkf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/VideoRecorder.ets#L239-L248" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">export</span> <span class="hljs-variable">function</span> <span class="hljs-title function_">previewVideo</span>(<span class="hljs-variable">context</span>: <span class="hljs-title class_">Context</span>, <span class="hljs-variable">videoUri</span>: <span class="hljs-title class_">string</span>): <span class="hljs-title class_">void</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">videoContext</span> = <span class="hljs-variable">context</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">common</span>.<span class="hljs-variable">UIAbilityContext</span>;</li><li>  <span class="hljs-variable">videoContext</span>.<span class="hljs-title function_">startAbility</span>({</li><li>    <span class="hljs-variable">parameters</span>: { <span class="hljs-variable">uri</span>: <span class="hljs-title class_">videoUri</span> },</li><li>    <span class="hljs-variable">action</span>: <span class="hljs-string">'ohos.want.action.viewData'</span>,</li><li>    <span class="hljs-variable">bundleName</span>: <span class="hljs-string">'com.huawei.hmos.photos'</span>,</li><li>    <span class="hljs-variable">abilityName</span>: <span class="hljs-string">'com.huawei.hmos.photos.MainAbility'</span></li><li>  })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/VideoRecorder.ets#L239-L248" target="_blank">VideoRecorder.ets</a></div></div></div></div> <p><strong>API使用链接</strong></p> <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-camera" target="_blank">相机管理</a></p> <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-photoaccesshelper" target="_blank">相册管理模块</a></p> </div> <div class="tiledSection"><h3 id="section11156131053718">动态照片<i class="anchor-icon anchor-icon-link" anchorid="section11156131053718" tips="复制节点链接"></i></h3><p>拍照按钮触发动态照片拍摄，限制在3s，效果如下。</p> <p></p> <p></p> <p><span><img height="567.4711000000001" originheight="480" originwidth="225" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163029.56302291485123917239363826070319:50001231000000:2800:5C581904FFE1E990EBCE0A6AAE2262C55A04202788BFA2175443A49DA933CD56.gif" width="266" class="notEnlarge"></span></p> <p><strong>时序图</strong></p> <p><span><img originheight="583" originwidth="504" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163029.99253757262148230598171017553494:50001231000000:2800:53EC4EA2CBCB6ACCEC801E77BBAF3620A59A6BBF7437CE7E6E9C50ED792461EE.png" width="504" height="583"></span></p> <p><strong>关键点说明</strong></p> <p>使能动态照片前需要分段式拍照能力。固定拍摄时间为3s。</p> <p><strong>关键代码片段</strong></p> <p>1、创建拍照输出流。</p> <div class="screenLinkPre"><div _ngcontent-rkf-c106="" class="highlight-div"><div _ngcontent-rkf-c106="" class="highlight-div-header"><div _ngcontent-rkf-c106="" class="highlight-div-header-left"><div _ngcontent-rkf-c106="" class="handle-button expand-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rkf-c106="" class="highlight-div-header-right"><div _ngcontent-rkf-c106="" class="handle-button ai-button"></div><div _ngcontent-rkf-c106="" class="handle-button line-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rkf-c106="" class="handle-button theme-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rkf-c106="" class="handle-button copy-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rkf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L74-L103" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-variable">photoProfilesArray</span>: <span class="hljs-title class_">camera</span>.<span class="hljs-title class_">Profile</span>[] = <span class="hljs-variable">cameraOutputCap</span>.<span class="hljs-variable">photoProfiles</span>;</li><li>
</li><li><span class="hljs-variable">photoOutPut</span> = <span class="hljs-variable">cameraManager</span>.<span class="hljs-title function_">createPhotoOutput</span>(<span class="hljs-variable">photoProfile</span>);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L74-L103" target="_blank">CameraShooter.ets</a></div></div></div></div> <p>2、查询当前设备当前模式是否支持动态照片能力。</p> <div class="screenLinkPre"><div _ngcontent-rkf-c106="" class="highlight-div"><div _ngcontent-rkf-c106="" class="highlight-div-header"><div _ngcontent-rkf-c106="" class="highlight-div-header-left"><div _ngcontent-rkf-c106="" class="handle-button expand-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rkf-c106="" class="highlight-div-header-right"><div _ngcontent-rkf-c106="" class="handle-button ai-button"></div><div _ngcontent-rkf-c106="" class="handle-button line-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rkf-c106="" class="handle-button theme-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rkf-c106="" class="handle-button copy-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rkf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L147-L147" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-variable">isSupported</span>: <span class="hljs-title class_">boolean</span> = <span class="hljs-variable">photoOutPut</span>.<span class="hljs-title function_">isMovingPhotoSupported</span>();</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L147-L147" target="_blank">CameraShooter.ets</a></div></div></div></div> <p>3、使能动态照片拍照能力。</p> <div class="screenLinkPre"><div _ngcontent-rkf-c106="" class="highlight-div"><div _ngcontent-rkf-c106="" class="highlight-div-header"><div _ngcontent-rkf-c106="" class="highlight-div-header-left"><div _ngcontent-rkf-c106="" class="handle-button expand-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rkf-c106="" class="highlight-div-header-right"><div _ngcontent-rkf-c106="" class="handle-button ai-button"></div><div _ngcontent-rkf-c106="" class="handle-button line-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rkf-c106="" class="handle-button theme-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rkf-c106="" class="handle-button copy-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rkf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L150-L152" data-highlighted="yes"><ol class="linenums"><li>if (isSupported) {</li><li>  photoOutPut<span class="hljs-selector-class">.enableMovingPhoto</span>(isMovingPhoto);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/utils/CameraShooter.ets#L150-L152" target="_blank">CameraShooter.ets</a></div></div></div></div> <p>4、预览需要使用MovingPhotoView，长按图片会播放动图。</p> <div class="screenLinkPre"><div _ngcontent-rkf-c106="" class="highlight-div"><div _ngcontent-rkf-c106="" class="highlight-div-header"><div _ngcontent-rkf-c106="" class="highlight-div-header-left"><div _ngcontent-rkf-c106="" class="handle-button expand-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rkf-c106="" class="highlight-div-header-right"><div _ngcontent-rkf-c106="" class="handle-button ai-button"></div><div _ngcontent-rkf-c106="" class="handle-button line-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rkf-c106="" class="handle-button theme-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rkf-c106="" class="handle-button copy-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rkf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/pages/MovingPhotoPage.ets#L7-L9" data-highlighted="yes"><ol class="linenums"><li>@<span class="hljs-title function_">State</span> <span class="hljs-variable">src</span>: <span class="hljs-title class_">photoAccessHelper</span>.<span class="hljs-title class_">MovingPhoto</span> | <span class="hljs-title class_">undefined</span> = <span class="hljs-variable">undefined</span>;</li><li><span class="hljs-variable">controller</span>: <span class="hljs-title class_">MovingPhotoViewController</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">MovingPhotoViewController</span>();</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/pages/MovingPhotoPage.ets#L7-L9" target="_blank">MovingPhotoPage.ets</a></div></div></div></div> <div class="screenLinkPre"><div _ngcontent-rkf-c106="" class="highlight-div"><div _ngcontent-rkf-c106="" class="highlight-div-header"><div _ngcontent-rkf-c106="" class="highlight-div-header-left"><div _ngcontent-rkf-c106="" class="handle-button expand-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rkf-c106="" class="highlight-div-header-right"><div _ngcontent-rkf-c106="" class="handle-button ai-button"></div><div _ngcontent-rkf-c106="" class="handle-button line-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rkf-c106="" class="handle-button theme-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rkf-c106="" class="handle-button copy-button"><div _ngcontent-rkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rkf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/pages/MovingPhotoPage.ets#L15-L18" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">MovingPhotoView</span>({</li><li>  <span class="hljs-variable">movingPhoto</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">src</span>,</li><li>  <span class="hljs-variable">controller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">controller</span></li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/third-party-camera/blob/master/entry/src/main/ets/pages/MovingPhotoPage.ets#L15-L18" target="_blank">MovingPhotoPage.ets</a></div></div></div></div> <p><strong>API使用链接</strong></p> <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-camera" target="_blank">相机管理</a></p> <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-photoaccesshelper" target="_blank">相册管理模块</a></p> <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ohos-multimedia-movingphotoview" target="_blank">动态照片</a></p> </div> <div class="tiledSection"><h2 id="section20579202914391"><strong>相关技术参考</strong><i class="anchor-icon anchor-icon-link" anchorid="section20579202914391" tips="复制节点链接"></i></h2><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/camera-kit" target="_blank">相机服务</a></p> </div> <div class="tiledSection"><h2 id="section1696714131404">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section1696714131404" tips="复制节点链接"></i></h2><ul><li><a href="https://gitee.com/harmonyos_samples/third-party-camera" target="_blank">生态应用相机实现系统级相机体验</a></li></ul> </div> </div> <div></div></div>