<h1 _ngcontent-ngo-c119="" class="doc-title ng-star-inserted" title="相机硬件差异"> 相机硬件差异 </h1>

<div _ngcontent-ngo-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section1544543318192">概述<i class="anchor-icon anchor-icon-link" anchorid="section1544543318192" tips="复制节点链接"></i></h2><p>在移动端应用开发中，相机页面的多设备适配一直是开发者面临的一大难题。由于不同设备的屏幕尺寸、相机镜头、折叠形态以及系统特性等方面存在较大差异，相机界面的开发往往会遇到一系列<a href="/consumer/cn/doc/best-practices/bpta-multi-device-camera#section1684283074912">兼容性问题</a>，影响用户体验。</p> <p>本文介绍如何将手机相机页面（含预览、拍摄和查看照片功能）适配至双折叠、阔折叠、三折叠和平板等多种设备形态。在基础相机功能（预览、拍照、查看照片）之上，适配折叠屏和平板设备时，需要重点关注以下核心问题：</p> </div> <ul><li><a href="/consumer/cn/doc/best-practices/bpta-multi-device-camera#section181143569262">通过断点实现多套页面布局</a>，并设置横竖屏旋转策略。</li><li><a href="/consumer/cn/doc/best-practices/bpta-multi-device-camera#section13854163154917">选择相机设备</a>。</li><li><a href="/consumer/cn/doc/best-practices/bpta-multi-device-camera#section882216138497">设置多设备上相机预览画面比例</a>。</li><li><a href="/consumer/cn/doc/best-practices/bpta-multi-device-camera#section0752024124911">设置拍照旋转角度</a>。</li><li><a href="/consumer/cn/doc/best-practices/bpta-multi-device-camera#section50639679">实现悬停态相机页面</a>。</li></ul> <div class="tiledSection"><h2 id="section181143569262">通过断点实现多套页面布局<i class="anchor-icon anchor-icon-link" anchorid="section181143569262" tips="复制节点链接"></i></h2><p>“两个宽度相近的窗口，页面布局应相同”。首先，根据这条原则，确认要适配窗口的宽度范围，手机、双折叠、阔折叠、三折叠、平板设备共涉及到3种横向断点：sm、md和lg，因此应用首次开发时需要单独设计3种页面布局。</p> <div class="p">“对于高度相对宽度较小的窗口，呈现横向窗口或类方形窗口时，页面布局需进行差异化设计”。其次根据这条规则，因为阔折叠外屏独特的小方形窗口形态，布局会与手机略有差异。UX设计图如下： <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><tbody><tr><td class="cellrowborder" valign="top" width="6.756756756756757%"><p>断点</p> </td> <td class="cellrowborder" valign="top" width="13.166023166023166%"><p>横向断点sm，纵向断点md</p> </td> <td class="cellrowborder" valign="top" width="12.915057915057915%"><p>横向断点sm，纵向断点lg</p> </td> <td class="cellrowborder" valign="top" width="24.150579150579148%"><p>横向断点md</p> </td> <td class="cellrowborder" valign="top" width="43.011583011583014%"><p>横向断点lg</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="6.756756756756757%"><p>UX图</p> </td> <td class="cellrowborder" valign="top" width="13.166023166023166%"><p><span><img height="120.01063166023167" originheight="2475" originwidth="2003" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163135.35404880650983652764359694021646:50001231000000:2800:6F34960B4BC324F55E88B3881208987771F91F2C65E81AF15FF6297900C04F44.png" title="点击放大" width="97.12741312741313"></span></p> </td> <td class="cellrowborder" valign="top" width="12.915057915057915%"><p><span><img height="200.99632586872585" originheight="2317" originwidth="1093" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163135.36717938546309395852533578973794:50001231000000:2800:1A72AF9E739DB4B6FA5C0C92588AC15D469B86FBCBE091D9993DA60D38DA94E3.png" title="点击放大" width="94.81853281853282"></span></p> </td> <td class="cellrowborder" valign="top" width="24.150579150579148%"><p><span><img height="220.8676389961389" originheight="2425" originwidth="2176" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163135.15941014856083424224698563526677:50001231000000:2800:262E439DF054F4294EC0C6A07033594BB3655AA305652DBCB23E9ABAAEAA2199.png" title="点击放大" width="198.18532818532813"></span></p> </td> <td class="cellrowborder" valign="top" width="43.011583011583014%"><p><span><img height="240.2773178893179" originheight="2278" originwidth="3524" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163135.70776839974484986093629387603100:50001231000000:2800:780EA01CC9FB64DECB0EC7F77CBF0C688C0BAD0BD3E18F61FDEE2BC3DB653033.png" title="点击放大" width="371.70656370656377"></span></p> </td> </tr>  </tbody></table></div> </div> </div> </div> <div class="tiledSection"><h3 id="section1760724563912" class="firsth2">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section1760724563912" tips="复制节点链接"></i></h3><ol><li>分析三种横向断点对应的UX设计。sm断点的相机按钮布局分布在上下两侧，需要单独实现，阔折叠外屏与手机布局的差异通过纵向断点进行区分；md、lg断点的相机按钮布局相同，分布在左右两侧，可以使用一套代码实现。使用Stack组件，展示相机预览画面上的控制按钮，并使用断点控制在三折叠不同使用状态下的显示与隐藏。相机页面中XComponent组件宽高均可设置为100%，预览画面的大小可通过设置XComponent组件对应Surface区域的宽高实现，代码可参考<a href="/consumer/cn/doc/best-practices/bpta-multi-device-camera#section882216138497">设置多设备上相机预览画面比例</a>。<div class="screenLinkPre"><div _ngcontent-ngo-c106="" class="highlight-div"><div _ngcontent-ngo-c106="" class="highlight-div-header"><div _ngcontent-ngo-c106="" class="highlight-div-header-left"><div _ngcontent-ngo-c106="" class="handle-button expand-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ngo-c106="" class="highlight-div-header-right"><div _ngcontent-ngo-c106="" class="handle-button ai-button"></div><div _ngcontent-ngo-c106="" class="handle-button line-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ngo-c106="" class="handle-button theme-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ngo-c106="" class="handle-button copy-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ngo-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" codehub="https://gitee.com/harmonyos_samples/MultiDeviceCamera/blob/master/entry/src/main/ets/pages/Index.ets#L141-L403" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-selector-tag">Stack</span>() {</li><li>  <span class="hljs-comment">// Camera View.</span></li><li>  <span class="hljs-selector-tag">Column</span>() {</li><li>    <span class="hljs-selector-tag">XComponent</span>({</li><li>      type: XComponentType.SURFACE,</li><li>      controller: this.xComponentController</li><li>    }) {}</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>  .<span class="hljs-built_in">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  .<span class="hljs-built_in">height</span>(this.isHalfFolded ? this.creaseRegion[<span class="hljs-number">0</span>] : <span class="hljs-string">''</span>)</li><li>  .<span class="hljs-built_in">layoutWeight</span>(this.isHalfFolded ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>)</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-comment">// Shooting button view.</span></li><li>  <span class="hljs-built_in">Stack</span>() {</li><li>    <span class="hljs-comment">// Setting view for sm.</span></li><li>    <span class="hljs-selector-tag">Column</span>() {</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    .<span class="hljs-built_in">width</span>(this.heightBp === HeightBreakpoint.<span class="hljs-attribute">HEIGHT</span>_MD ? <span class="hljs-number">30</span> : <span class="hljs-number">48</span>)</li><li>    .<span class="hljs-built_in">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-built_in">margin</span>({ <span class="hljs-attribute">right</span>: <span class="hljs-number">16</span> })</li><li>    .<span class="hljs-built_in">padding</span>({ <span class="hljs-attribute">top</span>: this.heightBp === HeightBreakpoint.<span class="hljs-attribute">HEIGHT</span>_MD ? <span class="hljs-number">16</span> : <span class="hljs-number">108</span> })</li><li>    .<span class="hljs-built_in">visibility</span>(this.widthBp === WidthBreakpoint.<span class="hljs-attribute">WIDTH</span>_SM ? Visibility.<span class="hljs-attribute">Visible </span>: Visibility.None)</li><li>
</li><li>    <span class="hljs-comment">// Choose music for sm.</span></li><li>    <span class="hljs-built_in">Row</span>() {</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    .<span class="hljs-built_in">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-built_in">height</span>(this.heightBp === HeightBreakpoint.<span class="hljs-attribute">HEIGHT</span>_MD ? <span class="hljs-number">28</span> : <span class="hljs-number">40</span>)</li><li>    .<span class="hljs-built_in">position</span>({</li><li>      <span class="hljs-attribute">x</span>: <span class="hljs-number">0</span>,</li><li>      <span class="hljs-attribute">y</span>: this.heightBp === HeightBreakpoint.<span class="hljs-attribute">HEIGHT</span>_MD ? <span class="hljs-number">16</span> : <span class="hljs-number">28</span></li><li>    })</li><li>    .<span class="hljs-built_in">justifyContent</span>(FlexAlign.Center)</li><li>    .<span class="hljs-built_in">visibility</span>(this.widthBp === WidthBreakpoint.<span class="hljs-attribute">WIDTH</span>_SM ? Visibility.<span class="hljs-attribute">Visible </span>: Visibility.None)</li><li>
</li><li>    <span class="hljs-comment">// Shooting button for sm.</span></li><li>    <span class="hljs-built_in">Column</span>() {</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    .<span class="hljs-built_in">visibility</span>(this.widthBp === WidthBreakpoint.<span class="hljs-attribute">WIDTH</span>_SM ? Visibility.<span class="hljs-attribute">Visible </span>: Visibility.None)</li><li>    .<span class="hljs-built_in">height</span>(this.heightBp === HeightBreakpoint.<span class="hljs-attribute">HEIGHT</span>_MD ? <span class="hljs-number">96</span> : <span class="hljs-number">132</span>)</li><li>    .<span class="hljs-built_in">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-built_in">margin</span>({ <span class="hljs-attribute">bottom</span>: this.heightBp === HeightBreakpoint.<span class="hljs-attribute">HEIGHT</span>_MD ? <span class="hljs-number">16</span> : <span class="hljs-number">84</span> })</li><li>
</li><li>    <span class="hljs-comment">// Setting view for md/lg.</span></li><li>    <span class="hljs-built_in">Column</span>() {</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    .<span class="hljs-built_in">width</span>(this.widthBp === WidthBreakpoint.<span class="hljs-attribute">WIDTH</span>_MD ? <span class="hljs-number">144</span> : <span class="hljs-number">152</span>)</li><li>    .<span class="hljs-built_in">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-built_in">justifyContent</span>(FlexAlign.Start)</li><li>    .<span class="hljs-built_in">padding</span>({ <span class="hljs-attribute">left</span>: this.heightBp === HeightBreakpoint.<span class="hljs-attribute">HEIGHT</span>_MD ? <span class="hljs-number">24</span> : <span class="hljs-number">32</span> })</li><li>    .<span class="hljs-built_in">position</span>({ <span class="hljs-attribute">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attribute">y</span>: <span class="hljs-number">0</span> })</li><li>    .<span class="hljs-built_in">alignItems</span>(HorizontalAlign.Start)</li><li>    .<span class="hljs-built_in">visibility</span>(this.widthBp === WidthBreakpoint.<span class="hljs-attribute">WIDTH</span>_MD || this.widthBp === WidthBreakpoint.<span class="hljs-attribute">WIDTH</span>_LG ?</li><li>      Visibility.<span class="hljs-attribute">Visible </span>: Visibility.None)</li><li>
</li><li>    <span class="hljs-comment">// Shooting button for md/lg.</span></li><li>    <span class="hljs-built_in">Column</span>() {</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    .<span class="hljs-built_in">width</span>(<span class="hljs-number">92</span>)</li><li>    .<span class="hljs-built_in">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-built_in">justifyContent</span>(FlexAlign.Center)</li><li>    .<span class="hljs-built_in">padding</span>({ <span class="hljs-attribute">right</span>: <span class="hljs-number">16</span> })</li><li>    .<span class="hljs-built_in">visibility</span>(this.widthBp === WidthBreakpoint.<span class="hljs-attribute">WIDTH</span>_MD || this.widthBp === WidthBreakpoint.<span class="hljs-attribute">WIDTH</span>_LG ?</li><li>      Visibility.<span class="hljs-attribute">Visible </span>: Visibility.None)</li><li>  }</li><li>  .<span class="hljs-built_in">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  .<span class="hljs-built_in">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  .<span class="hljs-built_in">alignContent</span>(Alignment.BottomEnd)</li><li>  .<span class="hljs-built_in">visibility</span>(this.isHalfFolded ? Visibility.<span class="hljs-attribute">None </span>: Visibility.Visible)</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>.<span class="hljs-built_in">height</span>(<span class="hljs-string">'100%'</span>)</li><li>.<span class="hljs-built_in">width</span>(<span class="hljs-string">'100%'</span>)</li><li>.<span class="hljs-built_in">alignContent</span>(this.widthBp === WidthBreakpoint.<span class="hljs-attribute">WIDTH</span>_MD ? (this.isHalfFolded ? Alignment.<span class="hljs-attribute">Top </span>: Alignment.Start) :</li><li>  Alignment.Center)</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/MultiDeviceCamera/blob/master/entry/src/main/ets/pages/Index.ets#L141-L403" target="_blank">Index.ets</a></div></div></div></div> </li><li>相机页面在不同设备上横竖屏旋转，请参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-multi-device-window-direction#section16257518182319">兼容多设备上的旋转策略</a>。以本应用为例，横向断点为sm时不支持旋转；md、lg时支持旋转。因此，当窗口宽度、高度的最小值大于等于600vp时，窗口支持旋转。<div class="screenLinkPre"><div _ngcontent-ngo-c106="" class="highlight-div"><div _ngcontent-ngo-c106="" class="highlight-div-header"><div _ngcontent-ngo-c106="" class="highlight-div-header-left"><div _ngcontent-ngo-c106="" class="handle-button expand-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ngo-c106="" class="highlight-div-header-right"><div _ngcontent-ngo-c106="" class="handle-button ai-button"></div><div _ngcontent-ngo-c106="" class="handle-button line-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ngo-c106="" class="handle-button theme-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ngo-c106="" class="handle-button copy-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ngo-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/MultiDeviceCamera/blob/master/entry/src/main/ets/entryability/EntryAbility.ets#L35-L135" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">onWindowSizeChange</span>: <span class="hljs-function">(<span class="hljs-params">windowSize: <span class="hljs-variable language_">window</span>.Size</span>) =&gt;</span> <span class="hljs-built_in">void</span> = <span class="hljs-function">(<span class="hljs-params">windowSize: <span class="hljs-variable language_">window</span>.Size</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setOrientation</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>!.<span class="hljs-title function_">px2vp</span>(windowSize.<span class="hljs-property">width</span>), <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>!.<span class="hljs-title function_">px2vp</span>(windowSize.<span class="hljs-property">height</span>));</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li><span class="hljs-title function_">setOrientation</span>(<span class="hljs-attr">width</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">height</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-comment">// When the minimum value of window width and height is greater than the md breakpoint threshold, rotation is supported.</span></li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(width, height) &gt;= <span class="hljs-number">600</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowData</span>?.<span class="hljs-title function_">setPreferredOrientation</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">Orientation</span>.<span class="hljs-property">AUTO_ROTATION_RESTRICTED</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowData</span>?.<span class="hljs-title function_">setPreferredOrientation</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">Orientation</span>.<span class="hljs-property">PORTRAIT</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// ...</span></li><li><span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-attr">windowStage</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStage</span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  windowStage.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/Index'</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {</li><li>    <span class="hljs-comment">// ...</span></li><li>    windowStage.<span class="hljs-title function_">getMainWindow</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data: <span class="hljs-variable language_">window</span>.Window</span>) =&gt;</span> {</li><li>      <span class="hljs-comment">// ...</span></li><li>      <span class="hljs-comment">// Monitor window size changes and update breakpoints.</span></li><li>      data.<span class="hljs-title function_">on</span>(<span class="hljs-string">'windowSizeChange'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onWindowSizeChange</span>);</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">rect</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">Rect</span> = data.<span class="hljs-title function_">getWindowProperties</span>().<span class="hljs-property">windowRect</span>;</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setOrientation</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(rect.<span class="hljs-property">width</span>), <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(rect.<span class="hljs-property">height</span>));</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Error occured, error code: <span class="hljs-subst">${err.code}</span>, error message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    })</li><li>  });</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/MultiDeviceCamera/blob/master/entry/src/main/ets/entryability/EntryAbility.ets#L35-L135" target="_blank">EntryAbility.ets</a></div></div></div></div> </li></ol> </div> <div class="tiledSection"><h2 id="section13854163154917">选择相机设备<i class="anchor-icon anchor-icon-link" anchorid="section13854163154917" tips="复制节点链接"></i></h2><p>完整的相机页面，除了实现页面的按钮组件，还需要实现相机预览画面。在创建相机预览对象之前，首先要使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-cameramanager#createcamerainput" target="_blank">createCameraInput()</a>确认使用的相机设备。</p> </div> <div class="tiledSection"><h3 id="section13754175553111" class="firsth2">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section13754175553111" tips="复制节点链接"></i></h3><ol><li>手机、双折叠、阔折叠、三折叠、平板均配有后置相机和前置相机。相机页面显示时，根据isFront变量选择对应CameraPosition的相机，默认使用后置相机。<div class="screenLinkPre"><div _ngcontent-ngo-c106="" class="highlight-div"><div _ngcontent-ngo-c106="" class="highlight-div-header"><div _ngcontent-ngo-c106="" class="highlight-div-header-left"><div _ngcontent-ngo-c106="" class="handle-button expand-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ngo-c106="" class="highlight-div-header-right"><div _ngcontent-ngo-c106="" class="handle-button ai-button"></div><div _ngcontent-ngo-c106="" class="handle-button line-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ngo-c106="" class="handle-button theme-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ngo-c106="" class="handle-button copy-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ngo-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/MultiDeviceCamera/blob/master/entry/src/main/ets/pages/Index.ets#L109-L125" data-highlighted="yes"><ol class="linenums"><li>onPageShow(): void {</li><li>  abilityAccessCtrl.createAtManager().requestPermissionsFromUser(<span class="hljs-keyword">this</span>.context, <span class="hljs-keyword">this</span>.permissions).then(() =&gt; {</li><li>    setTimeout(() =&gt; {</li><li>      <span class="hljs-comment">// After obtaining permission, load the camera preview stream and ensure it is consistent with the aspect ratio of the surface.</span></li><li>      <span class="hljs-comment">// ...</span></li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isFront) {</li><li>        <span class="hljs-keyword">this</span>.cameraUtil.cameraShooting(<span class="hljs-keyword">this</span>.surfaceId, <span class="hljs-keyword">this</span>.context!, camera.CameraPosition.CAMERA_POSITION_FRONT);</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-keyword">this</span>.cameraUtil.cameraShooting(<span class="hljs-keyword">this</span>.surfaceId, <span class="hljs-keyword">this</span>.context!, camera.CameraPosition.CAMERA_POSITION_BACK);</li><li>      }</li><li>    }, <span class="hljs-number">200</span>);</li><li>  }).<span class="hljs-keyword">catch</span>((err: BusinessError) =&gt; {</li><li>    hilog.error(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, `Failed to requestPermissionsFromUser. Code: ${err.code}, message: ${err.message}`);</li><li>  })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/MultiDeviceCamera/blob/master/entry/src/main/ets/pages/Index.ets#L109-L125" target="_blank">Index.ets</a></div></div></div></div> <p>CameraPosition是相对的而不是固定的，例如阔折叠外屏的相机。</p> <ul><li>在折叠态时CameraPosition为CAMERA_POSITION_FRONT，效果图如下：<p><span><img height="328.4036" originheight="642" originwidth="520" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163135.06395654140903606630940389659670:50001231000000:2800:22FF430E04BD49E42C8AC8E263B65AFDB8DFD23C3A2C72A3BBD649F97B249501.png" title="点击放大" width="266"></span></p> </li><li>在展开态时CameraPosition为CAMERA_POSITION_BACK，效果图如下：<p><span><img height="412.36650000000003" originheight="648" originwidth="418" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163135.02579626216322047415835255914699:50001231000000:2800:FCED12BC8FFB34FC7D9E333F29773A00A0BDCE3AD51AB3D33AC37FD77D92F654.png" title="点击放大" width="266"></span></p> </li></ul> </li><li>其他需要重置预览流的场景需要开发者单独处理。折叠状态切换（例如双折叠的折叠态切换至半折叠态），会导致显示屏幕变化，需要重新选择相机设备。所以在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-display#displayonfoldstatuschange10" target="_blank">display.on('foldStatusChange')</a>中判断变化前后的折叠状态，并根据变化前使用的相机位置，选择变化后使用前置相机或后置相机。<div class="screenLinkPre"><div _ngcontent-ngo-c106="" class="highlight-div"><div _ngcontent-ngo-c106="" class="highlight-div-header"><div _ngcontent-ngo-c106="" class="highlight-div-header-left"><div _ngcontent-ngo-c106="" class="handle-button expand-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ngo-c106="" class="highlight-div-header-right"><div _ngcontent-ngo-c106="" class="handle-button ai-button"></div><div _ngcontent-ngo-c106="" class="handle-button line-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ngo-c106="" class="handle-button theme-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ngo-c106="" class="handle-button copy-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ngo-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/MultiDeviceCamera/blob/master/entry/src/main/ets/pages/Index.ets#L50-L105" data-highlighted="yes"><ol class="linenums"><li>onFoldStatusChange: (foldStatus: display.FoldStatus) =&gt; void = (foldStatus: display.FoldStatus) =&gt; {</li><li>  <span class="hljs-keyword">if</span> (foldStatus === display.FoldStatus.FOLD_STATUS_HALF_FOLDED) {</li><li>    let orientation: display.Orientation = display.getDefaultDisplaySync().orientation;</li><li>    <span class="hljs-comment">// Determine the page layout that has entered half folded status and prohibit portrait orientation.</span></li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.widthBp === WidthBreakpoint.WIDTH_MD &amp;&amp; (orientation === display.Orientation.LANDSCAPE ||</li><li>      orientation === display.Orientation.LANDSCAPE_INVERTED)) {</li><li>      <span class="hljs-keyword">this</span>.isHalfFolded = <span class="hljs-literal">true</span>;</li><li>      <span class="hljs-keyword">this</span>.windowUtil.setMainWindowOrientation(window.Orientation.LANDSCAPE);</li><li>      <span class="hljs-keyword">this</span>.cameraUtil.setHalfFoldedRect(<span class="hljs-keyword">this</span>.windowUtil.getWindowSize());</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.oldFoldStatus === display.FoldStatus.FOLD_STATUS_FOLDED) {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isFront) {</li><li>          <span class="hljs-keyword">this</span>.cameraUtil.cameraShooting(<span class="hljs-keyword">this</span>.surfaceId, <span class="hljs-keyword">this</span>.context!, camera.CameraPosition.CAMERA_POSITION_FRONT);</li><li>        } <span class="hljs-keyword">else</span> {</li><li>          <span class="hljs-keyword">this</span>.cameraUtil.cameraShooting(<span class="hljs-keyword">this</span>.surfaceId, <span class="hljs-keyword">this</span>.context!, camera.CameraPosition.CAMERA_POSITION_BACK);</li><li>        }</li><li>      }</li><li>    }</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-comment">// Exit the half folded status page.</span></li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isHalfFolded) {</li><li>    <span class="hljs-keyword">this</span>.isHalfFolded = <span class="hljs-literal">false</span>;</li><li>    <span class="hljs-keyword">this</span>.cameraUtil.setXComponentRect(<span class="hljs-keyword">this</span>.windowUtil.getWindowSize());</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-keyword">if</span> (foldStatus === display.FoldStatus.FOLD_STATUS_FOLDED ||</li><li>      (<span class="hljs-keyword">this</span>.oldFoldStatus === display.FoldStatus.FOLD_STATUS_EXPANDED_WITH_SECOND_HALF_FOLDED &amp;&amp;</li><li>        foldStatus === display.FoldStatus.FOLD_STATUS_EXPANDED) ||</li><li>      (<span class="hljs-keyword">this</span>.oldFoldStatus === display.FoldStatus.FOLD_STATUS_EXPANDED &amp;&amp;</li><li>        foldStatus === display.FoldStatus.FOLD_STATUS_EXPANDED_WITH_SECOND_HALF_FOLDED)) {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isFront) {</li><li>        <span class="hljs-keyword">this</span>.cameraUtil.cameraShooting(<span class="hljs-keyword">this</span>.surfaceId, <span class="hljs-keyword">this</span>.context!, camera.CameraPosition.CAMERA_POSITION_FRONT);</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-keyword">this</span>.cameraUtil.cameraShooting(<span class="hljs-keyword">this</span>.surfaceId, <span class="hljs-keyword">this</span>.context!, camera.CameraPosition.CAMERA_POSITION_BACK);</li><li>      }</li><li>    }</li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li>aboutToAppear(): void {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    display.on(<span class="hljs-string">'foldStatusChange'</span>, <span class="hljs-keyword">this</span>.onFoldStatusChange);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    let err = error <span class="hljs-keyword">as</span> BusinessError;</li><li>    hilog.error(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'MultiDeviceCamera'</span>, `Failed to obtain fold status. Code: ${err.code}, message: ${err.message}`);</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/MultiDeviceCamera/blob/master/entry/src/main/ets/pages/Index.ets#L50-L105" target="_blank">Index.ets</a></div></div></div></div> <p>需要注意，PuraX外屏只存在前置相机。如果在内屏使用的是后置相机，切换外屏后，后置相机将不再可用，则返回可用相机列表中默认的相机。</p> <div class="screenLinkPre"><div _ngcontent-ngo-c106="" class="highlight-div"><div _ngcontent-ngo-c106="" class="highlight-div-header"><div _ngcontent-ngo-c106="" class="highlight-div-header-left"><div _ngcontent-ngo-c106="" class="handle-button expand-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ngo-c106="" class="highlight-div-header-right"><div _ngcontent-ngo-c106="" class="handle-button ai-button"></div><div _ngcontent-ngo-c106="" class="handle-button line-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ngo-c106="" class="handle-button theme-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ngo-c106="" class="handle-button copy-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ngo-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/MultiDeviceCamera/blob/master/entry/src/main/ets/utils/CameraUtil.ets#L110-L131" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">getCamera</span>(<span class="hljs-variable">cameras</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">camera</span>.<span class="hljs-title class_">CameraDevice</span>&gt;, <span class="hljs-variable">cameraPosition</span>: <span class="hljs-title class_">camera</span>.<span class="hljs-title class_">CameraPosition</span>): <span class="hljs-title class_">number</span> {</li><li>  <span class="hljs-comment">// Choose front or rear camera.</span></li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> <span class="hljs-variable">i</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">i</span> &lt; <span class="hljs-title class_">cameras</span>.<span class="hljs-title class_">length</span>; ++<span class="hljs-title class_">i</span>) {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">cameras</span>[<span class="hljs-variable">i</span>].<span class="hljs-variable">cameraPosition</span> === <span class="hljs-variable">cameraPosition</span>) {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable">cameraPosition</span> === <span class="hljs-variable">camera</span>.<span class="hljs-variable">CameraPosition</span>.<span class="hljs-variable">CAMERA_POSITION_BACK</span>) {</li><li>        <span class="hljs-variable">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'isFront'</span>, <span class="hljs-keyword">false</span>);</li><li>      }</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable">cameraPosition</span> === <span class="hljs-variable">camera</span>.<span class="hljs-variable">CameraPosition</span>.<span class="hljs-variable">CAMERA_POSITION_FRONT</span>) {</li><li>        <span class="hljs-variable">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'isFront'</span>, <span class="hljs-keyword">true</span>);</li><li>      }</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-variable">i</span>;</li><li>    }</li><li>  }</li><li>  <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testLog'</span>, `<span class="hljs-variable">Failed</span> <span class="hljs-variable">to</span> <span class="hljs-variable">find</span> <span class="hljs-variable">the</span> <span class="hljs-variable">camera</span> <span class="hljs-variable">with</span> <span class="hljs-variable">the</span> <span class="hljs-variable">corresponding</span> <span class="hljs-variable">position</span>.`);</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-variable">cameras</span>[<span class="hljs-number">0</span>].<span class="hljs-variable">cameraPosition</span> === <span class="hljs-variable">camera</span>.<span class="hljs-variable">CameraPosition</span>.<span class="hljs-variable">CAMERA_POSITION_BACK</span>) {</li><li>    <span class="hljs-variable">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'isFront'</span>, <span class="hljs-keyword">false</span>);</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-variable">cameras</span>[<span class="hljs-number">0</span>].<span class="hljs-variable">cameraPosition</span> === <span class="hljs-variable">camera</span>.<span class="hljs-variable">CameraPosition</span>.<span class="hljs-variable">CAMERA_POSITION_FRONT</span>) {</li><li>    <span class="hljs-variable">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'isFront'</span>, <span class="hljs-keyword">true</span>);</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/MultiDeviceCamera/blob/master/entry/src/main/ets/utils/CameraUtil.ets#L110-L131" target="_blank">CameraUtil.ets</a></div></div></div></div> </li></ol> </div> <div class="tiledSection"><h2 id="section882216138497">设置多设备上相机预览画面比例<i class="anchor-icon anchor-icon-link" anchorid="section882216138497" tips="复制节点链接"></i></h2><p>选择相机之后，需要通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-cameramanager#createpreviewoutput12" target="_blank">createPreviewOutput()</a>创建预览输出对象，绑定至XComponent组件展示预览画面，实现流程可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/camera-shooting-case" target="_blank">拍照实践</a>。在开发多设备上相机预览画面时，需要通过以下步骤避免压缩、拉伸、异常旋转的问题。</p> <p>XComponent组件对应Surface区域的宽高比，取决于用户预览时设备的屏幕顺时针旋转角度。如果display.rotation为0°或180°，则Surface与相机预览流宽高比互为倒数；如果display.rotation为90°或270°，则Surface与相机预览流宽高比一致。</p> <p>以获取预览流宽高比4:3为例（阔折叠折叠态为1:1），多设备不同状态的Surface宽高比如下表：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><tbody><tr><td class="cellrowborder" valign="top" width="9.27%">&nbsp;&nbsp;</td> <td class="cellrowborder" valign="top" width="16.259999999999998%"><p>阔折叠折叠态</p> </td> <td class="cellrowborder" valign="top" width="19.18%"><p>手机/双折叠折叠态/三折叠F态/阔折叠展开态</p> </td> <td class="cellrowborder" valign="top" width="17.630000000000003%"><p>双折叠展开态/三折叠M态</p> </td> <td class="cellrowborder" valign="top" width="17.21%"><p>三折叠G态</p> </td> <td class="cellrowborder" valign="top" width="20.45%"><p>平板</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="9.27%"><p>设备方向</p> </td> <td class="cellrowborder" valign="top" width="16.259999999999998%"><p>以充电口朝右为例</p> <p>display.rotation=270</p> </td> <td class="cellrowborder" valign="top" width="19.18%"><p>以充电口朝下为例</p> <p>display.rotation=0</p> </td> <td class="cellrowborder" valign="top" width="17.630000000000003%"><p>以充电口朝下为例</p> <p>display.rotation=0</p> </td> <td class="cellrowborder" valign="top" width="17.21%"><p>以充电口朝下为例</p> <p>display.rotation=0</p> </td> <td class="cellrowborder" valign="top" width="20.45%"><p>以充电口朝下为例</p> <p>display.rotation=0</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="9.27%"><p>Surface宽高比</p> </td> <td class="cellrowborder" valign="top" width="16.259999999999998%"><p>1:1</p> </td> <td class="cellrowborder" valign="top" width="19.18%"><p>3:4</p> </td> <td class="cellrowborder" valign="top" width="17.630000000000003%"><p>3:4</p> </td> <td class="cellrowborder" valign="top" width="17.21%"><p>3:4</p> </td> <td class="cellrowborder" valign="top" width="20.45%"><p>3:4</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="9.27%"><p>设备方向</p> </td> <td class="cellrowborder" rowspan="2" valign="top" width="16.259999999999998%"><p>页面不支持旋转</p> </td> <td class="cellrowborder" rowspan="2" valign="top" width="19.18%"><p>页面不支持旋转</p> </td> <td class="cellrowborder" valign="top" width="17.630000000000003%"><p>以充电口朝右为例</p> <p>display.rotation=270</p> </td> <td class="cellrowborder" valign="top" width="17.21%"><p>以充电口朝右为例</p> <p>display.rotation=270</p> </td> <td class="cellrowborder" valign="top" width="20.45%"><p>以充电口朝右为例</p> <p>display.rotation=270</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>Surface宽高比</p> </td> <td class="cellrowborder" valign="top"><p>4:3</p> </td> <td class="cellrowborder" valign="top"><p>4:3</p> </td> <td class="cellrowborder" valign="top"><p>4:3</p> </td> </tr>  </tbody></table></div> </div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>HarmonyOS不同设备的后置相机安装角度均为90°，前置相机安装角度均为270°。</p> </div></div></div> <p>多设备不同状态的预览效果图如下表：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><tbody><tr><td class="cellrowborder" valign="top" width="8.94910508949105%"><p>阔折叠折叠态</p> </td> <td class="cellrowborder" valign="top" width="15.238476152384761%"><p>手机/双折叠折叠态/三折叠F态/阔折叠展开态</p> </td> <td class="cellrowborder" valign="top" width="21.747825217478255%"><p>双折叠展开态/三折叠M态</p> </td> <td class="cellrowborder" valign="top" width="24.857514248575143%"><p>三折叠G态</p> </td> <td class="cellrowborder" valign="top" width="29.207079292070798%"><p>平板</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="8.94910508949105%"><p><span><img height="72.0747310868913" originheight="2475" originwidth="2003" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163135.27220397152965761607566249441866:50001231000000:2800:B719227BE7F0D364503BD39B9F00CE296C50A7FE0264CCBE3E892FFF2D6C2752.png" title="点击放大" width="58.331766823317665"></span></p> </td> <td class="cellrowborder" valign="top" width="15.238476152384761%"><p><span><img height="246.308000079992" originheight="2317" originwidth="1093" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163135.12218315374718510941192391117750:50001231000000:2800:983DBB8A344C5C79212822F68CD2D1B25EDAA0063A3A72ACFD554FC42310BD4D.png" title="点击放大" width="116.19398060193981"></span></p> </td> <td class="cellrowborder" valign="top" width="21.747825217478255%"><p><span><img height="196.22354308569146" originheight="2425" originwidth="2176" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163135.33195821841918222313388772863454:50001231000000:2800:3A6453FA05FFC42DF0B4ED5CA83D68811E3BEC594459E12EE7A51618A1F72D3C.png" title="点击放大" width="176.07999200079993"></span></p> </td> <td class="cellrowborder" valign="top" width="24.857514248575143%"><p><span><img height="145.49303437656238" originheight="2475" originwidth="3482" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163136.05026238395881023110731135321890:50001231000000:2800:D73CB3B5319150BA49C15F84635B547DDBF677FD3E0A93F6D1659BB09C20FA0A.png" title="点击放大" width="204.6891310868913"></span></p> </td> <td class="cellrowborder" valign="top" width="29.207079292070798%"><p><span><img height="378.5400765526748" originheight="3524" originwidth="2278" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163136.89786285720547328309912036651809:50001231000000:2800:BD6ECD9C5E7DDC3A90B1F67294312D40ED126871434C5BDE3537A429AB377FE3.png" title="点击放大" width="244.70512948705135"></span></p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="8.94910508949105%"><p>页面不支持旋转</p> </td> <td class="cellrowborder" valign="top" width="15.238476152384761%"><p>页面不支持旋转</p> </td> <td class="cellrowborder" valign="top" width="21.747825217478255%"><p><span><img height="157.9972111811207" originheight="2176" originwidth="2425" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163136.89710090019131518974015009086696:50001231000000:2800:BF990E674A390A25F92B53DA7FFDC536EFCBA0FE3B320B639AD8776B72C1774F.png" title="点击放大" width="176.07999200079993"></span></p> </td> <td class="cellrowborder" valign="top" width="24.857514248575143%"><p><span><img height="287.97007749984704" originheight="3482" originwidth="2475" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163137.60337724674845254221506347260947:50001231000000:2800:8326EA82FCF0F24E6B3F1314BCBB0CE963CFEBB7AB0F23975C55CC4B6803A583.png" title="点击放大" width="204.6891310868913"></span></p> </td> <td class="cellrowborder" valign="top" width="29.207079292070798%"><p><span><img height="158.18827148396275" originheight="2278" originwidth="3524" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163137.56355224704880770148623109215529:50001231000000:2800:034301F7BB1472B8606B53FA9DFE8E3D0AA23EE980AB0BA5B96EFB38FB3BE693.png" title="点击放大" width="244.70512948705135"></span></p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h3 id="section14071032123213" class="firsth2">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section14071032123213" tips="复制节点链接"></i></h3><ol><li>在窗口横竖屏旋转时，实现<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-xcomponent#setxcomponentsurfacerect12" target="_blank">setXComponentSurfaceRect()</a>方法重新设置XComponent组件中surface区域的宽和高，确保与多设备相机的预览流、拍照流宽高比一致。<div class="screenLinkPre"><div _ngcontent-ngo-c106="" class="highlight-div"><div _ngcontent-ngo-c106="" class="highlight-div-header"><div _ngcontent-ngo-c106="" class="highlight-div-header-left"><div _ngcontent-ngo-c106="" class="handle-button expand-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ngo-c106="" class="highlight-div-header-right"><div _ngcontent-ngo-c106="" class="handle-button ai-button"></div><div _ngcontent-ngo-c106="" class="handle-button line-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ngo-c106="" class="handle-button theme-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ngo-c106="" class="handle-button copy-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ngo-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/MultiDeviceCamera/blob/master/entry/src/main/ets/utils/CameraUtil.ets#L290-L333" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">setXComponentRect</span>(<span class="hljs-variable">windowSize</span>: <span class="hljs-title class_">window</span>.<span class="hljs-title class_">Size</span>): <span class="hljs-title class_">void</span> {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-comment">// Initialize the width and height of the surface to match the full screen of the window.</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">rect</span>: <span class="hljs-title class_">SurfaceRect</span> = {</li><li>      <span class="hljs-variable">surfaceWidth</span>: <span class="hljs-title class_">windowSize</span>.<span class="hljs-title class_">width</span>,</li><li>      <span class="hljs-variable">surfaceHeight</span>: <span class="hljs-title class_">windowSize</span>.<span class="hljs-title class_">height</span></li><li>    };</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">widthBp</span>: <span class="hljs-title class_">WidthBreakpoint</span> = <span class="hljs-keyword">this</span>.<span class="hljs-variable">uiContext</span>!.<span class="hljs-title function_">getWindowWidthBreakpoint</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">heightBp</span>: <span class="hljs-title class_">HeightBreakpoint</span> = <span class="hljs-keyword">this</span>.<span class="hljs-variable">uiContext</span>!.<span class="hljs-title function_">getWindowHeightBreakpoint</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">displayRotation</span>: <span class="hljs-title class_">number</span> = <span class="hljs-variable">display</span>.<span class="hljs-title function_">getDefaultDisplaySync</span>().<span class="hljs-variable">rotation</span> * <span class="hljs-number">90</span>;</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">widthBp</span> === <span class="hljs-variable">WidthBreakpoint</span>.<span class="hljs-variable">WIDTH_SM</span> &amp;&amp; <span class="hljs-variable">heightBp</span> === <span class="hljs-variable">HeightBreakpoint</span>.<span class="hljs-variable">HEIGHT_MD</span>) {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">xComponentController</span>!.<span class="hljs-title function_">setXComponentSurfaceRect</span>(<span class="hljs-variable">rect</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">AppStorage</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'isHalfFolded'</span>)) {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-title function_">setHalfFoldedRect</span>(<span class="hljs-variable">windowSize</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">displayRotation</span> === <span class="hljs-number">0</span> || <span class="hljs-variable">displayRotation</span> === <span class="hljs-number">180</span>) {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable">windowSize</span>.<span class="hljs-variable">height</span> * <span class="hljs-number">3</span> / <span class="hljs-number">4</span> &gt; <span class="hljs-variable">windowSize</span>.<span class="hljs-variable">width</span>) {</li><li>        <span class="hljs-variable">rect</span>.<span class="hljs-variable">surfaceHeight</span> = <span class="hljs-variable">windowSize</span>.<span class="hljs-variable">width</span> / <span class="hljs-number">3</span> * <span class="hljs-number">4</span>;</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-variable">rect</span>.<span class="hljs-variable">surfaceWidth</span> = <span class="hljs-variable">windowSize</span>.<span class="hljs-variable">height</span> / <span class="hljs-number">4</span> * <span class="hljs-number">3</span>;</li><li>      }</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable">widthBp</span> === <span class="hljs-variable">WidthBreakpoint</span>.<span class="hljs-variable">WIDTH_MD</span> &amp;&amp; <span class="hljs-variable">heightBp</span> === <span class="hljs-variable">HeightBreakpoint</span>.<span class="hljs-variable">HEIGHT_MD</span>) {</li><li>        <span class="hljs-variable">rect</span>.<span class="hljs-variable">offsetX</span> = <span class="hljs-number">0</span>;</li><li>        <span class="hljs-variable">rect</span>.<span class="hljs-variable">offsetY</span> = <span class="hljs-number">0</span>;</li><li>      }</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">displayRotation</span> === <span class="hljs-number">90</span> || <span class="hljs-variable">displayRotation</span> === <span class="hljs-number">270</span>) {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable">windowSize</span>.<span class="hljs-variable">width</span> * <span class="hljs-number">3</span> / <span class="hljs-number">4</span> &gt; <span class="hljs-variable">windowSize</span>.<span class="hljs-variable">height</span>) {</li><li>        <span class="hljs-variable">rect</span>.<span class="hljs-variable">surfaceWidth</span> = <span class="hljs-variable">windowSize</span>.<span class="hljs-variable">height</span> / <span class="hljs-number">3</span> * <span class="hljs-number">4</span>;</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-variable">rect</span>.<span class="hljs-variable">surfaceHeight</span> = <span class="hljs-variable">windowSize</span>.<span class="hljs-variable">width</span> / <span class="hljs-number">4</span> * <span class="hljs-number">3</span>;</li><li>      }</li><li>    }</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">xComponentController</span>!.<span class="hljs-title function_">setXComponentSurfaceRect</span>(<span class="hljs-variable">rect</span>);</li><li>  } <span class="hljs-keyword">catch</span> (<span class="hljs-variable">error</span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">err</span> = <span class="hljs-variable">error</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">BusinessError</span>;</li><li>    <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'MultiDeviceCamera'</span>, `<span class="hljs-variable">Failed</span> <span class="hljs-variable">to</span> <span class="hljs-variable">set</span> <span class="hljs-variable">XComponent</span> <span class="hljs-variable">rect</span>. <span class="hljs-variable">Code</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>}, <span class="hljs-variable">message</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>}`);</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/MultiDeviceCamera/blob/master/entry/src/main/ets/utils/CameraUtil.ets#L290-L333" target="_blank">CameraUtil.ets</a></div></div></div></div> </li><li>在窗口横竖屏旋转时，会刷新窗口尺寸，需要调用setXComponentRect()方法刷新预览画面比例，避免预览画面异常压缩或拉伸。<div class="screenLinkPre"><div _ngcontent-ngo-c106="" class="highlight-div"><div _ngcontent-ngo-c106="" class="highlight-div-header"><div _ngcontent-ngo-c106="" class="highlight-div-header-left"><div _ngcontent-ngo-c106="" class="handle-button expand-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ngo-c106="" class="highlight-div-header-right"><div _ngcontent-ngo-c106="" class="handle-button ai-button"></div><div _ngcontent-ngo-c106="" class="handle-button line-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ngo-c106="" class="handle-button theme-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ngo-c106="" class="handle-button copy-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ngo-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/MultiDeviceCamera/blob/master/entry/src/main/ets/entryability/EntryAbility.ets#L26-L154" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-attr">isFirstTime</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>;</li><li>  <span class="hljs-attr">onWindowSizeChange</span>: <span class="hljs-function">(<span class="hljs-params">windowSize: <span class="hljs-variable language_">window</span>.Size</span>) =&gt;</span> <span class="hljs-built_in">void</span> = <span class="hljs-function">(<span class="hljs-params">windowSize: <span class="hljs-variable language_">window</span>.Size</span>) =&gt;</span> {</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">isFirstTime</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">cameraUtil</span>!.<span class="hljs-title function_">setXComponentRect</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">windowUtil</span>!.<span class="hljs-title function_">getWindowSize</span>());</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">isFirstTime</span> = <span class="hljs-literal">false</span>;</li><li>    }</li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-attr">windowStage</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStage</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// ...</span></li><li>    windowStage.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/Index'</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {</li><li>      <span class="hljs-comment">// ...</span></li><li>      windowStage.<span class="hljs-title function_">getMainWindow</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data: <span class="hljs-variable language_">window</span>.Window</span>) =&gt;</span> {</li><li>        <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-comment">// Monitor window size changes and update breakpoints.</span></li><li>        data.<span class="hljs-title function_">on</span>(<span class="hljs-string">'windowSizeChange'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onWindowSizeChange</span>);</li><li>        <span class="hljs-comment">// ...</span></li><li>      }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Error occured, error code: <span class="hljs-subst">${err.code}</span>, error message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>      })</li><li>    });</li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/MultiDeviceCamera/blob/master/entry/src/main/ets/entryability/EntryAbility.ets#L26-L154" target="_blank">EntryAbility.ets</a></div></div></div></div> </li><li>最后调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-xcomponent#setxcomponentsurfacerotation12" target="_blank">setXComponentSurfaceRotation()</a>设置XComponent的Surface区域在屏幕旋转时锁定方向，确保相机预览画面旋转时的用户体验。<div class="screenLinkPre"><div _ngcontent-ngo-c106="" class="highlight-div"><div _ngcontent-ngo-c106="" class="highlight-div-header"><div _ngcontent-ngo-c106="" class="highlight-div-header-left"><div _ngcontent-ngo-c106="" class="handle-button expand-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ngo-c106="" class="highlight-div-header-right"><div _ngcontent-ngo-c106="" class="handle-button ai-button"></div><div _ngcontent-ngo-c106="" class="handle-button line-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ngo-c106="" class="handle-button theme-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ngo-c106="" class="handle-button copy-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ngo-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/MultiDeviceCamera/blob/master/entry/src/main/ets/pages/Index.ets#L147-L161" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">XComponent</span>({</li><li>  <span class="hljs-keyword">type</span>: <span class="hljs-title class_">XComponentType</span>.<span class="hljs-title class_">SURFACE</span>,</li><li>  <span class="hljs-variable">controller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">xComponentController</span></li><li>}) {}</li><li>.<span class="hljs-title function_">onLoad</span>(() =&gt; {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-comment">// Set surface to lock direction when screen rotates.</span></li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-variable">xComponentController</span>.<span class="hljs-title function_">setXComponentSurfaceRotation</span>({ <span class="hljs-variable">lock</span>: <span class="hljs-keyword">true</span> });</li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/MultiDeviceCamera/blob/master/entry/src/main/ets/pages/Index.ets#L147-L161" target="_blank">Index.ets</a></div></div></div></div> </li></ol> </div> <div class="tiledSection"><h2 id="section0752024124911">设置拍照旋转角度<i class="anchor-icon anchor-icon-link" anchorid="section0752024124911" tips="复制节点链接"></i></h2><p>在横竖屏拍照场景下，需确保图片始终正向显示，避免出现照片方向异常（如旋转90°或倒置）。</p> </div> <div class="tiledSection"><h3 id="section1154714509327" class="firsth2">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section1154714509327" tips="复制节点链接"></i></h3><p>在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-photooutput#capture-3" target="_blank">capture()</a>方法中，通过重力传感器获取当前拍照的角度，并区分后置相机与前置相机，设置拍照时的旋转角度rotation。</p> <div class="screenLinkPre"><div _ngcontent-ngo-c106="" class="highlight-div"><div _ngcontent-ngo-c106="" class="highlight-div-header"><div _ngcontent-ngo-c106="" class="highlight-div-header-left"><div _ngcontent-ngo-c106="" class="handle-button expand-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ngo-c106="" class="highlight-div-header-right"><div _ngcontent-ngo-c106="" class="handle-button ai-button"></div><div _ngcontent-ngo-c106="" class="handle-button line-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ngo-c106="" class="handle-button theme-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ngo-c106="" class="handle-button copy-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ngo-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/MultiDeviceCamera/blob/master/entry/src/main/ets/utils/CameraUtil.ets#L183-L224" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">capture</span>(): <span class="hljs-title class_">void</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">rotation</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-comment">// Obtain the angle of the gravity sensor during shooting and set the shooting rotation angle.</span></li><li>    <span class="hljs-variable">sensor</span>.<span class="hljs-title function_">once</span>(<span class="hljs-variable">sensor</span>.<span class="hljs-variable">SensorId</span>.<span class="hljs-variable">GRAVITY</span>, (<span class="hljs-variable">data</span>: <span class="hljs-title class_">sensor</span>.<span class="hljs-title class_">GravityResponse</span>) =&gt; {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-variable">degree</span>: <span class="hljs-title class_">number</span> = <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getCalDegree</span>(<span class="hljs-variable">data</span>.<span class="hljs-variable">x</span>, <span class="hljs-variable">data</span>.<span class="hljs-variable">y</span>, <span class="hljs-variable">data</span>.<span class="hljs-variable">z</span>);</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-variable">isFront</span>: <span class="hljs-title class_">boolean</span> | <span class="hljs-title class_">undefined</span> = <span class="hljs-variable">AppStorage</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'isFront'</span>);</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable">degree</span> &gt;= <span class="hljs-number">0</span> &amp;&amp; (<span class="hljs-variable">degree</span> &lt;= <span class="hljs-number">30</span> || <span class="hljs-title class_">degree</span> &gt;= <span class="hljs-number">300</span>)) {</li><li>        <span class="hljs-variable">rotation</span> = <span class="hljs-variable">camera</span>.<span class="hljs-variable">ImageRotation</span>.<span class="hljs-variable">ROTATION_0</span>;</li><li>      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">degree</span> &gt; <span class="hljs-number">30</span> &amp;&amp; <span class="hljs-variable">degree</span> &lt;= <span class="hljs-number">120</span>) {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">isFront</span>) {</li><li>          <span class="hljs-comment">// Use ROTATION_270 when degree range is (30, 120] for front camera.</span></li><li>          <span class="hljs-variable">rotation</span> = <span class="hljs-variable">camera</span>.<span class="hljs-variable">ImageRotation</span>.<span class="hljs-variable">ROTATION_270</span>;</li><li>        } <span class="hljs-keyword">else</span> {</li><li>          <span class="hljs-comment">// Use ROTATION_90 when degree range is (30, 120] for back camera.</span></li><li>          <span class="hljs-variable">rotation</span> = <span class="hljs-variable">camera</span>.<span class="hljs-variable">ImageRotation</span>.<span class="hljs-variable">ROTATION_90</span>;</li><li>        }</li><li>      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">degree</span> &gt; <span class="hljs-number">120</span> &amp;&amp; <span class="hljs-variable">degree</span> &lt;= <span class="hljs-number">210</span>) {</li><li>        <span class="hljs-comment">// Use ROTATION_180 when degree range is (120, 210].</span></li><li>        <span class="hljs-variable">rotation</span> = <span class="hljs-variable">camera</span>.<span class="hljs-variable">ImageRotation</span>.<span class="hljs-variable">ROTATION_180</span>;</li><li>      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">degree</span> &gt; <span class="hljs-number">210</span> &amp;&amp; <span class="hljs-variable">degree</span> &lt;= <span class="hljs-number">300</span>) {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">isFront</span>) {</li><li>          <span class="hljs-comment">// Use ROTATION_90 when degree range is (210, 300] for front camera.</span></li><li>          <span class="hljs-variable">rotation</span> = <span class="hljs-variable">camera</span>.<span class="hljs-variable">ImageRotation</span>.<span class="hljs-variable">ROTATION_90</span>;</li><li>        } <span class="hljs-keyword">else</span> {</li><li>          <span class="hljs-comment">// Use ROTATION_270 when degree range is (210, 300] for back camera.</span></li><li>          <span class="hljs-variable">rotation</span> = <span class="hljs-variable">camera</span>.<span class="hljs-variable">ImageRotation</span>.<span class="hljs-variable">ROTATION_270</span>;</li><li>        }</li><li>      };</li><li>
</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-variable">setting</span>: <span class="hljs-title class_">camera</span>.<span class="hljs-title class_">PhotoCaptureSetting</span> = {</li><li>        <span class="hljs-variable">quality</span>: <span class="hljs-title class_">camera</span>.<span class="hljs-title class_">QualityLevel</span>.<span class="hljs-title class_">QUALITY_LEVEL_HIGH</span>,</li><li>        <span class="hljs-variable">rotation</span>: <span class="hljs-title class_">rotation</span>,</li><li>        <span class="hljs-variable">mirror</span>: <span class="hljs-title class_">isFront</span></li><li>      }</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">photoOutput</span>?.<span class="hljs-title function_">capture</span>(<span class="hljs-variable">setting</span>);</li><li>    })</li><li>  } <span class="hljs-keyword">catch</span> (<span class="hljs-variable">error</span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">err</span> = <span class="hljs-variable">error</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">BusinessError</span>;</li><li>    <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'MultiDeviceCamera'</span>, `<span class="hljs-variable">Capture</span> <span class="hljs-variable">failed</span>. <span class="hljs-variable">Code</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>}, <span class="hljs-variable">message</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>}`);</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/MultiDeviceCamera/blob/master/entry/src/main/ets/utils/CameraUtil.ets#L183-L224" target="_blank">CameraUtil.ets</a></div></div></div></div> </div> <div class="tiledSection"><h2 id="section50639679">实现悬停态相机页面<i class="anchor-icon anchor-icon-link" anchorid="section50639679" tips="复制节点链接"></i></h2><p>悬停态对应折叠状态为FOLD_STATUS_HALF_FOLDED。在进入悬停态时，可以设计特殊的用户体验，UX效果图如下：</p> <p><span><img height="324.0279" originheight="1252" originwidth="1850" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163137.26333037874201790696231202623186:50001231000000:2800:9FFFBEC65D60B00E3107928A6DFAAB5C4D57F0E5B3C805934EAA575E99147261.png" title="点击放大" width="478.8"></span></p> </div> <div class="tiledSection"><h3 id="section7294111412102" class="firsth2">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section7294111412102" tips="复制节点链接"></i></h3><p>使用display.on('foldStatus')监听折叠状态的变化。当折叠状态为半折叠且屏幕显示方向为横屏或反向横屏时，记录悬停状态isHalfFolded为true，重新计算Xcomponent的Surface显示区域宽高并调整旋转策略，展示悬停态的相机页面布局；否则，记录悬停态状态为false。</p> <div class="screenLinkPre"><div _ngcontent-ngo-c106="" class="highlight-div"><div _ngcontent-ngo-c106="" class="highlight-div-header"><div _ngcontent-ngo-c106="" class="highlight-div-header-left"><div _ngcontent-ngo-c106="" class="handle-button expand-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ngo-c106="" class="highlight-div-header-right"><div _ngcontent-ngo-c106="" class="handle-button ai-button"></div><div _ngcontent-ngo-c106="" class="handle-button line-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ngo-c106="" class="handle-button theme-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ngo-c106="" class="handle-button copy-button"><div _ngcontent-ngo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ngo-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/MultiDeviceCamera/blob/master/entry/src/main/ets/pages/Index.ets#L49-L95" data-highlighted="yes"><ol class="linenums"><li>onFoldStatusChange: (foldStatus: display.FoldStatus) =&gt; void = (foldStatus: display.FoldStatus) =&gt; {</li><li>  <span class="hljs-keyword">if</span> (foldStatus === display.FoldStatus.FOLD_STATUS_HALF_FOLDED) {</li><li>    let orientation: display.Orientation = display.getDefaultDisplaySync().orientation;</li><li>    <span class="hljs-comment">// Determine the page layout that has entered half folded status and prohibit portrait orientation.</span></li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.widthBp === WidthBreakpoint.WIDTH_MD &amp;&amp; (orientation === display.Orientation.LANDSCAPE ||</li><li>      orientation === display.Orientation.LANDSCAPE_INVERTED)) {</li><li>      <span class="hljs-keyword">this</span>.isHalfFolded = <span class="hljs-literal">true</span>;</li><li>      <span class="hljs-keyword">this</span>.windowUtil.setMainWindowOrientation(window.Orientation.LANDSCAPE);</li><li>      <span class="hljs-keyword">this</span>.cameraUtil.setHalfFoldedRect(<span class="hljs-keyword">this</span>.windowUtil.getWindowSize());</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.oldFoldStatus === display.FoldStatus.FOLD_STATUS_FOLDED) {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isFront) {</li><li>          <span class="hljs-keyword">this</span>.cameraUtil.cameraShooting(<span class="hljs-keyword">this</span>.surfaceId, <span class="hljs-keyword">this</span>.context!, camera.CameraPosition.CAMERA_POSITION_FRONT);</li><li>        } <span class="hljs-keyword">else</span> {</li><li>          <span class="hljs-keyword">this</span>.cameraUtil.cameraShooting(<span class="hljs-keyword">this</span>.surfaceId, <span class="hljs-keyword">this</span>.context!, camera.CameraPosition.CAMERA_POSITION_BACK);</li><li>        }</li><li>      }</li><li>    }</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.widthBp !== WidthBreakpoint.WIDTH_SM) {</li><li>    <span class="hljs-keyword">this</span>.windowUtil.setMainWindowOrientation(window.Orientation.AUTO_ROTATION_RESTRICTED);</li><li>  }</li><li>  <span class="hljs-comment">// Exit the half folded status page.</span></li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isHalfFolded) {</li><li>    <span class="hljs-keyword">this</span>.isHalfFolded = <span class="hljs-literal">false</span>;</li><li>    <span class="hljs-keyword">this</span>.cameraUtil.setXComponentRect(<span class="hljs-keyword">this</span>.windowUtil.getWindowSize());</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-keyword">if</span> (foldStatus === display.FoldStatus.FOLD_STATUS_FOLDED ||</li><li>      (<span class="hljs-keyword">this</span>.oldFoldStatus === display.FoldStatus.FOLD_STATUS_EXPANDED_WITH_SECOND_HALF_FOLDED &amp;&amp;</li><li>        foldStatus === display.FoldStatus.FOLD_STATUS_EXPANDED) ||</li><li>      (<span class="hljs-keyword">this</span>.oldFoldStatus === display.FoldStatus.FOLD_STATUS_EXPANDED &amp;&amp;</li><li>        foldStatus === display.FoldStatus.FOLD_STATUS_EXPANDED_WITH_SECOND_HALF_FOLDED)) {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isFront) {</li><li>        <span class="hljs-keyword">this</span>.cameraUtil.cameraShooting(<span class="hljs-keyword">this</span>.surfaceId, <span class="hljs-keyword">this</span>.context!, camera.CameraPosition.CAMERA_POSITION_FRONT);</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-keyword">this</span>.cameraUtil.cameraShooting(<span class="hljs-keyword">this</span>.surfaceId, <span class="hljs-keyword">this</span>.context!, camera.CameraPosition.CAMERA_POSITION_BACK);</li><li>      }</li><li>    }</li><li>  }</li><li>  <span class="hljs-keyword">this</span>.oldFoldStatus = foldStatus;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/MultiDeviceCamera/blob/master/entry/src/main/ets/pages/Index.ets#L49-L95" target="_blank">Index.ets</a></div></div></div></div> </div> <div class="tiledSection"><h2 id="section1684283074912">常见问题<i class="anchor-icon anchor-icon-link" anchorid="section1684283074912" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section1059415213584" class="firsth2">按钮大小异常、被截断<i class="anchor-icon anchor-icon-link" anchorid="section1059415213584" tips="复制节点链接"></i></h3><p><strong>问题现象</strong></p> <p>在不同设备上显示按钮大小异常或被截断。</p> <p><strong>可能原因</strong></p> <p>未设计不同设备对应的多套相机页面布局。</p> <p><strong>解决方案</strong></p> <p>针对不同横向断点设计多套相机页面布局并实现。详情请参考<a href="/consumer/cn/doc/best-practices/bpta-multi-device-camera#section181143569262">通过断点实现多套页面布局</a>。</p> </div> <div class="tiledSection"><h3 id="section386918133586">大屏相机页面的可操作组件不支持旋转<i class="anchor-icon anchor-icon-link" anchorid="section386918133586" tips="复制节点链接"></i></h3><p><strong>问题现象</strong></p> <p>在三折叠G态、双折叠展开态、平板等大屏幕，相机页面的可操作组件不支持旋转，不易操作。</p> <p><strong>可能原因</strong></p> <p>未设置窗口支持旋转。</p> <p><strong>解决方案</strong></p> <p>相机页面的横向断点为sm时，不支持旋转；为md、lg时，支持旋转。因此当窗口宽度、高度的最小值大于等于600vp时，窗口支持旋转。详情请参考<a href="/consumer/cn/doc/best-practices/bpta-multi-device-camera#section181143569262">通过断点实现多套页面布局</a>。</p> </div> <div class="tiledSection"><h3 id="section1488143015586">预览画面压缩、拉伸<i class="anchor-icon anchor-icon-link" anchorid="section1488143015586" tips="复制节点链接"></i></h3><p><strong>问题现象</strong></p> <p>预览画面的显示内容被压缩或拉伸。</p> <p><strong>可能原因</strong></p> <p>相机预览对象绑定XComponent组件时，未正确设置Surface区域宽高的值，导致宽高比与预览流旋转后的宽高比不一致。</p> <p><strong>解决方案</strong></p> <p>设置XComponent组件对应Surface区域的宽高比，使其与预览流旋转后的宽高比保持一致。详情请参考<a href="/consumer/cn/doc/best-practices/bpta-multi-device-camera#section882216138497">设置多设备上相机预览画面比例</a>。</p> </div> <div class="tiledSection"><h3 id="section207628353588">拍完照片显示角度异常<i class="anchor-icon anchor-icon-link" anchorid="section207628353588" tips="复制节点链接"></i></h3><p><strong>问题现象</strong></p> <p>拍摄完成后，照片的实际内容与预期方向不符，可能发生90°、180°或270°的旋转，导致用户需要手动调整才能正常查看。</p> <p><strong>可能原因</strong></p> <p>拍照时旋转了设备，且未设置正确的拍照角度。</p> <p><strong>解决方案</strong></p> <p>设置拍照时的旋转角度。详情请参考<a href="/consumer/cn/doc/best-practices/bpta-multi-device-camera#section0752024124911">设置拍照旋转角度</a>。</p> </div> <div class="tiledSection"><h3 id="section2086813616112">折叠屏切换折叠状态时出现黑屏<i class="anchor-icon anchor-icon-link" anchorid="section2086813616112" tips="复制节点链接"></i></h3><p><strong>问题现象</strong></p> <p>在折叠屏开合，切换折叠状态后，相机预览页面出现黑屏。</p> <p><strong>可能原因</strong></p> <p>切换折叠状态过程，导致折叠前选择的相机不再可用，预览画面黑屏。</p> <p><strong>解决方案</strong></p> <p>折叠状态切换过程窗口尺寸会变化，通过监听窗口尺寸变化，重新选择相机生成预览流。详情请参考<a href="/consumer/cn/doc/best-practices/bpta-multi-device-camera#section13854163154917">选择相机设备</a>。</p> </div> <div class="tiledSection"><h2 id="section896711369011">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section896711369011" tips="复制节点链接"></i></h2><ul><li><a href="https://gitee.com/harmonyos_samples/MultiDeviceCamera" target="_blank">基于相机开放能力和一多能力实现多设备相机</a></li></ul> </div> </div> <div></div></div>