<h1 _ngcontent-bxu-c119="" class="doc-title ng-star-inserted" title="窗口方向"> 窗口方向 </h1>

<div _ngcontent-bxu-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section171912388324">概述<i class="anchor-icon anchor-icon-link" anchorid="section171912388324" tips="复制节点链接"></i></h2><p>在HarmonyOS设备中涉及屏幕、窗口、rotation、orientation等多个显示方向相关术语，下面内容帮助开发梳理相关概念和使用场景。</p> </div> <div class="tiledSection"><h3 id="section14401655183514" class="firsth2">屏幕和窗口的区别<i class="anchor-icon anchor-icon-link" anchorid="section14401655183514" tips="复制节点链接"></i></h3><ul><li>屏幕（Display）指物理或逻辑的显示设备，是显示内容的整体区域。例如：<ul><li>物理屏幕：显示器、手机屏幕、投影仪等硬件设备。</li><li>逻辑屏幕：操作系统虚拟的多屏幕环境（如扩展桌面）。</li></ul> </li><li>窗口（Window）是运行在屏幕上的一个可交互的图形界面区域，属于软件层面。例如：<ul><li>应用程序窗口（如浏览器、文件夹窗口）。</li><li>对话框、工具栏等子窗口。</li></ul> </li></ul> </div> <div class="tiledSection"><h3 id="section17747155702218">设备的sensor<i class="anchor-icon anchor-icon-link" anchorid="section17747155702218" tips="复制节点链接"></i></h3><p>设备的顺时针旋转角度可以通过计算重力传感器的数据来精确获取。</p> </div> <div class="tiledSection"><h3 id="section15598121101615">屏幕侧的rotation<i class="anchor-icon anchor-icon-link" anchorid="section15598121101615" tips="复制节点链接"></i></h3><p>显示设备的屏幕顺时针旋转角度。使用场景：适用于和硬件设备角度强关联的场景，如相机预览角度补偿。</p> <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-display#display" target="_blank">rotation</a>的取值有4种，分别对应下图所示的4个方向（以手机为例）。如果需要更精准的角度信息，则需要配合设备sensor获取。</p> <p><span><img height="176.3181" originheight="739" originwidth="3329" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163124.10163179980438949519106681274897:50001231000000:2800:8EF25C57A46B8D4E86D9A56108BB5EEBB52586B836F4D11FBF70D2D0772E120E.png" title="点击放大" width="798"></span></p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.4.5.1.3.1.1" valign="top" width="20.52%"><p>值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.5.1.3.1.2" valign="top" width="79.47999999999999%"><p>含义</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="20.52%"><p>0</p> </td> <td class="cellrowborder" valign="top" width="79.47999999999999%"><p><span style="color: rgb(29,29,26);">显示设备屏幕顺时针旋转为0°</span>。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="20.52%"><p>1</p> </td> <td class="cellrowborder" valign="top" width="79.47999999999999%"><p><span style="color: rgb(29,29,26);">显示设备屏幕顺时针旋转为90°</span>。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="20.52%"><p>2</p> </td> <td class="cellrowborder" valign="top" width="79.47999999999999%"><p><span style="color: rgb(29,29,26);">显示设备屏幕顺时针旋转为180°</span>。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="20.52%"><p>3</p> </td> <td class="cellrowborder" valign="top" width="79.47999999999999%"><p><span style="color: rgb(29,29,26);">显示设备屏幕顺时针旋转为270°。</span></p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h3 id="section1068917714184">屏幕侧的orientation<i class="anchor-icon anchor-icon-link" anchorid="section1068917714184" tips="复制节点链接"></i></h3><p>显示设备的屏幕横竖方向，适用于感知横竖屏状态的场景，如视频类应用根据屏幕方向进行锁定。开发者可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-display#orientation10" target="_blank">orientation</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.3.1.4.1.1" valign="top" width="33.33333333333333%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.4.1.2" valign="top" width="33.33333333333333%"><p>值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.4.1.3" valign="top" width="33.33333333333333%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>PORTRAIT</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>0</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>表示设备当前以竖屏方式显示。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>LANDSCAPE</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>1</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>表示设备当前以横屏方式显示。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>PORTRAIT_INVERTED</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>2</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>表示设备当前以反向竖屏方式显示。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>LANDSCAPE_INVERTED</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>3</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>表示设备当前以反向横屏方式显示。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h3 id="section1895441982811">窗口侧的orientation<i class="anchor-icon anchor-icon-link" anchorid="section1895441982811" tips="复制节点链接"></i></h3><p>代表的是窗口旋转策略。其中有18种旋转策略，开发者可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-e#orientation9" target="_blank">orientation</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.6.3.1.4.1.1" valign="top" width="26.92269226922692%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.3.1.4.1.2" valign="top" width="15.841584158415841%"><p>值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.3.1.4.1.3" valign="top" width="57.23572357235723%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="26.92269226922692%"><p>UNSPECIFIED</p> </td> <td class="cellrowborder" valign="top" width="15.841584158415841%"><p>0</p> </td> <td class="cellrowborder" valign="top" width="57.23572357235723%"><p>表示未定义方向模式，由系统判定。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="26.92269226922692%"><p>PORTRAIT</p> </td> <td class="cellrowborder" valign="top" width="15.841584158415841%"><p>1</p> </td> <td class="cellrowborder" valign="top" width="57.23572357235723%"><p>表示竖屏显示模式。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="26.92269226922692%"><p>LANDSCAPE</p> </td> <td class="cellrowborder" valign="top" width="15.841584158415841%"><p>2</p> </td> <td class="cellrowborder" valign="top" width="57.23572357235723%"><p>表示横屏显示模式。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="26.92269226922692%"><p>PORTRAIT_INVERTED</p> </td> <td class="cellrowborder" valign="top" width="15.841584158415841%"><p>3</p> </td> <td class="cellrowborder" valign="top" width="57.23572357235723%"><p>表示反向竖屏显示模式。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="26.92269226922692%"><p>LANDSCAPE_INVERTED</p> </td> <td class="cellrowborder" valign="top" width="15.841584158415841%"><p>4</p> </td> <td class="cellrowborder" valign="top" width="57.23572357235723%"><p>表示反向横屏显示模式。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="26.92269226922692%"><p>AUTO_ROTATION</p> </td> <td class="cellrowborder" valign="top" width="15.841584158415841%"><p>5</p> </td> <td class="cellrowborder" valign="top" width="57.23572357235723%"><p>跟随传感器自动旋转，可以旋转到竖屏、横屏、反向竖屏、反向横屏四个方向。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h3 id="section1528019445520">窗口侧的orientation和屏幕侧的orientation的区别<i class="anchor-icon anchor-icon-link" anchorid="section1528019445520" tips="复制节点链接"></i></h3><p>屏幕侧的orientation表示屏幕当前横竖显示方向，屏幕的横竖显示方向只能获取，不能设置，客观体现了当前屏幕的显示状态。</p> <p>窗口侧的orientation代表的是窗口旋转策略，窗口旋转策略可以由开发者设置，系统会根据开发者的预设策略进行相应的旋转。</p> <p>对于开发者而言，控制应用的显示方向应该通过设置窗口侧的orientation(窗口旋转策略)实现。</p> </div> <div class="tiledSection"><h3 id="section11774145414383">窗口的orientation和屏幕rotation的关系<i class="anchor-icon anchor-icon-link" anchorid="section11774145414383" tips="复制节点链接"></i></h3><p>需要开发者注意的是，窗口的orientation和屏幕rotation并没有直接关联关系，在使用上也不能相互替代，否则在多设配适配场景下可能会出现兼容性问题。以三折叠手机不同形态下的orientation与rotation映射关系为例说明。在rotation为0度的情况下，窗口的orientation可能是竖屏也可能是横屏。</p> <p><span><img height="456.8030000000001" originheight="858" originwidth="1728" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163124.70647382947149182843036470513566:50001231000000:2800:EA7780F1E4CF656574419FEC726416192121CBA01C775D8DE123B472F3B5E777.png" title="点击放大" width="920"></span></p> </div> <div class="tiledSection"><h2 id="section8706181135512">使用窗口属性控制显示方向<i class="anchor-icon anchor-icon-link" anchorid="section8706181135512" tips="复制节点链接"></i></h2><p>横竖屏切换功能是指应用内同时支持竖屏和横屏显示。当不同页面需要采用不同显示方向时，需在应用逻辑中动态调整窗口方向以实现该效果。例如，在包含视频播放功能的应用中，首页通常采用竖屏展示，而视频详情页则切换为横屏模式，以提供更佳的观看体验。</p> </div> <div class="tiledSection"><h3 id="section76240597554" class="firsth2">设置窗口旋转方向<i class="anchor-icon anchor-icon-link" anchorid="section76240597554" tips="复制节点链接"></i></h3><ol><li><strong>通过module.json5文件中“orientation”字段进行设置</strong><p>此字段配置的是应用启动时的窗口显示方向，如果应用启动时需要默认以横屏或者竖屏方式显示，需要在此字段进行相应的配置。</p> <p>其支持的参数可以参考module.json5配置项中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-configuration-file#abilities标签" target="_blank">orientation字段</a>。</p> <div class="screenLinkPre"><div _ngcontent-bxu-c106="" class="highlight-div"><div _ngcontent-bxu-c106="" class="highlight-div-header"><div _ngcontent-bxu-c106="" class="highlight-div-header-left"><div _ngcontent-bxu-c106="" class="handle-button expand-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bxu-c106="" class="highlight-div-header-right"><div _ngcontent-bxu-c106="" class="handle-button ai-button"></div><div _ngcontent-bxu-c106="" class="handle-button line-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bxu-c106="" class="handle-button theme-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bxu-c106="" class="handle-button copy-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bxu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/orientationDevelopment/entry/src/main/configportrait/module.json5#L2-L63" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"module"</span>: {</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-string">"abilities"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"name"</span>: <span class="hljs-string">"EntryAbility"</span>,</li><li>        <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-string">"orientation"</span>: <span class="hljs-string">"portrait"</span>,</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>    ],</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/orientationDevelopment/entry/src/main/configportrait/module.json5#L2-L63" target="_blank">module.json5</a></div></div></div></div> <p>应用可根据业务需求配置默认旋转策略：</p> <ul><li>如果应用是竖屏应用，建议配置portrait为默认旋转策略。</li><li>如果应用是横屏应用，例如游戏类应用，进入游戏时，默认就是横屏，此时有以下两种情况：<ul><li>仅支持横屏，建议配置landscape为默认旋转策略。</li><li>支持在横屏和反向横屏中切换，建议配置auto_rotation_landscape为默认旋转策略。</li></ul> </li><li>如果应用为可旋转应用，建议配置auto_rotation_restricted为默认旋转策略。</li><li>如果应用在直板机和折叠机折叠态为竖屏应用，在平板和折叠机展开态默认为可旋转应用，推荐配置follow_desktop为默认旋转策略。</li></ul> </li><li><strong>在代码中通过调用窗口window的setPreferredOrientation方法进行设置</strong><p>应用启动之后，还需要改变显示方向的场景（例如视频播放竖屏切换横屏），开发者可通过window的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setpreferredorientation9" target="_blank">setPreferredOrientation()</a>方法实现。</p> <div class="screenLinkPre"><div _ngcontent-bxu-c106="" class="highlight-div"><div _ngcontent-bxu-c106="" class="highlight-div-header"><div _ngcontent-bxu-c106="" class="highlight-div-header-left"><div _ngcontent-bxu-c106="" class="handle-button expand-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bxu-c106="" class="highlight-div-header-right"><div _ngcontent-bxu-c106="" class="handle-button ai-button"></div><div _ngcontent-bxu-c106="" class="handle-button line-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bxu-c106="" class="handle-button theme-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bxu-c106="" class="handle-button copy-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bxu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/ResponsiveLayout/blob/master/entry/src/main/ets/utils/WindowUtil.ets#L169-L179" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">setWindowOrientation</span>(<span class="hljs-attr">orientation</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">Orientation</span>): <span class="hljs-keyword">void</span> {</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">mainWindow</span>.<span class="hljs-title function_">setPreferredOrientation</span>(orientation)</li><li>    .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testLog'</span>, <span class="hljs-string">`Succeeded in setting window orientation.`</span>);</li><li>      <span class="hljs-comment">// Update window orientation.</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">mainWindowInfo</span>.<span class="hljs-property">orientation</span> = orientation;</li><li>    })</li><li>    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testLog'</span>, <span class="hljs-string">`Failed to set window orientation. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    });</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ResponsiveLayout/blob/master/entry/src/main/ets/utils/WindowUtil.ets#L169-L179" target="_blank">WindowUtil.ets</a></div></div></div></div> </li><li><strong>不同的页面设置不同的旋转策略</strong><p>通过window.setPreferredOrientation()实现横竖屏切换。window的横竖屏会影响到所有页面，当发生不同或相同页面跳转和页面返回时，都需要管理横竖屏的状态。</p> <p>同一应用内的A、B页面设置不同的旋转策略，开发者可以在打开页面时设置旋转策略，关闭页面时恢复之前的旋转策略。</p> <div class="screenLinkPre"><div _ngcontent-bxu-c106="" class="highlight-div"><div _ngcontent-bxu-c106="" class="highlight-div-header"><div _ngcontent-bxu-c106="" class="highlight-div-header-left"><div _ngcontent-bxu-c106="" class="handle-button expand-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bxu-c106="" class="highlight-div-header-right"><div _ngcontent-bxu-c106="" class="handle-button ai-button"></div><div _ngcontent-bxu-c106="" class="handle-button line-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bxu-c106="" class="handle-button theme-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bxu-c106="" class="handle-button copy-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bxu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/orientationDevelopment/entry/src/main/ets/pages/ScreenRotationA.ets#L6-L19" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@StorageLink(<span class="hljs-string">'mainWindow'</span>)</span> mainWindow?: window.Window = undefined;</li><li><span class="hljs-keyword">public</span> lastOrientation?: window.Orientation;</li><li>
</li><li>aboutToAppear(): void {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.mainWindow === undefined) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-keyword">this</span>.lastOrientation = <span class="hljs-keyword">this</span>.mainWindow!.getPreferredOrientation();</li><li>  <span class="hljs-keyword">this</span>.mainWindow!.setPreferredOrientation(window.Orientation.LANDSCAPE);</li><li>}</li><li>
</li><li>aboutToDisappear(): void {</li><li>  <span class="hljs-keyword">this</span>.mainWindow!.setPreferredOrientation(<span class="hljs-keyword">this</span>.lastOrientation)</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/orientationDevelopment/entry/src/main/ets/pages/ScreenRotationA.ets#L6-L19" target="_blank">ScreenRotationA.ets</a></div></div></div></div> </li><li><strong>不同窗口模式对窗口方向的支持情况</strong><ul><li>悬浮窗口<p>开启横向悬浮窗</p> <p>视频或者游戏类应用在横屏模式下开启悬浮窗后，页面没有适配横屏，导致内容显示不全或者观看体验不好。</p> <p><span><img height="550.3407000000001" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163124.99993139733557536264424535374187:50001231000000:2800:7D676EC856AB18C7A5D59B39B24139A0E2940B084A66B1A0BD84EC2FC695560D.gif" title="点击放大" width="266"></span></p> <p>悬浮窗默认是竖向的，但是对于横向游戏和视频应用，横向的悬浮窗体验会更好。开发者可以通过在module.json5配置文件中abilities标签下的preferMultiWindowOrientation属性增加“landscape”或者“landscape_auto”配合API以声明应用支持横向悬浮窗或上下分屏模式。</p> <div class="screenLinkPre"><div _ngcontent-bxu-c106="" class="highlight-div"><div _ngcontent-bxu-c106="" class="highlight-div-header"><div _ngcontent-bxu-c106="" class="highlight-div-header-left"><div _ngcontent-bxu-c106="" class="handle-button expand-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bxu-c106="" class="highlight-div-header-right"><div _ngcontent-bxu-c106="" class="handle-button ai-button"></div><div _ngcontent-bxu-c106="" class="handle-button line-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bxu-c106="" class="handle-button theme-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bxu-c106="" class="handle-button copy-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bxu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/orientationDevelopment/entry/src/main/configlandscapeauto/module.json5#L2-L63" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"module"</span>: {</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-string">"abilities"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"name"</span>: <span class="hljs-string">"EntryAbility"</span>,</li><li>        <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-string">"preferMultiWindowOrientation"</span>: <span class="hljs-string">"landscape_auto"</span>,</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>    ],</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/orientationDevelopment/entry/src/main/configlandscapeauto/module.json5#L2-L63" target="_blank">module.json5</a></div></div></div></div> <p>该场景下多窗布局动态可变为横向，需要配合API（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#enablelandscapemultiwindow12" target="_blank">enableLandscapeMultiWindow()</a>/ <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#disablelandscapemultiwindow12" target="_blank">disableLandscapeMultiWindow()</a>）使用。</p> <div class="screenLinkPre"><div _ngcontent-bxu-c106="" class="highlight-div"><div _ngcontent-bxu-c106="" class="highlight-div-header"><div _ngcontent-bxu-c106="" class="highlight-div-header-left"><div _ngcontent-bxu-c106="" class="handle-button expand-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bxu-c106="" class="highlight-div-header-right"><div _ngcontent-bxu-c106="" class="handle-button ai-button"></div><div _ngcontent-bxu-c106="" class="handle-button line-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bxu-c106="" class="handle-button theme-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bxu-c106="" class="handle-button copy-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bxu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/orientationDevelopment/entry/src/main/ets/pages/ScreenRotationB.ets#L6-L14" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">private</span> windowClass = (<span class="hljs-keyword">this</span>.getUIContext().getHostContext() <span class="hljs-keyword">as</span> common.UIAbilityContext).windowStage.getMainWindowSync()</li><li>
</li><li>aboutToAppear(): void {</li><li>  <span class="hljs-keyword">this</span>.windowClass.enableLandscapeMultiWindow();</li><li>}</li><li>
</li><li>aboutToDisappear(): void {</li><li>  <span class="hljs-keyword">this</span>.windowClass.disableLandscapeMultiWindow();</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/orientationDevelopment/entry/src/main/ets/pages/ScreenRotationB.ets#L6-L14" target="_blank">ScreenRotationB.ets</a></div></div></div></div> <p>优化后效果如下图所示。</p> <p><span><img height="550.3407000000001" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163124.85555712048953974521408400498645:50001231000000:2800:138377CE9CA71296EF96EABFCD4E9EE1FEDF02C78D4AC0923296E8423C2426C7.gif" title="点击放大" width="266"></span></p> </li><li>自由窗口<p>当前规格，自由窗口不支持设置窗口旋转策略，2in1设备上调用不生效，自由多窗模式下调用不生效，子窗调用后不生效。</p> </li></ul> </li></ol> </div> <div class="tiledSection"><h3 id="section623217421556">常见窗口旋转策略设置场景<i class="anchor-icon anchor-icon-link" anchorid="section623217421556" tips="复制节点链接"></i></h3><ol><li><strong>跟随系统自动旋转</strong><p>设置<a href="/consumer/cn/doc/best-practices/bpta-multi-device-window-direction#section1895441982811">窗口侧的orientation</a>的值为AUTO_ROTATION，开发者可参考<a href="/consumer/cn/doc/best-practices/bpta-multi-device-window-direction#section76240597554">设置窗口旋转方向</a>。</p> <div class="screenLinkPre"><div _ngcontent-bxu-c106="" class="highlight-div"><div _ngcontent-bxu-c106="" class="highlight-div-header"><div _ngcontent-bxu-c106="" class="highlight-div-header-left"><div _ngcontent-bxu-c106="" class="handle-button expand-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bxu-c106="" class="highlight-div-header-right"><div _ngcontent-bxu-c106="" class="handle-button ai-button"></div><div _ngcontent-bxu-c106="" class="handle-button line-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bxu-c106="" class="handle-button theme-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bxu-c106="" class="handle-button copy-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bxu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/orientationDevelopment/entry/src/main/configautorotation/module.json5#L2-L63" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"module"</span>: {</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-string">"abilities"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"name"</span>: <span class="hljs-string">"EntryAbility"</span>,</li><li>        <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-string">"orientation"</span>: <span class="hljs-string">"auto_rotation"</span>,</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>    ],</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/orientationDevelopment/entry/src/main/configautorotation/module.json5#L2-L63" target="_blank">module.json5</a></div></div></div></div> <p>开发者也可参考以下表格不同的自动旋转策略特性。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.11.2.1.5.1.7.1.1" valign="top" width="35%"><p>旋转策略</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.2.1.5.1.7.1.2" valign="top" width="13%"><p>受控制中心的旋转开关控制</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.2.1.5.1.7.1.3" valign="top" width="13%"><p>横屏</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.2.1.5.1.7.1.4" valign="top" width="13%"><p>反向横屏</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.2.1.5.1.7.1.5" valign="top" width="13%"><p>竖屏</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.2.1.5.1.7.1.6" valign="top" width="13%"><p>反向竖屏</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="35%"><p>AUTO_ROTATION</p> </td> <td class="cellrowborder" valign="top" width="13%"><p>×</p> </td> <td class="cellrowborder" valign="top" width="13%"><p>√</p> </td> <td class="cellrowborder" valign="top" width="13%"><p>√</p> </td> <td class="cellrowborder" valign="top" width="13%"><p>√</p> </td> <td class="cellrowborder" valign="top" width="13%"><p>√</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="35%"><p>AUTO_ROTATION_PORTRAIT</p> </td> <td class="cellrowborder" valign="top" width="13%"><p>×</p> </td> <td class="cellrowborder" valign="top" width="13%"><p>×</p> </td> <td class="cellrowborder" valign="top" width="13%"><p>×</p> </td> <td class="cellrowborder" valign="top" width="13%"><p>√</p> </td> <td class="cellrowborder" valign="top" width="13%"><p>√</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="35%"><p>AUTO_ROTATION_LANDSCAPE</p> </td> <td class="cellrowborder" valign="top" width="13%"><p>×</p> </td> <td class="cellrowborder" valign="top" width="13%"><p>√</p> </td> <td class="cellrowborder" valign="top" width="13%"><p>√</p> </td> <td class="cellrowborder" valign="top" width="13%"><p>×</p> </td> <td class="cellrowborder" valign="top" width="13%"><p>×</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="35%"><p>AUTO_ROTATION_RESTRICTED</p> </td> <td class="cellrowborder" valign="top" width="13%"><p>√</p> </td> <td class="cellrowborder" valign="top" width="13%"><p>√</p> </td> <td class="cellrowborder" valign="top" width="13%"><p>√</p> </td> <td class="cellrowborder" valign="top" width="13%"><p>√</p> </td> <td class="cellrowborder" valign="top" width="13%"><p>√</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="35%"><p>AUTO_ROTATION_PORTRAIT_RESTRICTED</p> </td> <td class="cellrowborder" valign="top" width="13%"><p>√</p> </td> <td class="cellrowborder" valign="top" width="13%"><p>×</p> </td> <td class="cellrowborder" valign="top" width="13%"><p>×</p> </td> <td class="cellrowborder" valign="top" width="13%"><p>√</p> </td> <td class="cellrowborder" valign="top" width="13%"><p>√</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="35%"><p>AUTO_ROTATION_LANDSCAPE_RESTRICTED</p> </td> <td class="cellrowborder" valign="top" width="13%"><p>√</p> </td> <td class="cellrowborder" valign="top" width="13%"><p>√</p> </td> <td class="cellrowborder" valign="top" width="13%"><p>√</p> </td> <td class="cellrowborder" valign="top" width="13%"><p>×</p> </td> <td class="cellrowborder" valign="top" width="13%"><p>×</p> </td> </tr>  </tbody></table></div> </div> </li><li><strong>锁定窗口旋转方向</strong><p>开发者可通过在module.json5文件中给<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-configuration-file#abilities标签" target="_blank">abilities</a>标签配置orientation固定屏幕方向属性值。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.11.2.2.3.1.3.1.1" valign="top" width="50%"><p><strong>值</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.2.2.3.1.3.1.2" valign="top" width="50%"><p><strong>模式</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%"><p>PORTRAIT</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>表示竖屏显示模式。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>LANDSCAPE</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>表示横屏显示模式。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>PORTRAIT_INVERTED</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>表示反向竖屏显示模式。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>LANDSCAPE_INVERTED</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>表示反向横屏显示模式。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>LOCKED</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>表示锁定模式，锁定当前窗口显示模式。</p> </td> </tr>  </tbody></table></div> </div> </li><li><strong>监听窗口横竖屏方向</strong><ul><li>如果开发者希望监听窗口方向来调整UI，建议使用横纵断点方式判断页面布局。当开发者设置旋转策略后，窗口会根据实际场景完成对应的旋转，窗口旋转后窗口尺寸会落入新的断点区间，开发者可监听纵向断点变化并刷新界面布局，可参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-multi-device-responsive-layout">响应式布局</a>。<p><span><img height="506.43700000000007" originheight="1517" originwidth="2752" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163124.88885325506022328527496588292347:50001231000000:2800:B5F33D11B0245398FDB82A4114B605C06EF7BFF50E4037A5D80F63FFF3D6BFB4.png" title="点击放大" width="920"></span></p> </li><li>可以利用窗口尺寸变化的监听on('windowSizeChange')，窗口旋转后，在回调中更新横纵断点。<div class="screenLinkPre"><div _ngcontent-bxu-c106="" class="highlight-div"><div _ngcontent-bxu-c106="" class="highlight-div-header"><div _ngcontent-bxu-c106="" class="highlight-div-header-left"><div _ngcontent-bxu-c106="" class="handle-button expand-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bxu-c106="" class="highlight-div-header-right"><div _ngcontent-bxu-c106="" class="handle-button ai-button"></div><div _ngcontent-bxu-c106="" class="handle-button line-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bxu-c106="" class="handle-button theme-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bxu-c106="" class="handle-button copy-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bxu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/ResponsiveLayout/blob/master/entry/src/main/ets/utils/WindowUtil.ets#L40-L220" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">public</span> <span class="hljs-attr">onWindowSizeChange</span>: <span class="hljs-function">(<span class="hljs-params">windowSize: <span class="hljs-variable language_">window</span>.Size</span>) =&gt;</span> <span class="hljs-built_in">void</span> = <span class="hljs-function">(<span class="hljs-params">windowSize: <span class="hljs-variable language_">window</span>.Size</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">mainWindowInfo</span>.<span class="hljs-property">windowSize</span> = windowSize;</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">mainWindowInfo</span>.<span class="hljs-property">widthBp</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>!.<span class="hljs-title function_">getWindowWidthBreakpoint</span>();</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">mainWindowInfo</span>.<span class="hljs-property">heightBp</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>!.<span class="hljs-title function_">getWindowHeightBreakpoint</span>();</li><li>};</li><li><span class="hljs-comment">// ...</span></li><li><span class="hljs-title function_">updateWindowInfo</span>(): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-comment">// Register for window size change monitoring, update window size and width/height breakpoint.</span></li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">mainWindow</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'windowSizeChange'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onWindowSizeChange</span>);</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ResponsiveLayout/blob/master/entry/src/main/ets/utils/WindowUtil.ets#L40-L220" target="_blank">WindowUtil.ets</a></div></div></div></div> </li><li>可以通过以下方式订阅系统环境变量的变化，但通过以下方式只能监听到窗口方向为水平还是垂直，无法监听到是否为反向横屏或反向竖屏：<ul><li>使用ApplicationContext订阅回调。</li><li>在onConfigurationUpdate()回调方法中订阅或监听系统环境变量的变化，包括语言、颜色模式和屏幕方向。开发者可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/subscribe-system-environment-variable-changes" target="_blank">获取/设置环境变量</a>。</li></ul> </li></ul> </li><li><strong>横竖屏无缝切换（性能优化）</strong><p>在窗口旋转时，屏幕尺寸变化会导致界面重新布局。为提高横竖屏切换的流畅度，需进行性能优化。</p> <ul><li>使用自定义组件冻结<p>旋转时，由于整窗一起旋转会导致页面重新布局，但是实际上需要展示的可能只有播放内容。对于其他的组件，可以使用自定义组件冻结功能，避免旋转导致的UI更新操作。例如，视频播放底下的详情内容，可能是单独的组件。</p> <div class="screenLinkPre"><div _ngcontent-bxu-c106="" class="highlight-div"><div _ngcontent-bxu-c106="" class="highlight-div-header"><div _ngcontent-bxu-c106="" class="highlight-div-header-left"><div _ngcontent-bxu-c106="" class="handle-button expand-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bxu-c106="" class="highlight-div-header-right"><div _ngcontent-bxu-c106="" class="handle-button ai-button"></div><div _ngcontent-bxu-c106="" class="handle-button line-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bxu-c106="" class="handle-button theme-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bxu-c106="" class="handle-button copy-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bxu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/LandscapePortraitToggle/blob/master/entry/src/main/ets/views/VideoPlayView.ets#L253-L266" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Component</span>({ freezeWhenInactive: true })</li><li>  <span class="hljs-comment">// Added custom component freezing function</span></li><li>struct VideoDetailView {</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    Scroll() {</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/LandscapePortraitToggle/blob/master/entry/src/main/ets/views/VideoPlayView.ets#L253-L266" target="_blank">VideoPlayView.ets</a></div></div></div></div> </li><li>对图片使用autoResize<p>如果当前旋转页面存在图片，未经合理的裁剪，图片过大，可以对图片设置autoResize属性，使图片裁剪到合适的大小进行绘制。该属性的作用是将组件显示区域作为绘制的图源尺寸，可以减少内存占用，例如，原图是1920*1080，但是显示区域是200*100，则在解码时会降低采样编码到200*100尺寸。</p> <div class="screenLinkPre"><div _ngcontent-bxu-c106="" class="highlight-div"><div _ngcontent-bxu-c106="" class="highlight-div-header"><div _ngcontent-bxu-c106="" class="highlight-div-header-left"><div _ngcontent-bxu-c106="" class="handle-button expand-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bxu-c106="" class="highlight-div-header-right"><div _ngcontent-bxu-c106="" class="handle-button ai-button"></div><div _ngcontent-bxu-c106="" class="handle-button line-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bxu-c106="" class="handle-button theme-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bxu-c106="" class="handle-button copy-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bxu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/LandscapePortraitToggle/blob/master/entry/src/main/ets/views/VideoPlayView.ets#L270-L282" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Builder</span></li><li>function ImageItem(<span class="hljs-attribute">imageSrc</span>: ResourceStr) {</li><li>  <span class="hljs-built_in">Stack</span>({}) {</li><li>    <span class="hljs-built_in">Image</span>(imageSrc)</li><li>      <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')</li><li>      <span class="hljs-selector-class">.height</span>('<span class="hljs-number">100%</span>')</li><li>      <span class="hljs-selector-class">.autoResize</span>(true)<span class="hljs-comment">// Use auto_resize attributes on images</span></li><li>      <span class="hljs-selector-class">.borderRadius</span>(<span class="hljs-number">8</span>)</li><li>      <span class="hljs-selector-class">.objectFit</span>(ImageFit.Fill)</li><li>      <span class="hljs-selector-class">.backgroundColor</span>('#<span class="hljs-number">1</span>AFFFFFF')</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/LandscapePortraitToggle/blob/master/entry/src/main/ets/views/VideoPlayView.ets#L270-L282" target="_blank">VideoPlayView.ets</a></div></div></div></div> </li><li>排查一些耗时操作<p>排查当前页面是否存在冗余的OnAreaChange事件、blur模糊或linearGradient属性。这些属性较为耗时，应根据是否必须使用来决定是否进行优化。</p> </li></ul> </li></ol> </div> <div class="tiledSection"><h3 id="section1193015522379">应用子窗旋转场景<i class="anchor-icon anchor-icon-link" anchorid="section1193015522379" tips="复制节点链接"></i></h3></div> <p>在应用旋转场景中，应用主窗的尺寸由系统控制，而应用子窗的尺寸和位置由应用控制。因此，建议应用开发者在有应用子窗的旋转场景中，同步调整应用子窗的尺寸和位置，避免因旋转过程中应用子窗的尺寸和位置保持不变而导致如下图所示的应用子窗显示截断问题（直板机默认的旋转策略为UNSPECIFIED，旋转锁定按钮关闭的情况下不允许应用旋转，可以通过module.json5配置文件中<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-structure#abilities对象的内部结构" target="_blank">abilities</a>标签的"orientation"字段配置应用的旋转策略为AUTO_ROTATION，使应用跟随设备方向旋转）。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="center" class="cellrowborder" id="mcps1.3.14.1.3.1.1" valign="top" width="41.83%"><p>旋转前竖屏显示</p> </th> <th align="center" class="cellrowborder" id="mcps1.3.14.1.3.1.2" valign="top" width="58.17%"><p>旋转后横屏显示（调整前）</p> </th> </tr> </thead> <tbody><tr><td align="center" class="cellrowborder" valign="top" width="41.83%"><p><span><img height="550.2343" originheight="1026" originwidth="496" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163124.45952769249537100381441726237497:50001231000000:2800:ECC863CFCFDDEAB611A95401789D935F4958FF880BD049E76EA334967C1139B1.png" title="点击放大" width="266"></span></p> </td> <td align="center" class="cellrowborder" valign="top" width="58.17%"><p><span><img height="246.33222495301433" originheight="495" originwidth="1026" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163125.88504626443477917804098351144162:50001231000000:2800:0BC82297E8A6AE9B4B5E17E086264C22C3F99022062BCD97AC04991D8BE630EA.png" title="点击放大" width="511.164"></span></p> </td> </tr>  </tbody></table></div> </div> <p><strong>实现方案</strong></p> <p>系统为设备窗口尺寸变化监听、设置应用子窗尺寸和位置提供了如下接口：</p> <ol><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#onwindowsizechange7" target="_blank">on('windowSizeChange')</a>接口用于开启窗口尺寸变化的监听，当窗口发生旋转后，会触发其中的回调。</li><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#resize9" target="_blank">resize()</a>接口用于改变当前窗口的大小，可以在窗口发生旋转后及时调整子窗的宽高。</li><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#movewindowto9" target="_blank">moveWindowTo()</a>接口用于移动窗口位置，可以在窗口发生旋转后及时调整子窗的位置。</li></ol> <p>为实现根据应用旋转方向设置应用子窗尺寸，开发者可使用on('windowSizeChange')接口监听窗口尺寸的变化，并在回调函数中通过resize()接口和moveWindowTo()接口分别调整应用子窗的尺寸和位置。</p> <p>需要指出的是，开发者可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setfollowparentwindowlayoutenabled17" target="_blank">setFollowParentWindowLayoutEnabled()</a>接口设置子窗或模态窗口的布局信息是否跟随主窗，如果设置为跟随主窗，那么子窗的旋转便不再需要额外适配。</p> <div class="screenLinkPre"><div _ngcontent-bxu-c106="" class="highlight-div"><div _ngcontent-bxu-c106="" class="highlight-div-header"><div _ngcontent-bxu-c106="" class="highlight-div-header-left"><div _ngcontent-bxu-c106="" class="handle-button expand-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bxu-c106="" class="highlight-div-header-right"><div _ngcontent-bxu-c106="" class="handle-button ai-button"></div><div _ngcontent-bxu-c106="" class="handle-button line-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bxu-c106="" class="handle-button theme-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bxu-c106="" class="handle-button copy-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bxu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SubwindowAdaptWhenRotate/entry/src/main/ets/pages/Index.ets#L17-L136" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">SUB_WINDOW_LEFT_OFFSET</span> = <span class="hljs-number">50</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">SUB_WINDOW_TOP_OFFSET</span> = <span class="hljs-number">500</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TAG</span> = <span class="hljs-string">'subWindowAdaptWhenRotate'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">DOMAIN</span> = <span class="hljs-number">0x0000</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">mainWindow</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">Window</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">subWindow</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">Window</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// create subWindow</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createSubWindow</span>();</li><li>
</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">mainWindow</span> = <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'mainWindow'</span>);</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">mainWindow</span>) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">mainWindow</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'windowSizeChange'</span>, <span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">adjustSubwindowSizeAndPosition</span>();</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">adjustSubwindowSizeAndPosition</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">subWindow</span>) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'subWindow is null'</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">subwindowRect</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">Rect</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>    <span class="hljs-keyword">try</span> {</li><li>      subwindowRect = <span class="hljs-variable language_">this</span>.<span class="hljs-property">subWindow</span>.<span class="hljs-title function_">getWindowProperties</span>().<span class="hljs-property">windowRect</span>;</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      hilog.<span class="hljs-title function_">warn</span>(<span class="hljs-number">0x000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`getWindowProperties failed, code=<span class="hljs-subst">${err.code}</span>, message=<span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">newWidth</span>: <span class="hljs-built_in">number</span> = subwindowRect!.<span class="hljs-property">height</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">newHeight</span>: <span class="hljs-built_in">number</span> = subwindowRect!.<span class="hljs-property">width</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">newX</span>: <span class="hljs-built_in">number</span> = subwindowRect!.<span class="hljs-property">top</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">newY</span>: <span class="hljs-built_in">number</span> = subwindowRect!.<span class="hljs-property">left</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">subWindow</span>.<span class="hljs-title function_">resize</span>(newWidth, newHeight)</li><li>      .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'Succeeded in changing the window size'</span>)</li><li>      }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`Failed to change the window size. Cause code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    });</li><li>
</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">subWindow</span>.<span class="hljs-title function_">moveWindowTo</span>(newX, newY)</li><li>      .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'Succeeded in moving the window'</span>);</li><li>      }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`Failed to move the window. Cause code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    });</li><li>
</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SubwindowAdaptWhenRotate/entry/src/main/ets/pages/Index.ets#L17-L136" target="_blank">Index.ets</a></div></div></div></div> <p><strong>实现效果</strong></p> <p>根据示例代码为不同旋转方向设置不同的应用子窗尺寸和位置的实际效果如下图所示，应用子窗的尺寸和位置在竖屏显示和横屏显示下是不同的。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="center" class="cellrowborder" id="mcps1.3.23.1.3.1.1" valign="top" width="41.46%"><p>旋转前竖屏显示</p> </th> <th align="center" class="cellrowborder" id="mcps1.3.23.1.3.1.2" valign="top" width="58.540000000000006%"><p>旋转后横屏显示</p> </th> </tr> </thead> <tbody><tr><td align="center" class="cellrowborder" valign="top" width="41.46%"><p><span><img height="550.2343" originheight="1026" originwidth="496" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163125.83064414802227142119836515997620:50001231000000:2800:CD85C7C4D86FA13875BAD0BFD80066017826B86A7597C3FCEC21333778E6AC62.png" title="点击放大" width="266"></span></p> </td> <td align="center" class="cellrowborder" valign="top" width="58.540000000000006%"><p><span><img height="247.97262782516506" originheight="495" originwidth="1026" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163125.40434615724813256918224592658718:50001231000000:2800:4713C84223967E1E86EDB2A2B1917A99CC19F77FD79FD36F9FD1FD29ADECDCD3.png" title="点击放大" width="514.568"></span></p> </td> </tr>  </tbody></table></div> </div> <div class="tiledSection"><h3 id="section16257518182319">兼容多设备上的旋转策略<i class="anchor-icon anchor-icon-link" anchorid="section16257518182319" tips="复制节点链接"></i></h3><div class="p"><strong>推荐的应用旋转策略</strong><ol><li>窗口旋转功能通常需要足够的空间来适应变化前后的横竖屏布局，以窗口高度和宽度中的较小值为基准，确保无论横屏还是竖屏，窗口均有足够的显示区域，避免内容挤压或溢出。<p>在横屏显示的条件下，为保证展示的列表数量、文本信息量和输入的舒适度，推荐横屏时窗口宽度和高度均大于348vp。因此应用窗口宽度和高度的最小值大于348vp时，该窗口符合支持旋转的标准要求。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>当窗口的宽度/高度最小值低于此值时，可能导致UI元素错位、文字截断或操作困难等问题。</p> </div></div></div> </li><li>当前HarmonyOS主流设备窗口全屏时尺寸和支持横竖屏旋转策略如下表所示。</li></ol>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.24.2.3.1.5.1.1" valign="top" width="22.442244224422446%"><p>产品类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.24.2.3.1.5.1.2" valign="top" width="22.562256225622566%"><p>窗口全屏时尺寸（vp）</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.24.2.3.1.5.1.3" valign="top" width="26.262626262626267%"><p><strong>以348vp为阈值，是否支持横竖屏旋转</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.24.2.3.1.5.1.4" valign="top" width="28.732873287328736%"><p>应用是否默认支持横竖屏旋转</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="22.442244224422446%"><p>手机（Mate60为例）</p> </td> <td class="cellrowborder" valign="top" width="22.562256225622566%"><p>374 * 827</p> </td> <td class="cellrowborder" valign="top" width="26.262626262626267%"><p>支持</p> </td> <td class="cellrowborder" valign="top" width="28.732873287328736%"><p>不支持</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="22.442244224422446%"><p>阔折叠（Pura X为例）</p> </td> <td class="cellrowborder" valign="top" width="22.562256225622566%"><p>内屏：440 * 797</p> <p>外屏：326 * 326</p> </td> <td class="cellrowborder" valign="top" width="26.262626262626267%"><p>内屏：支持</p> <p>外屏：不支持</p> </td> <td class="cellrowborder" valign="top" width="28.732873287328736%"><p>内屏：不支持</p> <p>外屏：不支持</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="22.442244224422446%"><p>双折叠（Mate X系列，Mate X5为例）</p> </td> <td class="cellrowborder" valign="top" width="22.562256225622566%"><p>内屏：711 * 798</p> <p>外屏：345 * 801</p> </td> <td class="cellrowborder" valign="top" width="26.262626262626267%"><p>内屏：支持</p> <p>外屏：不支持</p> </td> <td class="cellrowborder" valign="top" width="28.732873287328736%"><p>内屏：不支持</p> <p>外屏：不支持</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="22.442244224422446%"><p>三折叠（Mate XT为例）</p> </td> <td class="cellrowborder" valign="top" width="22.562256225622566%"><p>F态（单屏显示）：350 * 776</p> <p>M态（双屏显示）：712 * 776</p> <p>G态（三屏显示）：776 * 1107</p> </td> <td class="cellrowborder" valign="top" width="26.262626262626267%"><p>F态（单屏显示）：支持</p> <p>M态（双屏显示）：支持</p> <p>G态（三屏显示）：支持</p> </td> <td class="cellrowborder" valign="top" width="28.732873287328736%"><p>F态（单屏显示）：不支持</p> <p>M态（双屏显示）：不支持</p> <p>G态（三屏显示）：支持</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="22.442244224422446%"><p>平板（MatePad Pro为例）</p> </td> <td class="cellrowborder" valign="top" width="22.562256225622566%"><p>711 * 1137</p> </td> <td class="cellrowborder" valign="top" width="26.262626262626267%"><p>支持</p> </td> <td class="cellrowborder" valign="top" width="28.732873287328736%"><p>支持</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="22.442244224422446%"><p>PC/2in1</p> </td> <td class="cellrowborder" valign="top" width="22.562256225622566%"><p>/</p> </td> <td class="cellrowborder" valign="top" width="26.262626262626267%"><p>应用无法配置窗口旋转策略</p> </td> <td class="cellrowborder" valign="top" width="28.732873287328736%"><p>应用无法配置窗口旋转策略</p> </td> </tr>  </tbody></table></div> </div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>不同产品类型对应的窗口全屏时尺寸，可以在应用EntryAbility生命周期函数<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability#onwindowstagecreate" target="_blank">onWindowStageCreate()</a>中，通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-i#windowproperties" target="_blank">window.getWindowProperties().windowRect</a>获取窗口尺寸、调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-uicontext#px2vp12" target="_blank">uicontext.px2vp()</a>将结果转化为vp后查看。</p> </div></div></div> <ol start="3"><li>348vp为符合支持旋转的标准阈值。该阈值可作为基础参考值，应用实际的横竖屏旋转策略需要根据应用实际需求决定，以横纵向断点作为条件判断。例如：<p>如果需要Pura X外屏也支持旋转，可以同时设置“横向断点sm，纵向断点md”条件下支持旋转；如果需要双折叠外屏也支持旋转，可以同时设置“横向断点sm，纵向断点lg”条件下支持旋转。不同设备和状态对应的断点区间，请参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-multi-device-responsive-layout#section186821126131515">断点的定义</a>。</p> </li><li>如果应用旋转策略与348vp无关，则需要根据支持旋转产品类型，以横纵向断点作为条件判断，注意需要考虑到不同折叠状态和不同的横竖屏状态。例如：<ol><li>应用在双折叠外屏、三折叠M态和G态、平板上支持旋转，其他情况不旋转。</li><li>其在不同横竖屏状态下对应的横纵向断点如下表： <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.24.2.5.2.1.2.1.1.4.1.1" valign="top" width="20%"><p>产品类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.24.2.5.2.1.2.1.1.4.1.2" valign="top" width="40%"><p>横屏</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.24.2.5.2.1.2.1.1.4.1.3" valign="top" width="40%"><p>竖屏</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="20%"><p>双折叠内屏</p> </td> <td class="cellrowborder" valign="top" width="40%"><p>横向断点md，纵向断点md</p> </td> <td class="cellrowborder" valign="top" width="40%"><p>横向断点md，纵向断点md</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="20%"><p>三折叠M态</p> </td> <td class="cellrowborder" valign="top" width="40%"><p>横向断点md，纵向断点md</p> </td> <td class="cellrowborder" valign="top" width="40%"><p>横向断点md，纵向断点md</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="20%"><p>三折叠G态</p> </td> <td class="cellrowborder" valign="top" width="40%"><p>横向断点lg，纵向断点sm</p> </td> <td class="cellrowborder" valign="top" width="40%"><p>横向断点md，纵向断点lg</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="20%"><p>平板</p> </td> <td class="cellrowborder" valign="top" width="40%"><p>横向断点lg，纵向断点sm</p> </td> <td class="cellrowborder" valign="top" width="40%"><p>横向断点md，纵向断点lg</p> </td> </tr>  </tbody></table></div> </div> </li><li>结合表中所有条件，整理支持横竖屏旋转的条件为“(横向断点 === md &amp;&amp; 纵向断点 !== sm) || (横向断点 === lg &amp;&amp; 纵向断点 === sm)”。</li></ol> </li><li>通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setpreferredorientation9" target="_blank">window.setPreferredOrientation()</a>，设置AUTO_ROTATION_RESTRICTED，实现窗口支持横竖屏旋转，且受控制中心的旋转开关控制。<div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>仅主窗口支持设置旋转显示方向，PC/2in1、子窗口、自由多窗下调用window.setPreferredOrientation()接口不生效。</p> </div></div></div> </li></ol> </div> <div class="screenLinkPre"><div _ngcontent-bxu-c106="" class="highlight-div"><div _ngcontent-bxu-c106="" class="highlight-div-header"><div _ngcontent-bxu-c106="" class="highlight-div-header-left"><div _ngcontent-bxu-c106="" class="handle-button expand-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bxu-c106="" class="highlight-div-header-right"><div _ngcontent-bxu-c106="" class="handle-button ai-button"></div><div _ngcontent-bxu-c106="" class="handle-button line-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bxu-c106="" class="handle-button theme-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bxu-c106="" class="handle-button copy-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bxu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/bptaMultiWindow/entry/src/main/ets/entryability/EntryAbility1.ets#L21-L67" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">"@kit.PerformanceAnalysisKit"</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@kit.BasicServicesKit"</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@kit.ArkUI"</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@kit.AbilityKit"</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  windowObj?: <span class="hljs-variable language_">window</span>.<span class="hljs-property">Window</span>;</li><li>  uiContext?: <span class="hljs-title class_">UIContext</span>;</li><li>  <span class="hljs-attr">onWindowSizeChange</span>: <span class="hljs-function">(<span class="hljs-params">data: <span class="hljs-variable language_">window</span>.Size</span>) =&gt;</span> <span class="hljs-built_in">void</span> = <span class="hljs-function">(<span class="hljs-params">data: <span class="hljs-variable language_">window</span>.Size</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setDefaultOrientation</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">setDefaultOrientation</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">windowRect</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">Rect</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowObj</span>!.<span class="hljs-title function_">getWindowProperties</span>().<span class="hljs-property">windowRect</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">windowWidthVp</span>: <span class="hljs-built_in">number</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>!.<span class="hljs-title function_">px2vp</span>(windowRect.<span class="hljs-property">width</span>);</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">windowHeightVp</span>: <span class="hljs-built_in">number</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>!.<span class="hljs-title function_">px2vp</span>(windowRect.<span class="hljs-property">height</span>);</li><li>
</li><li>    <span class="hljs-comment">// If this condition is met, the window can be rotated.</span></li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(windowWidthVp, windowHeightVp) &gt; <span class="hljs-number">348</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowObj</span>?.<span class="hljs-title function_">setPreferredOrientation</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">Orientation</span>.<span class="hljs-property">AUTO_ROTATION_RESTRICTED</span>);</li><li>    }</li><li>    <span class="hljs-comment">// Otherwise, the window is displayed in portrait mode.</span></li><li>    <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowObj</span>?.<span class="hljs-title function_">setPreferredOrientation</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">Orientation</span>.<span class="hljs-property">PORTRAIT</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-attr">windowStage</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStage</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// Main window is created, set main page for this ability</span></li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Ability onWindowStageCreate'</span>);</li><li>    windowStage.<span class="hljs-title function_">getMainWindow</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">windowObj</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowObj</span> = windowObj;</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to obtain the main window. Cause code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    });</li><li>    windowStage.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/Index'</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (err.<span class="hljs-property">code</span>) {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Failed to load the content. Cause: %{public}s'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err) ?? <span class="hljs-string">''</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowObj</span>!.<span class="hljs-title function_">getUIContext</span>();</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setDefaultOrientation</span>();</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowObj</span>!.<span class="hljs-title function_">on</span>(<span class="hljs-string">'windowSizeChange'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onWindowSizeChange</span>);</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Succeeded in loading the content.'</span>);</li><li>    });</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/bptaMultiWindow/entry/src/main/ets/entryability/EntryAbility1.ets#L21-L67" target="_blank">EntryAbility1.ets</a></div></div></div></div> <p><strong>在配置文件中设置多设备不同的旋转策略</strong></p> <p>在module.json5文件中的"orientation"字段设置为"follow_desktop"，表示跟随桌面的旋转模式。</p> </div> <div class="tiledSection"><h2 id="section1790992213133">使用屏幕属性控制显示方向<i class="anchor-icon anchor-icon-link" anchorid="section1790992213133" tips="复制节点链接"></i></h2><p>不建议使用屏幕属性控制显示方向，屏幕属性与硬件特征强相关，很难实现软件与硬件解耦，请开发者优先考虑使用窗口属性控制显示方向。如果窗口属性不能满足场景诉求，再考虑使用屏幕属性，同时也要充分考虑不同硬件的差异问题。</p> </div> <div class="tiledSection"><h3 id="section1122583313311" class="firsth2">查询屏幕显示方向<i class="anchor-icon anchor-icon-link" anchorid="section1122583313311" tips="复制节点链接"></i></h3><ul><li>通过Display属性查询屏幕显示方向<div class="screenLinkPre"><div _ngcontent-bxu-c106="" class="highlight-div"><div _ngcontent-bxu-c106="" class="highlight-div-header"><div _ngcontent-bxu-c106="" class="highlight-div-header-left"><div _ngcontent-bxu-c106="" class="handle-button expand-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bxu-c106="" class="highlight-div-header-right"><div _ngcontent-bxu-c106="" class="handle-button ai-button"></div><div _ngcontent-bxu-c106="" class="handle-button line-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bxu-c106="" class="handle-button theme-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bxu-c106="" class="handle-button copy-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bxu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/ResponsiveLayout/blob/master/entry/src/main/ets/utils/WindowUtil.ets#L286-L287" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-variable">displayClass</span>: <span class="hljs-title class_">display</span>.<span class="hljs-title class_">Display</span> | <span class="hljs-title class_">null</span> = <span class="hljs-variable">display</span>.<span class="hljs-title function_">getDefaultDisplaySync</span>();</li><li><span class="hljs-variable">hilog</span>.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testLog'</span>, `<span class="hljs-variable">The</span> <span class="hljs-variable">Orientation</span> <span class="hljs-keyword">is</span> ${<span class="hljs-variable">displayClass</span>.<span class="hljs-variable">orientation</span>}`);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ResponsiveLayout/blob/master/entry/src/main/ets/utils/WindowUtil.ets#L286-L287" target="_blank">WindowUtil.ets</a></div></div></div></div> </li><li>通过Resourcemanager属性查询屏幕显示方向<div class="screenLinkPre"><div _ngcontent-bxu-c106="" class="highlight-div"><div _ngcontent-bxu-c106="" class="highlight-div-header"><div _ngcontent-bxu-c106="" class="highlight-div-header-left"><div _ngcontent-bxu-c106="" class="handle-button expand-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bxu-c106="" class="highlight-div-header-right"><div _ngcontent-bxu-c106="" class="handle-button ai-button"></div><div _ngcontent-bxu-c106="" class="handle-button line-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bxu-c106="" class="handle-button theme-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bxu-c106="" class="handle-button copy-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bxu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/ResponsiveLayout/blob/master/entry/src/main/ets/utils/WindowUtil.ets#L293-L295" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-variable">info</span>: <span class="hljs-title class_">resourceManager</span>.<span class="hljs-title class_">Direction</span> | <span class="hljs-title class_">undefined</span> =</li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-variable">uiContext</span>?.<span class="hljs-title function_">getHostContext</span>()?.<span class="hljs-variable">resourceManager</span>.<span class="hljs-title function_">getConfigurationSync</span>().<span class="hljs-variable">direction</span>;</li><li><span class="hljs-variable">hilog</span>.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testLog'</span>, `<span class="hljs-variable">The</span> <span class="hljs-variable">Orientation</span> <span class="hljs-keyword">is</span> ${<span class="hljs-variable">info</span>}`);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ResponsiveLayout/blob/master/entry/src/main/ets/utils/WindowUtil.ets#L293-L295" target="_blank">WindowUtil.ets</a></div></div></div></div> </li><li>通过媒体查询能力查询屏幕显示方向<p>在多线程场景中，MediaQuery对象要用UIContext中的getMediaQuery方法获取，不可以通过import 获取。</p> <div class="screenLinkPre"><div _ngcontent-bxu-c106="" class="highlight-div"><div _ngcontent-bxu-c106="" class="highlight-div-header"><div _ngcontent-bxu-c106="" class="highlight-div-header-left"><div _ngcontent-bxu-c106="" class="handle-button expand-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bxu-c106="" class="highlight-div-header-right"><div _ngcontent-bxu-c106="" class="handle-button ai-button"></div><div _ngcontent-bxu-c106="" class="handle-button line-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bxu-c106="" class="handle-button theme-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bxu-c106="" class="handle-button copy-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bxu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/orientationDevelopment/entry/src/main/ets/pages/MediaQueryPage.ets#L5-L70" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MediaQueryPage</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">color</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'#DB7093'</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Portrait'</span>;</li><li>  <span class="hljs-comment">// The condition is true when the device is in landscape orientation</span></li><li>  <span class="hljs-attr">listener</span>: mediaquery.<span class="hljs-property">MediaQueryListener</span> =</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getMediaQuery</span>().<span class="hljs-title function_">matchMediaSync</span>(<span class="hljs-string">'(orientation: landscape)'</span>);</li><li>  <span class="hljs-comment">// When the media query conditions are met, a callback is triggered</span></li><li>  <span class="hljs-title function_">onPortrait</span>(<span class="hljs-params">mediaQueryResult: mediaquery.MediaQueryResult</span>) {</li><li>    <span class="hljs-keyword">if</span> (mediaQueryResult.<span class="hljs-property">matches</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">boolean</span>) {</li><li>      <span class="hljs-comment">// If the device is in landscape orientation, change the corresponding page layout</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = <span class="hljs-string">'#FFD700'</span>;</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span> = <span class="hljs-string">'Landscape'</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = <span class="hljs-string">'#DB7093'</span>;</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span> = <span class="hljs-string">'Portrait'</span>;</li><li>    }</li><li>  }</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// Bind the current application instance</span></li><li>    <span class="hljs-comment">// Bind a callback function</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listener</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'change'</span>, <span class="hljs-function">(<span class="hljs-params">mediaQueryResult: mediaquery.MediaQueryResult</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onPortrait</span>(mediaQueryResult)</li><li>    });</li><li>  }</li><li>  <span class="hljs-title function_">aboutToDisappear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// Unbind the callback function registered in the listener</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listener</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'change'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// Change the horizontal and vertical screen status functions of the device</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">changeOrientation</span>(<span class="hljs-params">isLandscape: <span class="hljs-built_in">boolean</span></span>) {</li><li>    <span class="hljs-comment">// Obtain the context of the UIAbility instance</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>    <span class="hljs-comment">// Call this API to manually change the horizontal and vertical screen status of the device</span></li><li>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getLastWindow</span>(context).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">lastWindow</span>) =&gt;</span> {</li><li>      lastWindow.<span class="hljs-title function_">setPreferredOrientation</span>(isLandscape ? <span class="hljs-variable language_">window</span>.<span class="hljs-property">Orientation</span>.<span class="hljs-property">LANDSCAPE</span> : <span class="hljs-variable language_">window</span>.<span class="hljs-property">Orientation</span>.<span class="hljs-property">PORTRAIT</span>)</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">50</span> }) {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Landscape'</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Orange</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">changeOrientation</span>(<span class="hljs-literal">true</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Portrait'</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Orange</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">changeOrientation</span>(<span class="hljs-literal">false</span>);</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/orientationDevelopment/entry/src/main/ets/pages/MediaQueryPage.ets#L5-L70" target="_blank">MediaQueryPage.ets</a></div></div></div></div> </li></ul> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>通过Resourcemanager和媒体查询能力查询屏幕方向，只能查询横竖屏，不能查询到是否为反向横屏、反向竖屏。开发者可通过display.getDefaultDisplaySync().orientation来获取。</p> </div></div></div> </div> <div class="tiledSection"><h3 id="section2043391063614">监听屏幕显示（横竖）方向变化<i class="anchor-icon anchor-icon-link" anchorid="section2043391063614" tips="复制节点链接"></i></h3><p>应用设置屏幕自动旋转：在模块配置文件module.json5中给EntryAbility设置"orientation": “auto_rotation_restricted”，再打开手机自动旋转即可。 应用中获取window实例，用setPreferredOrientation设置窗口显示方向的属性。通过diplay.on可以监听屏幕状态改变。点击设置了具体方向后，再加上传感器模式判断屏幕方向。</p> <div class="screenLinkPre"><div _ngcontent-bxu-c106="" class="highlight-div"><div _ngcontent-bxu-c106="" class="highlight-div-header"><div _ngcontent-bxu-c106="" class="highlight-div-header-left"><div _ngcontent-bxu-c106="" class="handle-button expand-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bxu-c106="" class="highlight-div-header-right"><div _ngcontent-bxu-c106="" class="handle-button ai-button"></div><div _ngcontent-bxu-c106="" class="handle-button line-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bxu-c106="" class="handle-button theme-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bxu-c106="" class="handle-button copy-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bxu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/orientationDevelopment/entry/src/main/ets/pages/OrientationPage.ets#L2-L90" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { display, <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TAG</span> = <span class="hljs-string">'foo'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">ORIENTATION</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = [<span class="hljs-string">'垂直'</span>, <span class="hljs-string">'平'</span>, <span class="hljs-string">'反向垂直'</span>, <span class="hljs-string">'反向水平'</span>];</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">OrientationPage</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">rotation</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-variable constant_">ORIENTATION</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">rotation</span>];</li><li>  <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'setWindowLayOut'</span>) <span class="hljs-meta">@State</span> <span class="hljs-attr">isLandscape</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setOrientation</span>(<span class="hljs-number">1</span>);</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-title function_">callback</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; {</li><li>      <span class="hljs-keyword">let</span> getDefaultDisplay = display.<span class="hljs-title function_">getDefaultDisplaySync</span>();</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">rotation</span> = getDefaultDisplay.<span class="hljs-property">rotation</span>;</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-variable constant_">ORIENTATION</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">rotation</span>];</li><li>    };</li><li>    <span class="hljs-keyword">try</span> {</li><li>      display.<span class="hljs-title function_">on</span>(<span class="hljs-string">'change'</span>, callback);</li><li>    } <span class="hljs-keyword">catch</span> (exception) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'Failed to register callback. Code: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(exception));</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">setOrientation</span>(<span class="hljs-params"><span class="hljs-keyword">type</span>: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getLastWindow</span>(<span class="hljs-title function_">getContext</span>(<span class="hljs-variable language_">this</span>), <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {</li><li>        <span class="hljs-comment">//获取window实例</span></li><li>        <span class="hljs-keyword">if</span> (err.<span class="hljs-property">code</span>) {</li><li>          hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'Failed to obtain the top window. Cause: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>          <span class="hljs-keyword">return</span>;</li><li>        }</li><li>        <span class="hljs-keyword">let</span> windowClass = data;</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'Succeeded in obtaining the top window. Data: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">orientation</span>: <span class="hljs-built_in">number</span>;</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-number">1</span>) {</li><li>          orientation = <span class="hljs-variable language_">window</span>.<span class="hljs-property">Orientation</span>.<span class="hljs-property">AUTO_ROTATION</span>;</li><li>        } <span class="hljs-keyword">else</span> {</li><li>          orientation = <span class="hljs-variable language_">window</span>.<span class="hljs-property">Orientation</span>.<span class="hljs-property">UNSPECIFIED</span>;</li><li>        }</li><li>        <span class="hljs-keyword">try</span> {</li><li>          windowClass.<span class="hljs-title function_">setPreferredOrientation</span>(orientation, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {</li><li>            <span class="hljs-keyword">if</span> (err.<span class="hljs-property">code</span>) {</li><li>              hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'Failed to set window orientation. Cause: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>              <span class="hljs-keyword">return</span>;</li><li>            }</li><li>            hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Succeeded in setting window orientation.'</span>);</li><li>          });</li><li>        } <span class="hljs-keyword">catch</span> (exception) {</li><li>          hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'Failed to set window orientation. Cause: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(exception));</li><li>        }</li><li>      });</li><li>    } <span class="hljs-keyword">catch</span> (exception) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'Failed to obtain the top window. Cause: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(exception));</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">setWindowLayOut</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getLastWindow</span>(<span class="hljs-title function_">getContext</span>(<span class="hljs-variable language_">this</span>)).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">windowClass</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isLandscape</span>) {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'OrientationPage'</span>, <span class="hljs-string">'设置屏幕横屏'</span>);</li><li>        windowClass.<span class="hljs-title function_">setPreferredOrientation</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">Orientation</span>.<span class="hljs-property">AUTO_ROTATION_LANDSCAPE</span>);</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'OrientationPage'</span>, <span class="hljs-string">'设置屏幕竖屏'</span>);</li><li>        windowClass.<span class="hljs-title function_">setPreferredOrientation</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">Orientation</span>.<span class="hljs-property">AUTO_ROTATION_PORTRAIT</span>);</li><li>      }</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.rotation}</span>`</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">25</span>)</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>`</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">25</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'全屏'</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">140</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">isLandscape</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">isLandscape</span>;</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/orientationDevelopment/entry/src/main/ets/pages/OrientationPage.ets#L2-L90" target="_blank">OrientationPage.ets</a></div></div></div></div> </div> <div class="tiledSection"><h3 id="section14986108377">获取设备握持方向<i class="anchor-icon anchor-icon-link" anchorid="section14986108377" tips="复制节点链接"></i></h3><p>建议使用Windows的窗口旋转策略实现自动旋转。如果系统策略无法满足要求，可自定义开发设备角度检测。目前只能监听到屏幕的显示方向，并不能直接判断横竖握持方向。可以通过sensor获取设备角度，但是不能据此推断设备显示方向，因为不同设备0度对应的显示方向是不同的。</p> <p>通过sensor角度，先记录0度时的手机方向，再根据旋转判断设备方向。</p> <div class="screenLinkPre"><div _ngcontent-bxu-c106="" class="highlight-div"><div _ngcontent-bxu-c106="" class="highlight-div-header"><div _ngcontent-bxu-c106="" class="highlight-div-header-left"><div _ngcontent-bxu-c106="" class="handle-button expand-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bxu-c106="" class="highlight-div-header-right"><div _ngcontent-bxu-c106="" class="handle-button ai-button"></div><div _ngcontent-bxu-c106="" class="handle-button line-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bxu-c106="" class="handle-button theme-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bxu-c106="" class="handle-button copy-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bxu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/ResponsiveLayout/blob/master/entry/src/main/ets/utils/WindowUtil.ets#L300-L315" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">queryDegree</span>(): <span class="hljs-title class_">void</span> {</li><li>  <span class="hljs-variable">sensor</span>.<span class="hljs-title function_">on</span>(<span class="hljs-variable">sensor</span>.<span class="hljs-variable">SensorId</span>.<span class="hljs-variable">GRAVITY</span>, (<span class="hljs-variable">data</span>: <span class="hljs-title class_">sensor</span>.<span class="hljs-title class_">GravityResponse</span>) =&gt; {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">degree</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-variable">degree</span> = <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getCalDegree</span>(<span class="hljs-variable">data</span>.<span class="hljs-variable">x</span>, <span class="hljs-variable">data</span>.<span class="hljs-variable">y</span>, <span class="hljs-variable">data</span>.<span class="hljs-variable">z</span>);</li><li>  })</li><li>}</li><li>
</li><li><span class="hljs-title function_">getCalDegree</span>(<span class="hljs-variable">x</span>: <span class="hljs-title class_">number</span>, <span class="hljs-variable">y</span>: <span class="hljs-title class_">number</span>, <span class="hljs-variable">z</span>: <span class="hljs-title class_">number</span>): <span class="hljs-title class_">number</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">degree</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-comment">// three is Effective Delta Angle Threshold Coefficient.</span></li><li>  <span class="hljs-keyword">if</span> ((<span class="hljs-variable">x</span> * <span class="hljs-variable">x</span> + <span class="hljs-variable">y</span> * <span class="hljs-variable">y</span>) * <span class="hljs-number">3</span> &lt; <span class="hljs-title class_">z</span> * <span class="hljs-title class_">z</span>) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">degree</span>;</li><li>  }</li><li>  <span class="hljs-variable">degree</span> = <span class="hljs-number">90</span> - (<span class="hljs-variable">Number</span>)(<span class="hljs-variable">Math</span>.<span class="hljs-title function_">round</span>(<span class="hljs-variable">Math</span>.<span class="hljs-title function_">atan2</span>(<span class="hljs-variable">y</span>, -<span class="hljs-variable">x</span>) / <span class="hljs-variable">Math</span>.<span class="hljs-variable">PI</span> * <span class="hljs-number">180</span>));</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-variable">degree</span> &gt;= <span class="hljs-number">0</span> ? <span class="hljs-variable">degree</span> % <span class="hljs-number">360</span> : <span class="hljs-title class_">degree</span> % <span class="hljs-number">360</span> + <span class="hljs-number">360</span>;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ResponsiveLayout/blob/master/entry/src/main/ets/utils/WindowUtil.ets#L300-L315" target="_blank">WindowUtil.ets</a></div></div></div></div> </div> <div class="tiledSection"><h2 id="section078883710338">开发案例<i class="anchor-icon anchor-icon-link" anchorid="section078883710338" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section6952163023410" class="firsth2">视频类应用横竖屏开发<i class="anchor-icon anchor-icon-link" anchorid="section6952163023410" tips="复制节点链接"></i></h3><p>为了实现应用的横竖屏功能，需要从以下技术方面进行考虑：</p> <ol><li>设置窗口的旋转策略</li><li>监听屏幕的窗口变化</li><li>进行布局适配</li></ol> <p><strong>设置窗口的旋转策略</strong></p> <p>首先，需要对应用启动时的旋转策略进行设置，具体可以参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-landscape-and-portrait-development#section1188593118171" target="_blank">配置module.json5的Orientation字段</a>。这里我们以实现了一多开发为例，为满足直板机和平板设备不同的策略，设置为follow_desktop，这个字段主要解决在不同设备上默认旋转策略不同的问题。</p> <p>在具体需要实现横竖屏切换的页面上，例如视频播放页面支持横屏，但是首页的内容仅支持竖屏的，那么就需要在进入对应的页面时，采用window窗口提供的设置窗口方向的能力，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setpreferredorientation9" target="_blank">setPreferredOrientation()</a>将窗口显示的方向修改为横屏或竖屏的状态。在使用时，需根据应用自身的旋转策略选择相应的参数，可以封装如下方法，进行旋转策略的设置。</p> <p>具体如下：通过getContext获取对应的UIAbilityContext，并通过context获取对应的windowStage实例，然后通过windowStage.getMainWindowSync同步方法拿到对应的窗口实例win，然后调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setpreferredorientation9" target="_blank">setPreferredOrientation()</a>方法设置窗口方向。</p> <div class="screenLinkPre"><div _ngcontent-bxu-c106="" class="highlight-div"><div _ngcontent-bxu-c106="" class="highlight-div-header"><div _ngcontent-bxu-c106="" class="highlight-div-header-left"><div _ngcontent-bxu-c106="" class="handle-button expand-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bxu-c106="" class="highlight-div-header-right"><div _ngcontent-bxu-c106="" class="handle-button ai-button"></div><div _ngcontent-bxu-c106="" class="handle-button line-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bxu-c106="" class="handle-button theme-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bxu-c106="" class="handle-button copy-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bxu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/LandscapePortraitToggle/blob/master/entry/src/main/ets/views/VideoPlayView.ets#L18-L124" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span>, settings } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span></li><li><span class="hljs-keyword">import</span> <span class="hljs-title class_">Logger</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/Logger'</span></li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span></li><li>
</li><li><span class="hljs-meta">@Component</span></li><li><span class="hljs-keyword">export</span> struct <span class="hljs-title class_">VideoPlayView</span> {</li><li>  context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>()?.<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span></li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-keyword">private</span> windowClass = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span> <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>).<span class="hljs-property">windowStage</span>.<span class="hljs-title function_">getMainWindowSync</span>()</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">setOrientation</span>(<span class="hljs-params">orientation: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowClass</span>.<span class="hljs-title function_">setPreferredOrientation</span>(orientation).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'setWindowOrientation: '</span> + orientation + <span class="hljs-string">' Succeeded.'</span>)</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'setWindowOrientation: '</span> + orientation + <span class="hljs-string">' Failed. Cause: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err))</li><li>    })</li><li>  }</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/LandscapePortraitToggle/blob/master/entry/src/main/ets/views/VideoPlayView.ets#L18-L124" target="_blank">VideoPlayView.ets</a></div></div></div></div> <p>以视频播放为例，不仅支持通过系统控制横竖屏，也支持用户在系统锁定旋转的情况下，手动设置横屏状态，即需要满足以下条件：</p> <ol><li><strong>应用跟随传感器旋转；</strong></li><li><strong>受到控制中心的旋转锁定按钮控制；</strong></li><li><strong>支持用户在应用页面中临时调用设置方向的能力，例如点击全屏按钮进行切换。</strong></li></ol> <p>要实现以上效果，可以使用窗口的能力设置orientation的枚举类型进行相应的旋转。为了提供临时设置方向的能力，当用户手动点击全屏按钮时，需要手动触发横竖屏切换。如果此时关闭了旋转锁定，窗口需要能够跟随传感器旋转。因此，可以使用以下枚举中的能力，临时调用旋转，并让其后续支持跟随传感器。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.30.12.1.4.1.1" valign="top" width="30.09%"><p>orientation枚举值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.30.12.1.4.1.2" valign="top" width="6.84%"><p>枚举数值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.30.12.1.4.1.3" valign="top" width="63.07000000000001%"><p>效果描述</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="30.09%"><p>USER_ROTATION_PORTRAIT</p> </td> <td class="cellrowborder" valign="top" width="6.84%"><p>13</p> </td> <td class="cellrowborder" valign="top" width="63.07000000000001%"><p>调用时临时旋转到竖屏，之后跟随传感器自动旋转，受控制中心的旋转开关控制，且可旋转方向受系统判定。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="30.09%"><p>USER_ROTATION_LANDSCAPE</p> </td> <td class="cellrowborder" valign="top" width="6.84%"><p>14</p> </td> <td class="cellrowborder" valign="top" width="63.07000000000001%"><p>调用时临时旋转到横屏，之后跟随传感器自动旋转，受控制中心的旋转开关控制，且可旋转方向受系统判定。</p> </td> </tr>  </tbody></table></div> </div> <p>分析旋转方向：一般情况下，视频播放应用的旋转方向不会旋转到反向竖屏（由UX需求决定），仅支持旋转到竖屏、横屏和反向横屏。点击切换按钮时，默认旋转到横屏状态，并支持跟随传感器旋转到反向横屏。</p> <p></p> <p><span><img height="401.2743" originheight="747" originwidth="1480" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163125.54261890393825629840412106067733:50001231000000:2800:6CD2E14031D7BAD8D8E1BEE761195D9A9A147884EA3DDAC9F7F15BFBF308676F.jpg" title="点击放大" width="798"></span></p> <p>在需要用户点击的地方，需要根据进入全屏和退出全屏分别执行相应的逻辑，需要使用的方向状态如下：</p> <p>设置为横屏时，对应窗口方向为横屏状态：this.setOrientation(window.Orientation.USER_ROTATION_LANDSCAPE)，例如进入播放页时，进行竖屏 -&gt; 横屏切换；</p> <div class="screenLinkPre"><div _ngcontent-bxu-c106="" class="highlight-div"><div _ngcontent-bxu-c106="" class="highlight-div-header"><div _ngcontent-bxu-c106="" class="highlight-div-header-left"><div _ngcontent-bxu-c106="" class="handle-button expand-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bxu-c106="" class="highlight-div-header-right"><div _ngcontent-bxu-c106="" class="handle-button ai-button"></div><div _ngcontent-bxu-c106="" class="handle-button line-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bxu-c106="" class="handle-button theme-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bxu-c106="" class="handle-button copy-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bxu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/LandscapePortraitToggle/blob/master/entry/src/main/ets/views/VideoPlayView.ets#L219-L238" data-highlighted="yes"><ol class="linenums"><li>Image($r(<span class="hljs-string">'app.media.icon_zoom_in'</span>))</li><li>  <span class="hljs-comment">// ...</span></li><li>  .onClick(() =&gt; {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isExpandedOrHalfFolded()) {</li><li>      <span class="hljs-keyword">this</span>.isLandscape = <span class="hljs-literal">true</span></li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-keyword">this</span>.setOrientation(window.Orientation.USER_ROTATION_LANDSCAPE)</li><li>    }</li><li>  })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/LandscapePortraitToggle/blob/master/entry/src/main/ets/views/VideoPlayView.ets#L219-L238" target="_blank">VideoPlayView.ets</a></div></div></div></div> <p>设置为竖屏时，对应窗口方向为竖屏状态：this.setOrientation(window.Orientation.USER_ROTATION_PORTRAIT)，例如在返回竖屏状态时，进行横屏 -&gt; 竖屏切换;</p> <div class="screenLinkPre"><div _ngcontent-bxu-c106="" class="highlight-div"><div _ngcontent-bxu-c106="" class="highlight-div-header"><div _ngcontent-bxu-c106="" class="highlight-div-header-left"><div _ngcontent-bxu-c106="" class="handle-button expand-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bxu-c106="" class="highlight-div-header-right"><div _ngcontent-bxu-c106="" class="handle-button ai-button"></div><div _ngcontent-bxu-c106="" class="handle-button line-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bxu-c106="" class="handle-button theme-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bxu-c106="" class="handle-button copy-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bxu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/LandscapePortraitToggle/blob/master/entry/src/main/ets/views/VideoPlayView.ets#L162-L181" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Image</span>($r(<span class="hljs-string">'app.media.icon_back'</span>))</li><li>  <span class="hljs-comment">// ...</span></li><li>  .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-comment">// ...</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setOrientation</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">Orientation</span>.<span class="hljs-property">USER_ROTATION_PORTRAIT</span>)</li><li>      <span class="hljs-comment">// ...</span></li><li>  })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/LandscapePortraitToggle/blob/master/entry/src/main/ets/views/VideoPlayView.ets#L162-L181" target="_blank">VideoPlayView.ets</a></div></div></div></div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>需要注意，调用setPreferredOrientation()方法会改变窗口的显示方向。因此，如果在进入视频播放页时手动调用了旋转到横屏的方法，那么在退出页面时也必须手动调用该方法，以恢复窗口到竖屏状态。</p> </div></div></div> <p><strong>监听窗口变化</strong></p> <p>当传感器变化或用户手动设置窗口方向时，窗口显示和尺寸会发生变化。此时，可以通过获取窗口的宽高并进行对比，判断当前是竖屏还是横屏状态，然后利用这些数据对布局进行适配。</p> <p>监听窗口尺寸的变化可以通过window.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#onwindowsizechange7" target="_blank">on('windowSizeChange')</a>进行实现。具体的措施如下：在需要进行横竖屏切换的页面进行窗口监听，一般建议是在aboutToAppear中执行：</p> <div class="screenLinkPre"><div _ngcontent-bxu-c106="" class="highlight-div"><div _ngcontent-bxu-c106="" class="highlight-div-header"><div _ngcontent-bxu-c106="" class="highlight-div-header-left"><div _ngcontent-bxu-c106="" class="handle-button expand-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bxu-c106="" class="highlight-div-header-right"><div _ngcontent-bxu-c106="" class="handle-button ai-button"></div><div _ngcontent-bxu-c106="" class="handle-button line-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bxu-c106="" class="handle-button theme-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bxu-c106="" class="handle-button copy-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bxu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/LandscapePortraitToggle/blob/master/entry/src/main/ets/views/VideoPlayView.ets#L42-L105" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-keyword">void</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowClass</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'windowSizeChange'</span>, <span class="hljs-function">(<span class="hljs-params">size</span>) =&gt;</span> {</li><li>    <span class="hljs-comment">// ...</span></li><li>  })</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/LandscapePortraitToggle/blob/master/entry/src/main/ets/views/VideoPlayView.ets#L42-L105" target="_blank">VideoPlayView.ets</a></div></div></div></div> <p>并在aboutToDisappear中取消监听：</p> <div class="screenLinkPre"><div _ngcontent-bxu-c106="" class="highlight-div"><div _ngcontent-bxu-c106="" class="highlight-div-header"><div _ngcontent-bxu-c106="" class="highlight-div-header-left"><div _ngcontent-bxu-c106="" class="handle-button expand-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bxu-c106="" class="highlight-div-header-right"><div _ngcontent-bxu-c106="" class="handle-button ai-button"></div><div _ngcontent-bxu-c106="" class="handle-button line-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bxu-c106="" class="handle-button theme-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bxu-c106="" class="handle-button copy-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bxu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" codehub="https://gitee.com/harmonyos_samples/LandscapePortraitToggle/blob/master/entry/src/main/ets/views/VideoPlayView.ets#L128-L135" data-highlighted="yes"><ol class="linenums"><li>aboutToDisappear(): <span class="hljs-keyword">void</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-keyword">this</span>.windowClass.off(<span class="hljs-string">'windowSizeChange'</span>)</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/LandscapePortraitToggle/blob/master/entry/src/main/ets/views/VideoPlayView.ets#L128-L135" target="_blank">VideoPlayView.ets</a></div></div></div></div> <p>需要注意的是，当用户手动触发setOrientation设置为横屏状态时，即使当前手机处于垂直方向，窗口的状态也是横屏方向，即如下所示：</p> <p></p> <p><span><img height="443.27570000000003" originheight="805" originwidth="1454" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163125.17228582871009778430808012379215:50001231000000:2800:B7EE90C5766E496133C9E3CC7895EA0E0F26EDBE05F7C8911A73830CAF3EC8B6.jpg" title="点击放大" width="798"></span></p> <p>此时，窗口的宽是竖屏状态下的高，高变为竖屏状态的宽。所以在监听窗口变化时，可以通过窗口的宽高大小关系来确定当前窗口的方向，并决定实际的横竖屏状态。</p> <div class="screenLinkPre"><div _ngcontent-bxu-c106="" class="highlight-div"><div _ngcontent-bxu-c106="" class="highlight-div-header"><div _ngcontent-bxu-c106="" class="highlight-div-header-left"><div _ngcontent-bxu-c106="" class="handle-button expand-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bxu-c106="" class="highlight-div-header-right"><div _ngcontent-bxu-c106="" class="handle-button ai-button"></div><div _ngcontent-bxu-c106="" class="handle-button line-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bxu-c106="" class="handle-button theme-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bxu-c106="" class="handle-button copy-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bxu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/LandscapePortraitToggle/blob/master/entry/src/main/ets/views/VideoPlayView.ets#L50-L90" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">this</span>.windowClass.on(<span class="hljs-string">'windowSizeChange'</span>, (size) =&gt; {</li><li>  let viewWidth = <span class="hljs-keyword">this</span>.getUIContext().px2vp(size.width)</li><li>  let viewHeight = <span class="hljs-keyword">this</span>.getUIContext().px2vp(size.height)</li><li>  <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-keyword">if</span> (viewWidth &gt; viewHeight) {</li><li>      <span class="hljs-keyword">if</span> (display.getFoldStatus() === display.FoldStatus.FOLD_STATUS_EXPANDED ||</li><li>        display.getFoldStatus() === display.FoldStatus.FOLD_STATUS_HALF_FOLDED) {</li><li>        <span class="hljs-keyword">this</span>.xComponentHeight = viewWidth * <span class="hljs-keyword">this</span>.aspect</li><li>        <span class="hljs-keyword">this</span>.xComponentWidth = viewWidth</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-keyword">this</span>.xComponentWidth = viewHeight / <span class="hljs-keyword">this</span>.aspect</li><li>        <span class="hljs-keyword">this</span>.xComponentHeight = viewHeight</li><li>        <span class="hljs-keyword">this</span>.isLandscape = <span class="hljs-literal">true</span></li><li>      }</li><li>      <span class="hljs-keyword">this</span>.windowClass.setSpecificSystemBarEnabled(<span class="hljs-string">'navigationIndicator'</span>, <span class="hljs-literal">false</span>) <span class="hljs-comment">// hide bottom navigation bar</span></li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-keyword">this</span>.xComponentHeight = viewWidth * <span class="hljs-keyword">this</span>.aspect</li><li>      <span class="hljs-keyword">this</span>.xComponentWidth = viewWidth</li><li>      <span class="hljs-keyword">this</span>.windowClass.setSpecificSystemBarEnabled(<span class="hljs-string">'navigationIndicator'</span>, <span class="hljs-literal">true</span>) <span class="hljs-comment">// show bottom navigation bar</span></li><li>      <span class="hljs-keyword">this</span>.isLandscape = <span class="hljs-literal">false</span></li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/LandscapePortraitToggle/blob/master/entry/src/main/ets/views/VideoPlayView.ets#L50-L90" target="_blank">VideoPlayView.ets</a></div></div></div></div> <p><strong>进行布局适配</strong></p> <p>对应视频播放这类应用，属于只有播放窗口需要进行横竖屏，所以只需要对视频播放的组件内容进行横屏并进入全屏。可以利用UI状态更新的特点，来让播窗变为全屏，将播窗的尺寸定义为@State状态，并设置到XComponent组件上。</p> <div class="screenLinkPre"><div _ngcontent-bxu-c106="" class="highlight-div"><div _ngcontent-bxu-c106="" class="highlight-div-header"><div _ngcontent-bxu-c106="" class="highlight-div-header-left"><div _ngcontent-bxu-c106="" class="handle-button expand-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bxu-c106="" class="highlight-div-header-right"><div _ngcontent-bxu-c106="" class="handle-button ai-button"></div><div _ngcontent-bxu-c106="" class="handle-button line-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bxu-c106="" class="handle-button theme-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bxu-c106="" class="handle-button copy-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bxu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" codehub="https://gitee.com/harmonyos_samples/LandscapePortraitToggle/blob/master/entry/src/main/ets/views/VideoPlayView.ets#L28-L29" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">@State</span> <span class="hljs-attribute">xComponentWidth</span>: number = this.<span class="hljs-built_in">getUIContext</span>().<span class="hljs-built_in">px2vp</span>(display.<span class="hljs-built_in">getDefaultDisplaySync</span>().<span class="hljs-attribute">width</span>)</li><li><span class="hljs-variable">@State</span> <span class="hljs-attribute">xComponentHeight</span>: number = this.<span class="hljs-built_in">getUIContext</span>().<span class="hljs-built_in">px2vp</span>(display.<span class="hljs-built_in">getDefaultDisplaySync</span>().<span class="hljs-attribute">width</span> * this.aspect)</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/LandscapePortraitToggle/blob/master/entry/src/main/ets/views/VideoPlayView.ets#L28-L29" target="_blank">VideoPlayView.ets</a></div></div></div></div> <p>将状态变量与播窗绑定。</p> <div class="screenLinkPre"><div _ngcontent-bxu-c106="" class="highlight-div"><div _ngcontent-bxu-c106="" class="highlight-div-header"><div _ngcontent-bxu-c106="" class="highlight-div-header-left"><div _ngcontent-bxu-c106="" class="handle-button expand-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bxu-c106="" class="highlight-div-header-right"><div _ngcontent-bxu-c106="" class="handle-button ai-button"></div><div _ngcontent-bxu-c106="" class="handle-button line-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bxu-c106="" class="handle-button theme-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bxu-c106="" class="handle-button copy-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bxu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/LandscapePortraitToggle/blob/master/entry/src/main/ets/views/VideoPlayView.ets#L142-L155" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">XComponent</span>({ <span class="hljs-variable">id</span>: <span class="hljs-string">'video_player_id'</span>, <span class="hljs-keyword">type</span>: <span class="hljs-title class_">XComponentType</span>.<span class="hljs-title class_">SURFACE</span>, <span class="hljs-variable">controller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">xComponentController</span> })</li><li>  .<span class="hljs-title function_">onLoad</span>(() =&gt; {</li><li>    <span class="hljs-comment">// ...</span></li><li>  })</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">xComponentWidth</span>)</li><li>  .<span class="hljs-title function_">height</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">xComponentHeight</span>)</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/LandscapePortraitToggle/blob/master/entry/src/main/ets/views/VideoPlayView.ets#L142-L155" target="_blank">VideoPlayView.ets</a></div></div></div></div> <p>并且在之前监听窗口变化的回调中，对XComponentWidth和XComponentHeight进行动态修改，以适应窗口变化时横屏和竖屏的视频窗口布局。需要注意的是，在横屏时，视频播放的宽高应该和窗口的宽高一样，并且需要进入全屏状态。而竖屏时，视频播放的宽应该等于窗口的宽，但是高度应该是按照播窗比例乘以窗口的宽进行设置，并退出全屏状态。</p> <p><span><img height="465.29" originheight="791" originwidth="1564" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163125.15133580461070198536844556366561:50001231000000:2800:A99F7EDE4B5605D27BF15C3040EEAD8F4F9B8D9E00FE017C0F57A7A15BB43441.png" title="点击放大" width="920"></span></p> <p>具体实现如下，进入视频详情页面内需要监听窗口尺寸的变化，并根据当前状态，实现对横竖屏状态的监听。根据状态变化修改对应XComponent的宽高，实现全屏或者隐藏状态栏和导航条的逻辑。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>需要注意的是，对于视频全屏效果，建议采用沉浸式开发。沉浸式效果的实现，可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-develop-apply-immersive-effects" target="_blank">开发应用沉浸式效果</a>。</p> </div></div></div> <div class="screenLinkPre"><div _ngcontent-bxu-c106="" class="highlight-div"><div _ngcontent-bxu-c106="" class="highlight-div-header"><div _ngcontent-bxu-c106="" class="highlight-div-header-left"><div _ngcontent-bxu-c106="" class="handle-button expand-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bxu-c106="" class="highlight-div-header-right"><div _ngcontent-bxu-c106="" class="handle-button ai-button"></div><div _ngcontent-bxu-c106="" class="handle-button line-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bxu-c106="" class="handle-button theme-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bxu-c106="" class="handle-button copy-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bxu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/LandscapePortraitToggle/blob/master/entry/src/main/ets/views/VideoPlayView.ets#L50-L90" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">this</span>.windowClass.on(<span class="hljs-string">'windowSizeChange'</span>, (size) =&gt; {</li><li>  let viewWidth = <span class="hljs-keyword">this</span>.getUIContext().px2vp(size.width)</li><li>  let viewHeight = <span class="hljs-keyword">this</span>.getUIContext().px2vp(size.height)</li><li>  <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-keyword">if</span> (viewWidth &gt; viewHeight) {</li><li>      <span class="hljs-keyword">if</span> (display.getFoldStatus() === display.FoldStatus.FOLD_STATUS_EXPANDED ||</li><li>        display.getFoldStatus() === display.FoldStatus.FOLD_STATUS_HALF_FOLDED) {</li><li>        <span class="hljs-keyword">this</span>.xComponentHeight = viewWidth * <span class="hljs-keyword">this</span>.aspect</li><li>        <span class="hljs-keyword">this</span>.xComponentWidth = viewWidth</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-keyword">this</span>.xComponentWidth = viewHeight / <span class="hljs-keyword">this</span>.aspect</li><li>        <span class="hljs-keyword">this</span>.xComponentHeight = viewHeight</li><li>        <span class="hljs-keyword">this</span>.isLandscape = <span class="hljs-literal">true</span></li><li>      }</li><li>      <span class="hljs-keyword">this</span>.windowClass.setSpecificSystemBarEnabled(<span class="hljs-string">'navigationIndicator'</span>, <span class="hljs-literal">false</span>) <span class="hljs-comment">// hide bottom navigation bar</span></li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-keyword">this</span>.xComponentHeight = viewWidth * <span class="hljs-keyword">this</span>.aspect</li><li>      <span class="hljs-keyword">this</span>.xComponentWidth = viewWidth</li><li>      <span class="hljs-keyword">this</span>.windowClass.setSpecificSystemBarEnabled(<span class="hljs-string">'navigationIndicator'</span>, <span class="hljs-literal">true</span>) <span class="hljs-comment">// show bottom navigation bar</span></li><li>      <span class="hljs-keyword">this</span>.isLandscape = <span class="hljs-literal">false</span></li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/LandscapePortraitToggle/blob/master/entry/src/main/ets/views/VideoPlayView.ets#L50-L90" target="_blank">VideoPlayView.ets</a></div></div></div></div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>上述代码完成的是直板机上的旋转逻辑，在进入页面时进行窗口变化的监听，需要在退出页面时关闭监听功能。另外，对于在平板下，如果旋转行为仅触发页面旋转，不触发视频播窗的全屏，需要进行特殊处理。</p> </div></div></div> <p>因此，需要对旋转行为进行限制，只有在直板机设备发生旋转时，将播窗全屏，对应平板上，在某些特定情况下，不需要视频播窗全屏，而是直接将布局进行旋转。</p> <ul><li>采用响应式布局中<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-multi-device-responsive-layout#section1532120147301">断点</a>的方式进行判断</li></ul> <p><strong>锁定屏幕功能</strong></p> <p>某些视频应用支持屏幕锁定功能，在全屏状态下，实现对功能按钮的隐藏，并临时锁定屏幕的旋转，避免用户误触其他操作按钮。屏幕锁定后，应用可以在横屏和反向横屏之间翻转，不可由横屏旋转为竖屏，解锁后，如果当前屏幕处于竖屏，则应该恢复到竖屏显示。</p> <p></p> <p><span><img height="169.4686" originheight="279" originwidth="1336" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163125.38974281008756446979022101262659:50001231000000:2800:F7E7608107B3B93C28654ED132B654A352CA346084C513E0522E9E93BA350ABA.jpg" title="点击放大" width="798"></span></p> <p>实现上述功能可以考虑以下实现：</p> <ol><li>判断当前控制中心的开关状态，如果是已经锁定情况下，则不需要进行额外处理</li><li>锁定时设置旋转策略为AUTO_ROTATION_LANDSCAPE，即支持横屏和反向横屏旋转，不受控制中心控制</li><li>解锁时需要回到支持三向旋转，即支持横屏、竖屏、反向横屏，并受到控制中心控制</li></ol> <p>可以由上述推断功能实现得到如下代码：</p> <div class="screenLinkPre"><div _ngcontent-bxu-c106="" class="highlight-div"><div _ngcontent-bxu-c106="" class="highlight-div-header"><div _ngcontent-bxu-c106="" class="highlight-div-header-left"><div _ngcontent-bxu-c106="" class="handle-button expand-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bxu-c106="" class="highlight-div-header-right"><div _ngcontent-bxu-c106="" class="handle-button ai-button"></div><div _ngcontent-bxu-c106="" class="handle-button line-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bxu-c106="" class="handle-button theme-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bxu-c106="" class="handle-button copy-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bxu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/LandscapePortraitToggle/blob/master/entry/src/main/ets/views/VideoPlayView.ets#L187-L213" data-highlighted="yes"><ol class="linenums"><li>Image(<span class="hljs-keyword">this</span>.isVideoLock ? $r(<span class="hljs-string">'app.media.icon_lock'</span>) : $r(<span class="hljs-string">'app.media.icon_lock_open'</span>))</li><li>  <span class="hljs-comment">// ...</span></li><li>  .onClick(() =&gt; {</li><li>    <span class="hljs-keyword">this</span>.isVideoLock = !<span class="hljs-keyword">this</span>.isVideoLock</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isVideoLock) {</li><li>      <span class="hljs-keyword">this</span>.setOrientation(window.Orientation.AUTO_ROTATION_LANDSCAPE)</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-keyword">this</span>.setOrientation(window.Orientation.AUTO_ROTATION_UNSPECIFIED)</li><li>    }</li><li>  })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/LandscapePortraitToggle/blob/master/entry/src/main/ets/views/VideoPlayView.ets#L187-L213" target="_blank">VideoPlayView.ets</a></div></div></div></div> <p>若应用需要在折叠屏不同折叠状态下设置不同的旋转策略，可以封装如下方法isExpandedOrHalfFolded()方法，判断当前折叠状态。</p> <div class="screenLinkPre"><div _ngcontent-bxu-c106="" class="highlight-div"><div _ngcontent-bxu-c106="" class="highlight-div-header"><div _ngcontent-bxu-c106="" class="highlight-div-header-left"><div _ngcontent-bxu-c106="" class="handle-button expand-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bxu-c106="" class="highlight-div-header-right"><div _ngcontent-bxu-c106="" class="handle-button ai-button"></div><div _ngcontent-bxu-c106="" class="handle-button line-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bxu-c106="" class="handle-button theme-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bxu-c106="" class="handle-button copy-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bxu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-diff" codehub="https://gitee.com/harmonyos_samples/LandscapePortraitToggle/blob/master/entry/src/main/ets/views/VideoPlayView.ets#L109-L113" data-highlighted="yes"><ol class="linenums"><li>isExpandedOrHalfFolded(): boolean {</li><li>  return display.getFoldStatus() <span class="hljs-comment">=== display.FoldStatus.FOLD_STATUS_EXPANDED ||</span></li><li>    display.getFoldStatus() <span class="hljs-comment">=== display.FoldStatus.FOLD_STATUS_HALF_FOLDED</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/LandscapePortraitToggle/blob/master/entry/src/main/ets/views/VideoPlayView.ets#L109-L113" target="_blank">VideoPlayView.ets</a></div></div></div></div> <p>当要对设备控制中心状态进行监听时，可以通过settings.registerKeyObserver监听控制中心变化，其中orientationLockState是当前设备控制中心的状态。当设备控制中心的状态为“0”时，即代表旋转功能被系统锁定。此时在处理锁定功能代码中不需要进行旋转逻辑的处理，因为在控制中心旋转开关关闭的情况下，屏幕的旋转行为会收到限制，所以首先要考虑对控制中心的旋转锁定状态进行判断，可以参考如下代码实现对设备控制中心的状态监听：</p> <div class="screenLinkPre"><div _ngcontent-bxu-c106="" class="highlight-div"><div _ngcontent-bxu-c106="" class="highlight-div-header"><div _ngcontent-bxu-c106="" class="highlight-div-header-left"><div _ngcontent-bxu-c106="" class="handle-button expand-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bxu-c106="" class="highlight-div-header-right"><div _ngcontent-bxu-c106="" class="handle-button ai-button"></div><div _ngcontent-bxu-c106="" class="handle-button line-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bxu-c106="" class="handle-button theme-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bxu-c106="" class="handle-button copy-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bxu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/LandscapePortraitToggle/blob/master/entry/src/main/ets/views/VideoPlayView.ets#L96-L101" data-highlighted="yes"><ol class="linenums"><li>settings.registerKeyObserver(<span class="hljs-keyword">this</span>.context, settings.general.ACCELEROMETER_ROTATION_STATUS,</li><li>  settings.domainName.DEVICE_SHARED, () =&gt; {</li><li>    <span class="hljs-keyword">this</span>.orientationLockState =</li><li>      settings.getValueSync(<span class="hljs-keyword">this</span>.context, settings.general.ACCELEROMETER_ROTATION_STATUS,</li><li>        settings.domainName.DEVICE_SHARED)</li><li>  })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/LandscapePortraitToggle/blob/master/entry/src/main/ets/views/VideoPlayView.ets#L96-L101" target="_blank">VideoPlayView.ets</a></div></div></div></div> <p>排除了当前设备后，即可以进行通过应用内锁定按钮进行逻辑判断。锁定状态下，调用setOrientation设置为Landscape，此时可以在横屏和反向横屏旋转。解锁后，恢复到三向（横屏、竖屏、反向横屏）旋转策略：</p> <div class="screenLinkPre"><div _ngcontent-bxu-c106="" class="highlight-div"><div _ngcontent-bxu-c106="" class="highlight-div-header"><div _ngcontent-bxu-c106="" class="highlight-div-header-left"><div _ngcontent-bxu-c106="" class="handle-button expand-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bxu-c106="" class="highlight-div-header-right"><div _ngcontent-bxu-c106="" class="handle-button ai-button"></div><div _ngcontent-bxu-c106="" class="handle-button line-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bxu-c106="" class="handle-button theme-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bxu-c106="" class="handle-button copy-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bxu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/LandscapePortraitToggle/blob/master/entry/src/main/ets/views/VideoPlayView.ets#L207-L211" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isVideoLock) {</li><li>  <span class="hljs-keyword">this</span>.setOrientation(window.Orientation.AUTO_ROTATION_LANDSCAPE)</li><li>} <span class="hljs-keyword">else</span> {</li><li>  <span class="hljs-keyword">this</span>.setOrientation(window.Orientation.AUTO_ROTATION_UNSPECIFIED)</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/LandscapePortraitToggle/blob/master/entry/src/main/ets/views/VideoPlayView.ets#L207-L211" target="_blank">VideoPlayView.ets</a></div></div></div></div> </div> <div class="tiledSection"><h3 id="section764984164712">游戏类应用横屏开发<i class="anchor-icon anchor-icon-link" anchorid="section764984164712" tips="复制节点链接"></i></h3><p>对于游戏类应用，以横屏游戏居多，此类应用不需要在应用内进行开关控制，所以只需要在module.json5配置文件中进行相应的配置即可。一般有以下几种情况：</p> <p><strong>默认仅为横屏</strong></p> <p>如果该应用默认为横屏状态，那么则需要在module.json5中的“orientation”字段进行配置为landscape。</p> <p><span><img originheight="271" originwidth="555" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163126.51878551011256333856895562116111:50001231000000:2800:F466A85A551C2BED7EFF7B452EF0D50BF76D054439D5E9D077B2C9BECFB7A5CE.png" width="555" height="271"></span></p> <p><strong>支持横屏和反向横屏</strong></p> <p>如果应用需要根据设备方向，决定是横屏还是反向横屏，则可以对module.json5配置中“orientation”设置为auto_rotation_landscape。</p> <p></p> <p><span><img height="167.1278" originheight="278" originwidth="1350" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163126.49137763287120483087874993803752:50001231000000:2800:AD5B639016D058A15D8619E692C7562ACCCD303EA9F94E6A9B8953DFF7EE2AA9.jpg" title="点击放大" width="798"></span></p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>如果需要跟随控制中心的旋转锁定，则可以选择配置为"auto_rotation_landscape_restricted"</p> </div></div></div> <p><strong>支持竖屏切换横屏</strong></p> <p>此类适用于一些游戏大厅等应用，由于游戏大厅内，主页可能为竖屏，部分应用为横屏。从竖屏进入横屏时，需要调用设置窗口旋转的方法进行控制。具体案例可以参考视频播放的横竖屏切换。</p> </div> <div class="tiledSection"><h2 id="section1236212577516">常见问题<i class="anchor-icon anchor-icon-link" anchorid="section1236212577516" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section181875085313" class="firsth2">window.getLastWindow的方式获取窗口出现延迟<i class="anchor-icon anchor-icon-link" anchorid="section181875085313" tips="复制节点链接"></i></h3><ol><li>由于getLastWindow底层原因，需要经过查找获取实例，一定程度上会有性能损耗，可能会出现已经发生横屏或者竖屏切换的情况下，状态栏还没切换的情况。</li><li>使用windowStage.getMainWindowSync的同步方法获取窗口实例。</li></ol> <div class="screenLinkPre"><div _ngcontent-bxu-c106="" class="highlight-div"><div _ngcontent-bxu-c106="" class="highlight-div-header"><div _ngcontent-bxu-c106="" class="highlight-div-header-left"><div _ngcontent-bxu-c106="" class="handle-button expand-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bxu-c106="" class="highlight-div-header-right"><div _ngcontent-bxu-c106="" class="handle-button ai-button"></div><div _ngcontent-bxu-c106="" class="handle-button line-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bxu-c106="" class="handle-button theme-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bxu-c106="" class="handle-button copy-button"><div _ngcontent-bxu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bxu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-ini" codehub="https://gitee.com/harmonyos_samples/ResponsiveLayout/blob/master/entry/src/main/ets/entryability/EntryAbility.ets#L40-L40" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">this.windowUtil</span> = new WindowUtil(windowStage.getMainWindowSync())<span class="hljs-comment">;</span></li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ResponsiveLayout/blob/master/entry/src/main/ets/entryability/EntryAbility.ets#L40-L40" target="_blank">EntryAbility.ets</a></div></div></div></div> </div> <div class="tiledSection"><h3 id="section1596131711718">竖屏时进入任务中心，进入横屏的应用，在onpageshow时获取的display信息不符合期望<i class="anchor-icon anchor-icon-link" anchorid="section1596131711718" tips="复制节点链接"></i></h3><p>目前display接口规则还不够清晰，建议使用window的getWindowProperties()接口处理。</p> </div> <div class="tiledSection"><h3 id="section1371316521580">如何获取屏幕的宽度、高度、分辨率和横竖屏等信息<i class="anchor-icon anchor-icon-link" anchorid="section1371316521580" tips="复制节点链接"></i></h3><p>引入屏幕属性模块，可以通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-display#displaygetdefaultdisplaysync9" target="_blank">display.getDefaultDisplaySync()</a>方法获取display对象后，从而获取到屏幕的宽度、高度、分辨率和横竖屏等信息。</p> </div> </div> <div></div></div>