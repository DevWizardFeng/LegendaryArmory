<h1 _ngcontent-tvm-c119="" class="doc-title ng-star-inserted" title="窗口沉浸式"> 窗口沉浸式 </h1>

<div _ngcontent-tvm-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section867972741814">概述<i class="anchor-icon anchor-icon-link" anchorid="section867972741814" tips="复制节点链接"></i></h2><p>沉浸式模式通常指让应用的界面更加专注于内容，不希望用户被无关元素干扰。其开发需针对不同设备的屏幕特征、交互方式和系统规范进行适配优化。沉浸式设计可参考<a href="https://developer.huawei.com/consumer/cn/doc/design-guides/practices-overview-0000001746498066#section1610419884617" target="_blank">沉浸体验</a>。</p> <p>本文将介绍沉浸式开发的实现原理，并分析在多设备场景下不同窗口形态（全屏、分屏、悬浮窗、自由窗）和窗口方向下的适配问题和解决方案。</p> <ul><li><a href="/consumer/cn/doc/best-practices/bpta-multi-device-window-immersive#section14198114410189">沉浸模式适配不同窗口模式</a></li><li><a href="/consumer/cn/doc/best-practices/bpta-multi-device-window-immersive#section19755816161920">沉浸模式适配不同窗口方向</a></li><li><a href="/consumer/cn/doc/best-practices/bpta-multi-device-window-immersive#section19488122113212">不同设备定制沉浸式策略</a></li><li><a href="/consumer/cn/doc/best-practices/bpta-multi-device-window-immersive#section78426417192">开发实践案例</a><div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>本篇文章主要从窗口沉浸式适配多设备角度展开，沉浸式的相关内容，开发者可参考如下内容：</p> <ul><li><a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-immersive" target="_blank">沉浸式页面开发实践</a></li><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-develop-apply-immersive-effects" target="_blank">开发应用沉浸式效果</a></li><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/multi-window-controlbar-adapt" target="_blank">顶部窗口控制条避让适配智慧多窗</a></li></ul> </div></div></div> </li></ul> </div> <div class="tiledSection"><h2 id="section112681736101818">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section112681736101818" tips="复制节点链接"></i></h2><p>典型应用全屏窗口UI元素包括<a href="https://developer.huawei.com/consumer/cn/doc/design-guides/status-bar-0000001776775568" target="_blank">状态栏</a>、应用界面和底部<a href="https://developer.huawei.com/consumer/cn/doc/design-guides/navigation-0000001957075737" target="_blank">导航条</a>，其中状态栏和导航条，通常在沉浸式布局下称为避让区；避让区之外的区域称为安全区。开发应用沉浸式效果主要指通过调整状态栏、应用界面和导航条的显示效果来减少状态栏、导航条等系统界面的突兀感，从而使用户获得最佳的UI体验。</p> <div class="fignone"><span class="figcap"><b>图1 </b>界面元素示意图</span><br><span><img height="390.6343" originheight="1179" originwidth="802" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163142.47121632663014983838334358682750:50001231000000:2800:E219FBA8432CE472916FA33C5B0DE1AF5626018FC59D9A070D05376BE1F01855.png" title="点击放大" width="266"></span></div> <p>开发应用沉浸式效果主要要考虑如下几个设计要素：</p> <ul><li>UI元素避让处理：导航条底部区域可以响应点击事件，除此之外的可交互UI元素和应用关键信息不建议放到导航条区域。状态栏显示系统信息，如果与界面元素有冲突，需要考虑避让状态栏。</li><li>沉浸式效果处理：将状态栏和导航条颜色与界面元素颜色相匹配，避免明显的突兀感。</li></ul> <p>针对上面的设计要求，可以通过如下两种方式实现应用沉浸式效果：</p> <ul><li>窗口全屏布局方案：调整布局系统为全屏布局，界面元素延伸到状态栏和导航条区域以实现沉浸式效果。当不隐藏避让区时，可通过接口查询状态栏和导航条区域，进行可交互元素避让处理，并设置状态栏或导航条的颜色等属性与界面元素匹配。当隐藏避让区时，通过对应接口设置全屏布局即可。</li><li>组件安全区方案：布局系统保持安全区内布局，然后通过接口延伸绘制内容（如背景色、背景图）到状态栏和导航条区域以实现沉浸式效果。<p>该方案下，界面元素仅做绘制延伸，无法单独布局到状态栏和导航条区域，针对需要单独布局UI元素到状态栏和导航条区域的场景建议使用窗口全屏布局方案处理。</p> </li></ul> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>沉浸式适配内容，可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-develop-apply-immersive-effects" target="_blank">开发应用沉浸式效果</a>与<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-immersive" target="_blank">沉浸式页面开发实践</a>。</p> </div></div></div> </div> <div class="tiledSection"><h2 id="section14198114410189">支持不同窗口模式<i class="anchor-icon anchor-icon-link" anchorid="section14198114410189" tips="复制节点链接"></i></h2><p>多设备场景下，应用需要支持不同窗口模式及其沉浸式体验。常见的窗口模式包括FULL_SCREEN（全屏模式）、FLOATING（自由悬浮窗模式）与SPLIT_SCREEN（分屏模式）。</p> <p>本章节将详细讲解两种沉浸式适配实现方案：<a href="/consumer/cn/doc/best-practices/bpta-multi-device-window-immersive#section1477255312219">窗口全屏布局方案</a>与<a href="/consumer/cn/doc/best-practices/bpta-multi-device-window-immersive#section168201953194710">组件安全区方案</a>。通过系统介绍不同窗口模式下的适配方法，帮助开发者掌握沉浸式界面开发的完整技术方案。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>窗口模式相关内容，可参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-multi-device-window-mode">窗口模式</a>。</p> </div></div></div> </div> <div class="tiledSection"><h3 id="section1477255312219" class="firsth2">窗口全屏布局方案<i class="anchor-icon anchor-icon-link" anchorid="section1477255312219" tips="复制节点链接"></i></h3><p>窗口全屏布局方案主要涉及两种应用场景：应用扩展布局但不隐藏避让区，以及应用扩展布局并隐藏避让区。本章节将深入解析这两种场景下的不同窗口模式沉浸式适配实现方案。</p> <ol><li><strong>应用扩展布局，不隐藏避让区</strong><ul><li>全屏模式<p>可以通过调用窗口强制全屏布局接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setwindowlayoutfullscreen9" target="_blank">setWindowLayoutFullScreen()</a>实现界面元素延伸到状态栏和导航区域；然后通过接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#getwindowavoidarea9" target="_blank">getWindowAvoidArea()</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#onavoidareachange9" target="_blank">on('avoidAreaChange')</a>获取并动态监听避让区域的变更信息，页面布局根据避让区域信息进行动态调整；设置状态栏与导航区域的颜色或显隐等属性与界面元素进行匹配。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>应用<strong>扩</strong>展布局，不隐藏避让区场景下全屏模式的沉浸式适配，可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-develop-apply-immersive-effects#section171801550301" target="_blank">应用扩展布局，全屏显示，不隐藏避让区</a>。</p> </div></div></div> </li><li>分屏模式/悬浮窗模式<p>分屏模式与悬浮窗的沉浸式适配，主要需要考虑顶部窗口控制条的避让。顶部窗口控制条是应用窗口处于智慧多窗模式下，应用顶部的操作横条 。</p> <p>顶部窗口控制条示意图如下所示：</p> <p><span><img height="475.7568852459016" originheight="3351" originwidth="6480" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163142.69448844585145005844846483163667:50001231000000:2800:CB5EE0918B76E37B32CC76D4E499FAD4BC7F8510299B756911ADE97A3B9770A4.png" title="点击放大" width="920"></span></p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>分屏模式与悬浮窗的控制条避让，开发者可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/multi-window-controlbar-adapt" target="_blank">顶部窗口控制条避让适配智慧多窗</a>。</p> </div></div></div> </li><li>自由窗口模式<p>在PC/2in1设备上，默认情况下，自由窗口包含支持移动、缩小、放大和关闭的标题栏。开发者可以设置应用窗口的标题栏不可见，将应用页面扩展至原标题栏区域，实现窗口沉浸式效果。</p> <p>效果图如下：</p> <p><span><img height="452.5325" originheight="1576" originwidth="2316" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163142.83407361371387312418140072667608:50001231000000:2800:D813E52ADE63E1D72BE4FD7031D890A9135C264B4A40723B78FC8EFF26BFE003.png" title="点击放大" width="665"></span></p> <p><strong>实现原理</strong></p> <p>PC/2in1 设备的窗口标题栏包含应用图标、应用名称和三个按钮（全屏/还原、最小化、关闭）。通过设置标题栏不可见，隐藏应用图标和应用名称，保留三键区，实现窗口的沉浸式效果。</p> <p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setwindowdecorvisible11" target="_blank">setWindowDecorVisible(false)</a>设置隐藏标题栏，只显示右上角三键，此时应用页面拓展至标题栏区域。使用setDecorButtonStyle()接口设置右上角按钮颜色、大小、间距、圆角半径等样式。使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setwindowdecorheight11" target="_blank">setWindowDecorHeight()</a>接口设置标题栏高度，控制右上角三键区显示以及显示高度。使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#getwindowdecorheight11" target="_blank">getWindowDecorHeight()</a>获取自由窗口的标题栏高度、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#gettitlebuttonrect11" target="_blank">getTitleButtonRect()</a>获取窗口标题栏上的三键区位置和大小，用于不同场景下的页面布局避让。使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setwindowtitlebuttonvisible14" target="_blank">setWindowTitleButtonVisible()</a>控制最大化、最小化按键和分屏菜单是否可见。使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#onwindowtitlebuttonrectchange11" target="_blank">on('windowTitleButtonRectChange')</a>注册右上角三键大小变化监听。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>推荐通过on('windowTitleButtonRectChange')来监听三键区变化，不要在例如on('windowRectChange')等布局相关的回调函数中调用getTitleButtonRect()查询三键避让区位置与大小，可能因为系统内部时序问题返回非预期值。</p> </div></div></div> <p><strong>示例代码</strong></p> <p>通过调用setWindowDecorVisible(false)接口设置标题栏的隐藏。</p> <div class="screenLinkPre"><div _ngcontent-tvm-c106="" class="highlight-div"><div _ngcontent-tvm-c106="" class="highlight-div-header"><div _ngcontent-tvm-c106="" class="highlight-div-header-left"><div _ngcontent-tvm-c106="" class="handle-button expand-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tvm-c106="" class="highlight-div-header-right"><div _ngcontent-tvm-c106="" class="handle-button ai-button"></div><div _ngcontent-tvm-c106="" class="handle-button line-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tvm-c106="" class="handle-button theme-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tvm-c106="" class="handle-button copy-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tvm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/ResponsiveLayout/blob/master/entry/src/main/ets/utils/WindowUtil.ets#L112-L112" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">this</span>.mainWindow.setWindowDecorVisible(<span class="hljs-literal">false</span>);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ResponsiveLayout/blob/master/entry/src/main/ets/utils/WindowUtil.ets#L112-L112" target="_blank">WindowUtil.ets</a></div></div></div></div> </li></ul> </li><li><strong>应用扩展布局，隐藏避让区</strong><ul><li>全屏模式<p>在游戏、电影等应用场景中，需要设置状态栏和导航条区域隐藏。调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setspecificsystembarenabled11" target="_blank">setSpecificSystemBarEnabled()</a>接口，设置状态栏和导航区域的具体显隐状态，此场景下将其设置为隐藏。用户可以通过从底部上滑唤出导航条或三键导航。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>应用<strong>扩</strong>展布局，隐藏避让区场景下全屏模式的沉浸式适配，可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-develop-apply-immersive-effects#section202484117114" target="_blank">应用扩展布局，全屏显示，隐藏避让区</a>。</p> </div></div></div> </li><li>分屏模式/悬浮窗模式<p>分屏模式与悬浮窗的沉浸式适配，主要需要考虑顶部窗口控制条。当前不支持对控制条的隐藏，因此推荐开发者使用避让控制条方案。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>分屏模式与悬浮窗的控制条避让，开发者可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/multi-window-controlbar-adapt" target="_blank">顶部窗口控制条避让适配智慧多窗</a>。</p> </div></div></div> </li><li>自由窗口模式<p>在视频类应用适配PC/2in1设备时，实现视频播放页在自由窗口与全屏模式间的切换功能。</p> <div class="fignone"><span class="figcap"><b>图2 </b>PC全屏沉浸式示意图</span><br><span><img height="299.25" originheight="1756" originwidth="3070" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163142.96581722243966719206144855911730:50001231000000:2800:80FFF2B78CDFF925A2FDAB99BB1B8BC60877C59FD052CC6BBB74C767448231FF.png" title="点击放大" width="523.6875"></span></div> <p><strong>实现原理</strong></p> <p>通过调用窗口状态操作接口，实现应用在全屏沉浸式和自由窗口模式之间的切换。以长视频应用为例，视频播放界面在PC/2in1设备上需要支持沉浸式体验，适配指导如下：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.4.3.2.2.3.5.1.4.1.1" valign="top" width="33.33333333333333%"><p>状态</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.3.2.2.3.5.1.4.1.2" valign="top" width="33.31333133313331%"><p>用户操作</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.3.2.2.3.5.1.4.1.3" valign="top" width="33.35333533353336%"><p>使用接口</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>应用窗口化播放视频</p> </td> <td class="cellrowborder" valign="top" width="33.31333133313331%"><p>执行以下操作后，应进入沉浸式视频全屏播放：</p> <ul><li>鼠标双击视频区域</li><li>用户点击视频全屏按钮</li></ul> </td> <td class="cellrowborder" valign="top" width="33.35333533353336%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#maximize12" target="_blank">maximize()</a>：设置窗口最大化时的布局效果，接口默认传入参数为ENTER_IMMERSIVE实现最大化时进入沉浸式布局效果。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>沉浸式全屏播放视频</p> </td> <td class="cellrowborder" valign="top" width="33.31333133313331%"><p>执行以下操作后，应退出全屏沉浸式回到窗口状态：</p> <ul><li>按下ESC键</li><li>点击退出全屏按钮</li></ul> </td> <td class="cellrowborder" valign="top" width="33.35333533353336%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#recover11" target="_blank">recover()</a>：还原为浮动窗口，恢复为进入全屏前的大小和位置。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>开发步骤</strong></p> <p>1. 双击视频区域以及点击视频全屏按钮，分别采用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-gestures-tapgesture" target="_blank">TapGesture()</a>双击事件以及<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-click#onclick12" target="_blank">onClick()</a>点击事件实现。事件触发后，获取当前窗口模式。若窗口模式为自由窗口，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#maximize12" target="_blank">maximize()</a>接口最大化窗口，进入沉浸式全屏。</p> <div class="screenLinkPre"><div _ngcontent-tvm-c106="" class="highlight-div"><div _ngcontent-tvm-c106="" class="highlight-div-header"><div _ngcontent-tvm-c106="" class="highlight-div-header-left"><div _ngcontent-tvm-c106="" class="handle-button expand-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tvm-c106="" class="highlight-div-header-right"><div _ngcontent-tvm-c106="" class="handle-button ai-button"></div><div _ngcontent-tvm-c106="" class="handle-button line-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tvm-c106="" class="handle-button theme-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tvm-c106="" class="handle-button copy-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tvm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/bptaMultiWindow/entry/src/main/ets/components/WindowUtil.ets#L21-L57" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WindowUtil</span> {</li><li>  <span class="hljs-keyword">private</span> mainWindowClass?: <span class="hljs-variable language_">window</span>.<span class="hljs-property">Window</span>;</li><li>  <span class="hljs-title function_">maximize</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">mainWindowClass</span>!.<span class="hljs-title function_">getWindowStatus</span>() === <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStatusType</span>.<span class="hljs-property">FLOATING</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">mainWindowClass</span>!.<span class="hljs-title function_">maximize</span>()</li><li>        .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">`Succeed in maximizing the window.`</span>);</li><li>        })</li><li>        .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>          hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to maximize the window. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>,</li><li>            <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err) ?? <span class="hljs-string">''</span>);</li><li>        });</li><li>    }</li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/bptaMultiWindow/entry/src/main/ets/components/WindowUtil.ets#L21-L57" target="_blank">WindowUtil.ets</a></div></div></div></div> <p>2. 按下ESC按键以及点击退出全屏按钮，分别采用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-key" target="_blank">onKeyEvent()</a>按键事件以及onClick()点击事件实现。事件触发后，获取当前窗口模式。若窗口模式为全屏模式，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#recover11" target="_blank">recover()</a>恢复为进入全屏前的浮动窗口。</p> <div class="screenLinkPre"><div _ngcontent-tvm-c106="" class="highlight-div"><div _ngcontent-tvm-c106="" class="highlight-div-header"><div _ngcontent-tvm-c106="" class="highlight-div-header-left"><div _ngcontent-tvm-c106="" class="handle-button expand-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tvm-c106="" class="highlight-div-header-right"><div _ngcontent-tvm-c106="" class="handle-button ai-button"></div><div _ngcontent-tvm-c106="" class="handle-button line-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tvm-c106="" class="handle-button theme-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tvm-c106="" class="handle-button copy-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tvm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/bptaMultiWindow/entry/src/main/ets/components/WindowUtil.ets#L22-L58" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WindowUtil</span> {</li><li>  <span class="hljs-keyword">private</span> mainWindowClass?: <span class="hljs-variable language_">window</span>.<span class="hljs-property">Window</span>;</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">recover</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">mainWindowClass</span>!.<span class="hljs-title function_">getWindowStatus</span>() === <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStatusType</span>.<span class="hljs-property">FULL_SCREEN</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">mainWindowClass</span>!.<span class="hljs-title function_">recover</span>()</li><li>        .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">`Succeed in recovering the window.`</span>);</li><li>        })</li><li>        .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>          hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to recover the window. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>,</li><li>            <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err) ?? <span class="hljs-string">''</span>);</li><li>        });</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/bptaMultiWindow/entry/src/main/ets/components/WindowUtil.ets#L22-L58" target="_blank">WindowUtil.ets</a></div></div></div></div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>需要注意的是，调用maximize()接口后，应用窗口模式为FULL_SCREEN全屏，并非MAXIMIZE窗口最大化模式。</p> </div></div></div> </li></ul> </li></ol> </div> <div class="tiledSection"><h3 id="section168201953194710">组件安全区方案<i class="anchor-icon anchor-icon-link" anchorid="section168201953194710" tips="复制节点链接"></i></h3><p>组件安全区方案主要涉及应用扩展布局，不隐藏避让区和应用扩展布局，隐藏避让区两个应用场景，本章节将深入解析这两种场景下的不同窗口模式沉浸式适配实现方案。</p> <ol><li><strong>应用扩展布局，不隐藏避让区</strong><ul><li>全屏模式<p>通过设置组件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-expand-safe-area#expandsafearea" target="_blank">expandSafeArea</a>属性，让内容覆盖系统栏区域。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>使用expandSafeArea属性拓展安全区域实现沉浸式，可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-develop-apply-immersive-effects#section202081847174413" target="_blank">组件安全区方案</a>。</p> </div></div></div> </li><li>分屏模式/悬浮窗模式<p>分屏模式与悬浮窗的沉浸式适配，由于应用布局不避让状态栏、导航栏以及智慧多窗顶部横条，这可能发生组件与顶部横条的重叠，导致文字遮挡、点击事件冲突等情况。因此，需要考虑顶部窗口控制条的避让。顶部窗口控制条是应用窗口处于智慧多窗模式下，应用顶部的操作横条 。</p> <p></p> <p>顶部窗口控制条示意图如下所示：</p> <p><span><img height="475.7568852459016" originheight="3351" originwidth="6480" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163143.56946050527519641321606660050179:50001231000000:2800:A6A082615C2C4FCBDCBB7E2DE37BF210250AAF382C95F81E6EFC361079F12B70.png" title="点击放大" width="920"></span></p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>分屏模式与悬浮窗的控制条避让，开发者可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/multi-window-controlbar-adapt" target="_blank">顶部窗口控制条避让适配智慧多窗</a>。</p> </div></div></div> </li><li>自由窗口模式<p>在PC/2in1设备上，默认情况下，自由窗口包含支持移动、缩小、放大和关闭的标题栏。由于无法使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-expand-safe-area#expandsafearea" target="_blank">expandSafeArea</a>属性拓展标题栏，因此标题栏沉浸建议开发者设置应用窗口的标题栏不可见，将应用页面扩展至原标题栏区域，实现窗口沉浸式效果。</p> <p>效果图如下：</p> <p><span><img height="452.5325" originheight="1576" originwidth="2316" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163143.51550927324158434225697260305564:50001231000000:2800:9D04184BDE5F272528A6C59C54C42EC45C1B1DBA2C96C3CE5C77BB548C971A85.png" title="点击放大" width="665"></span></p> <p><strong>实现原理</strong></p> <p>PC/2in1 设备的窗口标题栏包含应用图标、应用名称和三个按钮（全屏/还原、最小化、关闭）。通过设置标题栏不可见，隐藏应用图标和应用名称，保留三键区，实现窗口的沉浸式效果。</p> <p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setwindowdecorvisible11" target="_blank">setWindowDecorVisible(false)</a>设置隐藏标题栏，只显示右上角三键，此时应用页面拓展至标题栏区域。使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setwindowdecorheight11" target="_blank">setWindowDecorHeight()</a>接口设置标题栏高度，控制右上角三键区显示以及显示高度。使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#getwindowdecorheight11" target="_blank">getWindowDecorHeight()</a>获取三键避让区域。使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setwindowtitlebuttonvisible14" target="_blank">setWindowTitleButtonVisible()</a>控制最大化、最小化按键和分屏菜单。使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#onwindowtitlebuttonrectchange11" target="_blank">on('windowTitleButtonRectChange')</a>注册右上角三键大小变化监听。</p> <p><strong>示例代码</strong></p> <p>通过调用setWindowDecorVisible(false)接口设置标题栏的隐藏。</p> <div class="screenLinkPre"><div _ngcontent-tvm-c106="" class="highlight-div"><div _ngcontent-tvm-c106="" class="highlight-div-header"><div _ngcontent-tvm-c106="" class="highlight-div-header-left"><div _ngcontent-tvm-c106="" class="handle-button expand-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tvm-c106="" class="highlight-div-header-right"><div _ngcontent-tvm-c106="" class="handle-button ai-button"></div><div _ngcontent-tvm-c106="" class="handle-button line-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tvm-c106="" class="handle-button theme-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tvm-c106="" class="handle-button copy-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tvm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/ResponsiveLayout/blob/master/entry/src/main/ets/utils/WindowUtil.ets#L112-L112" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">this</span>.mainWindow.setWindowDecorVisible(<span class="hljs-literal">false</span>);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ResponsiveLayout/blob/master/entry/src/main/ets/utils/WindowUtil.ets#L112-L112" target="_blank">WindowUtil.ets</a></div></div></div></div> </li></ul> </li><li><strong>应用扩展布局，隐藏避让区</strong><p>本章节的实现方式与窗口全屏布局方案一致，在此不做赘述，具体不同窗口模式隐藏避让区实现方案可参考<a href="/consumer/cn/doc/best-practices/bpta-multi-device-window-immersive#section1477255312219">窗口全屏布局方案</a>的对应章节。</p> </li></ol> </div> <div class="tiledSection"><h2 id="section19755816161920">支持不同窗口方向<i class="anchor-icon anchor-icon-link" anchorid="section19755816161920" tips="复制节点链接"></i></h2><p>多设备场景下，应用需要支持设备旋转，需要适配不同窗口方向的沉浸式开发。设备旋转会导致挖孔位置和状态栏位置发生变化，因此需要在实现沉浸式后做特定的处理。</p> <p>本章节将通过安全区避让与挖孔区避让两个章节展开讲解，帮助开发者掌握由于屏幕旋转带来的沉浸式适配问题。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>关于挖孔区避让的UX设计，可参考<a href="https://developer.huawei.com/consumer/cn/doc/design-guides/practices-overview-0000001746498066#section798514152314" target="_blank">横竖屏&amp;挖孔适配</a>。</p> </div></div></div> </div> <div class="tiledSection"><h3 id="section1343512124615" class="firsth2">安全区避让<i class="anchor-icon anchor-icon-link" anchorid="section1343512124615" tips="复制节点链接"></i></h3><p>窗口方向的改变会导致安全区域的变化，因此需要在屏幕旋转之后，获取避让区高度等信息的变化，并修改内容区的padding。</p> <p>根据不同的沉浸式实现方案，需要使用相应的适配策略。以下是针对窗口全屏布局方案和组件安全区方案两种典型方案的特殊适配要求：</p> <ul><li>窗口全屏布局方案<p>窗口全屏布局方案实现沉浸式是指通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setwindowlayoutfullscreen9" target="_blank">setWindowLayoutFullScreen()</a>实现全屏沉浸式。安全区域会随屏幕旋转而改变，需要使用on('avoidAreaChange')动态监听系统状态栏与导航条变化，在监听回调中获取其规避区域信息，并根据规避区域信息动态刷新UI，保证在避让区变化后能够正确避让系统规避区。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>具体的动态监听避让区变化实现步骤，可参考<a href="/consumer/cn/doc/best-practices/bpta-multi-device-window-immersive#section84879211727">动态监听避让区变化</a>。</p> </div></div></div> </li><li>组件安全区方案<p>组件安全区方案实现沉浸式是指通过设置组件的expandSafeArea属性，拓展组件的安全区域。</p> <p>可以通过为根容器组件设置拓展系统避让区以实现全屏效果；子组件通过设置不拓展系统避让区，以实现子组件自动避让系统避让区。</p> <div class="screenLinkPre"><div _ngcontent-tvm-c106="" class="highlight-div"><div _ngcontent-tvm-c106="" class="highlight-div-header"><div _ngcontent-tvm-c106="" class="highlight-div-header-left"><div _ngcontent-tvm-c106="" class="handle-button expand-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tvm-c106="" class="highlight-div-header-right"><div _ngcontent-tvm-c106="" class="handle-button ai-button"></div><div _ngcontent-tvm-c106="" class="handle-button line-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tvm-c106="" class="handle-button theme-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tvm-c106="" class="handle-button copy-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tvm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ExpandSafeArea/entry/src/main/ets/pages/Index.ets#L17-L40" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">@Entry</span></li><li><span class="hljs-variable">@Component</span></li><li>struct ExpandSafeAreaIndex {</li><li>  <span class="hljs-selector-tag">build</span>() {</li><li>    <span class="hljs-selector-tag">Column</span>(){</li><li>      <span class="hljs-comment">// Sub-component representing the content area</span></li><li>      <span class="hljs-comment">// designed to achieve automatic content avoidance around the notch area.</span></li><li>      <span class="hljs-selector-tag">Column</span>(){</li><li>
</li><li>      }</li><li>      .<span class="hljs-built_in">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-built_in">height</span>(<span class="hljs-number">50</span>)</li><li>      <span class="hljs-comment">// Passing an empty array indicates that the sub-component will not extend any safe area.</span></li><li>      <span class="hljs-comment">// thereby achieving automatic avoidance of the punch-hole/notch area.</span></li><li>      .<span class="hljs-built_in">expandSafeArea</span>([])</li><li>      .<span class="hljs-built_in">backgroundColor</span>(<span class="hljs-attribute">Color</span>.Blue)</li><li>    }</li><li>    <span class="hljs-selector-class">.width</span>(<span class="hljs-string">'100%'</span>)</li><li>    <span class="hljs-selector-class">.height</span>(<span class="hljs-string">'100%'</span>)</li><li>    <span class="hljs-comment">// By default, the root container expands to accommodate system bars, punch-hole area, and keyboard.</span></li><li>    <span class="hljs-selector-class">.expandSafeArea</span>()</li><li>    <span class="hljs-selector-class">.backgroundColor</span>(Color.Red)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ExpandSafeArea/entry/src/main/ets/pages/Index.ets#L17-L40" target="_blank">Index.ets</a></div></div></div></div> </li></ul> </div> <div class="tiledSection"><h3 id="section1036418189466">挖孔避让<i class="anchor-icon anchor-icon-link" anchorid="section1036418189466" tips="复制节点链接"></i></h3><p>手机和折叠屏折叠态的应用通常需要适配竖屏布局。仅部分特殊场景例如横屏游戏、长视频需要适配横屏布局。</p> <p>折叠屏展开态、平板上，应用需要同时适配横屏和竖屏布局。</p> <p>当设备尺寸比例接近 1:1 时，建议横竖屏使用相同或相近的布局；</p> <p>当设备尺寸比例差异大时，横竖屏可以使用不同的布局，从而提供更好的使用体验。例如，横屏后自动分栏或横屏后自动露出右侧的辅助信息等。</p> <p>横竖屏适配过程中，需要考虑核心内容与重要交互不要被挖孔区遮挡，如果被遮挡，则需进行局部内容避让；可滚动内容或非核心信息无需专门避让挖孔区；要避免因为避让挖孔导致左右侧留白不一致。</p> <div class="fignone"><span class="figcap"><b>图3 </b>横竖屏适配示意图</span><br><span><img height="187.53" originheight="1588" originwidth="4420" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163143.05215489093847159243018619009951:50001231000000:2800:2D5AAD40E34E023DAD372E37EDBB1DE04D203D0A0A549C0183E37669F0DADA67.png" title="点击放大" width="523.6875"></span></div> <p>以下是针对窗口全屏布局方案和组件安全区方案两种典型方案的特殊适配要求：</p> <ul><li>窗口全屏布局方案<p>窗口全屏布局方案实现沉浸式是指通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setwindowlayoutfullscreen9" target="_blank">setWindowLayoutFullScreen()</a>实现全屏沉浸式。</p> <p>挖孔区域会随屏幕旋转而改变，需要使用on('avoidAreaChange')动态监听挖孔区域变化，在监听回调中获取其挖孔区域信息，并根据挖孔区域信息动态刷新UI，保证在避让区变化后能够正确避让挖孔区。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>使用on('avoidAreaChange')动态监听避让区变化时，可以通过AvoidAreaType.TYPE_CUTOUT来获取挖孔区域信息，从而实现动态避让挖孔区域。</p> <p>具体的动态监听避让区变化实现步骤，可参考<a href="/consumer/cn/doc/best-practices/bpta-multi-device-window-immersive#section84879211727">动态监听避让区变化</a>。</p> </div></div></div> </li><li>组件安全区方案<p>组件安全区方案实现沉浸式是指通过设置组件的expandSafeArea属性，让内容覆盖系统栏区域，可以通过如下步骤，实现动态避让挖孔区。</p> <p>该实现方式需要在module.json5中进行如下设置，将摄像头挖孔区域设为非安全区。</p> <div class="p">在module.json5文件中声明metadata，配置避让挖孔区。<div class="screenLinkPre"><div _ngcontent-tvm-c106="" class="highlight-div"><div _ngcontent-tvm-c106="" class="highlight-div-header"><div _ngcontent-tvm-c106="" class="highlight-div-header-left"><div _ngcontent-tvm-c106="" class="handle-button expand-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tvm-c106="" class="highlight-div-header-right"><div _ngcontent-tvm-c106="" class="handle-button ai-button"></div><div _ngcontent-tvm-c106="" class="handle-button line-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tvm-c106="" class="handle-button theme-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tvm-c106="" class="handle-button copy-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tvm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ExpandSafeArea/entry/src/main/module.json5#L51-L57" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// module.json5</span></li><li><span class="hljs-string">"metadata"</span>: [</li><li>  {</li><li>    <span class="hljs-string">"name"</span>: <span class="hljs-string">"avoid_cutout"</span>,</li><li>    <span class="hljs-string">"value"</span>: <span class="hljs-string">"true"</span>,</li><li>  }</li><li>],</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ExpandSafeArea/entry/src/main/module.json5#L51-L57" target="_blank">module.json5</a></div></div></div></div> </div> <p>在页面根容器使用expandSafeArea属性，配置拓展安全区域SafeAreaType.CUTOUT，子组件不拓展挖孔区，即可在屏幕旋转时子组件自动避让挖孔区。</p> <div class="screenLinkPre"><div _ngcontent-tvm-c106="" class="highlight-div"><div _ngcontent-tvm-c106="" class="highlight-div-header"><div _ngcontent-tvm-c106="" class="highlight-div-header-left"><div _ngcontent-tvm-c106="" class="handle-button expand-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tvm-c106="" class="highlight-div-header-right"><div _ngcontent-tvm-c106="" class="handle-button ai-button"></div><div _ngcontent-tvm-c106="" class="handle-button line-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tvm-c106="" class="handle-button theme-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tvm-c106="" class="handle-button copy-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tvm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ExpandSafeArea/entry/src/main/ets/pages/Index.ets#L17-L40" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">@Entry</span></li><li><span class="hljs-variable">@Component</span></li><li>struct ExpandSafeAreaIndex {</li><li>  <span class="hljs-selector-tag">build</span>() {</li><li>    <span class="hljs-selector-tag">Column</span>(){</li><li>      <span class="hljs-comment">// Sub-component representing the content area</span></li><li>      <span class="hljs-comment">// designed to achieve automatic content avoidance around the notch area.</span></li><li>      <span class="hljs-selector-tag">Column</span>(){</li><li>
</li><li>      }</li><li>      .<span class="hljs-built_in">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-built_in">height</span>(<span class="hljs-number">50</span>)</li><li>      <span class="hljs-comment">// Passing an empty array indicates that the sub-component will not extend any safe area.</span></li><li>      <span class="hljs-comment">// thereby achieving automatic avoidance of the punch-hole/notch area.</span></li><li>      .<span class="hljs-built_in">expandSafeArea</span>([])</li><li>      .<span class="hljs-built_in">backgroundColor</span>(<span class="hljs-attribute">Color</span>.Blue)</li><li>    }</li><li>    <span class="hljs-selector-class">.width</span>(<span class="hljs-string">'100%'</span>)</li><li>    <span class="hljs-selector-class">.height</span>(<span class="hljs-string">'100%'</span>)</li><li>    <span class="hljs-comment">// By default, the root container expands to accommodate system bars, punch-hole area, and keyboard.</span></li><li>    <span class="hljs-selector-class">.expandSafeArea</span>()</li><li>    <span class="hljs-selector-class">.backgroundColor</span>(Color.Red)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ExpandSafeArea/entry/src/main/ets/pages/Index.ets#L17-L40" target="_blank">Index.ets</a></div></div></div></div> </li></ul> </div> <div class="tiledSection"><h3 id="section84879211727">动态监听避让区变化<i class="anchor-icon anchor-icon-link" anchorid="section84879211727" tips="复制节点链接"></i></h3><p>在以下场景中，系统避让区的尺寸可能发生变化：</p> <ul><li>窗口模式切换（全屏/悬浮窗/分屏等）</li><li>设备旋转</li><li>折叠屏状态切换（展开/折叠）</li><li>多设备窗口流转</li></ul> <p>由于不同窗口模式及设备形态下，系统避让区（如状态栏、导航栏、控制条等）的位置和尺寸可能不同，因此建议通过系统API实时获取避让区数据，并监听其变化事件，确保UI布局及时适配调整。</p> <p>以示例代码提供的工具类为例，动态监听避让区变化的开发步骤如下：</p> <ol><li><span>使用工具类方法首次获取避让区信息，将获取到的避让区信息数据保存至封装好的窗口信息类WindowInfo对象中，并使用AppStorage保存工具类对象以便后续使用其中的WindowInfo信息刷新页面布局。</span><p></p><div class="screenLinkPre"><div _ngcontent-tvm-c106="" class="highlight-div"><div _ngcontent-tvm-c106="" class="highlight-div-header"><div _ngcontent-tvm-c106="" class="highlight-div-header-left"><div _ngcontent-tvm-c106="" class="handle-button expand-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tvm-c106="" class="highlight-div-header-right"><div _ngcontent-tvm-c106="" class="handle-button ai-button"></div><div _ngcontent-tvm-c106="" class="handle-button line-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tvm-c106="" class="handle-button theme-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tvm-c106="" class="handle-button copy-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tvm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/ResponsiveLayout/blob/master/entry/src/main/ets/utils/WindowUtil.ets#L168-L221" data-highlighted="yes"><ol class="linenums"><li>updateWindowInfo(): void {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-comment">// First time get avoid area infos.</span></li><li>  <span class="hljs-keyword">this</span>.mainWindowInfo.AvoidSystem = <span class="hljs-keyword">this</span>.mainWindow.getWindowAvoidArea(window.AvoidAreaType.TYPE_SYSTEM);</li><li>  <span class="hljs-keyword">this</span>.mainWindowInfo.AvoidNavigationIndicator =</li><li>    <span class="hljs-keyword">this</span>.mainWindow.getWindowAvoidArea(window.AvoidAreaType.TYPE_NAVIGATION_INDICATOR);</li><li>  <span class="hljs-keyword">this</span>.mainWindowInfo.AvoidCutout = <span class="hljs-keyword">this</span>.mainWindow.getWindowAvoidArea(window.AvoidAreaType.TYPE_CUTOUT);</li><li>  <span class="hljs-keyword">this</span>.mainWindowInfo.AvoidSystemGesture =</li><li>    <span class="hljs-keyword">this</span>.mainWindow.getWindowAvoidArea(window.AvoidAreaType.TYPE_SYSTEM_GESTURE);</li><li>  <span class="hljs-keyword">this</span>.mainWindowInfo.AvoidKeyboard = <span class="hljs-keyword">this</span>.mainWindow.getWindowAvoidArea(window.AvoidAreaType.TYPE_KEYBOARD);</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ResponsiveLayout/blob/master/entry/src/main/ets/utils/WindowUtil.ets#L168-L221" target="_blank">WindowUtil.ets</a></div></div></div></div> <p></p></li><li><span>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#onavoidareachange9" target="_blank">avoidAreaChange</a>事件监听避让区域的变化，在监听回调中刷新避让区信息。</span><p></p><div class="screenLinkPre"><div _ngcontent-tvm-c106="" class="highlight-div"><div _ngcontent-tvm-c106="" class="highlight-div-header"><div _ngcontent-tvm-c106="" class="highlight-div-header-left"><div _ngcontent-tvm-c106="" class="handle-button expand-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tvm-c106="" class="highlight-div-header-right"><div _ngcontent-tvm-c106="" class="handle-button ai-button"></div><div _ngcontent-tvm-c106="" class="handle-button line-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tvm-c106="" class="handle-button theme-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tvm-c106="" class="handle-button copy-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tvm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/ResponsiveLayout/blob/master/entry/src/main/ets/utils/WindowUtil.ets#L47-L217" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">public</span> <span class="hljs-attr">onAvoidAreaChange</span>: <span class="hljs-function">(<span class="hljs-params">avoidOptions: <span class="hljs-variable language_">window</span>.AvoidAreaOptions</span>) =&gt;</span> <span class="hljs-built_in">void</span> =</li><li>  <span class="hljs-function">(<span class="hljs-params">avoidOptions: <span class="hljs-variable language_">window</span>.AvoidAreaOptions</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (avoidOptions.<span class="hljs-property">type</span> === <span class="hljs-variable language_">window</span>.<span class="hljs-property">AvoidAreaType</span>.<span class="hljs-property">TYPE_SYSTEM</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">mainWindowInfo</span>.<span class="hljs-property">AvoidSystem</span> = avoidOptions.<span class="hljs-property">area</span>;</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (avoidOptions.<span class="hljs-property">type</span> === <span class="hljs-variable language_">window</span>.<span class="hljs-property">AvoidAreaType</span>.<span class="hljs-property">TYPE_CUTOUT</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">mainWindowInfo</span>.<span class="hljs-property">AvoidCutout</span> = avoidOptions.<span class="hljs-property">area</span>;</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (avoidOptions.<span class="hljs-property">type</span> === <span class="hljs-variable language_">window</span>.<span class="hljs-property">AvoidAreaType</span>.<span class="hljs-property">TYPE_SYSTEM_GESTURE</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">mainWindowInfo</span>.<span class="hljs-property">AvoidSystemGesture</span> = avoidOptions.<span class="hljs-property">area</span>;</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (avoidOptions.<span class="hljs-property">type</span> === <span class="hljs-variable language_">window</span>.<span class="hljs-property">AvoidAreaType</span>.<span class="hljs-property">TYPE_KEYBOARD</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">mainWindowInfo</span>.<span class="hljs-property">AvoidKeyboard</span> = avoidOptions.<span class="hljs-property">area</span>;</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (avoidOptions.<span class="hljs-property">type</span> === <span class="hljs-variable language_">window</span>.<span class="hljs-property">AvoidAreaType</span>.<span class="hljs-property">TYPE_NAVIGATION_INDICATOR</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">mainWindowInfo</span>.<span class="hljs-property">AvoidNavigationIndicator</span> = avoidOptions.<span class="hljs-property">area</span>;</li><li>    }</li><li>  };</li><li><span class="hljs-comment">// ...</span></li><li><span class="hljs-title function_">updateWindowInfo</span>(): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">mainWindow</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'avoidAreaChange'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onAvoidAreaChange</span>);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ResponsiveLayout/blob/master/entry/src/main/ets/utils/WindowUtil.ets#L47-L217" target="_blank">WindowUtil.ets</a></div></div></div></div> <p></p></li><li><span>根据AppStorage存储的工具类中的窗口信息WindowInfo，刷新页面布局。</span><p></p><div class="screenLinkPre"><div _ngcontent-tvm-c106="" class="highlight-div"><div _ngcontent-tvm-c106="" class="highlight-div-header"><div _ngcontent-tvm-c106="" class="highlight-div-header-left"><div _ngcontent-tvm-c106="" class="handle-button expand-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tvm-c106="" class="highlight-div-header-right"><div _ngcontent-tvm-c106="" class="handle-button ai-button"></div><div _ngcontent-tvm-c106="" class="handle-button line-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tvm-c106="" class="handle-button theme-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tvm-c106="" class="handle-button copy-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tvm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/ResponsiveLayout/blob/master/entry/src/main/ets/pages/Index.ets#L33-L55" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">Column</span>() {</li><li>  <span class="hljs-built_in">Column</span>() {</li><li>    Text($r('app.string.sample_name'))</li><li>      <span class="hljs-selector-class">.fontSize</span>(<span class="hljs-number">30</span>)</li><li>      <span class="hljs-selector-class">.fontWeight</span>(<span class="hljs-number">700</span>)</li><li>      <span class="hljs-selector-class">.lineHeight</span>(<span class="hljs-number">40</span>)</li><li>  }</li><li>  <span class="hljs-selector-class">.height</span>(<span class="hljs-number">112</span>)</li><li>  <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')</li><li>  <span class="hljs-selector-class">.alignItems</span>(HorizontalAlign.Start)</li><li>  <span class="hljs-selector-class">.justifyContent</span>(FlexAlign.End)</li><li>  <span class="hljs-selector-class">.margin</span>({ bottom: <span class="hljs-number">12</span> })</li><li>
</li><li>  <span class="hljs-built_in">ListJumpView</span>({</li><li>    mainWindowInfo: this.windowUtil?.mainWindowInfo</li><li>  })</li><li>}</li><li><span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')</li><li><span class="hljs-selector-class">.padding</span>({</li><li>  top: this.getUIContext()<span class="hljs-selector-class">.px2vp</span>(this.windowUtil?.mainWindowInfo.AvoidSystem?.topRect.height),</li><li>  <span class="hljs-attribute">left</span>: <span class="hljs-number">16</span>,</li><li>  right: <span class="hljs-number">16</span></li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ResponsiveLayout/blob/master/entry/src/main/ets/pages/Index.ets#L33-L55" target="_blank">Index.ets</a></div></div></div></div> <p></p></li></ol> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>上述开发步骤仅展示了对状态栏与导航栏的动态避让实现，若开发者有对其他避让区（如挖孔区等）变化的监听需要，可参考上述开发流程，仅修改避让区类型即可。</p> </div></div></div> </div> <div class="tiledSection"><h2 id="section19488122113212">不同设备定制沉浸式策略<i class="anchor-icon anchor-icon-link" anchorid="section19488122113212" tips="复制节点链接"></i></h2><p>不同设备的定制沉浸式策略，推荐通过窗口类型进行区分，而非依赖设备类型判断。通过动态识别当前窗口类型（如全屏、分屏、悬浮窗、自由窗口等），可针对不同窗口形态实施定制化的沉浸式策略。</p> <p><strong>开发步骤：</strong></p> <ol><li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#onwindowstatuschange11" target="_blank">on('windowStatusChange')</a>方法，实现对窗口模式变化的监听，当窗口windowStatus发生变化时进行通知。</span><p></p><div class="screenLinkPre"><div _ngcontent-tvm-c106="" class="highlight-div"><div _ngcontent-tvm-c106="" class="highlight-div-header"><div _ngcontent-tvm-c106="" class="highlight-div-header-left"><div _ngcontent-tvm-c106="" class="handle-button expand-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tvm-c106="" class="highlight-div-header-right"><div _ngcontent-tvm-c106="" class="handle-button ai-button"></div><div _ngcontent-tvm-c106="" class="handle-button line-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tvm-c106="" class="handle-button theme-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tvm-c106="" class="handle-button copy-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tvm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/ResponsiveLayout/blob/master/entry/src/main/ets/utils/WindowUtil.ets#L35-L218" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">public</span> <span class="hljs-attr">onStatusTypeChange</span>: <span class="hljs-function">(<span class="hljs-params">statusType: <span class="hljs-variable language_">window</span>.WindowStatusType</span>) =&gt;</span> <span class="hljs-built_in">void</span> = <span class="hljs-function">(<span class="hljs-params">statusType: <span class="hljs-variable language_">window</span>.WindowStatusType</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">mainWindowInfo</span>.<span class="hljs-property">windowStatusType</span> = statusType;</li><li>}</li><li><span class="hljs-comment">// ...</span></li><li><span class="hljs-title function_">updateWindowInfo</span>(): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-comment">// First time get window status.</span></li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">mainWindowInfo</span>.<span class="hljs-property">windowStatusType</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">mainWindow</span>.<span class="hljs-title function_">getWindowStatus</span>();</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">mainWindow</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'windowStatusChange'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onStatusTypeChange</span>);</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ResponsiveLayout/blob/master/entry/src/main/ets/utils/WindowUtil.ets#L35-L218" target="_blank">WindowUtil.ets</a></div></div></div></div> <p></p></li><li><span>在回调方法中，根据不同的windowStatus，设置不同的沉浸式策略即可。</span></li></ol> </div> <div class="tiledSection"><h2 id="section78426417192">开发实践案例<i class="anchor-icon anchor-icon-link" anchorid="section78426417192" tips="复制节点链接"></i></h2><p>本章节将通过窗口工具类，介绍如何实现沉浸式布局，包括：</p> <ul><li>适配不同窗口模式（全屏、分屏、悬浮窗等）</li><li>响应屏幕方向变化（横竖屏切换）</li><li>动态监听避让区调整（如挖孔区域）</li></ul> <p>工具类代码如下：</p> <div class="screenLinkPre"><div _ngcontent-tvm-c106="" class="highlight-div"><div _ngcontent-tvm-c106="" class="highlight-div-header"><div _ngcontent-tvm-c106="" class="highlight-div-header-left"><div _ngcontent-tvm-c106="" class="handle-button expand-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tvm-c106="" class="highlight-div-header-right"><div _ngcontent-tvm-c106="" class="handle-button ai-button"></div><div _ngcontent-tvm-c106="" class="handle-button line-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tvm-c106="" class="handle-button theme-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tvm-c106="" class="handle-button copy-button"><div _ngcontent-tvm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tvm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/ResponsiveLayout/blob/master/entry/src/main/ets/utils/WindowUtil.ets#L17-L340" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">display</span>, <span class="hljs-variable">UIContext</span>, <span class="hljs-variable">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">hilog</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">StartOptions</span>, <span class="hljs-variable">AbilityConstant</span>, <span class="hljs-variable">Want</span>, <span class="hljs-variable">common</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">resourceManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocalizationKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">sensor</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.SensorServiceKit'</span>;</li><li>
</li><li><span class="hljs-variable">export</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ImmersiveType</span> {</li><li>  <span class="hljs-variable">NORMAL</span>,</li><li>  <span class="hljs-variable">IMMERSIVE</span>,</li><li>  <span class="hljs-variable">FULLSCREEN_IMMERSIVE</span></li><li>}</li><li>
</li><li><span class="hljs-variable">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WindowUtil</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-variable">uiContext</span>?: <span class="hljs-title class_">UIContext</span>;</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-variable">mainWindow</span>: <span class="hljs-title class_">window</span>.<span class="hljs-title class_">Window</span>;</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-variable">mainWindowInfo</span>: <span class="hljs-title class_">WindowInfo</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">WindowInfo</span>();</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-variable">onStatusTypeChange</span>: (<span class="hljs-variable">statusType</span>: <span class="hljs-title class_">window</span>.<span class="hljs-title class_">WindowStatusType</span>) =&gt; <span class="hljs-variable">void</span> = (<span class="hljs-variable">statusType</span>: <span class="hljs-title class_">window</span>.<span class="hljs-title class_">WindowStatusType</span>) =&gt; {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindowInfo</span>.<span class="hljs-variable">windowStatusType</span> = <span class="hljs-variable">statusType</span>;</li><li>  }</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-variable">onWindowSizeChange</span>: (<span class="hljs-variable">windowSize</span>: <span class="hljs-title class_">window</span>.<span class="hljs-title class_">Size</span>) =&gt; <span class="hljs-variable">void</span> = (<span class="hljs-variable">windowSize</span>: <span class="hljs-title class_">window</span>.<span class="hljs-title class_">Size</span>) =&gt; {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindowInfo</span>.<span class="hljs-variable">windowSize</span> = <span class="hljs-variable">windowSize</span>;</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindowInfo</span>.<span class="hljs-variable">widthBp</span> = <span class="hljs-keyword">this</span>.<span class="hljs-variable">uiContext</span>!.<span class="hljs-title function_">getWindowWidthBreakpoint</span>();</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindowInfo</span>.<span class="hljs-variable">heightBp</span> = <span class="hljs-keyword">this</span>.<span class="hljs-variable">uiContext</span>!.<span class="hljs-title function_">getWindowHeightBreakpoint</span>();</li><li>  };</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-variable">onAvoidAreaChange</span>: (<span class="hljs-variable">avoidOptions</span>: <span class="hljs-title class_">window</span>.<span class="hljs-title class_">AvoidAreaOptions</span>) =&gt; <span class="hljs-variable">void</span> =</li><li>    (<span class="hljs-variable">avoidOptions</span>: <span class="hljs-title class_">window</span>.<span class="hljs-title class_">AvoidAreaOptions</span>) =&gt; {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable">avoidOptions</span>.<span class="hljs-keyword">type</span> === <span class="hljs-variable">window</span>.<span class="hljs-variable">AvoidAreaType</span>.<span class="hljs-variable">TYPE_SYSTEM</span>) {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindowInfo</span>.<span class="hljs-variable">AvoidSystem</span> = <span class="hljs-variable">avoidOptions</span>.<span class="hljs-variable">area</span>;</li><li>      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">avoidOptions</span>.<span class="hljs-keyword">type</span> === <span class="hljs-variable">window</span>.<span class="hljs-variable">AvoidAreaType</span>.<span class="hljs-variable">TYPE_CUTOUT</span>) {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindowInfo</span>.<span class="hljs-variable">AvoidCutout</span> = <span class="hljs-variable">avoidOptions</span>.<span class="hljs-variable">area</span>;</li><li>      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">avoidOptions</span>.<span class="hljs-keyword">type</span> === <span class="hljs-variable">window</span>.<span class="hljs-variable">AvoidAreaType</span>.<span class="hljs-variable">TYPE_SYSTEM_GESTURE</span>) {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindowInfo</span>.<span class="hljs-variable">AvoidSystemGesture</span> = <span class="hljs-variable">avoidOptions</span>.<span class="hljs-variable">area</span>;</li><li>      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">avoidOptions</span>.<span class="hljs-keyword">type</span> === <span class="hljs-variable">window</span>.<span class="hljs-variable">AvoidAreaType</span>.<span class="hljs-variable">TYPE_KEYBOARD</span>) {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindowInfo</span>.<span class="hljs-variable">AvoidKeyboard</span> = <span class="hljs-variable">avoidOptions</span>.<span class="hljs-variable">area</span>;</li><li>      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">avoidOptions</span>.<span class="hljs-keyword">type</span> === <span class="hljs-variable">window</span>.<span class="hljs-variable">AvoidAreaType</span>.<span class="hljs-variable">TYPE_NAVIGATION_INDICATOR</span>) {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindowInfo</span>.<span class="hljs-variable">AvoidNavigationIndicator</span> = <span class="hljs-variable">avoidOptions</span>.<span class="hljs-variable">area</span>;</li><li>      }</li><li>    };</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-variable">mainWindow</span>: <span class="hljs-title class_">window</span>.<span class="hljs-title class_">Window</span>) {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span> = <span class="hljs-variable">mainWindow</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">setImmersiveType</span>(<span class="hljs-keyword">type</span>: <span class="hljs-title class_">ImmersiveType</span>) {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-variable">ImmersiveType</span>.<span class="hljs-variable">NORMAL</span>) {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">setWindowLayoutFullScreen</span>(<span class="hljs-keyword">false</span>)</li><li>        .<span class="hljs-title function_">then</span>(() =&gt; {</li><li>          <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testLog'</span>, `<span class="hljs-variable">Succeeded</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">setting</span> <span class="hljs-variable">immersive</span> <span class="hljs-variable">mode</span>.`);</li><li>        })</li><li>        .<span class="hljs-keyword">catch</span>((<span class="hljs-variable">err</span>: <span class="hljs-title class_">BusinessError</span>) =&gt; {</li><li>          <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testLog'</span>, `<span class="hljs-variable">Failed</span> <span class="hljs-variable">to</span> <span class="hljs-variable">set</span> <span class="hljs-variable">immersive</span> <span class="hljs-variable">mode</span>. <span class="hljs-variable">Code</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>}, <span class="hljs-variable">message</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>}`);</li><li>        });</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-title function_">setSystemBarEnabled</span>(<span class="hljs-keyword">true</span>);</li><li>      <span class="hljs-comment">// Only used after the function loadContent() or setUIContent().</span></li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">setWindowDecorVisible</span>(<span class="hljs-keyword">true</span>);</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-title function_">recover</span>();</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-variable">ImmersiveType</span>.<span class="hljs-variable">IMMERSIVE</span>) {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">setWindowLayoutFullScreen</span>(<span class="hljs-keyword">true</span>)</li><li>        .<span class="hljs-title function_">then</span>(() =&gt; {</li><li>          <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testLog'</span>, `<span class="hljs-variable">Succeeded</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">setting</span> <span class="hljs-variable">immersive</span> <span class="hljs-variable">mode</span>.`);</li><li>        })</li><li>        .<span class="hljs-keyword">catch</span>((<span class="hljs-variable">err</span>: <span class="hljs-title class_">BusinessError</span>) =&gt; {</li><li>          <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testLog'</span>, `<span class="hljs-variable">Failed</span> <span class="hljs-variable">to</span> <span class="hljs-variable">set</span> <span class="hljs-variable">immersive</span> <span class="hljs-variable">mode</span>. <span class="hljs-variable">Code</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>}, <span class="hljs-variable">message</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>}`);</li><li>        });</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-title function_">setSystemBarEnabled</span>(<span class="hljs-keyword">true</span>);</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">setWindowDecorVisible</span>(<span class="hljs-keyword">false</span>);</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-title function_">recover</span>();</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-variable">ImmersiveType</span>.<span class="hljs-variable">FULLSCREEN_IMMERSIVE</span>) {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">setWindowLayoutFullScreen</span>(<span class="hljs-keyword">true</span>)</li><li>        .<span class="hljs-title function_">then</span>(() =&gt; {</li><li>          <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testLog'</span>, `<span class="hljs-variable">Succeeded</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">setting</span> <span class="hljs-variable">immersive</span> <span class="hljs-variable">mode</span>.`);</li><li>        })</li><li>        .<span class="hljs-keyword">catch</span>((<span class="hljs-variable">err</span>: <span class="hljs-title class_">BusinessError</span>) =&gt; {</li><li>          <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testLog'</span>, `<span class="hljs-variable">Failed</span> <span class="hljs-variable">to</span> <span class="hljs-variable">set</span> <span class="hljs-variable">immersive</span> <span class="hljs-variable">mode</span>. <span class="hljs-variable">Code</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>}, <span class="hljs-variable">message</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>}`);</li><li>        });</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">getWindowStatus</span>() === <span class="hljs-variable">window</span>.<span class="hljs-variable">WindowStatusType</span>.<span class="hljs-variable">MAXIMIZE</span> ||</li><li>        (<span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">getWindowStatus</span>() === <span class="hljs-variable">window</span>.<span class="hljs-variable">WindowStatusType</span>.<span class="hljs-variable">FLOATING</span> &amp;&amp;</li><li>          <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">getWindowDecorHeight</span>() !== <span class="hljs-number">0</span>)) {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">maximize</span>()</li><li>          .<span class="hljs-title function_">then</span>(() =&gt; {</li><li>            <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testLog'</span>, `<span class="hljs-variable">Succeeded</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">maximizing</span> <span class="hljs-variable">the</span> <span class="hljs-variable">window</span>.`);</li><li>          })</li><li>          .<span class="hljs-keyword">catch</span>((<span class="hljs-variable">err</span>: <span class="hljs-title class_">BusinessError</span>) =&gt; {</li><li>            <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testLog'</span>, `<span class="hljs-variable">Failed</span> <span class="hljs-variable">to</span> <span class="hljs-variable">maximize</span> <span class="hljs-variable">the</span> <span class="hljs-variable">window</span>. <span class="hljs-variable">Code</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>}, <span class="hljs-variable">message</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>}`);</li><li>          });</li><li>      }</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-title function_">setSystemBarEnabled</span>(<span class="hljs-keyword">false</span>);</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">setWindowDecorVisible</span>(<span class="hljs-keyword">false</span>);</li><li>    }</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindowInfo</span>.<span class="hljs-variable">isImmersive</span> = <span class="hljs-keyword">type</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">setUIContext</span>() {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">uiContext</span> = <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">setSystemBarEnabled</span>(<span class="hljs-variable">isVisible</span>: <span class="hljs-title class_">boolean</span>): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">setSpecificSystemBarEnabled</span>(<span class="hljs-string">'status'</span>, <span class="hljs-variable">isVisible</span>)</li><li>      .<span class="hljs-title function_">then</span>(() =&gt; {</li><li>        <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testLog'</span>, `<span class="hljs-variable">Succeeded</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">setting</span> <span class="hljs-variable">status</span> <span class="hljs-variable">bar</span> <span class="hljs-variable">to</span> <span class="hljs-variable">be</span> <span class="hljs-variable">invisible</span>.`);</li><li>      })</li><li>      .<span class="hljs-keyword">catch</span>((<span class="hljs-variable">err</span>: <span class="hljs-title class_">BusinessError</span>) =&gt; {</li><li>        <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testLog'</span>,</li><li>          `<span class="hljs-variable">Failed</span> <span class="hljs-variable">to</span> <span class="hljs-variable">set</span> <span class="hljs-variable">status</span> <span class="hljs-variable">bar</span> <span class="hljs-variable">to</span> <span class="hljs-variable">be</span> <span class="hljs-variable">invisible</span>. <span class="hljs-variable">Code</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>}, <span class="hljs-variable">message</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>}`);</li><li>      });</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">setSpecificSystemBarEnabled</span>(<span class="hljs-string">'navigationIndicator'</span>, <span class="hljs-variable">isVisible</span>)</li><li>      .<span class="hljs-title function_">then</span>(() =&gt; {</li><li>        <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testLog'</span>, `<span class="hljs-variable">Succeeded</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">setting</span> <span class="hljs-variable">navigation</span> <span class="hljs-variable">indicator</span> <span class="hljs-variable">to</span> <span class="hljs-variable">be</span> <span class="hljs-variable">invisible</span>.`);</li><li>      })</li><li>      .<span class="hljs-keyword">catch</span>((<span class="hljs-variable">err</span>: <span class="hljs-title class_">BusinessError</span>) =&gt; {</li><li>        <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testLog'</span>,</li><li>          `<span class="hljs-variable">Failed</span> <span class="hljs-variable">to</span> <span class="hljs-variable">set</span> <span class="hljs-variable">navigation</span> <span class="hljs-variable">indicator</span> <span class="hljs-variable">to</span> <span class="hljs-variable">be</span> <span class="hljs-variable">invisible</span>. <span class="hljs-variable">Code</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>}, <span class="hljs-variable">message</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>}`);</li><li>      });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">recover</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">getWindowStatus</span>() === <span class="hljs-variable">window</span>.<span class="hljs-variable">WindowStatusType</span>.<span class="hljs-variable">FULL_SCREEN</span>) {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">recover</span>()</li><li>        .<span class="hljs-title function_">then</span>(() =&gt; {</li><li>          <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testLog'</span>, `<span class="hljs-variable">Succeeded</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">recovering</span> <span class="hljs-variable">the</span> <span class="hljs-variable">window</span>.`);</li><li>        })</li><li>        .<span class="hljs-keyword">catch</span>((<span class="hljs-variable">err</span>: <span class="hljs-title class_">BusinessError</span>) =&gt; {</li><li>          <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testLog'</span>, `<span class="hljs-variable">Failed</span> <span class="hljs-variable">to</span> <span class="hljs-variable">recover</span> <span class="hljs-variable">the</span> <span class="hljs-variable">window</span>. <span class="hljs-variable">Code</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>}, <span class="hljs-variable">message</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>}`);</li><li>        });</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">setWindowOrientation</span>(<span class="hljs-variable">orientation</span>: <span class="hljs-title class_">window</span>.<span class="hljs-title class_">Orientation</span>): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">setPreferredOrientation</span>(<span class="hljs-variable">orientation</span>)</li><li>      .<span class="hljs-title function_">then</span>(() =&gt; {</li><li>        <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testLog'</span>, `<span class="hljs-variable">Succeeded</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">setting</span> <span class="hljs-variable">window</span> <span class="hljs-variable">orientation</span>.`);</li><li>        <span class="hljs-comment">// Update window orientation.</span></li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindowInfo</span>.<span class="hljs-variable">orientation</span> = <span class="hljs-variable">orientation</span>;</li><li>      })</li><li>      .<span class="hljs-keyword">catch</span>((<span class="hljs-variable">err</span>: <span class="hljs-title class_">BusinessError</span>) =&gt; {</li><li>        <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testLog'</span>, `<span class="hljs-variable">Failed</span> <span class="hljs-variable">to</span> <span class="hljs-variable">set</span> <span class="hljs-variable">window</span> <span class="hljs-variable">orientation</span>. <span class="hljs-variable">Code</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>}, <span class="hljs-variable">message</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>}`);</li><li>      });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">updateWindowInfo</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-comment">// First time get window status.</span></li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindowInfo</span>.<span class="hljs-variable">windowStatusType</span> = <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">getWindowStatus</span>();</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'windowStatusChange'</span>, <span class="hljs-keyword">this</span>.<span class="hljs-variable">onStatusTypeChange</span>);</li><li>    <span class="hljs-comment">// First time get window size.</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">width</span>: <span class="hljs-title class_">number</span> = <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">getWindowProperties</span>().<span class="hljs-variable">windowRect</span>.<span class="hljs-variable">width</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">height</span>: <span class="hljs-title class_">number</span> = <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">getWindowProperties</span>().<span class="hljs-variable">windowRect</span>.<span class="hljs-variable">height</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">windowSize</span>: <span class="hljs-title class_">window</span>.<span class="hljs-title class_">Size</span> = {</li><li>      <span class="hljs-variable">width</span>: <span class="hljs-title class_">width</span>,</li><li>      <span class="hljs-variable">height</span>: <span class="hljs-title class_">height</span></li><li>    }</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindowInfo</span>.<span class="hljs-variable">windowSize</span> = <span class="hljs-variable">windowSize</span>;</li><li>    <span class="hljs-comment">// First time get width/height breakpoint.</span></li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindowInfo</span>.<span class="hljs-variable">widthBp</span> = <span class="hljs-keyword">this</span>.<span class="hljs-variable">uiContext</span>!.<span class="hljs-title function_">getWindowWidthBreakpoint</span>();</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindowInfo</span>.<span class="hljs-variable">heightBp</span> = <span class="hljs-keyword">this</span>.<span class="hljs-variable">uiContext</span>!.<span class="hljs-title function_">getWindowHeightBreakpoint</span>();</li><li>    <span class="hljs-comment">// Register for window size change monitoring, update window size and width/height breakpoint.</span></li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'windowSizeChange'</span>, <span class="hljs-keyword">this</span>.<span class="hljs-variable">onWindowSizeChange</span>);</li><li>
</li><li>    <span class="hljs-comment">// First time get avoid area infos.</span></li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindowInfo</span>.<span class="hljs-variable">AvoidSystem</span> = <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">getWindowAvoidArea</span>(<span class="hljs-variable">window</span>.<span class="hljs-variable">AvoidAreaType</span>.<span class="hljs-variable">TYPE_SYSTEM</span>);</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindowInfo</span>.<span class="hljs-variable">AvoidNavigationIndicator</span> =</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">getWindowAvoidArea</span>(<span class="hljs-variable">window</span>.<span class="hljs-variable">AvoidAreaType</span>.<span class="hljs-variable">TYPE_NAVIGATION_INDICATOR</span>);</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindowInfo</span>.<span class="hljs-variable">AvoidCutout</span> = <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">getWindowAvoidArea</span>(<span class="hljs-variable">window</span>.<span class="hljs-variable">AvoidAreaType</span>.<span class="hljs-variable">TYPE_CUTOUT</span>);</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindowInfo</span>.<span class="hljs-variable">AvoidSystemGesture</span> =</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">getWindowAvoidArea</span>(<span class="hljs-variable">window</span>.<span class="hljs-variable">AvoidAreaType</span>.<span class="hljs-variable">TYPE_SYSTEM_GESTURE</span>);</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindowInfo</span>.<span class="hljs-variable">AvoidKeyboard</span> = <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">getWindowAvoidArea</span>(<span class="hljs-variable">window</span>.<span class="hljs-variable">AvoidAreaType</span>.<span class="hljs-variable">TYPE_KEYBOARD</span>);</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'avoidAreaChange'</span>, <span class="hljs-keyword">this</span>.<span class="hljs-variable">onAvoidAreaChange</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">release</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'windowStatusChange'</span>);</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'windowSizeChange'</span>);</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'avoidAreaChange'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">setSplitScreen</span>(<span class="hljs-variable">bundleName</span>: <span class="hljs-title class_">string</span>, <span class="hljs-variable">abilityName</span>: <span class="hljs-title class_">string</span>, <span class="hljs-variable">moduleName</span>: <span class="hljs-title class_">string</span>): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">context</span> = <span class="hljs-keyword">this</span>.<span class="hljs-variable">uiContext</span>?.<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> <span class="hljs-variable">common</span>.<span class="hljs-variable">UIAbilityContext</span>;</li><li>    <span class="hljs-comment">// Create StartOptions and set them to the main window mode.</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">option</span>: <span class="hljs-title class_">StartOptions</span> = { <span class="hljs-variable">windowMode</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-title class_">WindowMode</span>.<span class="hljs-title class_">WINDOW_MODE_SPLIT_PRIMARY</span> };</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">want</span>: <span class="hljs-title class_">Want</span> = { <span class="hljs-variable">bundleName</span>: <span class="hljs-title class_">bundleName</span>, <span class="hljs-variable">abilityName</span>: <span class="hljs-title class_">abilityName</span>, <span class="hljs-variable">moduleName</span>: <span class="hljs-title class_">moduleName</span> };</li><li>    <span class="hljs-variable">context</span>.<span class="hljs-title function_">startAbility</span>(<span class="hljs-variable">want</span>, <span class="hljs-variable">option</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">cancelSplitScreen</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">context</span> = <span class="hljs-keyword">this</span>.<span class="hljs-variable">uiContext</span>?.<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> <span class="hljs-variable">common</span>.<span class="hljs-variable">UIAbilityContext</span>;</li><li>    <span class="hljs-variable">context</span>.<span class="hljs-title function_">terminateSelf</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">setWindowLimits</span>(<span class="hljs-variable">maxWidth</span>: <span class="hljs-title class_">number</span>, <span class="hljs-variable">maxHeight</span>: <span class="hljs-title class_">number</span>, <span class="hljs-variable">minWidth</span>: <span class="hljs-title class_">number</span>, <span class="hljs-variable">minHeight</span>: <span class="hljs-title class_">number</span>): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">windowLimits</span>: <span class="hljs-title class_">window</span>.<span class="hljs-title class_">WindowLimits</span> = {</li><li>      <span class="hljs-variable">maxWidth</span>: <span class="hljs-title class_">maxWidth</span>,</li><li>      <span class="hljs-variable">maxHeight</span>: <span class="hljs-title class_">maxHeight</span>,</li><li>      <span class="hljs-variable">minWidth</span>: <span class="hljs-title class_">minWidth</span>,</li><li>      <span class="hljs-variable">minHeight</span>: <span class="hljs-title class_">minHeight</span></li><li>    }</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">promise</span> = <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">setWindowLimits</span>(<span class="hljs-variable">windowLimits</span>);</li><li>    <span class="hljs-variable">promise</span>.<span class="hljs-title function_">then</span>((<span class="hljs-variable">data</span>: <span class="hljs-title class_">window</span>.<span class="hljs-title class_">WindowLimits</span>) =&gt; {</li><li>      <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testLog'</span>, `<span class="hljs-variable">Succeeded</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">changing</span> <span class="hljs-variable">the</span> <span class="hljs-variable">window</span> <span class="hljs-variable">limits</span>. <span class="hljs-variable">Cause</span>: ${<span class="hljs-variable">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable">data</span>)}`);</li><li>    }).<span class="hljs-keyword">catch</span>((<span class="hljs-variable">err</span>: <span class="hljs-title class_">BusinessError</span>) =&gt; {</li><li>      <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testLog'</span>,</li><li>        `<span class="hljs-variable">Failed</span> <span class="hljs-variable">to</span> <span class="hljs-variable">change</span> <span class="hljs-variable">the</span> <span class="hljs-variable">window</span> <span class="hljs-variable">limits</span>. <span class="hljs-variable">Cause</span> <span class="hljs-variable">code</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>}, <span class="hljs-variable">message</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>}`);</li><li>    });</li><li>  }</li><li>
</li><li>
</li><li>  <span class="hljs-title function_">resize</span>(<span class="hljs-variable">width</span>: <span class="hljs-title class_">number</span>, <span class="hljs-variable">height</span>: <span class="hljs-title class_">number</span>): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">mainWindow</span>.<span class="hljs-title function_">resize</span>(<span class="hljs-variable">width</span>, <span class="hljs-variable">height</span>, (<span class="hljs-variable">err</span>: <span class="hljs-title class_">BusinessError</span>) =&gt; {</li><li>      <span class="hljs-keyword">const</span> <span class="hljs-variable">errCode</span>: <span class="hljs-title class_">number</span> = <span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>;</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable">errCode</span>) {</li><li>        <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testLog'</span>,</li><li>          `<span class="hljs-variable">Failed</span> <span class="hljs-variable">to</span> <span class="hljs-variable">change</span> <span class="hljs-variable">the</span> <span class="hljs-variable">window</span> <span class="hljs-variable">size</span>. <span class="hljs-variable">Cause</span> <span class="hljs-variable">code</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>}, <span class="hljs-variable">message</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>}`);</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testLog'</span>, <span class="hljs-string">'Succeeded in changing the window size.'</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">queryOrientationByDisplay</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">displayClass</span>: <span class="hljs-title class_">display</span>.<span class="hljs-title class_">Display</span> | <span class="hljs-title class_">null</span> = <span class="hljs-variable">display</span>.<span class="hljs-title function_">getDefaultDisplaySync</span>();</li><li>    <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testLog'</span>, `<span class="hljs-variable">The</span> <span class="hljs-variable">Orientation</span> <span class="hljs-keyword">is</span> ${<span class="hljs-variable">displayClass</span>.<span class="hljs-variable">orientation</span>}`);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">queryOrientationByResourceManager</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">info</span>: <span class="hljs-title class_">resourceManager</span>.<span class="hljs-title class_">Direction</span> | <span class="hljs-title class_">undefined</span> =</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">uiContext</span>?.<span class="hljs-title function_">getHostContext</span>()?.<span class="hljs-variable">resourceManager</span>.<span class="hljs-title function_">getConfigurationSync</span>().<span class="hljs-variable">direction</span>;</li><li>    <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testLog'</span>, `<span class="hljs-variable">The</span> <span class="hljs-variable">Orientation</span> <span class="hljs-keyword">is</span> ${<span class="hljs-variable">info</span>}`);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">queryDegree</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-variable">sensor</span>.<span class="hljs-title function_">on</span>(<span class="hljs-variable">sensor</span>.<span class="hljs-variable">SensorId</span>.<span class="hljs-variable">GRAVITY</span>, (<span class="hljs-variable">data</span>: <span class="hljs-title class_">sensor</span>.<span class="hljs-title class_">GravityResponse</span>) =&gt; {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-variable">degree</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">0</span>;</li><li>      <span class="hljs-variable">degree</span> = <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getCalDegree</span>(<span class="hljs-variable">data</span>.<span class="hljs-variable">x</span>, <span class="hljs-variable">data</span>.<span class="hljs-variable">y</span>, <span class="hljs-variable">data</span>.<span class="hljs-variable">z</span>);</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getCalDegree</span>(<span class="hljs-variable">x</span>: <span class="hljs-title class_">number</span>, <span class="hljs-variable">y</span>: <span class="hljs-title class_">number</span>, <span class="hljs-variable">z</span>: <span class="hljs-title class_">number</span>): <span class="hljs-title class_">number</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">degree</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-comment">// three is Effective Delta Angle Threshold Coefficient.</span></li><li>    <span class="hljs-keyword">if</span> ((<span class="hljs-variable">x</span> * <span class="hljs-variable">x</span> + <span class="hljs-variable">y</span> * <span class="hljs-variable">y</span>) * <span class="hljs-number">3</span> &lt; <span class="hljs-title class_">z</span> * <span class="hljs-title class_">z</span>) {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-variable">degree</span>;</li><li>    }</li><li>    <span class="hljs-variable">degree</span> = <span class="hljs-number">90</span> - (<span class="hljs-variable">Number</span>)(<span class="hljs-variable">Math</span>.<span class="hljs-title function_">round</span>(<span class="hljs-variable">Math</span>.<span class="hljs-title function_">atan2</span>(<span class="hljs-variable">y</span>, -<span class="hljs-variable">x</span>) / <span class="hljs-variable">Math</span>.<span class="hljs-variable">PI</span> * <span class="hljs-number">180</span>));</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">degree</span> &gt;= <span class="hljs-number">0</span> ? <span class="hljs-variable">degree</span> % <span class="hljs-number">360</span> : <span class="hljs-title class_">degree</span> % <span class="hljs-number">360</span> + <span class="hljs-number">360</span>;</li><li>  }</li><li>}</li><li>
</li><li>@<span class="hljs-title function_">Observed</span></li><li><span class="hljs-variable">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WindowInfo</span> {</li><li>  <span class="hljs-comment">// Window status.</span></li><li>  <span class="hljs-keyword">public</span> <span class="hljs-variable">windowStatusType</span>: <span class="hljs-title class_">window</span>.<span class="hljs-title class_">WindowStatusType</span> = <span class="hljs-variable">window</span>.<span class="hljs-variable">WindowStatusType</span>.<span class="hljs-variable">UNDEFINED</span>;</li><li>  <span class="hljs-comment">// Is the window an immersive layout.</span></li><li>  <span class="hljs-keyword">public</span> <span class="hljs-variable">isImmersive</span>: <span class="hljs-title class_">ImmersiveType</span> = <span class="hljs-variable">ImmersiveType</span>.<span class="hljs-variable">NORMAL</span>;</li><li>  <span class="hljs-comment">// Window orientation.</span></li><li>  <span class="hljs-keyword">public</span> <span class="hljs-variable">orientation</span>: <span class="hljs-title class_">window</span>.<span class="hljs-title class_">Orientation</span> = <span class="hljs-variable">window</span>.<span class="hljs-variable">Orientation</span>.<span class="hljs-variable">UNSPECIFIED</span>;</li><li>  <span class="hljs-comment">// Window size.</span></li><li>  <span class="hljs-keyword">public</span> <span class="hljs-variable">windowSize</span>: <span class="hljs-title class_">window</span>.<span class="hljs-title class_">Size</span> = { <span class="hljs-variable">width</span>: <span class="hljs-number">0</span>, <span class="hljs-variable">height</span>: <span class="hljs-number">0</span> };</li><li>  <span class="hljs-comment">// Width/height breakpoint.</span></li><li>  <span class="hljs-keyword">public</span> <span class="hljs-variable">widthBp</span>: <span class="hljs-title class_">WidthBreakpoint</span> = <span class="hljs-variable">WidthBreakpoint</span>.<span class="hljs-variable">WIDTH_XS</span>;</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-variable">heightBp</span>: <span class="hljs-title class_">HeightBreakpoint</span> = <span class="hljs-variable">HeightBreakpoint</span>.<span class="hljs-variable">HEIGHT_SM</span>;</li><li>  <span class="hljs-comment">// Avoid area infos.</span></li><li>  <span class="hljs-keyword">public</span> <span class="hljs-variable">AvoidSystem</span>?: <span class="hljs-title class_">window</span>.<span class="hljs-title class_">AvoidArea</span>;</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-variable">AvoidNavigationIndicator</span>?: <span class="hljs-title class_">window</span>.<span class="hljs-title class_">AvoidArea</span>;</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-variable">AvoidCutout</span>?: <span class="hljs-title class_">window</span>.<span class="hljs-title class_">AvoidArea</span>;</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-variable">AvoidSystemGesture</span>?: <span class="hljs-title class_">window</span>.<span class="hljs-title class_">AvoidArea</span>;</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-variable">AvoidKeyboard</span>?: <span class="hljs-title class_">window</span>.<span class="hljs-title class_">AvoidArea</span>;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ResponsiveLayout/blob/master/entry/src/main/ets/utils/WindowUtil.ets#L17-L340" target="_blank">WindowUtil.ets</a></div></div></div></div> </div> <p></p> </div> <div></div></div>