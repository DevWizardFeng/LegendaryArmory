<h1 _ngcontent-hew-c119="" class="doc-title ng-star-inserted" title="组件复用问题诊断分析"> 组件复用问题诊断分析 </h1>

<div _ngcontent-hew-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section9698338152317">概述<i class="anchor-icon anchor-icon-link" anchorid="section9698338152317" tips="复制节点链接"></i></h2><p>组件复用的本质是自定义组件的缓存池。使用@Reusable装饰器标记自定义组件后，当该组件进入销毁流程时，将改为进入缓存池。当需要创建此自定义组件时，优先尝试从缓存池中寻找对应reuseId的自定义组件，若未找到再进行创建。此缓存池的实例位于@Reusable标记的自定义组件的父自定义组件上，会随父自定义组件的销毁一并销毁。关于自定义组件复用的详细使用方法，可参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-component-reuse" target="_blank">组件复用</a>文档。综上所述，组件复用的关键概念如下：</p> <ul><li>缓存池：用于存放自定义组件，位于父自定义组件对象上。</li><li>@Reusable装饰器：标记自定义组件，使其在释放时进入缓存池。</li><li>reuseId：自定义组件在缓存池中的键，用于区分池中的自定义组件类型。</li></ul> <p>理解了这些关键概念，即可对组件复用的问题进行分析和定位。本文以列表组件为例，介绍组件复用常见问题的分析与解决方案。</p> </div> <div class="tiledSection"><h2 id="section65225319817">同一列表内的组件复用问题分析与解决<i class="anchor-icon anchor-icon-link" anchorid="section65225319817" tips="复制节点链接"></i></h2><p>开发者可以通过AppAnalyzer对应用组件复用问题进行检测，执行场景化+手动滑动场景检查后，生成组件复用问题的体检报告，为开发者展示列表组件的结构化特征，并提供针对性的优化指导建议。</p> <p>使用AppAnalyzer工具检测组件复用步骤如下。</p> <ol><li>在DevEco Studio中启动AppAnalyzer工具，详细请参见<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-performance-detection#section135451444171" target="_blank">AppAnalyzer</a>。</li><li>本文展示的<a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/tree/master/ComponentReuse" target="_blank">正反例代码</a>分别位于positive和negative模块中，检测时需选择相应模块。<p><span><img height="452.7187" originheight="388" originwidth="457" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162902.47058549239820374864869367735204:50001231000000:2800:EFE416643614D02D5673BB59A671B5643FC87DEABD2F8DF31975DC9EEBC611E4.png" title="点击放大" width="532"></span></p> </li><li>点击工具“手动性能页面滑动体检”，按照提示进行检测操作。<p><span><img height="576.7013000000001" originheight="774" originwidth="714" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162902.05885809011987611133053134930656:50001231000000:2800:DB8DE48B910C48D67C46F2E2FEED22E93012A61D819B7E864599B384577125AC.png" title="点击放大" width="532"></span></p> </li><li>通过分析检测结果，结合滑动过程中列表卡片的创建次数，可以分析出当前列表的组件未使用复用或者复用未生效。<p><span><img height="234.18640000000002" originheight="432" originwidth="1472" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162902.60872782842926982223595747973871:50001231000000:2800:BD47E5FED6EF2EAD4CF1694D2DC6E640805CE09A690BA71BBA8F407D2AF6ABFF.png" title="点击放大" width="798"></span></p> </li></ol> <p>以下将介绍几种复用场景问题，通过代码分析和优化建议对组件复用问题进行修复。</p> </div> <div class="tiledSection"><h3 id="section10228161101910" class="firsth2">未使用组件复用<i class="anchor-icon anchor-icon-link" anchorid="section10228161101910" tips="复制节点链接"></i></h3></div> <ul><li><strong>场景一：</strong><strong>列表项结构类型相同</strong><p>ListItem的根组件只有一个，且根组件整体结构组成不变。</p> <p><span><img height="549.2235000000001" originheight="2258" originwidth="1093" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162902.17979502897485019346402813557245:50001231000000:2800:624BC2206408721EFCD961C349A4B51BCFA0981AB2316293B5F09EC80DA15B88.png" title="点击放大" width="266"></span></p> <p>例如以下示例中，NewsContent是新闻列表的内容组件，其内部包含三个子组件：顶部的文本，中部的图片以及底部的发布时间。</p> <p><strong>反例</strong></p> <div _ngcontent-hew-c106="" class="highlight-div"><div _ngcontent-hew-c106="" class="highlight-div-header"><div _ngcontent-hew-c106="" class="highlight-div-header-left"><div _ngcontent-hew-c106="" class="handle-button expand-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hew-c106="" class="highlight-div-header-right"><div _ngcontent-hew-c106="" class="handle-button ai-button"></div><div _ngcontent-hew-c106="" class="handle-button line-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hew-c106="" class="handle-button theme-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hew-c106="" class="handle-button copy-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hew-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// NewsListPage</span></li><li><span class="hljs-title function_">List</span>() {</li><li>  <span class="hljs-title function_">LazyForEach</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">dataSource</span>, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">ItemData</span>) =&gt; {</li><li>    <span class="hljs-title function_">ListItem</span>() {</li><li>      <span class="hljs-title function_">NewsContent</span>({ <span class="hljs-variable">item</span>: <span class="hljs-title class_">item</span> })</li><li>      }</li><li>    }</li><li>  }, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">ItemData</span>) =&gt; <span class="hljs-variable">item</span>.<span class="hljs-variable">id</span>.<span class="hljs-title function_">toString</span>())</li><li>}</li></ol></pre></div></div> <div _ngcontent-hew-c106="" class="highlight-div"><div _ngcontent-hew-c106="" class="highlight-div-header"><div _ngcontent-hew-c106="" class="highlight-div-header-left"><div _ngcontent-hew-c106="" class="handle-button expand-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hew-c106="" class="highlight-div-header-right"><div _ngcontent-hew-c106="" class="handle-button ai-button"></div><div _ngcontent-hew-c106="" class="handle-button line-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hew-c106="" class="handle-button theme-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hew-c106="" class="handle-button copy-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hew-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Component</span></li><li>struct NewsContent {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-keyword">@Builder</span></li><li>  myBuilder(<span class="hljs-attribute">item</span>: ItemData) {</li><li>    <span class="hljs-built_in">TopView</span>({ item: item }) <span class="hljs-comment">// Top Text.</span></li><li>    <span class="hljs-built_in">MiddleSingleImageView</span>({ item: item }) <span class="hljs-comment">// Image</span></li><li>    <span class="hljs-built_in">BottomView</span>({ item: item }) <span class="hljs-comment">// Bottom text.</span></li><li>  }</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-built_in">Column</span>() {</li><li>      this<span class="hljs-selector-class">.myBuilder</span>(this.item)</li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre></div></div> <p><strong>代码分析</strong></p> <p>ListItem模块的组件结构采用总-分式结构，未使用if-else实现子组件的条件渲染。父组件NewsContent缺少组件复用机制，导致每次使用时都需要重新创建实例，在组件较为复杂创建耗时较长的情况下，会影响滑动的性能，造成卡顿。</p> <p><strong>优化建议</strong></p> <p>这种场景下，列表中的每一项都是由相同类型的元素和布局构成，列表项组件可以作为复用逻辑的基本单位，给父组件NewsContent添加@Reusable装饰器即可。</p> <p><strong>正例</strong></p> <div class="screenLinkPre"><div _ngcontent-hew-c106="" class="highlight-div"><div _ngcontent-hew-c106="" class="highlight-div-header"><div _ngcontent-hew-c106="" class="highlight-div-header-left"><div _ngcontent-hew-c106="" class="handle-button expand-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hew-c106="" class="highlight-div-header-right"><div _ngcontent-hew-c106="" class="handle-button ai-button"></div><div _ngcontent-hew-c106="" class="handle-button line-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hew-c106="" class="handle-button theme-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hew-c106="" class="handle-button copy-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hew-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ComponentReuse/entry/src/main/ets/view/NoComponentReuseSceneOnePositiveExample.ets#L23-L46" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">@Reusable</span></li><li><span class="hljs-variable">@Component</span></li><li>struct NewsContent {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ComponentReuse/entry/src/main/ets/view/NoComponentReuseSceneOnePositiveExample.ets#L23-L46" target="_blank">NoComponentReuseSceneOnePositiveExample.ets</a></div></div></div></div> <p></p> </li><li id="li1441155123913"><a name="ZH-CN_TOPIC_0000002522906665__li1441155123913"></a><a name="li1441155123913"></a><strong>场景二：</strong><strong>列表项结构类型不同</strong><p><strong>①"总-分式"子组件可变结构</strong>：ListItem的根组件只有一个，且根组件整体结构组成不变，局部子组件进行替换。</p> <p><span><img height="549.2235000000001" originheight="2258" originwidth="1093" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162902.64930446842277558490910650382423:50001231000000:2800:714570F6A20DBED399E9C62CE3B1DFF5EF411780FBD3AD3478151423E035A5CD.png" title="点击放大" width="266"></span></p> <p>如以下示例中，NewsContent是新闻列表的内容组件，其内部包含三个子组件：顶部文本、底部发布时间，根据展示类型不同，中部可展示单张图片、三张图片或视频。</p> <p><strong>反例</strong></p> <div _ngcontent-hew-c106="" class="highlight-div"><div _ngcontent-hew-c106="" class="highlight-div-header"><div _ngcontent-hew-c106="" class="highlight-div-header-left"><div _ngcontent-hew-c106="" class="handle-button expand-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hew-c106="" class="highlight-div-header-right"><div _ngcontent-hew-c106="" class="handle-button ai-button"></div><div _ngcontent-hew-c106="" class="handle-button line-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hew-c106="" class="handle-button theme-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hew-c106="" class="handle-button copy-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hew-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// NewsListPage</span></li><li><span class="hljs-title function_">List</span>() {</li><li>  <span class="hljs-title function_">LazyForEach</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">dataSource</span>, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">ItemData</span>) =&gt; {</li><li>    <span class="hljs-title function_">ListItem</span>() {</li><li>      <span class="hljs-title function_">NewsContent</span>({ <span class="hljs-variable">item</span>: <span class="hljs-title class_">item</span> }) <span class="hljs-comment">// The root component of ListItem is singular, and the overall structure of the root component remains unchanged.</span></li><li>    }</li><li>  }, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">ItemData</span>) =&gt; <span class="hljs-variable">item</span>.<span class="hljs-variable">id</span>.<span class="hljs-title function_">toString</span>())</li><li>}</li></ol></pre></div></div> <div _ngcontent-hew-c106="" class="highlight-div"><div _ngcontent-hew-c106="" class="highlight-div-header"><div _ngcontent-hew-c106="" class="highlight-div-header-left"><div _ngcontent-hew-c106="" class="handle-button expand-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hew-c106="" class="highlight-div-header-right"><div _ngcontent-hew-c106="" class="handle-button ai-button"></div><div _ngcontent-hew-c106="" class="handle-button line-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hew-c106="" class="handle-button theme-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hew-c106="" class="handle-button copy-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hew-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Component</span></li><li>struct NewsContent {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-keyword">@Builder</span></li><li>  myBuilder(<span class="hljs-attribute">item</span>: ItemData) {</li><li>    <span class="hljs-built_in">TopView</span>({ item: item })</li><li>    if (item.type === <span class="hljs-number">0</span>) { <span class="hljs-comment">// Replace the local subcomponent.</span></li><li>      <span class="hljs-built_in">MiddleSingleImageView</span>({ item: item })</li><li>    } else if (item.type === <span class="hljs-number">1</span>) {</li><li>      <span class="hljs-built_in">MiddleThreeImageView</span>({ item: item })</li><li>    } else {</li><li>      <span class="hljs-built_in">MiddleVideoView</span>({ item: item })</li><li>    }</li><li>    <span class="hljs-built_in">BottomView</span>({ item: item })</li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre></div></div> <p><strong>代码分析</strong></p> <p>父组件NewsContent支持多种列表项类型，通过if-else条件渲染不同子组件，包含了单图、三图和视频三种形式，其布局、组成元素存在一定差异。</p> <p><strong>优化建议</strong></p> <p>给父组件NewsContent添加@Reusable装饰器，同时根据if<span style="color: rgb(154,110,58);">-</span>else分支合理配置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-reuse-id#reuseid" target="_blank">reuseId</a>。在同一段自定义组件代码中，如果使用if/else条件语句控制布局结构，会导致在不同逻辑分支中创建不同布局的组件，从而造成组件树结构的差异。此时可以使用reuseId来区分发生变化的分支逻辑，确保系统能够根据reuseId缓存各种结构的组件，提升复用性能。具体请参考：<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-component-reuse#section1239555818211" target="_blank">使用reuseId标记布局发生变化的组件</a>。若if/else条件分支过多，会导致reuseId分类过细，可参考<a href="/consumer/cn/doc/best-practices/bpta-component-reuse-issue-diagnosis-and-analysis#section511719116258">reuseId分类过细</a>进行优化。</p> <p><strong>正例</strong></p> <div class="screenLinkPre"><div _ngcontent-hew-c106="" class="highlight-div"><div _ngcontent-hew-c106="" class="highlight-div-header"><div _ngcontent-hew-c106="" class="highlight-div-header-left"><div _ngcontent-hew-c106="" class="handle-button expand-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hew-c106="" class="highlight-div-header-right"><div _ngcontent-hew-c106="" class="handle-button ai-button"></div><div _ngcontent-hew-c106="" class="handle-button line-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hew-c106="" class="handle-button theme-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hew-c106="" class="handle-button copy-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hew-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ComponentReuse/entry/src/main/ets/view/NoComponentReuseSceneTwoPositiveExample.ets#L12-L19" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">List</span>() {</li><li>  <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataSource</span>, <span class="hljs-function">(<span class="hljs-params">item: ItemData</span>) =&gt;</span> {</li><li>    <span class="hljs-title class_">ListItem</span>() {</li><li>      <span class="hljs-title class_">NewsContent</span>({ <span class="hljs-attr">item</span>: item }).<span class="hljs-title function_">reuseId</span>(<span class="hljs-string">`<span class="hljs-subst">${item.<span class="hljs-keyword">type</span>}</span>`</span>)</li><li>    }</li><li>  }, <span class="hljs-function">(<span class="hljs-params">item: ItemData</span>) =&gt;</span> item.<span class="hljs-property">id</span>.<span class="hljs-title function_">toString</span>())</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ComponentReuse/entry/src/main/ets/view/NoComponentReuseSceneTwoPositiveExample.ets#L12-L19" target="_blank">NoComponentReuseSceneTwoPositiveExample.ets</a></div></div></div></div> <div class="screenLinkPre"><div _ngcontent-hew-c106="" class="highlight-div"><div _ngcontent-hew-c106="" class="highlight-div-header"><div _ngcontent-hew-c106="" class="highlight-div-header-left"><div _ngcontent-hew-c106="" class="handle-button expand-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hew-c106="" class="highlight-div-header-right"><div _ngcontent-hew-c106="" class="handle-button ai-button"></div><div _ngcontent-hew-c106="" class="handle-button line-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hew-c106="" class="handle-button theme-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hew-c106="" class="handle-button copy-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hew-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ComponentReuse/entry/src/main/ets/view/NoComponentReuseSceneTwoPositiveExample.ets#L26-L55" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">@Reusable</span></li><li><span class="hljs-variable">@Component</span></li><li>struct NewsContent {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ComponentReuse/entry/src/main/ets/view/NoComponentReuseSceneTwoPositiveExample.ets#L26-L55" target="_blank">NoComponentReuseSceneTwoPositiveExample.ets</a></div></div></div></div> <p></p> <p><strong>②分类组合式结构</strong>：ListItem的根组件有多种类型，不同类型的根组件布局组成不同。</p> <p><span><img height="549.2235000000001" originheight="2258" originwidth="1093" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162902.92907225344009081431132019930882:50001231000000:2800:693ABBC83EEE0A39598F28ED2E3777D12A8A129310661CADCF43D9781906D087.png" title="点击放大" width="266"></span></p> <p>例如以下示例中，新闻列表的内容列表页，根据展示类型的不同，可分别展示包含单张图片、三张图片、视频的内容NewsContent。</p> <p><strong>反例</strong></p> <div _ngcontent-hew-c106="" class="highlight-div"><div _ngcontent-hew-c106="" class="highlight-div-header"><div _ngcontent-hew-c106="" class="highlight-div-header-left"><div _ngcontent-hew-c106="" class="handle-button expand-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hew-c106="" class="highlight-div-header-right"><div _ngcontent-hew-c106="" class="handle-button ai-button"></div><div _ngcontent-hew-c106="" class="handle-button line-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hew-c106="" class="handle-button theme-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hew-c106="" class="handle-button copy-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hew-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">List</span>() {</li><li>  <span class="hljs-title function_">LazyForEach</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">dataSource</span>, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">ItemData</span>) =&gt; {</li><li>    <span class="hljs-title function_">ListItem</span>() {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable">item</span>.<span class="hljs-keyword">type</span> === <span class="hljs-number">0</span>) { <span class="hljs-comment">// The root component of ListItem comes in various types.</span></li><li>        <span class="hljs-title function_">SingleImageNewsContent</span>({ <span class="hljs-variable">item</span>: <span class="hljs-title class_">item</span> })</li><li>      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">item</span>.<span class="hljs-keyword">type</span> === <span class="hljs-number">1</span>) {</li><li>        <span class="hljs-title function_">ThreeImageNewsContent</span>({ <span class="hljs-variable">item</span>: <span class="hljs-title class_">item</span> })</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-title function_">VideoNewsContent</span>({ <span class="hljs-variable">item</span>: <span class="hljs-title class_">item</span> })</li><li>      }</li><li>    }</li><li>  }, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">ItemData</span>) =&gt; <span class="hljs-variable">item</span>.<span class="hljs-variable">id</span>.<span class="hljs-title function_">toString</span>())</li><li>}</li></ol></pre></div></div> <div _ngcontent-hew-c106="" class="highlight-div"><div _ngcontent-hew-c106="" class="highlight-div-header"><div _ngcontent-hew-c106="" class="highlight-div-header-left"><div _ngcontent-hew-c106="" class="handle-button expand-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hew-c106="" class="highlight-div-header-right"><div _ngcontent-hew-c106="" class="handle-button ai-button"></div><div _ngcontent-hew-c106="" class="handle-button line-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hew-c106="" class="handle-button theme-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hew-c106="" class="handle-button copy-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hew-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Different types of root component layouts are composed differently.</span></li><li><span class="hljs-variable">@Component</span></li><li>struct SingleImageNewsContent {} </li><li>
</li><li><span class="hljs-variable">@Component</span></li><li>struct ThreeImageNewsContent{}</li><li>
</li><li><span class="hljs-variable">@Component</span></li><li>struct VideoNewsContent{}</li></ol></pre></div></div> <p><strong>代码分析</strong></p> <p>ListItem列表项根据type的不同，通过if条件渲染对应的自定义组件，包含SingleImageNewsContent、ThreeImageNewsContent、VideoNewsContent，均未添加@Reusable装饰器。在处理长列表渲染时，如果未对组件进行复用，每次渲染都会创建新的组件实例，将会导致内存使用增加、渲染时间变长，造成界面卡顿。</p> <p><strong>优化建议</strong></p> <p>将不同类型的列表项封装的自定义组件添加@Reusable修饰。此方法虽可实现组件复用，但由于被复用的组件内部包含了单图、多图、视频、顶部标题、底部时间等多种子组件，导致复用粒度过粗，仍存在性能优化空间。建议参考正例二进行细粒度拆分，将不同类型的内容模块独立封装，以提升复用效率和渲染性能。</p> <p><strong>正例</strong>一</p> <div class="screenLinkPre"><div _ngcontent-hew-c106="" class="highlight-div"><div _ngcontent-hew-c106="" class="highlight-div-header"><div _ngcontent-hew-c106="" class="highlight-div-header-left"><div _ngcontent-hew-c106="" class="handle-button expand-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hew-c106="" class="highlight-div-header-right"><div _ngcontent-hew-c106="" class="handle-button ai-button"></div><div _ngcontent-hew-c106="" class="handle-button line-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hew-c106="" class="handle-button theme-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hew-c106="" class="handle-button copy-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hew-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ComponentReuse/entry/src/main/ets/view/NoComponentReuseSceneTwoSubPositiveExample.ets#L29-L100" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">@Reusable</span></li><li><span class="hljs-variable">@Component</span></li><li>struct SingleImageNewsContent {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li><span class="hljs-variable">@Reusable</span></li><li><span class="hljs-variable">@Component</span></li><li>struct ThreeImageNewsContent {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li><span class="hljs-variable">@Reusable</span></li><li><span class="hljs-variable">@Component</span></li><li>struct VideoNewsContent {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ComponentReuse/entry/src/main/ets/view/NoComponentReuseSceneTwoSubPositiveExample.ets#L29-L100" target="_blank">NoComponentReuseSceneTwoSubPositiveExample.ets</a></div></div></div></div> <p><strong>正例二</strong></p> <p>为了更灵活地复用和更新局部内容，通常需要降低复用粒度，即给组件内部需要复用的子组件做复用，而不是组件自身，避免全量更新。通过降低复用粒度，可以显著提升列表滚动的流畅度，减少内存占用。具体可参考<a href="/consumer/cn/doc/best-practices/bpta-component-reuse-issue-diagnosis-and-analysis#li15198164511246">场景三：列表项内子组件可拆分组合</a>。</p> <p></p> </li><li id="li15198164511246"><a name="ZH-CN_TOPIC_0000002522906665__li15198164511246"></a><a name="li15198164511246"></a><strong>场景三</strong><strong>：</strong><strong>列表项内子组件可拆分组合</strong><p>ListItem没有根组件，通过不同子组件相互组合，形成多种布局形态。</p> <p><span><img height="549.2235000000001" originheight="2258" originwidth="1093" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162903.69698035162278624140464362839639:50001231000000:2800:2F17C44A572A1A314934F076D884CE3839C2EF632CCBD349A7353C4BEC39D235.png" title="点击放大" width="266"></span></p> <p>例如以下示例中，ListItem列表项根据type的不同，其子组件包含了顶部文本元素、底部的文本元素，根据展示类型的不同，中间可分别展示单张图片、三张图片、视频。</p> <p><strong>反例</strong></p> <div _ngcontent-hew-c106="" class="highlight-div"><div _ngcontent-hew-c106="" class="highlight-div-header"><div _ngcontent-hew-c106="" class="highlight-div-header-left"><div _ngcontent-hew-c106="" class="handle-button expand-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hew-c106="" class="highlight-div-header-right"><div _ngcontent-hew-c106="" class="handle-button ai-button"></div><div _ngcontent-hew-c106="" class="handle-button line-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hew-c106="" class="handle-button theme-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hew-c106="" class="handle-button copy-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hew-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// ...</span></li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-title function_">itemBuilderVideo</span>(<span class="hljs-params">item: ItemData</span>) {</li><li>  <span class="hljs-title class_">Column</span>() {</li><li>    <span class="hljs-comment">// By combining different subcomponents, various layout forms can be created.</span></li><li>    <span class="hljs-title class_">TopView</span>({ <span class="hljs-attr">item</span>: item })</li><li>    <span class="hljs-title class_">MiddleVideoView</span>({ <span class="hljs-attr">item</span>: item })</li><li>    <span class="hljs-title class_">BottomView</span>({ <span class="hljs-attr">item</span>: item })</li><li>  }</li><li>}</li><li><span class="hljs-comment">// ...</span></li><li><span class="hljs-title class_">List</span>() {</li><li>  <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataSource</span>, <span class="hljs-function">(<span class="hljs-params">item: ItemData</span>) =&gt;</span> {</li><li>    <span class="hljs-title class_">ListItem</span>() {</li><li>      <span class="hljs-comment">// ListItem does not have a root component.</span></li><li>      <span class="hljs-keyword">if</span> (item.<span class="hljs-property">type</span> === <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">itemBuilderSingleImage</span>(item)</li><li>      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.<span class="hljs-property">type</span> === <span class="hljs-number">1</span>) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">itemBuilderThreeImage</span>(item)</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">itemBuilderVideo</span>(item)</li><li>      }</li><li>    }</li><li>  }, <span class="hljs-function">(<span class="hljs-params">item: ItemData</span>) =&gt;</span> item.<span class="hljs-property">id</span>.<span class="hljs-title function_">toString</span>())</li><li>}</li><li><span class="hljs-comment">// ...</span></li></ol></pre></div></div> <div _ngcontent-hew-c106="" class="highlight-div"><div _ngcontent-hew-c106="" class="highlight-div-header"><div _ngcontent-hew-c106="" class="highlight-div-header-left"><div _ngcontent-hew-c106="" class="handle-button expand-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hew-c106="" class="highlight-div-header-right"><div _ngcontent-hew-c106="" class="handle-button ai-button"></div><div _ngcontent-hew-c106="" class="handle-button line-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hew-c106="" class="handle-button theme-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hew-c106="" class="handle-button copy-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hew-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">@Component</span></li><li>struct TopView {}</li><li>
</li><li><span class="hljs-variable">@Component</span></li><li>struct MiddleVideoView {}</li><li>
</li><li><span class="hljs-variable">@Component</span></li><li>struct BottomView {}</li></ol></pre></div></div> <p><strong>代码分析</strong></p> <p>列表项ListItem根据if-else做@Builder构建函数的条件渲染，其自定义组件TopView、MiddleVideoView、BottomView未添加@Reusable装饰器。在处理长列表渲染时，如果未对组件进行复用，每次渲染都会创建新的组件实例，将会导致内存使用增加、渲染时间变长，造成界面卡顿。</p> <p><strong>优化建议</strong></p> <p>由于@Reusable装饰器需与自定义组件配合使用，可将@Builder内的自定义组件添加@Reusable修饰。通过将不同类型的列表项分别封装为独立的自定义组件并应用@Reusable，实现更细粒度的复用，从而提升组件复用效率与整体渲染性能。</p> <p><strong>正例</strong></p> <div class="screenLinkPre"><div _ngcontent-hew-c106="" class="highlight-div"><div _ngcontent-hew-c106="" class="highlight-div-header"><div _ngcontent-hew-c106="" class="highlight-div-header-left"><div _ngcontent-hew-c106="" class="handle-button expand-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hew-c106="" class="highlight-div-header-right"><div _ngcontent-hew-c106="" class="handle-button ai-button"></div><div _ngcontent-hew-c106="" class="handle-button line-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hew-c106="" class="handle-button theme-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hew-c106="" class="handle-button copy-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hew-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ComponentReuse/entry/src/main/ets/view/NoComponentReuseSceneThreePositiveExample.ets#L56-L120" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">@Reusable</span></li><li><span class="hljs-variable">@Component</span></li><li>struct TopView {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li><span class="hljs-variable">@Reusable</span></li><li><span class="hljs-variable">@Component</span></li><li>struct BottomView {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li><span class="hljs-variable">@Reusable</span></li><li><span class="hljs-variable">@Component</span></li><li>struct MiddleSingleImageView {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li><span class="hljs-variable">@Reusable</span></li><li><span class="hljs-variable">@Component</span></li><li>struct MiddleThreeImageView {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li><span class="hljs-variable">@Reusable</span></li><li><span class="hljs-variable">@Component</span></li><li>struct MiddleVideoView {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ComponentReuse/entry/src/main/ets/view/NoComponentReuseSceneThreePositiveExample.ets#L56-L120" target="_blank">NoComponentReuseSceneThreePositiveExample.ets</a></div></div></div></div> </li></ul> <div class="tiledSection"><h3 id="section1746114435412">组件复用使用不当<i class="anchor-icon anchor-icon-link" anchorid="section1746114435412" tips="复制节点链接"></i></h3></div> <ul><li><strong>场景一：父组件未使用复用，子组件使用复用</strong><p><span><img height="549.2235000000001" originheight="2258" originwidth="1093" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162903.30572914034452457253069296102249:50001231000000:2800:868FBC030DF45F1C2E8893D8CBDEA3E2C76E211FB581E1740B2EF5391619F285.png" title="点击放大" width="266"></span></p> <p>例如以下示例中，NewsContent是新闻列表的内容组件，其内部包含三个子组件：顶部的文本，中部的图片以及底部的发布时间。</p> <p><strong>反例</strong></p> <div _ngcontent-hew-c106="" class="highlight-div"><div _ngcontent-hew-c106="" class="highlight-div-header"><div _ngcontent-hew-c106="" class="highlight-div-header-left"><div _ngcontent-hew-c106="" class="handle-button expand-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hew-c106="" class="highlight-div-header-right"><div _ngcontent-hew-c106="" class="handle-button ai-button"></div><div _ngcontent-hew-c106="" class="handle-button line-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hew-c106="" class="handle-button theme-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hew-c106="" class="handle-button copy-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hew-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Component</span></li><li>struct NewsContent {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-keyword">@Builder</span></li><li>  myBuilder(<span class="hljs-attribute">item</span>: ItemData) {</li><li>    <span class="hljs-built_in">TopView</span>({ item: item })</li><li>    <span class="hljs-built_in">MiddleSingleImageView</span>({ item: item })</li><li>    <span class="hljs-built_in">BottomView</span>({ item: item })</li><li>  }</li><li>
</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-built_in">Column</span>() {</li><li>      this<span class="hljs-selector-class">.myBuilder</span>(this.item)</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">@Reusable</span></li><li><span class="hljs-keyword">@Component</span></li><li>struct TopView {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre></div></div> <p><strong>代码分析</strong></p> <p>父组件NewsContent未使用组件复用，TopView等子组件使用了组件复用。当父组件未使用复用，但子组件使用了复用时，会引发复用机制失效的问题。由于父组件在离开屏幕或被销毁时都需要重新创建，其挂载的子组件及对应的复用池也随之销毁，子组件的复用池无法被有效保留和利用，导致子组件也被迫进行重建，失去了复用的意义。</p> <p><strong>优化建议</strong></p> <p>提升复用层级，在父组件启用复用，给父组件NewsContent添加@Reusable装饰器，取消子组件复用。</p> <p><strong>正例</strong></p> <p>以下为简单示例参考。若通过if-else条件渲染不同子组件，例如包含单图、三图和视频三种形式，可参考<a href="/consumer/cn/doc/best-practices/bpta-component-reuse-issue-diagnosis-and-analysis#section10228161101910">未使用组件复用</a>的<a href="/consumer/cn/doc/best-practices/bpta-component-reuse-issue-diagnosis-and-analysis#li1441155123913">场景二：列表项结构类型不同</a>和<a href="/consumer/cn/doc/best-practices/bpta-component-reuse-issue-diagnosis-and-analysis#li15198164511246">场景三：列表项内子组件可拆分组合</a>进行优化。</p> <div class="screenLinkPre"><div _ngcontent-hew-c106="" class="highlight-div"><div _ngcontent-hew-c106="" class="highlight-div-header"><div _ngcontent-hew-c106="" class="highlight-div-header-left"><div _ngcontent-hew-c106="" class="handle-button expand-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hew-c106="" class="highlight-div-header-right"><div _ngcontent-hew-c106="" class="handle-button ai-button"></div><div _ngcontent-hew-c106="" class="handle-button line-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hew-c106="" class="handle-button theme-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hew-c106="" class="handle-button copy-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hew-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ComponentReuse/entry/src/main/ets/view/NoComponentReuseSceneOnePositiveExample.ets#L23-L46" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">@Reusable</span></li><li><span class="hljs-variable">@Component</span></li><li>struct NewsContent {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ComponentReuse/entry/src/main/ets/view/NoComponentReuseSceneOnePositiveExample.ets#L23-L46" target="_blank">NoComponentReuseSceneOnePositiveExample.ets</a></div></div></div></div> <p></p> </li><li><strong>场景二：复用嵌套</strong><p><span><img height="549.2235000000001" originheight="2258" originwidth="1093" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162903.30489507292309590934569688804898:50001231000000:2800:3C5125938240C9A5F90FAB1532B2E7CEB4B6EE356C01EE052826893DADCC8AF9.png" title="点击放大" width="266"></span></p> <p>例如以下示例中，NewsContent是新闻列表的内容组件，其内部包含三个子组件：顶部的文本，中部的图片以及底部的发布时间。</p> <p><strong>反例</strong></p> <div _ngcontent-hew-c106="" class="highlight-div"><div _ngcontent-hew-c106="" class="highlight-div-header"><div _ngcontent-hew-c106="" class="highlight-div-header-left"><div _ngcontent-hew-c106="" class="handle-button expand-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hew-c106="" class="highlight-div-header-right"><div _ngcontent-hew-c106="" class="handle-button ai-button"></div><div _ngcontent-hew-c106="" class="handle-button line-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hew-c106="" class="handle-button theme-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hew-c106="" class="handle-button copy-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hew-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Reusable</span></li><li><span class="hljs-keyword">@Component</span></li><li>struct NewsContent {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-keyword">@Builder</span></li><li>  myBuilder(<span class="hljs-attribute">item</span>: ItemData) {</li><li>    <span class="hljs-built_in">TopView</span>({ item: item })</li><li>    <span class="hljs-built_in">MiddleSingleImageView</span>({ item: item })</li><li>    <span class="hljs-built_in">BottomView</span>({ item: item })</li><li>  }</li><li>
</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-built_in">Column</span>() {</li><li>      this<span class="hljs-selector-class">.myBuilder</span>(this.item)</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">@Reusable</span></li><li><span class="hljs-keyword">@Component</span></li><li>struct TopView {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li><span class="hljs-comment">// ...</span></li></ol></pre></div></div> <p><strong>代码分析</strong></p> <p>父组件NewsContent使用了组件复用，其子组件（如TopView等）也各自启用了组件复用，形成“复用嵌套”结构。在此模式下，虽然每个复用组件被封装为独立的自定义组件并支持整体复用，但当子组件自身内容更新时，仍会触发其独立的复用机制。由于子组件的复用行为受外层组件复用状态的制约，难以充分发挥复用优势。当不同类型的复用组件内容差异较大时，仍会发生频繁的创建与销毁，导致性能开销增加，复用效果大打折扣。</p> <p><strong>优化建议</strong></p> <p>在父组件已启用复用的前提下，若子组件内容简单，应取消子组件自身的复用，由父组件整体控制复用。避免“复用中的复用”，防止因内层复用ID不匹配导致的重建。</p> <p><strong>正例</strong></p> <p>以下为简单示例参考。若通过if-else条件渲染不同子组件，例如包含单图、三图和视频三种形式，可参考<a href="/consumer/cn/doc/best-practices/bpta-component-reuse-issue-diagnosis-and-analysis#section10228161101910">未使用组件复用</a>的<a href="/consumer/cn/doc/best-practices/bpta-component-reuse-issue-diagnosis-and-analysis#li1441155123913">场景二：列表项结构类型不同</a>和<a href="/consumer/cn/doc/best-practices/bpta-component-reuse-issue-diagnosis-and-analysis#li15198164511246">场景三：列表项内子组件可拆分组合</a>进行优化。</p> <div class="screenLinkPre"><div _ngcontent-hew-c106="" class="highlight-div"><div _ngcontent-hew-c106="" class="highlight-div-header"><div _ngcontent-hew-c106="" class="highlight-div-header-left"><div _ngcontent-hew-c106="" class="handle-button expand-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hew-c106="" class="highlight-div-header-right"><div _ngcontent-hew-c106="" class="handle-button ai-button"></div><div _ngcontent-hew-c106="" class="handle-button line-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hew-c106="" class="handle-button theme-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hew-c106="" class="handle-button copy-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hew-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ComponentReuse/entry/src/main/ets/view/NoComponentReuseSceneOnePositiveExample.ets#L50-L85" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">@Component</span></li><li>struct TopView {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li><span class="hljs-variable">@Component</span></li><li>struct BottomView {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li><span class="hljs-variable">@Component</span></li><li>struct MiddleSingleImageView {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ComponentReuse/entry/src/main/ets/view/NoComponentReuseSceneOnePositiveExample.ets#L50-L85" target="_blank">NoComponentReuseSceneOnePositiveExample.ets</a></div></div></div></div> <p></p> </li><li><strong>场景三：</strong><strong>reuseId分类过粗</strong><p><span><img height="549.2235000000001" originheight="2258" originwidth="1093" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162903.51474456441513619911852029755015:50001231000000:2800:048FA1A1603724F16F14A6765D0F3FEE308994B257E773D2166BEDF6B501CA64.png" title="点击放大" width="266"></span></p> <p>如以下示例中，NewsContent是新闻列表的内容组件，其内部包含三个子组件：顶部文本、底部发布时间，根据展示类型不同，中部可展示单张图片、三张图片或视频。</p> <p><strong>反例</strong></p> <div _ngcontent-hew-c106="" class="highlight-div"><div _ngcontent-hew-c106="" class="highlight-div-header"><div _ngcontent-hew-c106="" class="highlight-div-header-left"><div _ngcontent-hew-c106="" class="handle-button expand-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hew-c106="" class="highlight-div-header-right"><div _ngcontent-hew-c106="" class="handle-button ai-button"></div><div _ngcontent-hew-c106="" class="handle-button line-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hew-c106="" class="handle-button theme-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hew-c106="" class="handle-button copy-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hew-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// NewsListPage</span></li><li><span class="hljs-title function_">List</span>() {</li><li>  <span class="hljs-title function_">LazyForEach</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">dataSource</span>, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">ItemData</span>) =&gt; {</li><li>    <span class="hljs-title function_">ListItem</span>() {</li><li>      <span class="hljs-title function_">NewsContent</span>({ <span class="hljs-variable">item</span>: <span class="hljs-title class_">item</span> })</li><li>    }</li><li>  }, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">ItemData</span>) =&gt; <span class="hljs-variable">item</span>.<span class="hljs-variable">id</span>.<span class="hljs-title function_">toString</span>())</li><li>}</li></ol></pre></div></div> <div _ngcontent-hew-c106="" class="highlight-div"><div _ngcontent-hew-c106="" class="highlight-div-header"><div _ngcontent-hew-c106="" class="highlight-div-header-left"><div _ngcontent-hew-c106="" class="handle-button expand-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hew-c106="" class="highlight-div-header-right"><div _ngcontent-hew-c106="" class="handle-button ai-button"></div><div _ngcontent-hew-c106="" class="handle-button line-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hew-c106="" class="handle-button theme-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hew-c106="" class="handle-button copy-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hew-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">@Reusable</span></li><li><span class="hljs-variable">@Component</span></li><li>struct NewsContent {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-variable">@Builder</span></li><li>  <span class="hljs-built_in">myBuilder</span>(<span class="hljs-attribute">item</span>: ItemData) {</li><li>    <span class="hljs-selector-tag">TopView</span>({ item: item })</li><li>    <span class="hljs-selector-tag">if</span> (item.type === <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-selector-tag">MiddleSingleImageView</span>({ item: item })</li><li>    } else if (item.type === <span class="hljs-number">1</span>) {</li><li>      <span class="hljs-selector-tag">MiddleThreeImageView</span>({ item: item })</li><li>    } else {</li><li>      <span class="hljs-selector-tag">MiddleVideoView</span>({ item: item })</li><li>    }</li><li>    <span class="hljs-built_in">BottomView</span>({ <span class="hljs-attribute">item</span>: item })</li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre></div></div> <p><strong>代码分析</strong></p> <p>父组件NewsContent虽启用了组件复用，但未显示设置reuseId，导致其默认复用id为其组件名NewsContent。由于未根据if-else分支中的不同类型（单图、三图、视频）设置差异化的reuseId，导致复用分类粒度过粗。当多个结构或内容差异较大的组件实例共用相同或过于笼统的reuseId时，复用池无法准确区分不同类型，从而发生错误复用或频繁创建。</p> <p><strong>优化建议</strong></p> <p>应根据组件的结构、布局和特征，为不同类别分别配置独立稳定的reuseId，通过设置精细化、语义化的reuseId，让复用机制真正发挥性能优势，同时保障渲染正确性。</p> <p><strong>正例</strong></p> <div class="screenLinkPre"><div _ngcontent-hew-c106="" class="highlight-div"><div _ngcontent-hew-c106="" class="highlight-div-header"><div _ngcontent-hew-c106="" class="highlight-div-header-left"><div _ngcontent-hew-c106="" class="handle-button expand-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hew-c106="" class="highlight-div-header-right"><div _ngcontent-hew-c106="" class="handle-button ai-button"></div><div _ngcontent-hew-c106="" class="handle-button line-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hew-c106="" class="handle-button theme-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hew-c106="" class="handle-button copy-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hew-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ComponentReuse/entry/src/main/ets/view/NoComponentReuseSceneTwoPositiveExample.ets#L12-L19" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">List</span>() {</li><li>  <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataSource</span>, <span class="hljs-function">(<span class="hljs-params">item: ItemData</span>) =&gt;</span> {</li><li>    <span class="hljs-title class_">ListItem</span>() {</li><li>      <span class="hljs-title class_">NewsContent</span>({ <span class="hljs-attr">item</span>: item }).<span class="hljs-title function_">reuseId</span>(<span class="hljs-string">`<span class="hljs-subst">${item.<span class="hljs-keyword">type</span>}</span>`</span>)</li><li>    }</li><li>  }, <span class="hljs-function">(<span class="hljs-params">item: ItemData</span>) =&gt;</span> item.<span class="hljs-property">id</span>.<span class="hljs-title function_">toString</span>())</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ComponentReuse/entry/src/main/ets/view/NoComponentReuseSceneTwoPositiveExample.ets#L12-L19" target="_blank">NoComponentReuseSceneTwoPositiveExample.ets</a></div></div></div></div> </li></ul> <div class="tiledSection"><h3 id="section511719116258">reuseId分类过细<i class="anchor-icon anchor-icon-link" anchorid="section511719116258" tips="复制节点链接"></i></h3><p>下图中简单示意了常见的列表效果，显示区域中有三种不同类型的列表项，真实场景中还会有更多类型的列表项，复杂场景可能会多达几十种，此时如果严格按照列表项类型分类，会造成分类过细，滑动时不断有新的类型元素进入可视区，创建新的类型列表项，此时就容易发生滑动卡顿。</p> <p><span><img height="589.5225" originheight="709" originwidth="629" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162903.90265977743332222152179926183843:50001231000000:2800:E5A4C551B8A26EB9E82077693573E264E4A89234FBCCB08EBBD8569CEF489322.png" title="点击放大" width="523.6875"></span></p> <p>例如以下示例中，NewsContent是新闻列表的内容组件，其内部包含多种子组件：顶部文本、底部发布时间，根据展示类型不同，中部可展示文本、单张图片、三张图片、视频等。</p> <p><strong>反例</strong></p> <div _ngcontent-hew-c106="" class="highlight-div"><div _ngcontent-hew-c106="" class="highlight-div-header"><div _ngcontent-hew-c106="" class="highlight-div-header-left"><div _ngcontent-hew-c106="" class="handle-button expand-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hew-c106="" class="highlight-div-header-right"><div _ngcontent-hew-c106="" class="handle-button ai-button"></div><div _ngcontent-hew-c106="" class="handle-button line-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hew-c106="" class="handle-button theme-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hew-c106="" class="handle-button copy-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hew-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// NewsListPage</span></li><li><span class="hljs-title class_">List</span>() {</li><li>  <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataSource</span>, <span class="hljs-function">(<span class="hljs-params">item: ItemData</span>) =&gt;</span> {</li><li>    <span class="hljs-title class_">ListItem</span>() {</li><li>      <span class="hljs-title class_">NewsContent</span>({ <span class="hljs-attr">item</span>: item }).<span class="hljs-title function_">reuseId</span>(<span class="hljs-string">`<span class="hljs-subst">${item.<span class="hljs-keyword">type</span>}</span>`</span>)</li><li>    }</li><li>  }, <span class="hljs-function">(<span class="hljs-params">item: ItemData</span>) =&gt;</span> item.<span class="hljs-property">id</span>.<span class="hljs-title function_">toString</span>())</li><li>}</li></ol></pre></div></div> <div _ngcontent-hew-c106="" class="highlight-div"><div _ngcontent-hew-c106="" class="highlight-div-header"><div _ngcontent-hew-c106="" class="highlight-div-header-left"><div _ngcontent-hew-c106="" class="handle-button expand-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hew-c106="" class="highlight-div-header-right"><div _ngcontent-hew-c106="" class="handle-button ai-button"></div><div _ngcontent-hew-c106="" class="handle-button line-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hew-c106="" class="handle-button theme-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hew-c106="" class="handle-button copy-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hew-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Reusable</span></li><li><span class="hljs-keyword">@Component</span></li><li>struct NewsContent {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-keyword">@Builder</span></li><li>  myBuilder(<span class="hljs-attribute">item</span>: ItemData) {</li><li>    <span class="hljs-built_in">TopView</span>({ item: item })</li><li>    if (item.type === <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-built_in">MiddleTextView</span>({ item: item })</li><li>    } else if (item.type === <span class="hljs-number">1</span>) {</li><li>      <span class="hljs-built_in">MiddleTextNoTitleView</span>({ item: item })</li><li>    } else if (item.type === <span class="hljs-number">2</span>) {</li><li>      <span class="hljs-built_in">MiddleSingleImageView</span>({ item: item })</li><li>    } else if (item.type === <span class="hljs-number">3</span>) {</li><li>      <span class="hljs-built_in">MiddleThreeImageView</span>({ item: item })</li><li>    } else if (item.type === <span class="hljs-number">4</span>) {</li><li>      <span class="hljs-built_in">MiddleVideoView</span>({ item: item })</li><li>    } else if (item.type === <span class="hljs-number">5</span>) {</li><li>      <span class="hljs-comment">// ...</span></li><li>    } else {</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-built_in">BottomView</span>({ item: item })</li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre></div></div> <p><strong>代码分析</strong></p> <p>每个布局结构有差异的列表项都设置有独立的reuseId，每种列表项都独立实现，滑动过程中，模板命中率极低，易造成卡顿。当reuseId设置过于细化，例如，为每个数据项分配唯一ID，会导致复用缓存池被过度拆分，形成多个小型缓存桶，降低组件复用率。</p> <p><strong>优化建议</strong></p> <p>将结构相近的列表项合并到一个类型中，以提升复用的命中率，在上述例子中，MiddleTextView、MiddleTextNoTitleView列表项仅存在标题的差异，因此可以考虑合并成相同类型的模板MiddleTextView，通过visibility显隐属性进行效果切换。</p> <p>常见的模板可合并因素如下：</p> <ul><li>少量内容元素显隐差异（需平均新建时的耗时开销）</li><li>布局差异，如横向布局切换成纵向布局，可考虑通过相对布局更新布局条件</li><li>文本内容/图片内容/样式效果差异</li></ul> <p>当上述问题无法适用时，可以考虑进一步拆解复用组件颗粒度，通过使用全局复用池实现跨列表项的复用。</p> <p><strong>正例</strong></p> <div class="screenLinkPre"><div _ngcontent-hew-c106="" class="highlight-div"><div _ngcontent-hew-c106="" class="highlight-div-header"><div _ngcontent-hew-c106="" class="highlight-div-header-left"><div _ngcontent-hew-c106="" class="handle-button expand-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hew-c106="" class="highlight-div-header-right"><div _ngcontent-hew-c106="" class="handle-button ai-button"></div><div _ngcontent-hew-c106="" class="handle-button line-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hew-c106="" class="handle-button theme-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hew-c106="" class="handle-button copy-button"><div _ngcontent-hew-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hew-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ComponentReuse/entry/src/main/ets/view/ReuseIdClassificationIsTooDetailedScenePositiveExample.ets#L103-L117" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Component</span></li><li>struct MiddleTextView {</li><li>  <span class="hljs-keyword">@ObjectLink</span> <span class="hljs-attribute">item</span>: ItemData;</li><li>
</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-built_in">Column</span>() {</li><li>      Text('title')</li><li>        <span class="hljs-selector-class">.visibility</span>(this.item.isShowTitle) <span class="hljs-comment">// Switch effects through the visibility property.</span></li><li>      Text()</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ComponentReuse/entry/src/main/ets/view/ReuseIdClassificationIsTooDetailedScenePositiveExample.ets#L103-L117" target="_blank">ReuseIdClassificationIsTooDetailedScenePositiveExample.ets</a></div></div></div></div> </div> <div class="tiledSection"><h3 id="section28421718182916">复用缓存池为空<i class="anchor-icon anchor-icon-link" anchorid="section28421718182916" tips="复制节点链接"></i></h3><p>当一个已启用复用的自定义组件仍触发创建操作，表明其未从复用缓存池中成功获取实例，复用未能生效。这意味着缓存池中不存在可用的该类型组件实例，常见的情况列举如下：</p> <ul><li><strong>列表的首次滑动</strong><p>在列表首次滑动过程中，复用缓存池为空属于正常现象。这是因为在初始渲染时，所有可见组件均需通过新建（BuildItem）方式创建组件实例，尚未有组件被移出屏幕并回收至缓存池。只有当列表项滚动至可视区域后，系统才会将其放入复用缓存池；后续新进入可视区域的列表项将优先从缓存池中获取并复用（BuildRecycle），从而提升性能。</p> </li><li><strong>列表滑动速度突然变快</strong><p>当列表项快速滑动时，若观察到大量组件以BuildItem方式创建，且复用行为（BuildRecycle）显著减少或消失，表明复用机制未能及时响应高频滚动事件。在持续高速滑动中频繁新建组件，可能导致内存激增和页面卡顿。例如，初始以一帧一个ListItem的速度滑动列表，每帧有一个ListItem划出屏幕进入缓存池，有一个ListItem被复用，形成动态平衡。若此时突然加速滑动，变为一帧两个ListItem，原先缓存池中的缓存仅能满足一帧复用一个ListItem的需求，因此会复用一个ListItem后再创建一个。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表1 </b>快速滑动可能出现的问题</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.8.3.2.3.2.4.1.1" valign="top" width="33.33333333333333%"><p>问题</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.3.2.3.2.4.1.2" valign="top" width="33.33333333333333%"><p>原因</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.3.2.3.2.4.1.3" valign="top" width="33.33333333333333%"><p>表现</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>回收滞后</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>滚动速度过快，系统来不及回收移出的组件</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>缓存池无法填充，新项只能通过新建（BuildItem）方式进行创建</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>缓存池溢出</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>短时间内产生大量待回收项，超出缓存容量</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>旧实例被丢弃，新项仍需重建</p> </td> </tr>  </tbody></table></div> </div> </li></ul> </div> <div class="tiledSection"><h2 id="section297151813529">组件复用后的卡顿问题<i class="anchor-icon anchor-icon-link" anchorid="section297151813529" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section856017165417" class="firsth2">复用过程函数耗时长<i class="anchor-icon anchor-icon-link" anchorid="section856017165417" tips="复制节点链接"></i></h3><p>在复用过程中会触发应用复用生命周期回调和内容刷新，若复用成功但仍有丢帧时，优先检查复用过程中是否存在耗时函数，并对耗时函数进行性能优化，以快速实现性能优化。</p> </div> <p><strong>典型Trace分析</strong></p> <p><span><img height="522.8762" originheight="469" originwidth="714" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162903.56306334148615096844491151694398:50001231000000:2800:15E7E57B9EE23CDB5EAAF1F6249984CAA20043253DD4A0F2AEADC46EBCC90747.png" title="点击放大" width="798"></span></p> <p>上述案例中，BuildRecycle是典型的复用成功回调，此处执行耗时过长造成了应用丢帧，虽然当前操作在帧间，但是长耗时仍然会影响下一帧的执行。通过耗时函数检测，可以定位到具体的耗时方法。</p> <p><span><img height="364.80570000000006" originheight="413" originwidth="900" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162903.28518389709102763351535708316167:50001231000000:2800:DBB4DFC59FA69C6A4B06F2F8857469C32AF27BA5C7F64F0BB045F78F6EB3B260.png" title="点击放大" width="798"></span></p> <p>这个场景下识别到Index文件中有stringify耗时长，此时可迅速定位到问题点，通过逻辑优化或者异步化方案进行优化。</p> <p><strong>异步化方案</strong></p> <p><a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-app-concurrency-design" target="_blank">应用并发设计</a></p> <div class="tiledSection"><h3 id="section26691823175418">复用过程刷新耗时长<i class="anchor-icon anchor-icon-link" anchorid="section26691823175418" tips="复制节点链接"></i></h3><p>复用过程的更新与状态管理的标准更新一致，可参考文档：<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-status-management" target="_blank">状态管理最佳实践</a>。</p> </div> <div class="tiledSection"><h2 id="section683033154013">总结<i class="anchor-icon anchor-icon-link" anchorid="section683033154013" tips="复制节点链接"></i></h2><p>开发者可通过AppAnalyzer对应用的组件复用问题进行诊断，结合本文介绍的未使用组件复用、复用使用不当、reuseId分类过细等典型场景，参考相应的代码分析与优化建议，针对性地对组件复用问题进行性能优化。需要注意，本文列举的场景仅是对实际开发中复杂问题的抽象归纳，真实开发业务可能更加多样化。因此，开发者应灵活运用文中方案，合理组合策略，以实现高效稳定的组件复用，提升组件渲染性能。</p> </div> </div> <div></div></div>