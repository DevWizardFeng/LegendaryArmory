<h1 _ngcontent-eex-c119="" class="doc-title ng-star-inserted" title="组件封装"> 组件封装 </h1>

<div _ngcontent-eex-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section19933190185116">概述<i class="anchor-icon anchor-icon-link" anchorid="section19933190185116" tips="复制节点链接"></i></h2></div> <p>在ArkUI应用开发中，常常需要对UI组件或样式进行封装。封装是为了复用相同或相似的代码功能，提高开发效率，同时也便于工程维护和团队协作。</p> <p>通常组件封装包含以下典型场景：</p> <ul><li><a href="/consumer/cn/doc/best-practices/bpta-ui-component-encapsulation#section16593152733118">组件公共样式封装</a></li><li><a href="/consumer/cn/doc/best-practices/bpta-ui-component-encapsulation#section299514487282">自定义组件封装</a></li><li><a href="/consumer/cn/doc/best-practices/bpta-ui-component-encapsulation#section178216212105">组件工厂类封装</a></li></ul> <div class="tiledSection"><h2 id="section16593152733118">组件公共样式封装<i class="anchor-icon anchor-icon-link" anchorid="section16593152733118" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section15389168125310" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section15389168125310" tips="复制节点链接"></i></h3></div> <p>在开发不同的业务功能时，可能需要使用相同样式的组件。例如，登录页面的登录按钮与购物页面的结算按钮，二者在同一应用中且表示确认操作，可能会采用相同的UI样式。这时可以抽取按钮Button组件的公共样式，封装后实现全局复用。下图是一个在默认态、按压态两种不同情况下的Button按钮。</p> <p><span><img originheight="123" originwidth="543" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162900.70273919881793093789223085882089:50001231000000:2800:5B24F9EDD39C174F73B60104B82D0C631C2D3648FB3B09D1AB1D58DBF2AD2DBD.png" width="543" height="123"></span></p> <div class="tiledSection"><h3 id="section111601214105315">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section111601214105315" tips="复制节点链接"></i></h3></div> <p>组件的公共样式通过设置组件的属性实现，ArkUI可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-user-defined-extension-attributemodifier" target="_blank">AttributeModifier属性修改器</a>，将属性封装在同一个AttributeModifier实现类中，在需要复用样式的组件中应用AttributeModifier实例对象。</p> <div class="tiledSection"><h3 id="section59261119125319">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section59261119125319" tips="复制节点链接"></i></h3></div> <ol><li><span>提供方定义AttributeModifier接口的实现类，封装公共样式属性。</span><p></p><div class="screenLinkPre"><div _ngcontent-eex-c106="" class="highlight-div"><div _ngcontent-eex-c106="" class="highlight-div-header"><div _ngcontent-eex-c106="" class="highlight-div-header-left"><div _ngcontent-eex-c106="" class="handle-button expand-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eex-c106="" class="highlight-div-header-right"><div _ngcontent-eex-c106="" class="handle-button ai-button"></div><div _ngcontent-eex-c106="" class="handle-button line-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eex-c106="" class="handle-button theme-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eex-c106="" class="handle-button copy-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eex-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/ComponentEncapsulation/blob/master/entry/src/main/ets/pages/AttributeStylePage.ets#L18-L43" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// The provider creates a custom Class that implements the system's AttributeModifier interface.</span></li><li><span class="hljs-variable">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyButtonModifier</span> <span class="hljs-variable">implements</span> <span class="hljs-title class_">AttributeModifier</span>&lt;<span class="hljs-title class_">ButtonAttribute</span>&gt; {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">buttonType</span>: <span class="hljs-title class_">ButtonType</span> = <span class="hljs-variable">ButtonType</span>.<span class="hljs-variable">Normal</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>() {</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">applyNormalAttribute</span>(<span class="hljs-variable">instance</span>: <span class="hljs-title class_">ButtonAttribute</span>): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-variable">instance</span>.<span class="hljs-keyword">type</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">buttonType</span>);</li><li>    <span class="hljs-variable">instance</span>.<span class="hljs-title function_">width</span>(<span class="hljs-number">200</span>);</li><li>    <span class="hljs-variable">instance</span>.<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>);</li><li>    <span class="hljs-variable">instance</span>.<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>);</li><li>    <span class="hljs-variable">instance</span>.<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#0A59F7'</span>)</li><li>    <span class="hljs-variable">instance</span>.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#0D000000'</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">applyPressedAttribute</span>(<span class="hljs-variable">instance</span>: <span class="hljs-title class_">ButtonAttribute</span>): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-variable">instance</span>.<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#0A59F7'</span>)</li><li>    <span class="hljs-variable">instance</span>.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#26000000'</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">type</span>(<span class="hljs-keyword">type</span>: <span class="hljs-title class_">ButtonType</span>): <span class="hljs-title class_">MyButtonModifier</span> {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">buttonType</span> = <span class="hljs-keyword">type</span>;</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ComponentEncapsulation/blob/master/entry/src/main/ets/pages/AttributeStylePage.ets#L18-L43" target="_blank">AttributeStylePage.ets</a></div></div></div></div> <p></p></li><li><span>使用方创建AttributeModifier实例，将其作为参数传入到系统组件的attributeModifier()方法中，封装的样式会应用到该组件上。</span><p></p><div class="screenLinkPre"><div _ngcontent-eex-c106="" class="highlight-div"><div _ngcontent-eex-c106="" class="highlight-div-header"><div _ngcontent-eex-c106="" class="highlight-div-header-left"><div _ngcontent-eex-c106="" class="handle-button expand-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eex-c106="" class="highlight-div-header-right"><div _ngcontent-eex-c106="" class="handle-button ai-button"></div><div _ngcontent-eex-c106="" class="handle-button line-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eex-c106="" class="handle-button theme-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eex-c106="" class="handle-button copy-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eex-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/ComponentEncapsulation/blob/master/entry/src/main/ets/pages/AttributeStylePage.ets#L52-L72" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">AttributeStylePage</span> {</li><li>  modifier = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyButtonModifier</span>()</li><li>    .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>)</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Capsule Button'</span>)</li><li>          .<span class="hljs-title function_">attributeModifier</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">modifier</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: $r(<span class="hljs-string">'app.float.margin_top'</span>) })</li><li>      .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Start</span>)</li><li>      .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Center</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">title</span>(<span class="hljs-title function_">getResourceString</span>($r(<span class="hljs-string">'app.string.common_style_extract'</span>), <span class="hljs-variable language_">this</span>))</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ComponentEncapsulation/blob/master/entry/src/main/ets/pages/AttributeStylePage.ets#L52-L72" target="_blank">AttributeStylePage.ets</a></div></div></div></div> <div class="p"><div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>AttributeModifier应用在系统组件上，暂不支持修改自定义组件的属性。</p> <p>AttributeModifier实例可以跨文件导出复用，支持多态样式下的属性/事件修改。</p> <p>更多参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-user-defined-extension-attributemodifier#使用说明" target="_blank">AttributeModifier使用说明</a>。</p> </div></div></div> </div> <p></p></li></ol> <div class="tiledSection"><h2 id="section299514487282">自定义组件封装<i class="anchor-icon anchor-icon-link" anchorid="section299514487282" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section16962143565212" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section16962143565212" tips="复制节点链接"></i></h3><p>应用开发中，除了UI样式，布局、逻辑等也可能需要复用，这时可以考虑将相同功能或样式的UI内容封装成一个自定义组件。例如，下图是一个包含图片文字的自定义组件，由Image组件和Text组件纵向排列实现，其中Image和Text的样式可由使用方修改。</p> </div> <p><span><img height="553.0007" originheight="1027" originwidth="494" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162900.53317148870751103832837143643972:50001231000000:2800:858B6D23B1ADBAD790B579D21441A5D6CBFBC4EFD52D9D5108C666FEF7E64EB4.png" title="点击放大" width="266"></span></p> <div class="tiledSection"><h3 id="section898644916520">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section898644916520" tips="复制节点链接"></i></h3></div> <p>使用@Component封装<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-create-custom-components" target="_blank">自定义组件</a>，将不变的部分实现在组件内部，将可能发生变化的部分，使用参数变量暴露出去。</p> <p>当前场景下，添加变量设置子组件的attributeModifier()方法，外部使用方通过参数传入AttributeModifier实例，从而实现内部子组件的样式修改。</p> <div class="tiledSection"><h3 id="section18705185810525">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section18705185810525" tips="复制节点链接"></i></h3></div> <ol><li><span>提供方封装默认属性样式：分别实现Image组件和Text组件的AttributeModifier接口实现类，提供方法设置可能发生变化的属性，例如width、height等。</span><p></p><div class="screenLinkPre"><div _ngcontent-eex-c106="" class="highlight-div"><div _ngcontent-eex-c106="" class="highlight-div-header"><div _ngcontent-eex-c106="" class="highlight-div-header-left"><div _ngcontent-eex-c106="" class="handle-button expand-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eex-c106="" class="highlight-div-header-right"><div _ngcontent-eex-c106="" class="handle-button ai-button"></div><div _ngcontent-eex-c106="" class="handle-button line-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eex-c106="" class="handle-button theme-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eex-c106="" class="handle-button copy-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eex-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/ComponentEncapsulation/blob/master/entry/src/main/ets/view/CustomImageText.ets#L18-L54" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// The AttributeModifier interface implementation class for the Image component.</span></li><li>export <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomImageModifier</span> <span class="hljs-title">implements</span> <span class="hljs-title">AttributeModifier</span>&lt;<span class="hljs-type">ImageAttribute</span>&gt; {</li><li>  <span class="hljs-keyword">private</span> imageWidth: Length = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">private</span> imageHeight: Length = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-keyword">constructor</span>(width: Length, height: Length) {</li><li>    <span class="hljs-keyword">this</span>.imageWidth = width;</li><li>    <span class="hljs-keyword">this</span>.imageHeight = height;</li><li>  }</li><li>
</li><li>  width(width: Length) {</li><li>    <span class="hljs-keyword">this</span>.imageWidth = width;</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;</li><li>  }</li><li>
</li><li>  height(height: Length) {</li><li>    <span class="hljs-keyword">this</span>.imageHeight = height;</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;</li><li>  }</li><li>
</li><li>  applyNormalAttribute(instance: ImageAttribute): void {</li><li>    instance.width(<span class="hljs-keyword">this</span>.imageWidth);</li><li>    instance.height(<span class="hljs-keyword">this</span>.imageHeight);</li><li>    instance.borderRadius($r(<span class="hljs-string">'app.float.border_radius'</span>))</li><li>
</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// Text component's AttributeModifier interface implementation class.</span></li><li>export <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomTextModifier</span> <span class="hljs-title">implements</span> <span class="hljs-title">AttributeModifier</span>&lt;<span class="hljs-type">TextAttribute</span>&gt; {</li><li>  <span class="hljs-keyword">constructor</span>() {</li><li>  }</li><li>
</li><li>  applyNormalAttribute(instance: TextAttribute): void {</li><li>    instance.fontSize($r(<span class="hljs-string">'app.float.font_size_l'</span>));</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ComponentEncapsulation/blob/master/entry/src/main/ets/view/CustomImageText.ets#L18-L54" target="_blank">CustomImageText.ets</a></div></div></div></div> <p></p></li><li><span>提供方封装自定义组件CustomImageText，添加相关变量，使用默认AttributeModifier对象设置Image、Text。</span><p></p><div class="screenLinkPre"><div _ngcontent-eex-c106="" class="highlight-div"><div _ngcontent-eex-c106="" class="highlight-div-header"><div _ngcontent-eex-c106="" class="highlight-div-header-left"><div _ngcontent-eex-c106="" class="handle-button expand-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eex-c106="" class="highlight-div-header-right"><div _ngcontent-eex-c106="" class="handle-button ai-button"></div><div _ngcontent-eex-c106="" class="handle-button line-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eex-c106="" class="handle-button theme-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eex-c106="" class="handle-button copy-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eex-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/ComponentEncapsulation/blob/master/entry/src/main/ets/view/CustomImageText.ets#L58-L78" data-highlighted="yes"><ol class="linenums"><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-variable">export</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">CustomImageText</span> {</li><li>  @<span class="hljs-title function_">Prop</span> <span class="hljs-variable">imageAttribute</span>: <span class="hljs-title class_">AttributeModifier</span>&lt;<span class="hljs-title class_">ImageAttribute</span>&gt; = <span class="hljs-variable">new</span> <span class="hljs-title function_">CustomImageModifier</span>(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>);</li><li>  @<span class="hljs-title function_">Prop</span> <span class="hljs-variable">textAttribute</span>: <span class="hljs-title class_">AttributeModifier</span>&lt;<span class="hljs-title class_">TextAttribute</span>&gt; = <span class="hljs-variable">new</span> <span class="hljs-title function_">CustomTextModifier</span>();</li><li>  @<span class="hljs-title function_">Prop</span> <span class="hljs-variable">imageSrc</span>: <span class="hljs-title class_">PixelMap</span> | <span class="hljs-title class_">ResourceStr</span> | <span class="hljs-title class_">DrawableDescriptor</span>;</li><li>  @<span class="hljs-title function_">Prop</span> <span class="hljs-variable">text</span>: <span class="hljs-title class_">string</span>;</li><li>  <span class="hljs-variable">onClickEvent</span>?: () =&gt; <span class="hljs-variable">void</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Column</span>({ <span class="hljs-variable">space</span>: <span class="hljs-number">12</span> }) {</li><li>      <span class="hljs-title function_">Image</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">imageSrc</span>)</li><li>        .<span class="hljs-title function_">attributeModifier</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">imageAttribute</span>)</li><li>      <span class="hljs-title function_">Text</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">text</span>)</li><li>        .<span class="hljs-title function_">attributeModifier</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">textAttribute</span>)</li><li>    }.<span class="hljs-title function_">onClick</span>(() =&gt; {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.<span class="hljs-variable">onClickEvent</span> !== <span class="hljs-variable">undefined</span>) {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-title function_">onClickEvent</span>();</li><li>      }</li><li>    })</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ComponentEncapsulation/blob/master/entry/src/main/ets/view/CustomImageText.ets#L58-L78" target="_blank">CustomImageText.ets</a></div></div></div></div> <p></p></li><li><span>使用方在布局中添加自定义组件CustomImageText，可以选择创建Image、Text组件的AttributeModifier实现类实例，传参到CustomImageText组件中修改属性样式。</span><p></p><div class="screenLinkPre"><div _ngcontent-eex-c106="" class="highlight-div"><div _ngcontent-eex-c106="" class="highlight-div-header"><div _ngcontent-eex-c106="" class="highlight-div-header-left"><div _ngcontent-eex-c106="" class="handle-button expand-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eex-c106="" class="highlight-div-header-right"><div _ngcontent-eex-c106="" class="handle-button ai-button"></div><div _ngcontent-eex-c106="" class="handle-button line-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eex-c106="" class="handle-button theme-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eex-c106="" class="handle-button copy-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eex-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/ComponentEncapsulation/blob/master/entry/src/main/ets/pages/CommonComponent.ets#L26-L50" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Component</span></li><li>struct CommonComponent {</li><li>  imageAttribute: CustomImageModifier = new <span class="hljs-built_in">CustomImageModifier</span>(<span class="hljs-number">330</span>, <span class="hljs-number">330</span>);</li><li>
</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-built_in">NavDestination</span>() {</li><li>      <span class="hljs-built_in">Column</span>() {</li><li>        <span class="hljs-built_in">CustomImageText</span>({</li><li>          imageAttribute: this.imageAttribute,</li><li>          imageSrc: $r('app.media.image'),</li><li>          text: <span class="hljs-string">'Scenery'</span>,</li><li>          onClickEvent: () =&gt; {</li><li>            this<span class="hljs-selector-class">.getUIContext</span>()<span class="hljs-selector-class">.getPromptAction</span>()<span class="hljs-selector-class">.showToast</span>({ message: 'Clicked' })</li><li>          }</li><li>        })</li><li>      }</li><li>      <span class="hljs-selector-class">.margin</span>({ top: $r('app.float.margin_top') })</li><li>      <span class="hljs-selector-class">.justifyContent</span>(FlexAlign.Start)</li><li>      <span class="hljs-selector-class">.alignItems</span>(HorizontalAlign.Center)</li><li>      <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')</li><li>      <span class="hljs-selector-class">.height</span>('<span class="hljs-number">100%</span>')</li><li>    }</li><li>    <span class="hljs-selector-class">.title</span>(getResourceString($r('app.string.common'), this))</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ComponentEncapsulation/blob/master/entry/src/main/ets/pages/CommonComponent.ets#L26-L50" target="_blank">CommonComponent.ets</a></div></div></div></div> <p></p></li></ol> <div class="tiledSection"><h2 id="section178216212105">组件工厂类封装<i class="anchor-icon anchor-icon-link" anchorid="section178216212105" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section34071433152610" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section34071433152610" tips="复制节点链接"></i></h3></div> <p>如下图所示，团队A实现了一个组件工厂类，其中封装了多个组件。业务团队B在不同的开发场景下，希望通过组件名从工厂类实例中获取对应的组件。例如，当B团队向实例中传入参数"TextInput"或"Radio"，可以分别获取TextInput或Radio组件模板。</p> <p><span><img height="415.3856" originheight="634" originwidth="812" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162900.49049130657049425320248062028271:50001231000000:2800:402AB59228B7FF6C1BDF26569D858AED36487DC77AC136F0CF2B4DEE95D5F99A.png" title="点击放大" width="532"></span></p> <div class="tiledSection"><h3 id="section1986134614268">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section1986134614268" tips="复制节点链接"></i></h3><p>系统提供了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-builder" target="_blank">@Builder装饰器</a>，其装饰的方法遵循自定义组件build()函数语法规则。将@Builder装饰的方法传入<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-wrapbuilder" target="_blank">wrapBuilder</a>后，会返回<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-wrapbuilder" target="_blank">WrappedBuilder</a>对象，该对象支持赋值和传递。</p> <p>借助wrapBuilder函数，组件工厂可以使用Map结构存入各种组件，其中key为组件名，value为WrappedBuilder对象，使用时可以通过key值获取相应的组件。</p> </div> <div class="tiledSection"><h3 id="section15882283358">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section15882283358" tips="复制节点链接"></i></h3></div> <ol><li><span>在组件工厂实现方，将需要工厂化的组件通过全局@Builder方法封装。</span><p></p><div class="screenLinkPre"><div _ngcontent-eex-c106="" class="highlight-div"><div _ngcontent-eex-c106="" class="highlight-div-header"><div _ngcontent-eex-c106="" class="highlight-div-header-left"><div _ngcontent-eex-c106="" class="handle-button expand-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eex-c106="" class="highlight-div-header-right"><div _ngcontent-eex-c106="" class="handle-button ai-button"></div><div _ngcontent-eex-c106="" class="handle-button line-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eex-c106="" class="handle-button theme-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eex-c106="" class="handle-button copy-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eex-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-php" codehub="https://gitee.com/harmonyos_samples/ComponentEncapsulation/blob/master/entry/src/main/ets/view/FactoryMap.ets#L17-L65" data-highlighted="yes"><ol class="linenums"><li>@Builder</li><li><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myRadio</span>(<span class="hljs-params"></span>) </span>{</li><li>  <span class="hljs-title function_ invoke__">Text</span>(<span class="hljs-variable">$r</span>(<span class="hljs-string">'app.string.radio'</span>))</li><li>    .<span class="hljs-title function_ invoke__">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_ invoke__">fontColor</span>(<span class="hljs-variable">$r</span>(<span class="hljs-string">'sys.color.mask_secondary'</span>))</li><li>  <span class="hljs-title function_ invoke__">Row</span>() {</li><li>    <span class="hljs-title function_ invoke__">Radio</span>({ <span class="hljs-attr">value</span>: <span class="hljs-string">'1'</span>, <span class="hljs-attr">group</span>: <span class="hljs-string">'radioGroup'</span> })</li><li>      .<span class="hljs-title function_ invoke__">margin</span>({ <span class="hljs-attr">right</span>: <span class="hljs-variable">$r</span>(<span class="hljs-string">'app.float.margin_right'</span>) })</li><li>    <span class="hljs-title function_ invoke__">Text</span>(<span class="hljs-string">'man'</span>)</li><li>  }</li><li>  .<span class="hljs-title function_ invoke__">width</span>(<span class="hljs-string">'100%'</span>)</li><li>
</li><li>  <span class="hljs-title function_ invoke__">Row</span>() {</li><li>    <span class="hljs-title function_ invoke__">Radio</span>({ <span class="hljs-attr">value</span>: <span class="hljs-string">'0'</span>, <span class="hljs-attr">group</span>: <span class="hljs-string">'radioGroup'</span> })</li><li>      .<span class="hljs-title function_ invoke__">margin</span>({ <span class="hljs-attr">right</span>: <span class="hljs-variable">$r</span>(<span class="hljs-string">'app.float.margin_right'</span>) })</li><li>    <span class="hljs-title function_ invoke__">Text</span>(<span class="hljs-string">'woman'</span>)</li><li>  }</li><li>  .<span class="hljs-title function_ invoke__">width</span>(<span class="hljs-string">'100%'</span>)</li><li>}</li><li>
</li><li>@Builder</li><li><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myCheckBox</span>(<span class="hljs-params"></span>) </span>{</li><li>  <span class="hljs-title function_ invoke__">Text</span>(<span class="hljs-variable">$r</span>(<span class="hljs-string">'app.string.checkbox'</span>))</li><li>    .<span class="hljs-title function_ invoke__">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_ invoke__">fontColor</span>(<span class="hljs-variable">$r</span>(<span class="hljs-string">'sys.color.mask_secondary'</span>))</li><li>  <span class="hljs-title function_ invoke__">Row</span>() {</li><li>    <span class="hljs-title function_ invoke__">CheckboxGroup</span>({ <span class="hljs-attr">group</span>: <span class="hljs-string">'checkboxGroup'</span> })</li><li>      .<span class="hljs-title function_ invoke__">checkboxShape</span>(CheckBoxShape.ROUNDED_SQUARE)</li><li>    <span class="hljs-title function_ invoke__">Text</span>(<span class="hljs-string">'all'</span>)</li><li>      .<span class="hljs-title function_ invoke__">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-variable">$r</span>(<span class="hljs-string">'app.float.margin_right'</span>) })</li><li>  }</li><li>  .<span class="hljs-title function_ invoke__">width</span>(<span class="hljs-string">'100%'</span>)</li><li>
</li><li>  <span class="hljs-title function_ invoke__">Row</span>() {</li><li>    <span class="hljs-title function_ invoke__">Checkbox</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'1'</span>, <span class="hljs-attr">group</span>: <span class="hljs-string">'checkboxGroup'</span> })</li><li>      .<span class="hljs-title function_ invoke__">shape</span>(CheckBoxShape.ROUNDED_SQUARE)</li><li>      .<span class="hljs-title function_ invoke__">margin</span>({ <span class="hljs-attr">right</span>: <span class="hljs-variable">$r</span>(<span class="hljs-string">'app.float.margin_right'</span>) })</li><li>    <span class="hljs-title function_ invoke__">Text</span>(<span class="hljs-string">'text1'</span>)</li><li>  }</li><li>  .<span class="hljs-title function_ invoke__">width</span>(<span class="hljs-string">'100%'</span>)</li><li>
</li><li>  <span class="hljs-title function_ invoke__">Row</span>() {</li><li>    <span class="hljs-title function_ invoke__">Checkbox</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'0'</span>, <span class="hljs-attr">group</span>: <span class="hljs-string">'checkboxGroup'</span> })</li><li>      .<span class="hljs-title function_ invoke__">shape</span>(CheckBoxShape.ROUNDED_SQUARE)</li><li>      .<span class="hljs-title function_ invoke__">margin</span>({ <span class="hljs-attr">right</span>: <span class="hljs-variable">$r</span>(<span class="hljs-string">'app.float.margin_right'</span>) })</li><li>    <span class="hljs-title function_ invoke__">Text</span>(<span class="hljs-string">'text2'</span>)</li><li>  }</li><li>  .<span class="hljs-title function_ invoke__">width</span>(<span class="hljs-string">'100%'</span>)</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ComponentEncapsulation/blob/master/entry/src/main/ets/view/FactoryMap.ets#L17-L65" target="_blank">FactoryMap.ets</a></div></div></div></div> <p></p></li><li><span>在组件工厂实现方，将封装好的全局@Builder方法使用wrapBuilder函数包裹，并将返回值作为组件工厂Map的value值存入。全部组件存入后，将组件工厂导出供外部使用。</span><p></p><div class="screenLinkPre"><div _ngcontent-eex-c106="" class="highlight-div"><div _ngcontent-eex-c106="" class="highlight-div-header"><div _ngcontent-eex-c106="" class="highlight-div-header-left"><div _ngcontent-eex-c106="" class="handle-button expand-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eex-c106="" class="highlight-div-header-right"><div _ngcontent-eex-c106="" class="handle-button ai-button"></div><div _ngcontent-eex-c106="" class="handle-button line-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eex-c106="" class="handle-button theme-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eex-c106="" class="handle-button copy-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eex-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/ComponentEncapsulation/blob/master/entry/src/main/ets/view/FactoryMap.ets#L69-L77" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Define the component factory Map.</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">factoryMap</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();</li><li>
</li><li><span class="hljs-comment">// The components that need to be factory stored in the component factory.</span></li><li>factoryMap.<span class="hljs-title function_">set</span>(<span class="hljs-string">'Radio'</span>, <span class="hljs-title function_">wrapBuilder</span>(myRadio));</li><li>factoryMap.<span class="hljs-title function_">set</span>(<span class="hljs-string">'Checkbox'</span>, <span class="hljs-title function_">wrapBuilder</span>(myCheckBox));</li><li>
</li><li><span class="hljs-comment">// Export assembly factory</span></li><li><span class="hljs-keyword">export</span> { factoryMap };</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ComponentEncapsulation/blob/master/entry/src/main/ets/view/FactoryMap.ets#L69-L77" target="_blank">FactoryMap.ets</a></div></div></div></div> <p></p></li><li><span>在使用方，引入组件工厂并通过key值获取对应的WrappedBuilder对象。</span><p></p><div class="screenLinkPre"><div _ngcontent-eex-c106="" class="highlight-div"><div _ngcontent-eex-c106="" class="highlight-div-header"><div _ngcontent-eex-c106="" class="highlight-div-header-left"><div _ngcontent-eex-c106="" class="handle-button expand-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eex-c106="" class="highlight-div-header-right"><div _ngcontent-eex-c106="" class="handle-button ai-button"></div><div _ngcontent-eex-c106="" class="handle-button line-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eex-c106="" class="handle-button theme-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eex-c106="" class="handle-button copy-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eex-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/ComponentEncapsulation/blob/master/entry/src/main/ets/pages/ComponentFactory.ets#L16-L23" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Import the component factory. The path must be based on the actual location.</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">factoryMap</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../view/FactoryMap'</span>;</li><li><span class="hljs-comment">// ...</span></li><li><span class="hljs-comment">// Get the corresponding WrappedBuilder object from the key value of the component factory Map.</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">myRadio</span>: <span class="hljs-title class_">WrappedBuilder</span>&lt;[]&gt; = <span class="hljs-variable">factoryMap</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'Radio'</span>) <span class="hljs-keyword">as</span> <span class="hljs-variable">WrappedBuilder</span>&lt;[]&gt;;</li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">myCheckbox</span>: <span class="hljs-title class_">WrappedBuilder</span>&lt;[]&gt; = <span class="hljs-variable">factoryMap</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'Checkbox'</span>) <span class="hljs-keyword">as</span> <span class="hljs-variable">WrappedBuilder</span>&lt;[]&gt;;</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ComponentEncapsulation/blob/master/entry/src/main/ets/pages/ComponentFactory.ets#L16-L23" target="_blank">ComponentFactory.ets</a></div></div></div></div> <p></p></li><li><span>在使用方，build()函数中调用WrappedBuilder对象的builder()方法应用具体组件。</span><p></p><div class="screenLinkPre"><div _ngcontent-eex-c106="" class="highlight-div"><div _ngcontent-eex-c106="" class="highlight-div-header"><div _ngcontent-eex-c106="" class="highlight-div-header-left"><div _ngcontent-eex-c106="" class="handle-button expand-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eex-c106="" class="highlight-div-header-right"><div _ngcontent-eex-c106="" class="handle-button ai-button"></div><div _ngcontent-eex-c106="" class="handle-button line-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eex-c106="" class="handle-button theme-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eex-c106="" class="handle-button copy-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eex-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/ComponentEncapsulation/blob/master/entry/src/main/ets/pages/ComponentFactory.ets#L32-L46" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Component</span></li><li>struct ComponentFactory {</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-built_in">NavDestination</span>() {</li><li>      <span class="hljs-built_in">Column</span>({ space: <span class="hljs-number">12</span> }) {</li><li>        <span class="hljs-comment">// myRadio and myCheckbox are WrappedBuilder objects obtained from the component factory.</span></li><li>        myRadio<span class="hljs-selector-class">.builder</span>();</li><li>        myCheckbox<span class="hljs-selector-class">.builder</span>();</li><li>      }</li><li>      <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')</li><li>      <span class="hljs-selector-class">.padding</span>($r('app.float.padding'))</li><li>    }</li><li>    <span class="hljs-selector-class">.title</span>(getResourceString($r('app.string.factory'), this))</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ComponentEncapsulation/blob/master/entry/src/main/ets/pages/ComponentFactory.ets#L32-L46" target="_blank">ComponentFactory.ets</a></div></div></div></div> <p></p></li></ol> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>使用wrapBuilder方法有以下限制：</p> <ol><li>wrapBuilder方法只支持传入全局@Builder方法。</li><li>wrapBuilder方法返回的WrappedBuilder对象的builder属性方法只能在struct内部使用。</li></ol> </div></div></div> <div class="tiledSection"><h2 id="section141261618518">常见问题<i class="anchor-icon anchor-icon-link" anchorid="section141261618518" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section1186112410119" class="firsth2">如何调用子组件中的方法<i class="anchor-icon anchor-icon-link" anchorid="section1186112410119" tips="复制节点链接"></i></h3><p>主要有以下方法：</p> <ul><li><strong>方法一</strong><strong>：</strong><strong>使用Controller类</strong><ol><li>定义Controller类，添加一个方法变量。</li><li>在子组件中封装具体方法，添加Controller变量，在aboutToAppear()时将方法赋值。</li><li>父组件中创建Controller实例，并传递给子组件。当父组件执行Controller实例中的方法，会间接调用子组件中的方法。<div class="screenLinkPre"><div _ngcontent-eex-c106="" class="highlight-div"><div _ngcontent-eex-c106="" class="highlight-div-header"><div _ngcontent-eex-c106="" class="highlight-div-header-left"><div _ngcontent-eex-c106="" class="handle-button expand-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eex-c106="" class="highlight-div-header-right"><div _ngcontent-eex-c106="" class="handle-button ai-button"></div><div _ngcontent-eex-c106="" class="handle-button line-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eex-c106="" class="handle-button theme-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eex-c106="" class="handle-button copy-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eex-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ComponentEncapsulation/entry/src/main/ets/pages/ControllerCallPage.ets#L16-L65" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Controller</span> {</li><li>  action = <span class="hljs-function">() =&gt;</span> {</li><li>  };</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li><span class="hljs-keyword">export</span> struct <span class="hljs-title class_">ChildComponent</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">bgColor</span>: <span class="hljs-title class_">ResourceColor</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>;</li><li>  <span class="hljs-attr">controller</span>: <span class="hljs-title class_">Controller</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-keyword">private</span> switchColor = <span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">bgColor</span> === <span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">bgColor</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">bgColor</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>;</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-property">action</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">switchColor</span>;</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Child Component'</span>)</li><li>    }.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">bgColor</span>).<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> childRef = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Controller</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">ChildComponent</span>({ <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">childRef</span> })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Switch Color'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">childRef</span>.<span class="hljs-title function_">action</span>();</li><li>        })</li><li>        .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">16</span> })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Center</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ComponentEncapsulation/entry/src/main/ets/pages/ControllerCallPage.ets#L16-L65" target="_blank">ControllerCallPage.ets</a></div></div></div></div> </li></ol> </li></ul> <ul><li><strong>方法二：</strong><strong>使用@Watch</strong><p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-watch" target="_blank">@Watch</a>监听状态变量，当父组件修改此变量时，@Watch的回调方法将被执行，即实现了子组件中的方法调用。</p> <div class="screenLinkPre"><div _ngcontent-eex-c106="" class="highlight-div"><div _ngcontent-eex-c106="" class="highlight-div-header"><div _ngcontent-eex-c106="" class="highlight-div-header-left"><div _ngcontent-eex-c106="" class="handle-button expand-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eex-c106="" class="highlight-div-header-right"><div _ngcontent-eex-c106="" class="handle-button ai-button"></div><div _ngcontent-eex-c106="" class="handle-button line-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eex-c106="" class="handle-button theme-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eex-c106="" class="handle-button copy-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eex-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ComponentEncapsulation/entry/src/main/ets/pages/WatchCallPage.ets#L16-L56" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li><span class="hljs-keyword">export</span> struct <span class="hljs-title class_">ChildComponent</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">bgColor</span>: <span class="hljs-title class_">ResourceColor</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>;</li><li>  <span class="hljs-meta">@Link</span> <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'switchColor'</span>) <span class="hljs-attr">checkFlag</span>: <span class="hljs-built_in">boolean</span>;</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">switchColor</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">checkFlag</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">bgColor</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">bgColor</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>;</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Child Component'</span>)</li><li>    }.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">bgColor</span>)</li><li>    .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">childCheckFlag</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">ChildComponent</span>({ <span class="hljs-attr">checkFlag</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">childCheckFlag</span> })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Switch Color'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">childCheckFlag</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">childCheckFlag</span>;</li><li>        })</li><li>        .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">16</span> })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Center</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ComponentEncapsulation/entry/src/main/ets/pages/WatchCallPage.ets#L16-L56" target="_blank">WatchCallPage.ets</a></div></div></div></div> </li><li><strong>方法三：使用事件通信</strong><p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/itc-with-emitter" target="_blank">Emitter</a>通信机制，在子组件中添加事件监听，在父组件emit发布对应事件，监听的事件被执行，即实现了子组件中的方法调用。</p> <div class="screenLinkPre"><div _ngcontent-eex-c106="" class="highlight-div"><div _ngcontent-eex-c106="" class="highlight-div-header"><div _ngcontent-eex-c106="" class="highlight-div-header-left"><div _ngcontent-eex-c106="" class="handle-button expand-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eex-c106="" class="highlight-div-header-right"><div _ngcontent-eex-c106="" class="handle-button ai-button"></div><div _ngcontent-eex-c106="" class="handle-button line-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eex-c106="" class="handle-button theme-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eex-c106="" class="handle-button copy-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eex-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ComponentEncapsulation/entry/src/main/ets/pages/EmitterCallPage.ets#L18-L63" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li><span class="hljs-keyword">export</span> struct <span class="hljs-title class_">ChildComponent</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-variable constant_">EVENT_ID_SWITCH_COLOR</span> = <span class="hljs-string">'SWITCH_COLOR'</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">bgColor</span>: <span class="hljs-title class_">ResourceColor</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>;</li><li>  <span class="hljs-keyword">private</span> switchColor = <span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">bgColor</span> === <span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">bgColor</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">bgColor</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>;</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    emitter.<span class="hljs-title function_">on</span>(<span class="hljs-title class_">ChildComponent</span>.<span class="hljs-property">EVENT_ID_SWITCH_COLOR</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">switchColor</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToDisappear</span>(): <span class="hljs-built_in">void</span> {</li><li>    emitter.<span class="hljs-title function_">off</span>(<span class="hljs-title class_">ChildComponent</span>.<span class="hljs-property">EVENT_ID_SWITCH_COLOR</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">switchColor</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Child Component'</span>)</li><li>    }.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">bgColor</span>)</li><li>    .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">ChildComponent</span>()</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Switch Color'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          emitter.<span class="hljs-title function_">emit</span>(<span class="hljs-title class_">ChildComponent</span>.<span class="hljs-property">EVENT_ID_SWITCH_COLOR</span>);</li><li>        })</li><li>        .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">16</span> })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Center</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ComponentEncapsulation/entry/src/main/ets/pages/EmitterCallPage.ets#L18-L63" target="_blank">EmitterCallPage.ets</a></div></div></div></div> </li></ul> </div> <div class="tiledSection"><h3 id="section1236518914466">如何调用父组件中的方法<i class="anchor-icon anchor-icon-link" anchorid="section1236518914466" tips="复制节点链接"></i></h3><p>在子组件中添加一个回调方法，当父组件在使用子组件时，将父组件中的方法做为参数传递进去即可。</p> <div class="screenLinkPre"><div _ngcontent-eex-c106="" class="highlight-div"><div _ngcontent-eex-c106="" class="highlight-div-header"><div _ngcontent-eex-c106="" class="highlight-div-header-left"><div _ngcontent-eex-c106="" class="handle-button expand-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eex-c106="" class="highlight-div-header-right"><div _ngcontent-eex-c106="" class="handle-button ai-button"></div><div _ngcontent-eex-c106="" class="handle-button line-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eex-c106="" class="handle-button theme-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eex-c106="" class="handle-button copy-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eex-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ComponentEncapsulation/entry/src/main/ets/pages/ParentCallPage.ets#L16-L54" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li><span class="hljs-keyword">export</span> struct <span class="hljs-title class_">ChildComponent</span> {</li><li>  call = <span class="hljs-function">() =&gt;</span> {</li><li>  };</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Child Component'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">call</span>();</li><li>        })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-title function_">parentAction</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getPromptAction</span>().<span class="hljs-title function_">showToast</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">'Parent Action'</span> });</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      hilog.<span class="hljs-title function_">warn</span>(<span class="hljs-number">0x000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`showToast failed, code=<span class="hljs-subst">${err.code}</span>, message=<span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">ChildComponent</span>({ <span class="hljs-attr">call</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentAction</span> })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Center</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ComponentEncapsulation/entry/src/main/ets/pages/ParentCallPage.ets#L16-L54" target="_blank">ParentCallPage.ets</a></div></div></div></div> </div> <div class="tiledSection"><h3 id="section086082412419">如何将UI的可变部分提取出来，实现类似插槽的功能<i class="anchor-icon anchor-icon-link" anchorid="section086082412419" tips="复制节点链接"></i></h3><p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-builderparam#参数初始化组件" target="_blank">@BuilderParam参数</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-builderparam#尾随闭包初始化组件" target="_blank">@BuilderParam尾随闭包</a>的方法，在封装的子组件中，将可变的UI内容做为变量开放出去，当父组件在应用子组件时实现具体的UI内容。</p> <div class="screenLinkPre"><div _ngcontent-eex-c106="" class="highlight-div"><div _ngcontent-eex-c106="" class="highlight-div-header"><div _ngcontent-eex-c106="" class="highlight-div-header-left"><div _ngcontent-eex-c106="" class="handle-button expand-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eex-c106="" class="highlight-div-header-right"><div _ngcontent-eex-c106="" class="handle-button ai-button"></div><div _ngcontent-eex-c106="" class="handle-button line-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eex-c106="" class="handle-button theme-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eex-c106="" class="handle-button copy-button"><div _ngcontent-eex-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eex-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ComponentEncapsulation/entry/src/main/ets/pages/BuilderParamPage.ets#L16-L50" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Component</span></li><li>export struct ChildComponent {</li><li>  <span class="hljs-keyword">@Builder</span></li><li>  customBuilder() {</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">@BuilderParam</span> <span class="hljs-attribute">customBuilderParam</span>: () =&gt; void = this.customBuilder;</li><li>
</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-built_in">Column</span>() {</li><li>      Text('Text in Child')</li><li>      this<span class="hljs-selector-class">.customBuilderParam</span>();</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">@Entry</span></li><li><span class="hljs-keyword">@Component</span></li><li>struct Index {</li><li>  <span class="hljs-keyword">@Builder</span></li><li>  componentBuilder() {</li><li>    Text(`Parent builder`)</li><li>  }</li><li>
</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-built_in">Column</span>() {</li><li>      <span class="hljs-built_in">ChildComponent</span>() {</li><li>        this<span class="hljs-selector-class">.componentBuilder</span>();</li><li>      }</li><li>    }</li><li>    <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')</li><li>    <span class="hljs-selector-class">.alignItems</span>(HorizontalAlign.Center)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ComponentEncapsulation/entry/src/main/ets/pages/BuilderParamPage.ets#L16-L50" target="_blank">BuilderParamPage.ets</a></div></div></div></div> </div> <div class="tiledSection"><h3 id="section1678423315107">如何传递UI组件数组，实现ForEach循环渲染<i class="anchor-icon anchor-icon-link" anchorid="section1678423315107" tips="复制节点链接"></i></h3><p>先将UI组件包装成全局@Builder，然后使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-wrapbuilder" target="_blank">wrapBuilder</a>依次封装每个@Builder，这样得到的WrappedBuilder对象/数组可以用于参数传递，可以使用ForEach对传递的数组进行渲染。</p> <p>参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-wrapbuilder#builder方法赋值给变量在ui语法中使用" target="_blank">builder方法赋值给变量在ui语法中使用</a></p> </div> <div class="tiledSection"><h2 id="section4449171917513">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section4449171917513" tips="复制节点链接"></i></h2></div> <ul><li><a href="https://gitee.com/harmonyos_samples/ComponentEncapsulation" target="_blank">ArkUI组件封装场景</a></li></ul> <p></p> </div> <div></div></div>