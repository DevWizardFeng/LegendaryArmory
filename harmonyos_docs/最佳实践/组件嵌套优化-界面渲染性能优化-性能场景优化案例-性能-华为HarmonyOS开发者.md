<h1 _ngcontent-qgq-c119="" class="doc-title ng-star-inserted" title="组件嵌套优化"> 组件嵌套优化 </h1>

<div _ngcontent-qgq-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>本文通过原理概念、优化场景和实践数据对比三个角度，详细介绍了组件嵌套的优化，着重从优化场景角度为开发者阐明组件嵌套的优化场景以及优化策略。</p> <div class="tiledSection"><h2 id="section61283312127">原理概述<i class="anchor-icon anchor-icon-link" anchorid="section61283312127" tips="复制节点链接"></i></h2><p>本章节将从原理角度分析，通过ArkUI框架的执行流程，以及自定义组件的生命周期两个角度，来分析组件过度嵌套对性能的影响。</p> </div> <div class="tiledSection"><h3 id="section141289317127" class="firsth2">ArkUI框架执行流程<i class="anchor-icon anchor-icon-link" anchorid="section141289317127" tips="复制节点链接"></i></h3><p></p> <p><span><img height="250.3725" originheight="1857" originwidth="3871" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163411.24121340879250924354949056910883:50001231000000:2800:010271CE28E749442615C737E359588CAE9A1777F8CA26EAF6F4142748A5318E.png" title="点击放大" width="523.6875"></span></p> <p>如上图所示，可以看到ArkUI框架的执行顺序：</p> <ol><li>执行ArkTS中的UI描述信息，通过UI描述API创建后端的页面节点树，其中包含了处理UI组件属性更新、布局测算、事件处理等业务逻辑；</li><li>通过FrameNode生成当前的界面描述数据结构——渲染树RenderTree，RenderTree描述了具体的元素在屏幕上的布局信息，包含大小、位置以及一些其他属性；</li><li>最后渲染线程会根据RenderTree的信息执行相应的绘制工作。</li></ol> </div> <div class="tiledSection"><h3 id="section2128131101210">自定义组件的生命周期<i class="anchor-icon anchor-icon-link" anchorid="section2128131101210" tips="复制节点链接"></i></h3><p><span><img height="365.306445" originheight="509" originwidth="631" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163411.20714423797846893415425594443894:50001231000000:2800:C9F01C105DB77134C5807936FB0CC5F71F12A4B38AAADC699848CA3CB58F9597.png" title="点击放大" width="452.865"></span></p> <p>如上图所示，自定义组件创建完成之后，在build函数执行之前，将先执行aboutToAppear()生命周期回调函数。执行完build函数后，还会有一些事件监听函数，例如可以使用onPageShow监听页面显示事件，onPageHide函数可以监听页面隐藏事件。最终在自定义组件析构销毁前执行aboutToDisappear函数。</p> <p>具体的页面和自定义组件生命周期可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-page-custom-components-lifecycle" target="_blank">自定义组件生命周期</a>。</p> </div> <div class="tiledSection"><h3 id="section912811314125">组件过度嵌套对性能的影响<i class="anchor-icon anchor-icon-link" anchorid="section912811314125" tips="复制节点链接"></i></h3><p>组件嵌套是指一个组件包含另一个或多个组件的情况，这种嵌套关系可以形成组件树的结构。从最外层组件的类型来看，可以分为自定义组件嵌套和原生组件嵌套。</p> <p>从ArkUI框架的执行流程上分析，布局时会采用递归遍历所有节点的方式进行组件位置和大小的计算。嵌套层级过深将带来更多的中间节点，在布局测算阶段下，额外的节点数将导致更多的计算过程，造成性能消耗。</p> <p>从自定义组件的生命周期的角度上分析，如果自定义组件过度嵌套，则会有大量的生命周期函数需要执行，消耗性能。</p> <p>详细的组件嵌套性能数据分析可参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-improve-layout-performance#section9293918175210" target="_blank">《精简节点数》</a>。</p> </div> <div class="tiledSection"><h2 id="section81295319129">优化场景<i class="anchor-icon anchor-icon-link" anchorid="section81295319129" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section1012953161217" class="firsth2">优先使用@Builder方法代替自定义组件<i class="anchor-icon anchor-icon-link" anchorid="section1012953161217" tips="复制节点链接"></i></h3><p>自定义组件与自定义构建函数概念定义如下：</p> <p>自定义组件：用@Component修饰的struct结构体称为自定义组件，在自定义组件中可以定义函数/变量、build()方法、组件的生命周期回调等。自定义组件具有可组合、可重用和数据驱动UI更新的特点。</p> <p>自定义构建函数：@Builder装饰的函数称为“自定义构建函数”，分为组件内自定义构建函数和全局自定义构建函数。@Builder所装饰的函数遵循build()函数语法规则，开发者可以将重复使用的UI元素抽象成一个方法，在build方法里调用。</p> <p></p> <p>自定义组件和自定义构建函数（@Builder）的主要区别如下：</p> <ol><li>自定义构建函数（@Builder）更轻量，其作为UI元素抽象的方法，实现和调用相较于自定义组件比较简洁。</li><li>在自定义组件中，可以定义成员函数/变量、自定义组件生命周期等。自定义构建函数（@Builder）不支持定义状态变量和自定义生命周期。</li><li>在自定义组件中，可直接通过状态变量的改变，来驱动UI的刷新。而自定义构建函数（@Builder）默认的按值参数传递方式不支持动态改变组件，当传递的参数为状态变量时，状态变量的改变不会引起@Builder方法内的UI刷新，要实现UI动态刷新需要按引用传递参数。</li><li>在自定义组件中要实现插槽功能，需要使用@Builder和@BuilderParam实现。具体实现可参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-builderparam" target="_blank">@BuilderParam装饰器：引用@Builder函数</a>。</li><li>自定义构建函数（@Builder）中使用了自定义组件，那么该方法每次被调用时，对应的自定义组件均会重新创建。</li></ol> <p>整体上，自定义组件在实际应用开发场景中更加通用、灵活。自定义构建函数（@Builder）由于不支持定义变量和生命周期等限制，在使用场景上灵活性受限，多用在插槽或系统提供的组件/方法里面属性传值类型为Builder类型场景中。</p> <p>根据上面自定义组件与自定义构建函数的区别可以看出，由于@Builder不涉及生命周期，在自定义组件大量嵌套的场景中，更加轻量级的@Builder在性能方面更加出色。</p> <p>因此，当自定义组件不涉及到状态变量和自定义生命周期时，可以优先使用@Builder替换自定义组件，提升性能。</p> <p>优化策略</p> <p>自定义组件示例代码：</p> <div class="screenLinkPre"><div _ngcontent-qgq-c106="" class="highlight-div"><div _ngcontent-qgq-c106="" class="highlight-div-header"><div _ngcontent-qgq-c106="" class="highlight-div-header-left"><div _ngcontent-qgq-c106="" class="handle-button expand-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qgq-c106="" class="highlight-div-header-right"><div _ngcontent-qgq-c106="" class="handle-button ai-button"></div><div _ngcontent-qgq-c106="" class="handle-button line-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qgq-c106="" class="handle-button theme-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qgq-c106="" class="handle-button copy-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qgq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/Component_Nesting_Optimization/entry/src/main/ets/segment/segment1.ets#L2-L10" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Component</span></li><li>export struct example {</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-built_in">Column</span>(){</li><li>      Text('Custom Component Sample Code')</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/Component_Nesting_Optimization/entry/src/main/ets/segment/segment1.ets#L2-L10" target="_blank">segment1.ets</a></div></div></div></div> <p>自定义构建函数示例代码：</p> <div class="screenLinkPre"><div _ngcontent-qgq-c106="" class="highlight-div"><div _ngcontent-qgq-c106="" class="highlight-div-header"><div _ngcontent-qgq-c106="" class="highlight-div-header-left"><div _ngcontent-qgq-c106="" class="handle-button expand-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qgq-c106="" class="highlight-div-header-right"><div _ngcontent-qgq-c106="" class="handle-button ai-button"></div><div _ngcontent-qgq-c106="" class="handle-button line-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qgq-c106="" class="handle-button theme-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qgq-c106="" class="handle-button copy-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qgq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/Component_Nesting_Optimization/entry/src/main/ets/segment/segment1.ets#L14-L20" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Builder</span></li><li>export function example1(){</li><li>  <span class="hljs-built_in">Column</span>(){</li><li>    Text('Sample code for customizing the constructor')</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/Component_Nesting_Optimization/entry/src/main/ets/segment/segment1.ets#L14-L20" target="_blank">segment1.ets</a></div></div></div></div> <p>具体可以参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-ui-component-performance-optimization#section18773182614502" target="_blank">优先使用@Builder方法代替自定义组件</a>。</p> </div> <div class="tiledSection"><h3 id="section25911641123713">减少自定义组件产生多余节点<i class="anchor-icon anchor-icon-link" anchorid="section25911641123713" tips="复制节点链接"></i></h3><p>自定义组件自身为非渲染节点，仅是组件树和状态数据的组合，常规使用自定义组件时并不会产生多余的节点。但是给自定义组件添加属性后，会将自定义组件作为一个整体节点进行处理。对内部的组件树进行操作，如背景色绘制、圆角绘制等都会作用在该节点上。</p> <p>通过DevEco Studio内置ArkUI Inspector工具，查看组件树结构可以看到，相比使用@Builder方法，组件树多一个自定义组件节点，所以<a href="/consumer/cn/doc/best-practices/bpta-component-nesting-optimization#section1012953161217">优先使用@Builder方法代替自定义组件</a>减少了自定义组件节点数量。而给自定义组件添加属性，会在自定义组件外部会创建一个“__Common__”类型的节点，如下图所示。为了避免这类“__Common__”节点的创建，可以将自定义组件的属性移至内部，或者动态设置自定义组件的属性。减少自定义组件产生多余节点，可以使总节点数量降低，从而提升性能。</p> <div class="fignone"><span class="figcap"><b>图1 </b>自定义组件树变化示意图</span><br><span><img height="418.30960500000003" originheight="663" originwidth="1249" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163411.36979614393068407367586144054524:50001231000000:2800:205BDBC69239D3E1C77E580C5624BE72347F28239C047B7CECF8CE0114CE2857.png" title="点击放大" width="788.0250000000001"></span></div> <p><strong>将自定义组件的属性移至内部</strong></p> <p>当需要给自定义组件添加属性时，一般少量属性的场景下，可以将这些属性移至自定义组件内部，具体优化示例如下所示。</p> <p>反例：</p> <div class="screenLinkPre"><div _ngcontent-qgq-c106="" class="highlight-div"><div _ngcontent-qgq-c106="" class="highlight-div-header"><div _ngcontent-qgq-c106="" class="highlight-div-header-left"><div _ngcontent-qgq-c106="" class="handle-button expand-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qgq-c106="" class="highlight-div-header-right"><div _ngcontent-qgq-c106="" class="handle-button ai-button"></div><div _ngcontent-qgq-c106="" class="handle-button line-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qgq-c106="" class="handle-button theme-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qgq-c106="" class="handle-button copy-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qgq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/Component_Nesting_Optimization/entry/src/main/ets/segment/segment2.ets#L8-L22" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Component</span></li><li>export struct Example {</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-built_in">Column</span>() {</li><li>      <span class="hljs-comment">// Custom Components</span></li><li>      <span class="hljs-built_in">FlowListStruct</span>(</li><li>        // Custom Component Passing Parameters</li><li>        // ...</li><li>      )<span class="hljs-selector-class">.backgroundColor</span>('#FFFFFF')</li><li>    }</li><li>    <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')</li><li>    <span class="hljs-selector-class">.height</span>('<span class="hljs-number">100%</span>')</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/Component_Nesting_Optimization/entry/src/main/ets/segment/segment2.ets#L8-L22" target="_blank">segment2.ets</a></div></div></div></div> <p>正例：</p> <div class="screenLinkPre"><div _ngcontent-qgq-c106="" class="highlight-div"><div _ngcontent-qgq-c106="" class="highlight-div-header"><div _ngcontent-qgq-c106="" class="highlight-div-header-left"><div _ngcontent-qgq-c106="" class="handle-button expand-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qgq-c106="" class="highlight-div-header-right"><div _ngcontent-qgq-c106="" class="handle-button ai-button"></div><div _ngcontent-qgq-c106="" class="handle-button line-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qgq-c106="" class="handle-button theme-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qgq-c106="" class="handle-button copy-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qgq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/Component_Nesting_Optimization/entry/src/main/ets/segment/segment2.ets#L26-L35" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Component</span></li><li>export struct FlowListStruct2 {</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-built_in">Column</span>() {</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-selector-class">.backgroundColor</span>('#FFFFFF')</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/Component_Nesting_Optimization/entry/src/main/ets/segment/segment2.ets#L26-L35" target="_blank">segment2.ets</a></div></div></div></div> <p><strong>动态设置自定义组件的属性</strong></p> <p>ArkUI提供了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-attribute-modifier" target="_blank">动态属性设置</a>的接口，支持使用自定义AttributeModifier构建组件并配置属性。当需要给自定义组件设置较多属性时，如果将所有的属性设置都内移，会出现传递参数过多的问题，同时也会创建更多状态变量，增加参数的传递耗时。虽然减少了节点数量，但是性能没有得到有效提升。推荐使用自定义AttributeModifier的方式来动态设置自定义组件的属性，减少节点数量的同时，也避免了参数过多导致耗时的问题，具体优化示例如下所示。</p> <div class="screenLinkPre"><div _ngcontent-qgq-c106="" class="highlight-div"><div _ngcontent-qgq-c106="" class="highlight-div-header"><div _ngcontent-qgq-c106="" class="highlight-div-header-left"><div _ngcontent-qgq-c106="" class="handle-button expand-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qgq-c106="" class="highlight-div-header-right"><div _ngcontent-qgq-c106="" class="handle-button ai-button"></div><div _ngcontent-qgq-c106="" class="handle-button line-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qgq-c106="" class="handle-button theme-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qgq-c106="" class="handle-button copy-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qgq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/Component_Nesting_Optimization/entry/src/main/ets/segment/segment2.ets#L39-L81" data-highlighted="yes"><ol class="linenums"><li>@<span class="hljs-title function_">Entry</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">CustomComponentModifier</span> {</li><li>  <span class="hljs-variable">modifier</span>: <span class="hljs-title class_">ColumnModifier</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">ColumnModifier</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">modifier</span>.<span class="hljs-variable">width</span> = <span class="hljs-number">100</span>;</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">modifier</span>.<span class="hljs-variable">height</span> = <span class="hljs-number">100</span>;</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">modifier</span>.<span class="hljs-variable">backgroundColor</span> = <span class="hljs-variable">Color</span>.<span class="hljs-variable">Red</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Column</span>() {</li><li>      <span class="hljs-title function_">ModifierCustom</span>({ <span class="hljs-variable">modifier</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">modifier</span> })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li>
</li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ModifierCustom</span> {</li><li>  @<span class="hljs-title function_">Require</span> @<span class="hljs-title function_">Prop</span> <span class="hljs-variable">modifier</span>: <span class="hljs-title class_">AttributeModifier</span>&lt;<span class="hljs-title class_">ColumnAttribute</span>&gt;;</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Column</span>() {</li><li>      <span class="hljs-title function_">Text</span>(<span class="hljs-string">'Hello World'</span>)</li><li>    }.<span class="hljs-title function_">attributeModifier</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">modifier</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// When using dynamic attribute setting, you need to inherit AttributeModifier, implement a Modifier by yourself, and then set it to the required component.</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ColumnModifier</span> <span class="hljs-variable">implements</span> <span class="hljs-title class_">AttributeModifier</span>&lt;<span class="hljs-title class_">ColumnAttribute</span>&gt; {</li><li>  <span class="hljs-variable">width</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-variable">height</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-variable">backgroundColor</span>: <span class="hljs-title class_">ResourceColor</span> | <span class="hljs-title class_">undefined</span> = <span class="hljs-variable">undefined</span>;</li><li>
</li><li>  <span class="hljs-title function_">applyNormalAttribute</span>(<span class="hljs-variable">instance</span>: <span class="hljs-title class_">ColumnAttribute</span>): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-variable">instance</span>.<span class="hljs-title function_">width</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">width</span>);</li><li>    <span class="hljs-variable">instance</span>.<span class="hljs-title function_">height</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">height</span>);</li><li>    <span class="hljs-variable">instance</span>.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">backgroundColor</span>);</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/Component_Nesting_Optimization/entry/src/main/ets/segment/segment2.ets#L39-L81" target="_blank">segment2.ets</a></div></div></div></div> </div> <div class="tiledSection"><h3 id="section14129163191215">选择合适的布局组件<i class="anchor-icon anchor-icon-link" anchorid="section14129163191215" tips="复制节点链接"></i></h3><p>复杂布局提供了场景化的能力，解决一种或者多种布局场景。但是在一些场景下，不恰当的使用这些高级组件，可能带来更多的性能消耗。</p> <p>优化策略：</p> <ul><li>在相同嵌套层级的情况下，如果多种布局方式可以实现相同布局效果，优选低耗时的布局，如使用Column、Row替代Flex实现相同的单行布局。</li><li>在能够通过其他布局大幅优化节点数的情况下，可以使用高级组件替代，如使用RelativeContainer替代Row、Column实现扁平化布局，此时其收益大于布局组件本身的性能差距。</li><li>仅在必要的场景下使用高耗时的布局组件，如使用Flex实现折行布局、使用Grid实现二维网格布局等。</li></ul> <p>具体可以参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-improve-layout-performance#section12745188175420" target="_blank">合理使用布局组件</a></p> </div> <div class="tiledSection"><h3 id="section1012993119126">删除无用的Stack/Column/Row嵌套，移除冗余节点<i class="anchor-icon anchor-icon-link" anchorid="section1012993119126" tips="复制节点链接"></i></h3><p>在组件嵌套的情况中，可以找到一些无用的容器组件嵌套。在考虑组件嵌套优化中，可以删除掉无用容器组件嵌套，移除冗余节点，从而避免冗余节点对性能的消耗。</p> <p>优化方式：</p> <p>反例：</p> <div class="screenLinkPre"><div _ngcontent-qgq-c106="" class="highlight-div"><div _ngcontent-qgq-c106="" class="highlight-div-header"><div _ngcontent-qgq-c106="" class="highlight-div-header-left"><div _ngcontent-qgq-c106="" class="handle-button expand-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qgq-c106="" class="highlight-div-header-right"><div _ngcontent-qgq-c106="" class="handle-button ai-button"></div><div _ngcontent-qgq-c106="" class="handle-button line-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qgq-c106="" class="handle-button theme-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qgq-c106="" class="handle-button copy-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qgq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/Component_Nesting_Optimization/entry/src/main/ets/segment/segment3.ets#L8-L25" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Component</span></li><li>export struct example {</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-built_in">Column</span>() {</li><li>      <span class="hljs-built_in">Row</span>() {</li><li>        <span class="hljs-comment">// Custom Components</span></li><li>        <span class="hljs-built_in">FlowListStruct</span>(</li><li>          // Custom Component Passing Parameters</li><li>          // ...</li><li>        )</li><li>      }</li><li>      <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')</li><li>    }</li><li>    <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')</li><li>    <span class="hljs-selector-class">.height</span>('<span class="hljs-number">100%</span>')</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/Component_Nesting_Optimization/entry/src/main/ets/segment/segment3.ets#L8-L25" target="_blank">segment3.ets</a></div></div></div></div> <p>正例：</p> <div class="screenLinkPre"><div _ngcontent-qgq-c106="" class="highlight-div"><div _ngcontent-qgq-c106="" class="highlight-div-header"><div _ngcontent-qgq-c106="" class="highlight-div-header-left"><div _ngcontent-qgq-c106="" class="handle-button expand-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qgq-c106="" class="highlight-div-header-right"><div _ngcontent-qgq-c106="" class="handle-button ai-button"></div><div _ngcontent-qgq-c106="" class="handle-button line-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qgq-c106="" class="handle-button theme-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qgq-c106="" class="handle-button copy-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qgq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/Component_Nesting_Optimization/entry/src/main/ets/segment/segment3.ets#L28-L42" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Component</span></li><li>export struct example2 {</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-built_in">Column</span>() {</li><li>      <span class="hljs-comment">// Custom Components</span></li><li>      <span class="hljs-built_in">FlowListStruct</span>(</li><li>        // Custom Component Passing Parameters</li><li>        // ...</li><li>      )</li><li>    }</li><li>    <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')</li><li>    <span class="hljs-selector-class">.height</span>('<span class="hljs-number">100%</span>')</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/Component_Nesting_Optimization/entry/src/main/ets/segment/segment3.ets#L28-L42" target="_blank">segment3.ets</a></div></div></div></div> </div> <div class="tiledSection"><h3 id="section78181114123811">优先使用组件属性代替嵌套组件<i class="anchor-icon anchor-icon-link" anchorid="section78181114123811" tips="复制节点链接"></i></h3><p>在实现文本浮层、按压遮罩或颜色叠加等场景时，通常会采用Stack布局嵌套组件的方式。实际上有些场景直接使用组件属性或借助系统API的能力就能实现，例如使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-overlay#overlay" target="_blank">overlay</a>属性可以实现浮层场景，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-graphics#colormetrics12" target="_blank">ColorMetrics</a>可以实现颜色叠加效果。直接使用组件属性的方式可以减少Stack布局嵌套组件的使用，从而减少嵌套组件带来的节点数。以文本浮层场景为例，如下图所示，使用overlay属性实现文本浮层比Stack组件嵌套方式少了一层Stack节点。开发这一类场景时，推荐优先使用组件属性代替嵌套组件。</p> <div class="fignone"><span class="figcap"><b>图2 </b>使用组件属性代替嵌套组件示意图</span><br><span><img height="461.84250000000003" originheight="659" originwidth="1130" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163411.68979778104125540883315522234316:50001231000000:2800:1B76E2C1575CA4816C7BC0A366161D3EF4D532D59EFFC3338457B7CE0A983E5F.png" title="点击放大" width="791.7297149999999"></span></div> <p><strong>使用overlay属性实现浮层</strong></p> <p>使用overlay属性可以直接给组件添加浮层，实现堆叠的效果，常见的场景有文本浮层、按压遮罩等。相较于Stack布局嵌套组件的方式，使用overlay属性减少了Stack组件节点的创建。以增加文本浮层为例，具体优化示例如下所示。更多使用overlay属性实现浮层场景的示例可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-overlay#示例" target="_blank">浮层-示例</a>。</p> <p>反例：</p> <div class="screenLinkPre"><div _ngcontent-qgq-c106="" class="highlight-div"><div _ngcontent-qgq-c106="" class="highlight-div-header"><div _ngcontent-qgq-c106="" class="highlight-div-header-left"><div _ngcontent-qgq-c106="" class="handle-button expand-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qgq-c106="" class="highlight-div-header-right"><div _ngcontent-qgq-c106="" class="handle-button ai-button"></div><div _ngcontent-qgq-c106="" class="handle-button line-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qgq-c106="" class="handle-button theme-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qgq-c106="" class="handle-button copy-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qgq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/Component_Nesting_Optimization/entry/src/main/ets/segment/segment3.ets#L46-L61" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Entry</span></li><li><span class="hljs-keyword">@Component</span></li><li>struct StackNesting {</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-built_in">Column</span>() {</li><li>      <span class="hljs-built_in">Stack</span>() {</li><li>        <span class="hljs-built_in">Image</span>($r('app.media.startIcon'))</li><li>          <span class="hljs-selector-class">.objectFit</span>(ImageFit.Contain)</li><li>        Text('fragmentary text')</li><li>          <span class="hljs-selector-class">.fontSize</span>(<span class="hljs-number">20</span>)</li><li>          <span class="hljs-selector-class">.fontColor</span>(Color.Black)</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/Component_Nesting_Optimization/entry/src/main/ets/segment/segment3.ets#L46-L61" target="_blank">segment3.ets</a></div></div></div></div> <p>正例：</p> <div class="screenLinkPre"><div _ngcontent-qgq-c106="" class="highlight-div"><div _ngcontent-qgq-c106="" class="highlight-div-header"><div _ngcontent-qgq-c106="" class="highlight-div-header-left"><div _ngcontent-qgq-c106="" class="handle-button expand-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qgq-c106="" class="highlight-div-header-right"><div _ngcontent-qgq-c106="" class="handle-button ai-button"></div><div _ngcontent-qgq-c106="" class="handle-button line-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qgq-c106="" class="handle-button theme-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qgq-c106="" class="handle-button copy-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qgq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/Component_Nesting_Optimization/entry/src/main/ets/segment/segment4.ets#L2-L20" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">@Entry</span></li><li><span class="hljs-variable">@Component</span></li><li>struct OverlayExample {</li><li>  <span class="hljs-variable">@Builder</span></li><li>  <span class="hljs-built_in">OverlayNode</span>() {</li><li>    <span class="hljs-selector-tag">Text</span>(<span class="hljs-string">'fragmentary text'</span>)</li><li>      <span class="hljs-selector-class">.fontSize</span>(<span class="hljs-number">20</span>)</li><li>      <span class="hljs-selector-class">.fontColor</span>(Color.Black)</li><li>  }</li><li>
</li><li>  <span class="hljs-selector-tag">build</span>() {</li><li>    <span class="hljs-selector-tag">Column</span>() {</li><li>      <span class="hljs-selector-tag">Image</span>($<span class="hljs-built_in">r</span>(<span class="hljs-string">'app.media.startIcon'</span>))</li><li>        <span class="hljs-selector-class">.overlay</span>(this.<span class="hljs-built_in">OverlayNode</span>(), { align: Alignment.Center })</li><li>        <span class="hljs-selector-class">.objectFit</span>(ImageFit.Contain)</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/Component_Nesting_Optimization/entry/src/main/ets/segment/segment4.ets#L2-L20" target="_blank">segment4.ets</a></div></div></div></div> </div> <p><strong>使用</strong><strong>ColorMetrics</strong><strong>实现</strong><strong>颜色叠加</strong></p> <p>系统通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-graphics#colormetrics12" target="_blank">ColorMetrics</a>接口提供了颜色计算能力，可以用于颜色叠加显示的场景。同样，与Stack布局嵌套组件的方式相比，直接使用ColorMetrics能力可以减少Stack层的布局节点，具体优化示例如下所示。</p> <p>反例：</p> <div class="screenLinkPre"><div _ngcontent-qgq-c106="" class="highlight-div"><div _ngcontent-qgq-c106="" class="highlight-div-header"><div _ngcontent-qgq-c106="" class="highlight-div-header-left"><div _ngcontent-qgq-c106="" class="handle-button expand-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qgq-c106="" class="highlight-div-header-right"><div _ngcontent-qgq-c106="" class="handle-button ai-button"></div><div _ngcontent-qgq-c106="" class="handle-button line-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qgq-c106="" class="handle-button theme-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qgq-c106="" class="handle-button copy-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qgq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/Component_Nesting_Optimization/entry/src/main/ets/segment/segment5.ets#L2-L41" data-highlighted="yes"><ol class="linenums"><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ColorNormal</span> {</li><li>  @<span class="hljs-title function_">Prop</span> <span class="hljs-variable">isSelected</span>: <span class="hljs-title class_">boolean</span> = <span class="hljs-keyword">false</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Stack</span>() {</li><li>      <span class="hljs-title function_">Column</span>()</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">isSelected</span> ? <span class="hljs-variable">Color</span>.<span class="hljs-variable">Blue</span> : <span class="hljs-title class_">Color</span>.<span class="hljs-title class_">Grey</span>)</li><li>        .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">12</span>)</li><li>        .<span class="hljs-title function_">alignItems</span>(<span class="hljs-variable">HorizontalAlign</span>.<span class="hljs-variable">Center</span>)</li><li>        .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-variable">FlexAlign</span>.<span class="hljs-variable">Center</span>)</li><li>      <span class="hljs-title function_">Column</span>()</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">isSelected</span> ? <span class="hljs-string">"#99000000"</span> : <span class="hljs-title class_">Color</span>.<span class="hljs-title class_">Grey</span>)</li><li>        .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">12</span>)</li><li>        .<span class="hljs-title function_">alignItems</span>(<span class="hljs-variable">HorizontalAlign</span>.<span class="hljs-variable">Center</span>)</li><li>        .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-variable">FlexAlign</span>.<span class="hljs-variable">Center</span>)</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li>@<span class="hljs-title function_">Entry</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ColorOverlayStackExample</span> {</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">isSelected</span>: <span class="hljs-title class_">boolean</span> = <span class="hljs-keyword">false</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Scroll</span>() {</li><li>      <span class="hljs-title function_">Column</span>() {</li><li>        <span class="hljs-title function_">ColorNormal</span>({ <span class="hljs-variable">isSelected</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">isSelected</span> })</li><li>          .<span class="hljs-title function_">onClick</span>(() =&gt; {</li><li>            <span class="hljs-keyword">this</span>.<span class="hljs-variable">isSelected</span> = !<span class="hljs-keyword">this</span>.<span class="hljs-variable">isSelected</span>;</li><li>          })</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/Component_Nesting_Optimization/entry/src/main/ets/segment/segment5.ets#L2-L41" target="_blank">segment5.ets</a></div></div></div></div> <p>正例：</p> <div class="screenLinkPre"><div _ngcontent-qgq-c106="" class="highlight-div"><div _ngcontent-qgq-c106="" class="highlight-div-header"><div _ngcontent-qgq-c106="" class="highlight-div-header-left"><div _ngcontent-qgq-c106="" class="handle-button expand-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qgq-c106="" class="highlight-div-header-right"><div _ngcontent-qgq-c106="" class="handle-button ai-button"></div><div _ngcontent-qgq-c106="" class="handle-button line-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qgq-c106="" class="handle-button theme-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qgq-c106="" class="handle-button copy-button"><div _ngcontent-qgq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qgq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/Component_Nesting_Optimization/entry/src/main/ets/segment/segment6.ets#L2-L50" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ColorMetrics</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ColorMeasure</span> {</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">isSelected</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>()</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">isSelected</span> ? <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getBlendColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>, <span class="hljs-string">"#99000000"</span>).<span class="hljs-property">color</span> : <span class="hljs-title class_">Color</span>.<span class="hljs-property">Grey</span>)</li><li>      .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">12</span>)</li><li>      .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Center</span>)</li><li>      .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getBlendColor</span>(<span class="hljs-attr">baseColor</span>: <span class="hljs-title class_">ResourceColor</span>, <span class="hljs-attr">addColor</span>: <span class="hljs-title class_">ResourceColor</span>): <span class="hljs-title class_">ColorMetrics</span> {</li><li>    <span class="hljs-keyword">if</span> (!baseColor || !addColor) {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-title class_">ColorMetrics</span>.<span class="hljs-title function_">resourceColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>);</li><li>    }</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">sourceColor</span>: <span class="hljs-title class_">ColorMetrics</span>;</li><li>    <span class="hljs-keyword">try</span> {</li><li>      sourceColor = <span class="hljs-title class_">ColorMetrics</span>.<span class="hljs-title function_">resourceColor</span>(baseColor).<span class="hljs-title function_">blendColor</span>(<span class="hljs-title class_">ColorMetrics</span>.<span class="hljs-title function_">resourceColor</span>(addColor));</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-keyword">let</span> error = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to blend color, code = <span class="hljs-subst">${error.code}</span>, message =<span class="hljs-subst">${error.message}</span>`</span>);</li><li>      sourceColor = <span class="hljs-title class_">ColorMetrics</span>.<span class="hljs-title function_">resourceColor</span>(addColor);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> sourceColor;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ColorMetricsExample</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">isSelected</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Scroll</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">ColorMeasure</span>({ <span class="hljs-attr">isSelected</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">isSelected</span> })</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">isSelected</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">isSelected</span>;</li><li>          })</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/Component_Nesting_Optimization/entry/src/main/ets/segment/segment6.ets#L2-L50" target="_blank">segment6.ets</a></div></div></div></div> <div class="tiledSection"><h2 id="section0129173111219">实践数据对比<i class="anchor-icon anchor-icon-link" anchorid="section0129173111219" tips="复制节点链接"></i></h2><p>关于实践数据对比部分，具体可以参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-improve-layout-performance" target="_blank">布局优化指导</a>和<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-ui-component-performance-optimization" target="_blank">UI组件性能优化</a>的数据对比部分。</p> </div> <div class="tiledSection"><h2 id="section1078520389541">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section1078520389541" tips="复制节点链接"></i></h2><ul><li><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/tree/master/ArkUI/Component_Nesting_Optimization" target="_blank">组件嵌套优化</a></li></ul> </div> </div> <div></div></div>