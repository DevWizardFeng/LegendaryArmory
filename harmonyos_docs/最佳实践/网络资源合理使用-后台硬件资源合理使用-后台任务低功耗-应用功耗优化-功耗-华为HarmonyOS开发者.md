<h1 _ngcontent-hsc-c119="" class="doc-title ng-star-inserted" title="网络资源合理使用"> 网络资源合理使用 </h1>

<div _ngcontent-hsc-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>无长时任务的应用退到后台时，主动断开TCP和UDP连接。</p> <div class="tiledSection"><h2 id="section477543201116">约束<i class="anchor-icon anchor-icon-link" anchorid="section477543201116" tips="复制节点链接"></i></h2><p>如果应用不主动断开socket连接，系统将强制断开TCP连接。应用返回前台后，需主动重新创建连接。</p> </div> <div class="tiledSection"><h2 id="section99397509114">示例<i class="anchor-icon anchor-icon-link" anchorid="section99397509114" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section729719151210" class="firsth2">HTTP数据请求<i class="anchor-icon anchor-icon-link" anchorid="section729719151210" tips="复制节点链接"></i></h3><div class="screenLinkPre"><div _ngcontent-hsc-c106="" class="highlight-div"><div _ngcontent-hsc-c106="" class="highlight-div-header"><div _ngcontent-hsc-c106="" class="highlight-div-header-left"><div _ngcontent-hsc-c106="" class="handle-button expand-button"><div _ngcontent-hsc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hsc-c106="" class="highlight-div-header-right"><div _ngcontent-hsc-c106="" class="handle-button ai-button"></div><div _ngcontent-hsc-c106="" class="handle-button line-button"><div _ngcontent-hsc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hsc-c106="" class="handle-button theme-button"><div _ngcontent-hsc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hsc-c106="" class="handle-button copy-button"><div _ngcontent-hsc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hsc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/BptaUseResources/entry/src/main/ets/pages/Https.ets#L7-L25" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { http } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">onForeground</span>(): <span class="hljs-keyword">void</span> {</li><li>    <span class="hljs-comment">// Create an HTTP request based on the service requirements at the foreground</span></li><li>    <span class="hljs-keyword">let</span> httpRequest = http.<span class="hljs-title function_">createHttp</span>();</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onBackground</span>(): <span class="hljs-keyword">void</span> {</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-comment">// Go back to the background and release the http request</span></li><li>    httpRequest.<span class="hljs-title function_">destroy</span>();</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/BptaUseResources/entry/src/main/ets/pages/Https.ets#L7-L25" target="_blank">Https.ets</a></div></div></div></div> </div> <p>有关HTTP数据请求相关接口的使用，详情可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/http-request" target="_blank">使用HTTP访问网络</a>。</p> <div class="tiledSection"><h3 id="section10599349181310">Socket连接<i class="anchor-icon anchor-icon-link" anchorid="section10599349181310" tips="复制节点链接"></i></h3><div class="screenLinkPre"><div _ngcontent-hsc-c106="" class="highlight-div"><div _ngcontent-hsc-c106="" class="highlight-div-header"><div _ngcontent-hsc-c106="" class="highlight-div-header-left"><div _ngcontent-hsc-c106="" class="handle-button expand-button"><div _ngcontent-hsc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hsc-c106="" class="highlight-div-header-right"><div _ngcontent-hsc-c106="" class="handle-button ai-button"></div><div _ngcontent-hsc-c106="" class="handle-button line-button"><div _ngcontent-hsc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hsc-c106="" class="handle-button theme-button"><div _ngcontent-hsc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hsc-c106="" class="handle-button copy-button"><div _ngcontent-hsc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hsc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/BptaUseResources/entry/src/main/ets/pages/Socket.ets#L7-L28" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { socket } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-attr">tcp</span>: socket.<span class="hljs-property">TCPSocket</span> = socket.<span class="hljs-title function_">constructTCPSocketInstance</span>();</li><li>
</li><li>  <span class="hljs-title function_">onForeground</span>(): <span class="hljs-keyword">void</span> {</li><li>    <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">     * In the foreground, create a socket connection and send service data as required, for example:</span></li><li><span class="hljs-comment">     * this.tcp.bind(ipAddress, (err: BusinessError) =&gt; {})</span></li><li><span class="hljs-comment">     * this.tcp.connect(tcpConnect, (err: BusinessError) =&gt; {})</span></li><li><span class="hljs-comment">     * this.tcp.send(tcpSendOptions, (err: BusinessError) =&gt; {})</span></li><li><span class="hljs-comment">     */</span></li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onBackground</span>(): <span class="hljs-keyword">void</span> {</li><li>    <span class="hljs-comment">// Go back to the background and close the socket connection</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tcp</span>.<span class="hljs-title function_">close</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {})</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/BptaUseResources/entry/src/main/ets/pages/Socket.ets#L7-L28" target="_blank">Socket.ets</a></div></div></div></div> <p>有关网络Socket相关接口的使用，详情可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/socket-connection" target="_blank">使用Socket访问网络</a>。</p> </div> <div class="tiledSection"><h3 id="section18297231141">WebSocket连接<i class="anchor-icon anchor-icon-link" anchorid="section18297231141" tips="复制节点链接"></i></h3><div class="screenLinkPre"><div _ngcontent-hsc-c106="" class="highlight-div"><div _ngcontent-hsc-c106="" class="highlight-div-header"><div _ngcontent-hsc-c106="" class="highlight-div-header-left"><div _ngcontent-hsc-c106="" class="handle-button expand-button"><div _ngcontent-hsc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hsc-c106="" class="highlight-div-header-right"><div _ngcontent-hsc-c106="" class="handle-button ai-button"></div><div _ngcontent-hsc-c106="" class="handle-button line-button"><div _ngcontent-hsc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hsc-c106="" class="handle-button theme-button"><div _ngcontent-hsc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hsc-c106="" class="handle-button copy-button"><div _ngcontent-hsc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hsc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/BptaUseResources/entry/src/main/ets/pages/WebSocket.ets#L7-L37" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { webSocket } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-comment">// Create a websocket based on service requirements</span></li><li>  ws = webSocket.<span class="hljs-title function_">createWebSocket</span>();</li><li>
</li><li>
</li><li>  <span class="hljs-title function_">onForeground</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// Send data through websocket in the foreground</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ws</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'open'</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, value: <span class="hljs-built_in">Object</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"onopen,status:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(value));</li><li>      <span class="hljs-comment">// When an on ('open') event is received, you can communicate with the server through the send () method</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">ws</span>.<span class="hljs-title function_">send</span>(<span class="hljs-string">"Hello,server!"</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, value: <span class="hljs-built_in">boolean</span></span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">if</span> (!err) {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Messagesentsuccessfully"</span>);</li><li>        } <span class="hljs-keyword">else</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Failedtosendthemessage.Err:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>        }</li><li>      });</li><li>    });</li><li>  }</li><li>
</li><li>
</li><li>  <span class="hljs-title function_">onBackground</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// Backstage closes websocket</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ws</span>.<span class="hljs-title function_">close</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {});</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/BptaUseResources/entry/src/main/ets/pages/WebSocket.ets#L7-L37" target="_blank">WebSocket.ets</a></div></div></div></div> <p>有关网络WebSocket相关接口的使用，详情可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/websocket-connection" target="_blank">使用WebSocket访问网络</a>。</p> </div> </div> <div></div></div>