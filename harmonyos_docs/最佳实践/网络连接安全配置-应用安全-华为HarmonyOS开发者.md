<h1 _ngcontent-bvq-c119="" class="doc-title ng-star-inserted" title="网络连接安全配置"> 网络连接安全配置 </h1>

<div _ngcontent-bvq-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section157420101193">概述<i class="anchor-icon anchor-icon-link" anchorid="section157420101193" tips="复制节点链接"></i></h2><p>应用与服务器之间的数据传输需确保安全，保护数据的机密性和完整性，防止敏感数据被窃取和篡改。推荐使用传输层安全协议（TLS）保护数据安全。</p> <p>当应用通过HTTPS访问云侧服务器时，如果信任了用户安装的CA证书，用户可以通过网络代理工具（如Fiddler、Charles）对HTTPS消息进行中间人攻击，如查看、篡改请求和响应消息，这可能导致应用或云侧服务器产生安全风险。因此，通过HTTPS访问云侧服务器时，应配置CA证书进行合法性校验。</p> <p>本文介绍如何配置CA证书以进行合法性校验，避免应用或云侧服务器的安全风险。</p> <p><span><img height="296.5368" originheight="1072" originwidth="1928" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163355.93717080219457432459287642753391:50001231000000:2800:6318D8EDD7071D5ACC948190469403A5D77EF1664B3ACEF0D1862C14A3DC9547.png" title="点击放大" width="532"></span></p> </div> <div class="tiledSection"><h2 id="section1931216104718">配置CA证书对服务器进行合法性校验<i class="anchor-icon anchor-icon-link" anchorid="section1931216104718" tips="复制节点链接"></i></h2><p>当应用通过TLS协议连接服务器时，服务器会提供证书链来证明其身份，应用需要使用可信的CA（证书颁发机构）证书对服务器证书链进行合法性校验。</p> <p>服务器根据场景使用不同类型的CA颁发的证书链：</p> <ol><li>权威CA证书，如CFCA、GlobalSign CA机构的根CA证书，满足业界管理规范并通过审计认证，可信度高。</li><li>企业自建的CA证书，用于企业内部服务器的证书链。企业内部应用直接信任此类CA证书。</li></ol> <p>系统提供3种CA证书管理方式：</p> <ol><li>系统预置CA证书：系统预置了业界主流的权威CA证书。</li><li>应用管理的CA证书：应用可在Hap内预置可信的CA证书，如企业内部自建的CA证书。</li><li>用户安装的CA证书：通过系统设置界面安装的私有CA证书。这类证书可信度较低，可能被用于中间人攻击。</li></ol> <p>开发者应结合应用的业务场景，在不影响业务功能的前提下，合理设置可信CA证书的范围：</p> <ul><li>面向互联网用户的应用，建议只<a href="/consumer/cn/doc/best-practices/bpta-network-ca-security#section121091116142117">配置信任系统预置的CA证书</a>。</li><li>只访问企业内部服务器的应用，建议只<a href="/consumer/cn/doc/best-practices/bpta-network-ca-security#section05271716102218">配置信任应用管理的CA证书</a>。</li><li>同时访问企业内部服务器和互联网服务的应用，建议根据访问的服务器域名分别配置<a href="/consumer/cn/doc/best-practices/bpta-network-ca-security#section121091116142117">信任系统预置的CA证书</a>或<a href="/consumer/cn/doc/best-practices/bpta-network-ca-security#section05271716102218">应用管理的CA证书</a>。</li><li>应用开发和调测过程中需要进行网络抓包以定位问题和测试，建议仅在调测版本<a href="/consumer/cn/doc/best-practices/bpta-network-ca-security#section12518142215236">配置信任用户安装的CA证书</a>。</li><li>应用需支持通过企业代理服务器访问应用服务器，可信任企业MDM系统或设备管理员用户手动安装<a href="/consumer/cn/doc/best-practices/bpta-network-ca-security#section12518142215236">CA证书</a>。然而，设备管理员用户可能通过代理工具抓取应用网络数据，建议在应用层实施安全防护，如对敏感数据进行二次加密或签名。</li><li>对于需要较高网络安全的应用（如金融支付、银行类应用），配置CA证书后，通过<a href="/consumer/cn/doc/best-practices/bpta-network-ca-security#section4337175511234">SSL Pinning方式</a>绑定服务器证书的公钥，以增强安全性。</li></ul> </div> <div class="tiledSection"><h2 id="section5454123841911">网络连接安全配置<i class="anchor-icon anchor-icon-link" anchorid="section5454123841911" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section121091116142117" class="firsth2">配置信任系统预置的CA证书<i class="anchor-icon anchor-icon-link" anchorid="section121091116142117" tips="复制节点链接"></i></h3><div class="p">面向互联网用户提供服务的应用，通常只需信任系统预置的CA证书。<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/network-kit" target="_blank">Network Kit（网络服务）</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/remote-communication-kit-guide" target="_blank">Remote Communication Kit（远场通信服务）</a>的HTTPS连接已默认信任系统预置的CA证书。<div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>系统Network Kit和Remote Communication Kit的HTTPS连接默认信任系统预置的CA证书和用户安装的CA证书，可<a href="/consumer/cn/doc/best-practices/bpta-network-ca-security#section11935814273">配置不信任用户安装的CA证书</a>提升安全性。</p> </div></div></div> </div> <p>如果应用使用第三方库进行网络连接，需要手动设置系统预置的CA证书路径：/etc/security/certificates。</p> <p><strong>示例</strong></p> <p>使用三方库<a href="https://gitee.com/openharmony-sig/tpc_c_cplusplus/tree/master/thirdparty/curl" target="_blank">curl</a>进行HTTPS连接，通过下面代码设置信任的CA证书路径：</p> <div class="screenLinkPre"><div _ngcontent-bvq-c106="" class="highlight-div"><div _ngcontent-bvq-c106="" class="highlight-div-header"><div _ngcontent-bvq-c106="" class="highlight-div-header-left"><div _ngcontent-bvq-c106="" class="handle-button expand-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bvq-c106="" class="highlight-div-header-right"><div _ngcontent-bvq-c106="" class="handle-button ai-button"></div><div _ngcontent-bvq-c106="" class="handle-button line-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bvq-c106="" class="handle-button theme-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bvq-c106="" class="handle-button copy-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bvq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/Cybersecurity.md#L21-L21" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">curl_easy_setopt</span>(curl, CURLOPT_CATH, "/etc/security/certificates");</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/Cybersecurity.md#L21-L21" target="_blank">Cybersecurity.md</a></div></div></div></div> </div> <div class="tiledSection"><h3 id="section11935814273">配置不信任用户安装的CA证书<i class="anchor-icon anchor-icon-link" anchorid="section11935814273" tips="复制节点链接"></i></h3><p><strong>Network Kit和Remote Communication Kit配置不信任用户安装的CA证书</strong>：在src/main/resources/base/profile/network_config.json<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/http-request#配置证书校验" target="_blank">配置文件</a>中进行配置。</p> <div class="screenLinkPre"><div _ngcontent-bvq-c106="" class="highlight-div"><div _ngcontent-bvq-c106="" class="highlight-div-header"><div _ngcontent-bvq-c106="" class="highlight-div-header-left"><div _ngcontent-bvq-c106="" class="handle-button expand-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bvq-c106="" class="highlight-div-header-right"><div _ngcontent-bvq-c106="" class="handle-button ai-button"></div><div _ngcontent-bvq-c106="" class="handle-button line-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bvq-c106="" class="handle-button theme-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bvq-c106="" class="handle-button copy-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bvq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/Cybersecurity.md#L30-L36" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"network-security-config"</span>: {</li><li>    ... ...</li><li>  },</li><li>  <span class="hljs-string">"trust-global-user-ca"</span>: <span class="hljs-keyword">false</span>,  <span class="hljs-comment">//Configure whether to trust the CA certificate manually installed by the enterprise MDM system or device administrator. The default value is true</span></li><li>  <span class="hljs-string">"trust-current-user-ca"</span>: <span class="hljs-keyword">false</span>  <span class="hljs-comment">// Configure whether to trust the CA certificate installed by the current user. The default value is true</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/Cybersecurity.md#L30-L36" target="_blank">Cybersecurity.md</a></div></div></div></div> </div> <div class="tiledSection"><h3 id="section05271716102218">配置信任应用管理的CA证书<i class="anchor-icon anchor-icon-link" anchorid="section05271716102218" tips="复制节点链接"></i></h3><p>如果应用服务器使用企业内部自建的CA证书，可以在Hap包中预置这些CA证书，并配置信任。</p> <ul><li>Network Kit和Remote Communication Kit可以通过src/main/resources/base/profile/network_config.json文件进行配置。例如，可以将应用级信任的 CA 证书预置到/data/storage/el1/bundle/entry/resources/resfile/appCaCert目录，将特定域名信任的CA 证书预置到/data/storage/el1/bundle/entry/resources/resfile/domainCaCert目录。<div class="screenLinkPre"><div _ngcontent-bvq-c106="" class="highlight-div"><div _ngcontent-bvq-c106="" class="highlight-div-header"><div _ngcontent-bvq-c106="" class="highlight-div-header-left"><div _ngcontent-bvq-c106="" class="handle-button expand-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bvq-c106="" class="highlight-div-header-right"><div _ngcontent-bvq-c106="" class="handle-button ai-button"></div><div _ngcontent-bvq-c106="" class="handle-button line-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bvq-c106="" class="handle-button theme-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bvq-c106="" class="handle-button copy-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bvq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/Cybersecurity.md#L45-L70" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"network-security-config"</span>: {</li><li>    <span class="hljs-string">"base-config"</span>: {</li><li>      <span class="hljs-string">"trust-anchors"</span>: [</li><li>        {</li><li>          <span class="hljs-string">"certificates"</span>: <span class="hljs-string">"/data/storage/el1/bundle/entry/resources/resfile/appCaCert"</span></li><li>        }</li><li>      ]</li><li>    },</li><li>    <span class="hljs-string">"domain-config"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"domains"</span>: [</li><li>          {</li><li>            <span class="hljs-string">"include-subdomains"</span>: <span class="hljs-keyword">true</span>,</li><li>            <span class="hljs-string">"name"</span>: <span class="hljs-string">"example.com"</span></li><li>          }</li><li>        ],</li><li>        <span class="hljs-string">"trust-anchors"</span>: [</li><li>          {</li><li>            <span class="hljs-string">"certificates"</span>: <span class="hljs-string">"/data/storage/el1/bundle/entry/resources/resfile/domainCaCert"</span></li><li>          }</li><li>        ]</li><li>      }</li><li>    ]</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/Cybersecurity.md#L45-L70" target="_blank">Cybersecurity.md</a></div></div></div></div> <p>Network Kit也支持在发起HTTPS请求的代码中<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-http#httprequestoptions" target="_blank">指定信任的CA证书路径</a>：</p> <div class="screenLinkPre"><div _ngcontent-bvq-c106="" class="highlight-div"><div _ngcontent-bvq-c106="" class="highlight-div-header"><div _ngcontent-bvq-c106="" class="highlight-div-header-left"><div _ngcontent-bvq-c106="" class="handle-button expand-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bvq-c106="" class="highlight-div-header-right"><div _ngcontent-bvq-c106="" class="handle-button ai-button"></div><div _ngcontent-bvq-c106="" class="handle-button line-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bvq-c106="" class="handle-button theme-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bvq-c106="" class="handle-button copy-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bvq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/NetworkTrust.ets#L26-L37" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">httpRequest</span>.<span class="hljs-title function_">request</span>( <span class="hljs-string">'EXAMPLE_URL'</span>,  {</li><li>  <span class="hljs-variable">method</span>: <span class="hljs-title class_">http</span>.<span class="hljs-title class_">RequestMethod</span>.<span class="hljs-title class_">POST</span>,</li><li>  <span class="hljs-variable">header</span>: {</li><li>    <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span></li><li>  },</li><li>  <span class="hljs-variable">extraData</span>: <span class="hljs-string">'data to send'</span>,</li><li>  <span class="hljs-variable">expectDataType</span>: <span class="hljs-title class_">http</span>.<span class="hljs-title class_">HttpDataType</span>.<span class="hljs-title class_">STRING</span>,</li><li>  <span class="hljs-variable">connectTimeout</span>: <span class="hljs-number">60000</span>,</li><li>  <span class="hljs-variable">caPath</span>:<span class="hljs-string">'/data/storage/el1/bundle/entry/resources/resfile/domainCaCert'</span>, <span class="hljs-comment">// Specifies the trusted CA certificate path</span></li><li>}, (<span class="hljs-variable">err</span>: <span class="hljs-title class_">BusinessError</span>, <span class="hljs-variable">data</span>: <span class="hljs-title class_">http</span>.<span class="hljs-title class_">HttpResponse</span>) =&gt; {</li><li>  <span class="hljs-comment">// ...</span></li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/NetworkTrust.ets#L26-L37" target="_blank">NetworkTrust.ets</a></div></div></div></div> <p>Remote Communication Kit也支持在代码中<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/remote-communication-rcp#section1597118916425" target="_blank">指定信任的CA证书路径</a>：</p> <div class="screenLinkPre"><div _ngcontent-bvq-c106="" class="highlight-div"><div _ngcontent-bvq-c106="" class="highlight-div-header"><div _ngcontent-bvq-c106="" class="highlight-div-header-left"><div _ngcontent-bvq-c106="" class="handle-button expand-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bvq-c106="" class="highlight-div-header-right"><div _ngcontent-bvq-c106="" class="handle-button ai-button"></div><div _ngcontent-bvq-c106="" class="handle-button line-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bvq-c106="" class="handle-button theme-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bvq-c106="" class="handle-button copy-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bvq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/NetworkTrust.ets#L46-L53" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-variable">caPath</span>: <span class="hljs-title class_">rcp</span>.<span class="hljs-title class_">CertificateAuthority</span> = {</li><li>  <span class="hljs-variable">folderPath</span>: <span class="hljs-string">'/data/storage/el1/bundle/entry/resources/resfile/appCaCert'</span>, <span class="hljs-comment">// Specify trusted CA certificate path</span></li><li>}</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">securityConfig</span>: <span class="hljs-title class_">rcp</span>.<span class="hljs-title class_">SecurityConfiguration</span> = {</li><li>  <span class="hljs-variable">remoteValidation</span>: <span class="hljs-title class_">caPath</span></li><li>};</li><li><span class="hljs-comment">// Use the security configuration in the session creation</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">sessionWithSecurityConfig</span> = <span class="hljs-variable">rcp</span>.<span class="hljs-title function_">createSession</span>({ <span class="hljs-variable">requestConfiguration</span>: { <span class="hljs-variable">security</span>: <span class="hljs-title class_">securityConfig</span> } });</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/NetworkTrust.ets#L46-L53" target="_blank">NetworkTrust.ets</a></div></div></div></div> </li></ul> <div class="p"><div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>系统Network Kit和Remote Communication Kit在完成上述配置后，HTTPS连接仍信任系统预置的CA证书和用户安装的CA证书。如需提升安全性，可<a href="/consumer/cn/doc/best-practices/bpta-network-ca-security#section11935814273">配置不信任用户安装的CA证书</a>。</p> </div></div></div> </div> <ul><li>如果应用使用三方库进行网络连接，需要在代码中设置应用管理的CA证书路径。例如，使用三方库<a href="https://gitee.com/openharmony-sig/tpc_c_cplusplus/tree/master/thirdparty/curl" target="_blank">curl</a>进行HTTPS连接时，可以通过以下代码设置信任的CA证书路径：<div class="screenLinkPre"><div _ngcontent-bvq-c106="" class="highlight-div"><div _ngcontent-bvq-c106="" class="highlight-div-header"><div _ngcontent-bvq-c106="" class="highlight-div-header-left"><div _ngcontent-bvq-c106="" class="handle-button expand-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bvq-c106="" class="highlight-div-header-right"><div _ngcontent-bvq-c106="" class="handle-button ai-button"></div><div _ngcontent-bvq-c106="" class="handle-button line-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bvq-c106="" class="handle-button theme-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bvq-c106="" class="handle-button copy-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bvq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/Cybersecurity.md#L78-L78" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">curl_easy_setopt</span>(curl, CURLOPT_CATH, "/data/storage/el1/bundle/entry/resources/resfile/domainCaCert");</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/Cybersecurity.md#L78-L78" target="_blank">Cybersecurity.md</a></div></div></div></div> </li></ul> </div> <div class="tiledSection"><h3 id="section12518142215236">配置信任用户安装的CA证书<i class="anchor-icon anchor-icon-link" anchorid="section12518142215236" tips="复制节点链接"></i></h3><p>用户安装的CA证书可信度较低，除以下场景外，建议应用不信任用户安装的CA证书：</p> <ol><li>应用开发和调测过程中需要进行网络抓包以定位问题和测试。用户通过系统的设置界面安装的CA证书，保存在目录：<strong>/data/certificates/user_cacerts/{userid}</strong> ，其中 userid 从100开始。<p><strong>注意：</strong>在商用发布的应用版本中应该不信任用户安装的CA证书。</p> </li><li>面向2B企业应用的场景，应用需支持通过企业代理服务器访问应用服务器。设备需通过企业的MDM系统或设备管理员用户手工安装CA证书，并保存在目录：<strong>/data/certificates/user_cacerts/0</strong> 。</li></ol> </div> <div class="tiledSection"><h3 id="section4337175511234">配置SSL Pinning证书锁定<i class="anchor-icon anchor-icon-link" anchorid="section4337175511234" tips="复制节点链接"></i></h3><p>应用默认信任系统预置的CA证书。如果预置的CA颁发了不可信证书，应用将面临攻击风险。对于需要高网络安全的应用，如金融支付和银行类应用，可以通过配置SSL Pinning证书锁定方式，仅信任指定服务器证书的公钥。</p> <p>配置SSL Pinning支持两种方式。如果服务器域名固定，建议采用静态SSL Pinning。否则，采用动态SSL Pinning。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>SSL Pinning要求应用云侧服务器证书的公钥不能变化。如果公钥发生变化，需要修改应用内配置的证书公钥，否则应用的网络连接将失败。因此，建议SSL Pinning配置始终包含至少一个备用公钥。</p> <p>应用还可以设置SSL Pinning的到期时间。到期后，证书将不再被锁定，这有助于在服务器证书公钥变化时防止尚未更新的应用出现连接问题。然而，设置SSL Pinning的到期时间可能会使攻击者绕过证书锁定。</p> <p>请开发者评估并决定是否配置安全风险和SSL Pinning的限制约束。如果应用在应用层对敏感信息进行了加密或签名，则安全风险较低。</p> </div></div></div> <ol><li>通过network_config.json文件进行静态SSL Pinning配置：<div class="screenLinkPre"><div _ngcontent-bvq-c106="" class="highlight-div"><div _ngcontent-bvq-c106="" class="highlight-div-header"><div _ngcontent-bvq-c106="" class="highlight-div-header-left"><div _ngcontent-bvq-c106="" class="handle-button expand-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bvq-c106="" class="highlight-div-header-right"><div _ngcontent-bvq-c106="" class="handle-button ai-button"></div><div _ngcontent-bvq-c106="" class="handle-button line-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bvq-c106="" class="handle-button theme-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bvq-c106="" class="handle-button copy-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bvq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/Cybersecurity.md#L87-L109" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"network-security-config"</span>: {</li><li>    <span class="hljs-string">"domain-config"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"domains"</span>: [</li><li>          {</li><li>            <span class="hljs-string">"include-subdomains"</span>: <span class="hljs-keyword">true</span>,</li><li>            <span class="hljs-string">"name"</span>: <span class="hljs-string">"server.com"</span></li><li>          }</li><li>        ],</li><li>        <span class="hljs-string">"pin-set"</span>: {</li><li>          <span class="hljs-string">"expiration"</span>: <span class="hljs-string">"2024-11-08"</span>,</li><li>          <span class="hljs-string">"pin"</span>: [</li><li>            {</li><li>              <span class="hljs-string">"digest-algorithm"</span>: <span class="hljs-string">"sha256"</span>,</li><li>              <span class="hljs-string">"digest"</span>: <span class="hljs-string">"g8CsdcpyAKxmLoWFvMd2hC7ZDUy7L4E2NYOi1i8qEtE="</span> <span class="hljs-comment">// Hash of the server certificate public key</span></li><li>            }</li><li>          ]</li><li>        }</li><li>      }</li><li>    ]</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/Cybersecurity.md#L87-L109" target="_blank">Cybersecurity.md</a></div></div></div></div> <p>具体可参考配置指导的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/http-request#证书锁定" target="_blank">“证书锁定”</a>章节。</p> </li><li>通过在代码中动态设置进行动态SSL Pinning配置：<ul><li>Network Kit配置动态SSL Pinning：<div class="screenLinkPre"><div _ngcontent-bvq-c106="" class="highlight-div"><div _ngcontent-bvq-c106="" class="highlight-div-header"><div _ngcontent-bvq-c106="" class="highlight-div-header-left"><div _ngcontent-bvq-c106="" class="handle-button expand-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bvq-c106="" class="highlight-div-header-right"><div _ngcontent-bvq-c106="" class="handle-button ai-button"></div><div _ngcontent-bvq-c106="" class="handle-button line-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bvq-c106="" class="handle-button theme-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bvq-c106="" class="handle-button copy-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bvq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/Cybersecurity.md#L118-L126" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">certificatePinning</span>: [ <span class="hljs-comment">//Optional, supports dynamic setting of certificate lock configuration information. This property is supported since API 12</span></li><li>   {</li><li>     <span class="hljs-variable">publicKeyHash</span>: <span class="hljs-string">'g8CsdcpyAKxmLoWFvMd2hC7ZDUy7L4E2NYOi1i8qEtE='</span>, <span class="hljs-comment">// Hash of the server certificate public key</span></li><li>     <span class="hljs-variable">hashAlgorithm</span>: <span class="hljs-string">'SHA-256'</span> </li><li>   }, {</li><li>     <span class="hljs-variable">publicKeyHash</span>: <span class="hljs-string">'MGFiY2UyMDk5ZjEyMzI3MWQ4MDMyY2E4ODEzMmY3EtE='</span>, <span class="hljs-comment">// Hash of the secondary public key of the server certificate</span></li><li>     <span class="hljs-variable">hashAlgorithm</span>: <span class="hljs-string">'SHA-256'</span> </li><li>   }</li><li> ]</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/Cybersecurity.md#L118-L126" target="_blank">Cybersecurity.md</a></div></div></div></div> <p>具体可参考配置指导的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-http#httprequestoptions" target="_blank">“certificatePinning”参数说明</a>。</p> </li></ul> <ul><li>Remote Communication Kit配置动态SSL Pinning：<div class="screenLinkPre"><div _ngcontent-bvq-c106="" class="highlight-div"><div _ngcontent-bvq-c106="" class="highlight-div-header"><div _ngcontent-bvq-c106="" class="highlight-div-header-left"><div _ngcontent-bvq-c106="" class="handle-button expand-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bvq-c106="" class="highlight-div-header-right"><div _ngcontent-bvq-c106="" class="handle-button ai-button"></div><div _ngcontent-bvq-c106="" class="handle-button line-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bvq-c106="" class="handle-button theme-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bvq-c106="" class="handle-button copy-button"><div _ngcontent-bvq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bvq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/NetworkTrust.ets#L63-L76" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-variable">keyHash</span>: <span class="hljs-title class_">string</span> = <span class="hljs-string">'g8CsdcpyAKxmLoWFvMd2hC7ZDUy7L4E2NYOi1i8qEtE='</span>; <span class="hljs-comment">// Public key of the server certificate</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">session</span> = <span class="hljs-variable">rcp</span>.<span class="hljs-title function_">createSession</span>();</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">request</span> = <span class="hljs-variable">new</span> <span class="hljs-variable">rcp</span>.<span class="hljs-title function_">Request</span>(<span class="hljs-variable">HTTP_SERVER</span>);</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">pin</span>: <span class="hljs-title class_">rcp</span>.<span class="hljs-title class_">CertificatePinning</span> = {</li><li>  <span class="hljs-variable">kind</span>: <span class="hljs-string">'public-key'</span>,</li><li>  <span class="hljs-variable">publicKeyHash</span>: <span class="hljs-title class_">keyHash</span>,</li><li>  <span class="hljs-variable">hashAlgorithm</span>: <span class="hljs-string">'SHA-256'</span></li><li>};</li><li><span class="hljs-variable">request</span>.<span class="hljs-variable">configuration</span> = {</li><li>  <span class="hljs-variable">security</span>: {</li><li>    <span class="hljs-variable">certificatePinning</span>: <span class="hljs-title class_">pin</span>,</li><li>  }</li><li>};</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">resp</span> = <span class="hljs-variable">await</span> <span class="hljs-variable">session</span>.<span class="hljs-title function_">fetch</span>(<span class="hljs-variable">request</span>);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/NetworkTrust.ets#L63-L76" target="_blank">NetworkTrust.ets</a></div></div></div></div> <p>具体可参考配置指导的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/remote-communication-rcp#section1597118916425" target="_blank">“certificatePinning”参数说明</a>。</p> </li></ul> </li></ol> <p></p> </div> </div></div>