<h1 _ngcontent-qli-c119="" class="doc-title ng-star-inserted" title="自定义字体设置"> 自定义字体设置 </h1>

<div _ngcontent-qli-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section8162145104719">概述<i class="anchor-icon anchor-icon-link" anchorid="section8162145104719" tips="复制节点链接"></i></h2><p>在应用开发中，字体是用户界面的核心视觉元素之一，也是构建良好用户体验的关键要素之一，直接影响应用界面的美观性、可读性和用户体验。</p> <p>ArkUI提供了全面的字体控制能力，如自定义设置字体大小和字重；支持通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-font#registerfont" target="_blank">registerFont()</a>方法注册TTF和OTF自定义字体文件，或下载字体文件到沙箱内注册使用，实现字体的动态切换；支持省略号、自动缩放和换行控制等多种文本内容溢出处理策略，使开发者能够精细调整应用中的字体表现，满足应用多样化的设计需求。</p> <p>本文将介绍以下字体设置场景的实现：</p> <ul><li><a href="/consumer/cn/doc/best-practices/bpta-custom-font-settings#section148766114477">使用自定义字体显示文本</a></li><li><a href="/consumer/cn/doc/best-practices/bpta-custom-font-settings#section994084874710">从自定义字体恢复为系统字体</a></li><li><a href="/consumer/cn/doc/best-practices/bpta-custom-font-settings#section1635772719497">使字体大小跟随系统设置</a></li><li><a href="/consumer/cn/doc/best-practices/bpta-custom-font-settings#section161251820115015">使字体大小不跟随系统设置</a></li></ul> </div> <div class="tiledSection"><h2 id="section148766114477">使用自定义字体显示文本<i class="anchor-icon anchor-icon-link" anchorid="section148766114477" tips="复制节点链接"></i></h2><p><strong>场景描述</strong></p> <p>在字体设置中，点击选择字体列表中的某个字体后，页面的字体样式会发生变化。在退出应用重新进入后，默认显示退出前选择的字体样式。</p> <p><span><img height="549.2900000000001" originheight="1080" originwidth="523" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162952.10094077211044986901019319174284:50001231000000:2800:808339A47BD40EBAE0026172232470DA26DF908CDA8B734902263F6BA5B30A31.gif" title="点击放大" width="266"></span></p> <p><strong>实现原理</strong></p> <p><span style="color: rgb(0,0,0);">registerFont()</span>方法可以在字体管理器中注册自定义字体，支持注册TTF格式和OTF格式的字体文件。</p> <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-data-preferences" target="_blank">preferences (用户首选项)</a>则为应用提供了处理Key-Value键值型数据的能力，支持应用持久化轻量级数据，以及数据的修改和查询。</p> <p><strong>开发步骤</strong></p> <ol><li id="li1099532613615">创建首选项工具类PreferenceUtils，在类中定义如下方法：<ul><li>getTextFontPreference()方法：在其中通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-data-preferences#preferencesgetpreferencessync10" target="_blank">getPreferencesSync()</a>方法获取首选项实例。</li><li>saveModifyFont()方法：在其中通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-data-preferences#putsync10" target="_blank">putSync()</a>方法将传入的字体信息数据写入首选项实例中，再使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-data-preferences#flush" target="_blank">flush()</a>方法将数据持久化存储。</li><li>getFont()方法：在其中通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-data-preferences#getsync10" target="_blank">getSync()</a>方法从首选项实例中获取存储的数据。</li></ul> <div class="screenLinkPre"><div _ngcontent-qli-c106="" class="highlight-div"><div _ngcontent-qli-c106="" class="highlight-div-header"><div _ngcontent-qli-c106="" class="highlight-div-header-left"><div _ngcontent-qli-c106="" class="handle-button expand-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qli-c106="" class="highlight-div-header-right"><div _ngcontent-qli-c106="" class="handle-button ai-button"></div><div _ngcontent-qli-c106="" class="handle-button line-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qli-c106="" class="handle-button theme-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qli-c106="" class="handle-button copy-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qli-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/text-display-font/blob/master/entry/src/main/ets/common/CommonUtils.ets#L27-L134" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PreferenceUtils</span> {</li><li>  preference?: preferences.<span class="hljs-property">Preferences</span>;</li><li>
</li><li>  <span class="hljs-comment">// Get Preferences instance</span></li><li>  <span class="hljs-title function_">getTextFontPreference</span>(<span class="hljs-params">context: Context</span>) {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">preference</span> = preferences.<span class="hljs-title function_">getPreferencesSync</span>(context, { <span class="hljs-attr">name</span>: <span class="hljs-string">'TextFontPreference'</span> });</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'create preference success'</span>);</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-keyword">let</span> error = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`create preference failed. code: <span class="hljs-subst">${error.code}</span>, message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-comment">// Save Font</span></li><li>  <span class="hljs-title function_">saveModifyFont</span>(<span class="hljs-params">textFont: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">preference</span>?.<span class="hljs-title function_">putSync</span>(<span class="hljs-variable constant_">TEXT_FONT</span>, textFont);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">preference</span>?.<span class="hljs-title function_">flush</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">if</span> (err) {</li><li>          hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`Failed to flush. code:<span class="hljs-subst">${err.code}</span>, message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>          <span class="hljs-keyword">return</span>;</li><li>        }</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'Succeeded in flushing.'</span>);</li><li>      })</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-keyword">let</span> error = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>,</li><li>        <span class="hljs-string">`putSync or flush font preference data failed. code: <span class="hljs-subst">${error.code}</span>, message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// Get Font</span></li><li>  <span class="hljs-title function_">getFont</span>(): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">textFont</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>    <span class="hljs-keyword">try</span> {</li><li>      textFont = <span class="hljs-variable language_">this</span>.<span class="hljs-property">preference</span>?.<span class="hljs-title function_">getSync</span>(<span class="hljs-variable constant_">TEXT_FONT</span>, <span class="hljs-string">''</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-keyword">let</span> error = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`getSync font preference data failed. code: <span class="hljs-subst">${error.code}</span>, message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> textFont;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PreferenceUtils</span>();</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/text-display-font/blob/master/entry/src/main/ets/common/CommonUtils.ets#L27-L134" target="_blank">CommonUtils.ets</a></div></div></div></div> </li><li>在EntryAbility的onCreate()生命周期中，调用getTextFontPreference()方法获取首选项实例。<div class="screenLinkPre"><div _ngcontent-qli-c106="" class="highlight-div"><div _ngcontent-qli-c106="" class="highlight-div-header"><div _ngcontent-qli-c106="" class="highlight-div-header-left"><div _ngcontent-qli-c106="" class="handle-button expand-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qli-c106="" class="highlight-div-header-right"><div _ngcontent-qli-c106="" class="handle-button ai-button"></div><div _ngcontent-qli-c106="" class="handle-button line-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qli-c106="" class="handle-button theme-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qli-c106="" class="handle-button copy-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qli-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/text-display-font/blob/master/entry/src/main/ets/entryability/EntryAbility.ets#L31-L104" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">export</span> <span class="hljs-variable">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-variable">extends</span> <span class="hljs-variable">UIAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-variable">_want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-variable">_launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-title class_">LaunchParam</span>): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-comment">// Get preference instance</span></li><li>    <span class="hljs-variable">PreferenceUtils</span>.<span class="hljs-title function_">getTextFontPreference</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">context</span>);</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/text-display-font/blob/master/entry/src/main/ets/entryability/EntryAbility.ets#L31-L104" target="_blank">EntryAbility.ets</a></div></div></div></div> </li><li>定义registerMyFont()方法注册自定义字体。<p>在使用时，需要通过UIContext中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-uicontext#getfont" target="_blank">getFont()</a>方法获取当前UI上下文关联的Font对象，再通过该对象调用registerFont()方法注册字体。</p> <div class="screenLinkPre"><div _ngcontent-qli-c106="" class="highlight-div"><div _ngcontent-qli-c106="" class="highlight-div-header"><div _ngcontent-qli-c106="" class="highlight-div-header-left"><div _ngcontent-qli-c106="" class="handle-button expand-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qli-c106="" class="highlight-div-header-right"><div _ngcontent-qli-c106="" class="handle-button ai-button"></div><div _ngcontent-qli-c106="" class="handle-button line-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qli-c106="" class="handle-button theme-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qli-c106="" class="handle-button copy-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qli-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-php" codehub="https://gitee.com/harmonyos_samples/text-display-font/blob/master/entry/src/main/ets/common/CommonUtils.ets#L138-L155" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Register font</span></li><li>export <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">registerMyFont</span>(<span class="hljs-params">uiContext: UIContext</span>) </span>{</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-comment">// Register HarmonyOS Italic font through registrant Font</span></li><li>    uiContext.<span class="hljs-title function_ invoke__">getFont</span>().<span class="hljs-title function_ invoke__">registerFont</span>({</li><li>      <span class="hljs-attr">familyName</span>: <span class="hljs-variable">$r</span>(<span class="hljs-string">'app.string.HarmonyOS_Italic'</span>),</li><li>      familySrc: <span class="hljs-variable">$rawfile</span>(<span class="hljs-string">'HarmonyOS_SansItalic.ttf'</span>)</li><li>    });</li><li>    <span class="hljs-comment">// Register HarmonyOS Condensed font through registrant Font</span></li><li>    uiContext.<span class="hljs-title function_ invoke__">getFont</span>().<span class="hljs-title function_ invoke__">registerFont</span>({</li><li>      <span class="hljs-attr">familyName</span>: <span class="hljs-variable">$r</span>(<span class="hljs-string">'app.string.HarmonyOS_Condensed'</span>),</li><li>      familySrc: <span class="hljs-variable">$rawfile</span>(<span class="hljs-string">'HarmonyOS_Condensed.ttf'</span>)</li><li>    });</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    let error = err <span class="hljs-keyword">as</span> BusinessError;</li><li>    hilog.<span class="hljs-title function_ invoke__">error</span>(<span class="hljs-number">0x0000</span>, TAG, `registerFont failed. <span class="hljs-attr">code</span>: ${error.code}, <span class="hljs-attr">message</span>:${err.message}`);</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/text-display-font/blob/master/entry/src/main/ets/common/CommonUtils.ets#L138-L155" target="_blank">CommonUtils.ets</a></div></div></div></div> </li><li>通过@StorageLink装饰变量fontOffset，标识当前选择的字体。在页面aboutToAppear()生命周期中，调用registerMyFont()方法并传入UIContext，注册自定义字体，并通过PreferenceUtils类调用getFont()方法，获取首选项中存储的数据，赋值给fontOffset，实现退出重新进入应用后显示退出前选择的字体。<div class="screenLinkPre"><div _ngcontent-qli-c106="" class="highlight-div"><div _ngcontent-qli-c106="" class="highlight-div-header"><div _ngcontent-qli-c106="" class="highlight-div-header-left"><div _ngcontent-qli-c106="" class="handle-button expand-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qli-c106="" class="highlight-div-header-right"><div _ngcontent-qli-c106="" class="handle-button ai-button"></div><div _ngcontent-qli-c106="" class="handle-button line-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qli-c106="" class="handle-button theme-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qli-c106="" class="handle-button copy-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qli-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/text-display-font/blob/master/entry/src/main/ets/view/SettingsPage.ets#L23-L41" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@StorageLink(<span class="hljs-string">'fontOffset'</span>)</span> fontOffset: string = <span class="hljs-string">''</span>;</li><li><span class="hljs-comment">// ...</span></li><li>
</li><li>aboutToAppear() {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-comment">// Get font data from preferences</span></li><li>  <span class="hljs-keyword">this</span>.fontOffset = PreferenceUtils.getFont();</li><li>  <span class="hljs-comment">// Register font</span></li><li>  registerMyFont(<span class="hljs-keyword">this</span>.getUIContext());</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/text-display-font/blob/master/entry/src/main/ets/view/SettingsPage.ets#L23-L41" target="_blank">SettingsPage.ets</a></div></div></div></div> </li><li>在MenuItem的onChange()事件中修改fontOffset的值，并通过saveModifyFont()方法，将选择的字体数据写入首选项并持久化存储。<div class="screenLinkPre"><div _ngcontent-qli-c106="" class="highlight-div"><div _ngcontent-qli-c106="" class="highlight-div-header"><div _ngcontent-qli-c106="" class="highlight-div-header-left"><div _ngcontent-qli-c106="" class="handle-button expand-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qli-c106="" class="highlight-div-header-right"><div _ngcontent-qli-c106="" class="handle-button ai-button"></div><div _ngcontent-qli-c106="" class="handle-button line-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qli-c106="" class="handle-button theme-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qli-c106="" class="handle-button copy-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qli-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/text-display-font/blob/master/entry/src/main/ets/view/SettingsPage.ets#L50-L57" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">MenuItem</span>({</li><li>  <span class="hljs-variable">content</span>: <span class="hljs-title class_">item</span> === <span class="hljs-string">''</span> ? $<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.string.system_default'</span>) : <span class="hljs-title class_">item</span>,</li><li>  <span class="hljs-variable">endIcon</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">fontOffset</span> === <span class="hljs-variable">item</span> ? $<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.media.checkmark'</span>) : <span class="hljs-string">''</span></li><li>})</li><li>  .<span class="hljs-title function_">onChange</span>(() =&gt; {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">fontOffset</span> = <span class="hljs-variable">item</span>;</li><li>    <span class="hljs-variable">PreferenceUtils</span>.<span class="hljs-title function_">saveModifyFont</span>(<span class="hljs-variable">item</span>);</li><li>  })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/text-display-font/blob/master/entry/src/main/ets/view/SettingsPage.ets#L50-L57" target="_blank">SettingsPage.ets</a></div></div></div></div> </li><li>通过fontFamily属性传入变量fontOffset，使用注册的自定义字体改变字体样式。<div class="screenLinkPre"><div _ngcontent-qli-c106="" class="highlight-div"><div _ngcontent-qli-c106="" class="highlight-div-header"><div _ngcontent-qli-c106="" class="highlight-div-header-left"><div _ngcontent-qli-c106="" class="handle-button expand-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qli-c106="" class="highlight-div-header-right"><div _ngcontent-qli-c106="" class="handle-button ai-button"></div><div _ngcontent-qli-c106="" class="handle-button line-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qli-c106="" class="handle-button theme-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qli-c106="" class="handle-button copy-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qli-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/text-display-font/blob/master/entry/src/main/ets/view/SettingsPage.ets#L80-L98" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Example Text Content</span></li><li><span class="hljs-built_in">Column</span>() {</li><li>  Text($r('app.string.preview_text'))</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-selector-class">.fontFamily</span>(this.fontOffset)</li><li>}</li><li><span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')</li><li><span class="hljs-selector-class">.padding</span>(<span class="hljs-number">12</span>)</li><li><span class="hljs-selector-class">.margin</span>({ top: <span class="hljs-number">35</span> })</li><li><span class="hljs-selector-class">.backgroundColor</span>('#FFF')</li><li><span class="hljs-selector-class">.borderRadius</span>(<span class="hljs-number">16</span>)</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/text-display-font/blob/master/entry/src/main/ets/view/SettingsPage.ets#L80-L98" target="_blank">SettingsPage.ets</a></div></div></div></div> </li></ol> </div> <div class="tiledSection"><h2 id="section994084874710">从自定义字体恢复为系统字体<i class="anchor-icon anchor-icon-link" anchorid="section994084874710" tips="复制节点链接"></i></h2><p><strong>场景描述</strong></p> <p>在应用设置页面的字体设置中，点击选择系统默认字体，首页和设置页顶部的字体样式变为系统默认。退出并重新进入应用后，仍会显示系统默认字体。</p> <p><span><img height="549.2900000000001" originheight="1080" originwidth="523" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162952.49450960363651034867231932459269:50001231000000:2800:8EF0566AA3BEEE19D1D899C60FC7C3406D8B07E6E3FE12E0E34584DFB097B834.gif" title="点击放大" width="266"></span></p> <p><strong>实现原理</strong></p> <p>系统默认字体为无衬线字体HarmonyOS Sans，当fontFamily属性被显式设置为空字符串时，实际生效字体与不设置fontFamily时的效果一致，会回退到默认字体，字体样式、字重等其它属性可正常应用。</p> <p><strong>开发步骤</strong></p> <ol><li>方法定义参考：<a href="/consumer/cn/doc/best-practices/bpta-custom-font-settings#li1099532613615">使用自定义字体显示文本</a>。</li><li>在MenuItem的onChange()事件中修改fontOffset的值，并调用saveModifyFont()方法修改首选项的值。<div class="screenLinkPre"><div _ngcontent-qli-c106="" class="highlight-div"><div _ngcontent-qli-c106="" class="highlight-div-header"><div _ngcontent-qli-c106="" class="highlight-div-header-left"><div _ngcontent-qli-c106="" class="handle-button expand-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qli-c106="" class="highlight-div-header-right"><div _ngcontent-qli-c106="" class="handle-button ai-button"></div><div _ngcontent-qli-c106="" class="handle-button line-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qli-c106="" class="handle-button theme-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qli-c106="" class="handle-button copy-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qli-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/text-display-font/blob/master/entry/src/main/ets/view/SettingsPage.ets#L47-L67" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">Menu</span>() {</li><li>  <span class="hljs-title function_">ForEach</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">menuItemArr</span>, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">string</span>) =&gt; {</li><li>    <span class="hljs-title function_">MenuItem</span>({</li><li>      <span class="hljs-variable">content</span>: <span class="hljs-title class_">item</span> === <span class="hljs-string">''</span> ? $<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.string.system_default'</span>) : <span class="hljs-title class_">item</span>,</li><li>      <span class="hljs-variable">endIcon</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">fontOffset</span> === <span class="hljs-variable">item</span> ? $<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.media.checkmark'</span>) : <span class="hljs-string">''</span></li><li>    })</li><li>      .<span class="hljs-title function_">onChange</span>(() =&gt; {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">fontOffset</span> = <span class="hljs-variable">item</span>;</li><li>        <span class="hljs-variable">PreferenceUtils</span>.<span class="hljs-title function_">saveModifyFont</span>(<span class="hljs-variable">item</span>);</li><li>      })</li><li>  }, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">string</span>) =&gt; <span class="hljs-variable">item</span>)</li><li>}</li><li><span class="hljs-comment">// ...</span></li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/text-display-font/blob/master/entry/src/main/ets/view/SettingsPage.ets#L47-L67" target="_blank">SettingsPage.ets</a></div></div></div></div> </li><li>通过fontFamily属性传入变量fontOffset，使用注册的自定义字体改变字体样式。<div class="screenLinkPre"><div _ngcontent-qli-c106="" class="highlight-div"><div _ngcontent-qli-c106="" class="highlight-div-header"><div _ngcontent-qli-c106="" class="highlight-div-header-left"><div _ngcontent-qli-c106="" class="handle-button expand-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qli-c106="" class="highlight-div-header-right"><div _ngcontent-qli-c106="" class="handle-button ai-button"></div><div _ngcontent-qli-c106="" class="handle-button line-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qli-c106="" class="handle-button theme-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qli-c106="" class="handle-button copy-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qli-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/text-display-font/blob/master/entry/src/main/ets/view/SettingsPage.ets#L83-L90" data-highlighted="yes"><ol class="linenums"><li>Text($r(<span class="hljs-string">'app.string.preview_text'</span>))</li><li>  <span class="hljs-comment">// ...</span></li><li>  .fontFamily(<span class="hljs-keyword">this</span>.fontOffset)</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/text-display-font/blob/master/entry/src/main/ets/view/SettingsPage.ets#L83-L90" target="_blank">SettingsPage.ets</a></div></div></div></div> </li></ol> </div> <div class="tiledSection"><h2 id="section1635772719497">使字体大小跟随系统设置<i class="anchor-icon anchor-icon-link" anchorid="section1635772719497" tips="复制节点链接"></i></h2><p><strong>场景描述</strong></p> <p>在设置页面中，点击打开Toggle按钮，使页面字体大小跟随系统设置发生变化。此时，自定义字体大小和字重的Slider将被禁用，无法滑动或点击。</p> <p><span><img height="549.2900000000001" originheight="1080" originwidth="523" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162953.78114180621645326838677520669686:50001231000000:2800:B6F7793A4E2F056893CA965FE97A6B5461077BC2F00D5E924379D25FDA871674.gif" title="点击放大" width="266"></span></p> <p><strong>实现原理</strong></p> <p>在应用的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-configuration-file" target="_blank">app.json5</a>配置文件中，configuration标签是用于标识应用字体大小跟随系统变更的配置文件。当configuration的fontSizeScale属性取值为followSystem，且字体大小fontSize属性使用fp为像素单位时，在改变系统设置中的字体大小缩放比例后，应用中的字体也会相应变化。</p> <p><strong>开发步骤</strong></p> <ol><li>在AppScope/resources/base/profile下面定义配置文件xxx.json。<p>fontSizeScale属性取值（默认为nonFollowSystem不跟随系统）：</p> <ul><li>followSystem：跟随系统。</li><li>nonFollowSystem：不跟随系统。</li></ul> <div class="p">fontSizeMaxScale属性：用于设置应用字体大小在选择跟随系统后，相比系统字体的最大比例。<div _ngcontent-qli-c106="" class="highlight-div"><div _ngcontent-qli-c106="" class="highlight-div-header"><div _ngcontent-qli-c106="" class="highlight-div-header-left"><div _ngcontent-qli-c106="" class="handle-button expand-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qli-c106="" class="highlight-div-header-right"><div _ngcontent-qli-c106="" class="handle-button ai-button"></div><div _ngcontent-qli-c106="" class="handle-button line-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qli-c106="" class="handle-button theme-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qli-c106="" class="handle-button copy-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qli-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"configuration"</span>: {</li><li>    <span class="hljs-string">"fontSizeScale"</span>: <span class="hljs-string">"followSystem"</span>,</li><li>    <span class="hljs-string">"fontSizeMaxScale"</span>: <span class="hljs-string">"2"</span></li><li>  }</li><li>}</li></ol></pre></div></div> </div> </li><li>在app.json5配置文件中通过configuration字段，标识当前应用字体大小是否跟随系统配置。<div class="screenLinkPre"><div _ngcontent-qli-c106="" class="highlight-div"><div _ngcontent-qli-c106="" class="highlight-div-header"><div _ngcontent-qli-c106="" class="highlight-div-header-left"><div _ngcontent-qli-c106="" class="handle-button expand-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qli-c106="" class="highlight-div-header-right"><div _ngcontent-qli-c106="" class="handle-button ai-button"></div><div _ngcontent-qli-c106="" class="handle-button line-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qli-c106="" class="handle-button theme-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qli-c106="" class="handle-button copy-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qli-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/text-display-font/blob/master/AppScope/app.json5#L2-L12" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"app"</span>: {</li><li>    <span class="hljs-string">"bundleName"</span>: <span class="hljs-string">"com.example.textdisplayfont"</span>,</li><li>    <span class="hljs-string">"vendor"</span>: <span class="hljs-string">"example"</span>,</li><li>    <span class="hljs-string">"versionCode"</span>: <span class="hljs-number">1000000</span>,</li><li>    <span class="hljs-string">"versionName"</span>: <span class="hljs-string">"1.0.0"</span>,</li><li>    <span class="hljs-string">"icon"</span>: <span class="hljs-string">"$media:layered_image"</span>,</li><li>    <span class="hljs-string">"label"</span>: <span class="hljs-string">"$string:app_name"</span>,</li><li>    <span class="hljs-string">"configuration"</span>: <span class="hljs-string">"$profile:configuration"</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/text-display-font/blob/master/AppScope/app.json5#L2-L12" target="_blank">app.json5</a></div></div></div></div> </li><li>配置完成后应用字体大小和字重即可随系统设置发生变化。</li><li>在Toggle组件的onChange()方法中，修改变量toggleState的值。<div class="screenLinkPre"><div _ngcontent-qli-c106="" class="highlight-div"><div _ngcontent-qli-c106="" class="highlight-div-header"><div _ngcontent-qli-c106="" class="highlight-div-header-left"><div _ngcontent-qli-c106="" class="handle-button expand-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qli-c106="" class="highlight-div-header-right"><div _ngcontent-qli-c106="" class="handle-button ai-button"></div><div _ngcontent-qli-c106="" class="handle-button line-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qli-c106="" class="handle-button theme-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qli-c106="" class="handle-button copy-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qli-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/text-display-font/blob/master/entry/src/main/ets/view/SettingsPage.ets#L113-L116" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">Toggle</span>({ <span class="hljs-keyword">type</span>: <span class="hljs-title class_">ToggleType</span>.<span class="hljs-title class_">Switch</span>, <span class="hljs-variable">isOn</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">toggleState</span> })</li><li>  .<span class="hljs-title function_">onChange</span>((<span class="hljs-variable">isOn</span>: <span class="hljs-title class_">boolean</span>) =&gt; {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">toggleState</span> = <span class="hljs-variable">isOn</span>;</li><li>  })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/text-display-font/blob/master/entry/src/main/ets/view/SettingsPage.ets#L113-L116" target="_blank">SettingsPage.ets</a></div></div></div></div> </li><li>根据toggleState的值，控制Slider组件是否可交互。<p>当toggleState为true时，表示跟随系统，Slider不可点击或滑动；为false时，表示不跟随系统，Slider可以点击或滑动。</p> <div class="screenLinkPre"><div _ngcontent-qli-c106="" class="highlight-div"><div _ngcontent-qli-c106="" class="highlight-div-header"><div _ngcontent-qli-c106="" class="highlight-div-header-left"><div _ngcontent-qli-c106="" class="handle-button expand-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qli-c106="" class="highlight-div-header-right"><div _ngcontent-qli-c106="" class="handle-button ai-button"></div><div _ngcontent-qli-c106="" class="handle-button line-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qli-c106="" class="handle-button theme-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qli-c106="" class="handle-button copy-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qli-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/text-display-font/blob/master/entry/src/main/ets/view/SettingsPage.ets#L145-L153" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">Slider</span>({</li><li>  <span class="hljs-variable">min</span>: -<span class="hljs-number">4</span>,</li><li>  <span class="hljs-variable">max</span>: <span class="hljs-number">4</span>,</li><li>  <span class="hljs-variable">value</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">fontSizeOffset</span>,</li><li>  <span class="hljs-variable">style</span>: <span class="hljs-title class_">SliderStyle</span>.<span class="hljs-title class_">InSet</span></li><li>})</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)</li><li>  .<span class="hljs-title function_">margin</span>({ <span class="hljs-variable">top</span>: <span class="hljs-number">12</span> })</li><li>  .<span class="hljs-title function_">enabled</span>(!<span class="hljs-keyword">this</span>.<span class="hljs-variable">toggleState</span>)</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/text-display-font/blob/master/entry/src/main/ets/view/SettingsPage.ets#L145-L153" target="_blank">SettingsPage.ets</a></div></div></div></div> </li></ol> </div> <div class="tiledSection"><h2 id="section161251820115015">使字体大小不跟随系统设置<i class="anchor-icon anchor-icon-link" anchorid="section161251820115015" tips="复制节点链接"></i></h2><p><strong>场景描述</strong></p> <p>在设置页中点击关闭Toggle按钮，通过Slider组件可以调整页面字体大小。在系统设置中调整字体大小，页面字体不会发生变化。</p> <p><span><img height="549.2900000000001" originheight="1080" originwidth="523" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162953.27879729067859884347816404710764:50001231000000:2800:44219F6BB612BD6665172E15E69B33E5865E5F8E62BD59C0BB075676F249CBFA.gif" title="点击放大" width="266"></span></p> <p><strong>实现原理</strong></p> <p>在应用的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-configuration-file" target="_blank">app.json5</a>配置文件中，通过configuration标签标识了应用字体跟随系统设置，当字体大小fontSize属性使用屏幕物理像素单位px时，页面字体大小将不再受系统设置的影响。</p> <p><strong>开发步骤</strong></p> <ol><li>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-display#displaygetdefaultdisplaysync9" target="_blank">getDefaultDisplaySync()</a>方法获取display屏幕实例对象，然后通过该display对象获取设备的物理像素密度<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-display#display" target="_blank">densityDPI</a>。将字体大小fp为单位的数值传入fp2pxUtil()方法，将其转换为对应的px数值。<div class="screenLinkPre"><div _ngcontent-qli-c106="" class="highlight-div"><div _ngcontent-qli-c106="" class="highlight-div-header"><div _ngcontent-qli-c106="" class="highlight-div-header-left"><div _ngcontent-qli-c106="" class="handle-button expand-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qli-c106="" class="highlight-div-header-right"><div _ngcontent-qli-c106="" class="handle-button ai-button"></div><div _ngcontent-qli-c106="" class="handle-button line-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qli-c106="" class="handle-button theme-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qli-c106="" class="handle-button copy-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qli-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/text-display-font/blob/master/entry/src/main/ets/common/CommonUtils.ets#L159-L172" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Convert fp to px</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fp2pxUtil</span>(<span class="hljs-params">fp: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">string</span> {</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-attr">pxStr</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'px'</span>;</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">pxVal</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">displayClass</span>: display.<span class="hljs-property">Display</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    displayClass = display.<span class="hljs-title function_">getDefaultDisplaySync</span>();</li><li>    pxVal = fp * (displayClass.<span class="hljs-property">densityDPI</span> / <span class="hljs-number">160</span>);</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-keyword">let</span> error = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`get densityDPI failed. code: <span class="hljs-subst">${error.code}</span>, message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-keyword">return</span> pxVal + pxStr;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/text-display-font/blob/master/entry/src/main/ets/common/CommonUtils.ets#L159-L172" target="_blank">CommonUtils.ets</a></div></div></div></div> </li><li>在页面中通过判断toggleState变量的值，控制字体单位的切换，实现页面字体是否跟随系统设置。<ul><li>当toggleState为true时：使用number类型的值，以fp为像素单位，页面字体跟随系统设置。</li><li>当toggleState为false时：调用fp2pxUtil()方法，传入具体数值转为以px为单位的值，使页面字体不跟随系统设置。</li></ul> <div class="screenLinkPre"><div _ngcontent-qli-c106="" class="highlight-div"><div _ngcontent-qli-c106="" class="highlight-div-header"><div _ngcontent-qli-c106="" class="highlight-div-header-left"><div _ngcontent-qli-c106="" class="handle-button expand-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qli-c106="" class="highlight-div-header-right"><div _ngcontent-qli-c106="" class="handle-button ai-button"></div><div _ngcontent-qli-c106="" class="handle-button line-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qli-c106="" class="handle-button theme-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qli-c106="" class="handle-button copy-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qli-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/text-display-font/blob/master/entry/src/main/ets/view/SettingsPage.ets#L74-L77" data-highlighted="yes"><ol class="linenums"><li>Text($r('app.string.setting'))</li><li>  <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')</li><li>  <span class="hljs-selector-class">.fontWeight</span>(<span class="hljs-number">700</span>)</li><li>  <span class="hljs-selector-class">.fontSize</span>(this.toggleState ? <span class="hljs-number">26</span> : fp2pxUtil(<span class="hljs-number">26</span>))</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/text-display-font/blob/master/entry/src/main/ets/view/SettingsPage.ets#L74-L77" target="_blank">SettingsPage.ets</a></div></div></div></div> </li></ol> </div> <div class="tiledSection"><h2 id="section151031231283">常见问题<i class="anchor-icon anchor-icon-link" anchorid="section151031231283" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section1079883442818" class="firsth2">如何获取系统缩放比例系数来修改应用内字体大小<i class="anchor-icon anchor-icon-link" anchorid="section1079883442818" tips="复制节点链接"></i></h3><ol><li>在app.json5中不配置configuration标签，或者在configuration标签指定的文件中，将fontSizeScale属性取值为nonFollowSystem不跟随系统，使应用字体大小不随系统设置发生变化。</li><li>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-environmentcallback#onconfigurationupdated" target="_blank">onConfigurationUpdated()</a>获取系统设置中字体大小缩放比例fontSizeScale、字体粗细缩放比例fontWeightScale等变化的信息，再通过ApplicationContext.on('environment')对系统环境变化进行监听，可参考如下示例：<div class="screenLinkPre"><div _ngcontent-qli-c106="" class="highlight-div"><div _ngcontent-qli-c106="" class="highlight-div-header"><div _ngcontent-qli-c106="" class="highlight-div-header-left"><div _ngcontent-qli-c106="" class="handle-button expand-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qli-c106="" class="highlight-div-header-right"><div _ngcontent-qli-c106="" class="handle-button ai-button"></div><div _ngcontent-qli-c106="" class="handle-button line-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qli-c106="" class="handle-button theme-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qli-c106="" class="handle-button copy-button"><div _ngcontent-qli-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qli-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/text-display-font/blob/master/entry/src/main/ets/entryability/EntryAbility.ets#L37-L49" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// System environment change information</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">envCallback</span>: <span class="hljs-title class_">EnvironmentCallback</span> = {</li><li>  <span class="hljs-title function_">onConfigurationUpdated</span>(<span class="hljs-params">config</span>) {</li><li>    envFont.<span class="hljs-property">fontSizeScale</span> = config.<span class="hljs-property">fontSizeScale</span>; <span class="hljs-comment">// Font size scaling ratio</span></li><li>    envFont.<span class="hljs-property">fontWeightScale</span> = config.<span class="hljs-property">fontWeightScale</span>; <span class="hljs-comment">// Font thickness scaling ratio</span></li><li>  },</li><li>  <span class="hljs-title function_">onMemoryLevel</span>(<span class="hljs-params">level</span>) {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onMemoryLevel level: <span class="hljs-subst">${level}</span>`</span>);</li><li>  }</li><li>}</li><li><span class="hljs-keyword">let</span> appContext = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">getApplicationContext</span>();</li><li><span class="hljs-comment">// Register to monitor changes in the system environment</span></li><li>callbackId = appContext.<span class="hljs-title function_">on</span>(<span class="hljs-string">'environment'</span>, envCallback);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/text-display-font/blob/master/entry/src/main/ets/entryability/EntryAbility.ets#L37-L49" target="_blank">EntryAbility.ets</a></div></div></div></div> </li><li>在需要修改字体大小的位置，将基础字体大小 * 字体大小缩放系数的值，传入fontSize()属性即可。</li></ol> </div> <div class="tiledSection"><h2 id="section98041312248">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section98041312248" tips="复制节点链接"></i></h2><ul><li><a href="https://gitee.com/harmonyos_samples/text-display-font" target="_blank">实现字体设置功能</a></li></ul> </div> </div></div>