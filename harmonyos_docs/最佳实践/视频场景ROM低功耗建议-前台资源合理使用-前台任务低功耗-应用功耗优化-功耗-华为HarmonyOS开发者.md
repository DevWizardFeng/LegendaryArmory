<h1 _ngcontent-pjv-c119="" class="doc-title ng-star-inserted" title="视频场景ROM低功耗建议"> 视频场景ROM低功耗建议 </h1>

<div _ngcontent-pjv-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section103291628287">建议<i class="anchor-icon anchor-icon-link" anchorid="section103291628287" tips="复制节点链接"></i></h2></div> <p>视频和小视频在线播放时，不建议将片源全部下载到ROM中。下载到ROM的功耗比仅加载到DDR中高100mA以上。因此，应避免将片源全部下载到ROM。</p> <div class="tiledSection"><h2 id="section7181529165813">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section7181529165813" tips="复制节点链接"></i></h2><p>推荐使用异步接口fileIo.write()写文件到ROM，函数的返回值number为实际写入的数据长度（单位：字节）。统计返回值的累计值，该累计值表示应用在一段时间内写入ROM的文件总大小。为确保视频和小视频在线播放时，文件下载速率不超过20MB/min。</p> <div class="screenLinkPre"><div _ngcontent-pjv-c106="" class="highlight-div"><div _ngcontent-pjv-c106="" class="highlight-div-header"><div _ngcontent-pjv-c106="" class="highlight-div-header-left"><div _ngcontent-pjv-c106="" class="handle-button expand-button"><div _ngcontent-pjv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pjv-c106="" class="highlight-div-header-right"><div _ngcontent-pjv-c106="" class="handle-button ai-button"></div><div _ngcontent-pjv-c106="" class="handle-button line-button"><div _ngcontent-pjv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pjv-c106="" class="handle-button theme-button"><div _ngcontent-pjv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pjv-c106="" class="handle-button copy-button"><div _ngcontent-pjv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pjv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/RationalUseOfFrontEndResources/entry/src/main/ets/pages/VideoScenesROMRule.ets#L26-L36" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-variable">filePath</span>: <span class="hljs-title class_">string</span> = <span class="hljs-variable">pathDir</span> + <span class="hljs-string">"/test.txt"</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">file</span>: <span class="hljs-title class_">fileIo</span>.<span class="hljs-title class_">File</span> = <span class="hljs-variable">fileIo</span>.<span class="hljs-title function_">openSync</span>(<span class="hljs-variable">filePath</span>, <span class="hljs-variable">fileIo</span>.<span class="hljs-variable">OpenMode</span>.<span class="hljs-variable">READ_WRITE</span> | <span class="hljs-variable">fileIo</span>.<span class="hljs-variable">OpenMode</span>.<span class="hljs-variable">CREATE</span>);</li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">str</span>: <span class="hljs-title class_">string</span> = <span class="hljs-string">"hello, world"</span>;</li><li><span class="hljs-comment">// Use asynchronous methods to write files to the ROM</span></li><li><span class="hljs-variable">fileIo</span>.<span class="hljs-title function_">write</span>(<span class="hljs-variable">file</span>.<span class="hljs-variable">fd</span>, <span class="hljs-variable">str</span>).<span class="hljs-title function_">then</span>((<span class="hljs-variable">writeLen</span>: <span class="hljs-title class_">number</span>) =&gt; {</li><li>  <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Sample'</span>, <span class="hljs-string">'write data to file succeed and size is:'</span> + <span class="hljs-variable">writeLen</span>);</li><li>}).<span class="hljs-keyword">catch</span>((<span class="hljs-variable">err</span>: <span class="hljs-title class_">BusinessError</span>) =&gt; {</li><li>  <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Sample'</span>, <span class="hljs-string">'write data to file failed with error message: '</span> + <span class="hljs-variable">err</span>.<span class="hljs-variable">message</span> + <span class="hljs-string">', error code: '</span> + <span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>);</li><li>}).<span class="hljs-keyword">finally</span>(() =&gt; {</li><li>  <span class="hljs-variable">fileIo</span>.<span class="hljs-title function_">closeSync</span>(<span class="hljs-variable">file</span>);</li><li>});</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/RationalUseOfFrontEndResources/entry/src/main/ets/pages/VideoScenesROMRule.ets#L26-L36" target="_blank">VideoScenesROMRule.ets</a></div></div></div></div> </div> <div class="tiledSection"><h2 id="section894815155911">调测验证<i class="anchor-icon anchor-icon-link" anchorid="section894815155911" tips="复制节点链接"></i></h2><p>通过查看storage_info节点的信息，如下所示：Total Host Write Data表示整机下载文件的总大小（单位为100MB）。建议文件下载的总速率不超过20MB/min。以视频播放10分钟为例，测试前后的Total Host Write Data节点差值应小于或等于2，符合要求。</p> <p><span><img height="230.24960000000002" originheight="283" originwidth="828" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163445.56464290228000960426274153233826:50001231000000:2800:C3C74AAF6E351CC02D5CB4D853A0C91CB3298231D911A413EA638E46127AA2A6.png" title="点击放大" width="665.9842000000001"></span></p> </div> </div> <div></div></div>