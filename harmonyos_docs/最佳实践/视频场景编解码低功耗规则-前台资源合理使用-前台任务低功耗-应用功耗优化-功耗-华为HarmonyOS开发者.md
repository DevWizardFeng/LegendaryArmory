<h1 _ngcontent-mfr-c119="" class="doc-title ng-star-inserted" title="视频场景编解码低功耗规则"> 视频场景编解码低功耗规则 </h1>

<div _ngcontent-mfr-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section103291628287">规则<i class="anchor-icon anchor-icon-link" anchorid="section103291628287" tips="复制节点链接"></i></h2></div> <ul><li>视频应用需使用视频硬件编解码器。</li><li>视频场景应使用专用硬件解码器(VDEC)，其功耗效率显著优于CPU软解码。因此，应使用平台的视频硬件编解码器进行视频播放。</li></ul> <div class="tiledSection"><h2 id="section7181529165813">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section7181529165813" tips="复制节点链接"></i></h2></div> <p>调用OH_AVCodec相关接口，使用视频硬件编解码器处理视频。</p> <div class="screenLinkPre"><div _ngcontent-mfr-c106="" class="highlight-div"><div _ngcontent-mfr-c106="" class="highlight-div-header"><div _ngcontent-mfr-c106="" class="highlight-div-header-left"><div _ngcontent-mfr-c106="" class="handle-button expand-button"><div _ngcontent-mfr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mfr-c106="" class="highlight-div-header-right"><div _ngcontent-mfr-c106="" class="handle-button ai-button"></div><div _ngcontent-mfr-c106="" class="handle-button line-button"><div _ngcontent-mfr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mfr-c106="" class="handle-button theme-button"><div _ngcontent-mfr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mfr-c106="" class="handle-button copy-button"><div _ngcontent-mfr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mfr-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/RationalUseOfFrontEndResources/entry/src/main/cpp/VideoSceneEncoding.cpp#L25-L33" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// To create a decoder using a codec name, if the application has special requirements, such as selecting a decoder that supports a certain resolution specification, </span></li><li><span class="hljs-comment">// the capability can be queried first, and then the decoder can be created based on the codec name.</span></li><li>OH_AVCapability *capability = <span class="hljs-built_in">OH_AVCodec_GetCapability</span>(OH_AVCODEC_MIMETYPE_VIDEO_AVC, <span class="hljs-literal">false</span>);</li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *name = <span class="hljs-built_in">OH_AVCapability_GetName</span>(capability);</li><li><span class="hljs-comment">// Create a decoder through mimetype</span></li><li><span class="hljs-comment">// Hard solution: Create H264 decoder. When there are multiple optional decoders, the system will create the most suitable decoder</span></li><li>OH_AVCodec *videoDec = <span class="hljs-built_in">OH_VideoDecoder_CreateByMime</span>(OH_AVCODEC_MIMETYPE_VIDEO_AVC);</li><li><span class="hljs-comment">// Hard solution: Create H265 decoder</span></li><li>OH_AVCodec *videoDecH = <span class="hljs-built_in">OH_VideoDecoder_CreateByMime</span>(OH_AVCODEC_MIMETYPE_VIDEO_HEVC);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/RationalUseOfFrontEndResources/entry/src/main/cpp/VideoSceneEncoding.cpp#L25-L33" target="_blank">VideoSceneEncoding.cpp</a></div></div></div></div> <div class="tiledSection"><h2 id="section894815155911">调测验证<i class="anchor-icon anchor-icon-link" anchorid="section894815155911" tips="复制节点链接"></i></h2><ul><li>方法一：在命令提示符窗口中，输入hdc shell top命令，查看当前系统的top进程的CPU占用率。如果av_codec_service进程的CPU负载率超过 5%，则说明视频硬解码已启用。<p><span><img height="233.08489400000002" originheight="354" originwidth="865" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163445.07041527842813474793954837212759:50001231000000:2800:26B68820E2DE7D36A902CAF68A1569691C715F3CF321C9C6327BC0399FE447F9.png" title="点击放大" width="569.5725"></span></p> </li></ul> <ul><li>方法二：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-insight-session-time" target="_blank">通过DevEco Studio Profiler抓取systrace</a><p>通过systrace确认av_codec_service进程的负载，如下图所示。业务频繁唤醒且有实际函数运行，说明视频处于硬解码状态。</p> <p><span><img height="256.123021" originheight="482" originwidth="1070" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163445.51620298411261172125293751359288:50001231000000:2800:31FD2D057ABE60DF512B1C7BF1D3D891C9791E40707D7C3A965014BAB3C0B83A.png" title="点击放大" width="568.575"></span></p> </li></ul> </div> </div> <div></div></div>