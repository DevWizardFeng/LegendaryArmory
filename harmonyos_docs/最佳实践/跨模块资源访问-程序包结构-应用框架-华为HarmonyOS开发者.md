<h1 _ngcontent-aau-c119="" class="doc-title ng-star-inserted" title="跨模块资源访问"> 跨模块资源访问 </h1>

<div _ngcontent-aau-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section124251071488">概述<i class="anchor-icon anchor-icon-link" anchorid="section124251071488" tips="复制节点链接"></i></h2>          <p>随着应用复杂度的增加，将应用划分为多个独立的模块有助于提高代码的可维护性和可扩展性。特别是在大型项目中，不同团队负责不同的模块（如HAR/HSP模块），当某些资源（如图标、颜色、字符串等）被多个模块复用时，可以将其集中管理在某个模块中给其他模块使用，从而减少重复定义，便于资源管理，提升开发效率。</p>     <p>在HarmonyOS中应用模块化设计一般使用HAR和HSP来共享资源，本文将介绍如何实现跨模块访问HAR和HSP里面的资源。</p>    </div>    <div class="tiledSection">     <h2 id="section17921546133810">跨模块访问HAR资源<i class="anchor-icon anchor-icon-link" anchorid="section17921546133810" tips="复制节点链接"></i></h2>          <p>跨模块（HAP、HSP或HAR）访问HAR资源和访问模块自身资源一样，可以使用下面两种方法访问资源：</p>     <ol>      <li><strong>方法一：通过'$r'或'$rawfile'语法访问资源。</strong>       <p>此方法适合简单的、静态的资源引用场景，比如在UI组件中直接引用。通过$('app.type.name')或$rawfile('name')访问资源，其中，app为resources目录中定义的资源；type为资源类型或资源的存放位置；name为资源名，开发者定义资源时确定。</p>       <div class="screenLinkPre"><div _ngcontent-aau-c106="" class="highlight-div"><div _ngcontent-aau-c106="" class="highlight-div-header"><div _ngcontent-aau-c106="" class="highlight-div-header-left"><div _ngcontent-aau-c106="" class="handle-button expand-button"><div _ngcontent-aau-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aau-c106="" class="highlight-div-header-right"><div _ngcontent-aau-c106="" class="handle-button ai-button"></div><div _ngcontent-aau-c106="" class="handle-button line-button"><div _ngcontent-aau-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aau-c106="" class="handle-button theme-button"><div _ngcontent-aau-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aau-c106="" class="handle-button copy-button"><div _ngcontent-aau-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aau-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" codehub="https://gitee.com/harmonyos_samples/CrossModuleResourceAccess/blob/master/har1/src/main/ets/components/Har1Page.ets#L28-L34" data-highlighted="yes"><ol class="linenums"><li>Text(<span class="hljs-variable">$r</span>(<span class="hljs-string">'app.string.string_in_har2'</span>))</li><li>Image(<span class="hljs-variable">$r</span>(<span class="hljs-string">'app.media.image_in_har2'</span>))</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/CrossModuleResourceAccess/blob/master/har1/src/main/ets/components/Har1Page.ets#L28-L34" target="_blank">Har1Page.ets</a></div></div></div></div></li>      <li><strong>方法二：通过resourceManager访问资源。</strong>       <p>此方法提供的API更为丰富，适用于构建更加复杂的应用逻辑，比如图像效果处理。通过本应用上下文获取ResourceManager后，调用不同<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-resource-manager" target="_blank">资源管理接口</a>访问不同资源。例如：resourceManager.getStringSync('string_in_har1').id可获取字符串资源，推荐使用资源id作为入参的方式使用，这种方式性能更好，具体可以参考：避免使用耗时接口中关于<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-time-optimization-of-the-main-thread#section193673511440">ResourceManager</a>的介绍。</p>       <div class="screenLinkPre"><div _ngcontent-aau-c106="" class="highlight-div"><div _ngcontent-aau-c106="" class="highlight-div-header"><div _ngcontent-aau-c106="" class="highlight-div-header-left"><div _ngcontent-aau-c106="" class="handle-button expand-button"><div _ngcontent-aau-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aau-c106="" class="highlight-div-header-right"><div _ngcontent-aau-c106="" class="handle-button ai-button"></div><div _ngcontent-aau-c106="" class="handle-button line-button"><div _ngcontent-aau-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aau-c106="" class="handle-button theme-button"><div _ngcontent-aau-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aau-c106="" class="handle-button copy-button"><div _ngcontent-aau-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aau-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" codehub="https://gitee.com/harmonyos_samples/CrossModuleResourceAccess/blob/master/entry/src/main/ets/pages/Index.ets#L35-L36" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">let</span> stringInHar1 = this.context.resourceManager.getStringSync(<span class="hljs-variable">$r</span>(<span class="hljs-string">'app.string.access_resource_har1'</span>).<span class="hljs-built_in">id</span>);</li><li><span class="hljs-built_in">let</span> imgArrayInHar1 = this.context.resourceManager.getMediaContentSync(<span class="hljs-variable">$r</span>(<span class="hljs-string">'app.media.image_in_har1'</span>).<span class="hljs-built_in">id</span>);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/CrossModuleResourceAccess/blob/master/entry/src/main/ets/pages/Index.ets#L35-L36" target="_blank">Index.ets</a></div></div></div></div></li>     </ol>    </div>    <div class="p">     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>在编译构建HAP时，DevEco Studio会从HAP模块及依赖的模块中收集资源文件，如果不同模块下的资源文件出现重名冲突时，DevEco Studio会按照以下优先级进行覆盖（优先级由高到低）：</p>       <ul>        <li>AppScope里面的资源。</li>        <li>HAP包自身模块。</li>        <li>依赖的HAR模块，如果依赖的多个HAR之间有资源冲突，会按照工程oh-package.json5中dependencies下的依赖顺序进行覆盖，依赖顺序在前的优先级较高。</li>       </ul>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="section19821281390">跨模块访问HSP资源<i class="anchor-icon anchor-icon-link" anchorid="section19821281390" tips="复制节点链接"></i></h2>          <p>跨模块（HAP、HSP或HAR）访问HSP资源一般有以下三种方法，下面详细介绍这三种方法的使用场景和优缺点。</p>     <ol>      <li><strong>方法一：通过"$r"或"$rawfile"语法访问资源。</strong>       <p><strong>使用场景</strong></p>       <p>适合简单的、静态的资源引用场景，比如在UI组件中直接引用。</p>       <p><strong>优点</strong></p>       <p>使用简单，易于理解。</p>       <p><strong>缺点</strong></p>       <p>不能直接获取到值，不方便对数据进行处理。</p>       <p><strong>实现方式</strong></p>       <p>使用$r或$rawfile语法，并指定HSP模块名称（HSP模块module.json5中module的name属性），资源访问格式如下：</p>       <ul>        <li>使用$r('[hsp].media.name')访问resources资源目录下media文件夹中的资源。</li>        <li>使用$rawfile('[hsp].name')访问rawfile资源目录下的资源。</li>       </ul>       <p>其中，[hsp]是HSP模块名，type是资源类型，而name是资源名称。下面示例代码中加载的资源来自名为“hsp1”的HSP模块：</p>       <div class="screenLinkPre"><div _ngcontent-aau-c106="" class="highlight-div"><div _ngcontent-aau-c106="" class="highlight-div-header"><div _ngcontent-aau-c106="" class="highlight-div-header-left"><div _ngcontent-aau-c106="" class="handle-button expand-button"><div _ngcontent-aau-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aau-c106="" class="highlight-div-header-right"><div _ngcontent-aau-c106="" class="handle-button ai-button"></div><div _ngcontent-aau-c106="" class="handle-button line-button"><div _ngcontent-aau-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aau-c106="" class="handle-button theme-button"><div _ngcontent-aau-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aau-c106="" class="handle-button copy-button"><div _ngcontent-aau-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aau-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" codehub="https://gitee.com/harmonyos_samples/CrossModuleResourceAccess/blob/master/entry/src/main/ets/pages/Index.ets#L90-L103" data-highlighted="yes"><ol class="linenums"><li>Text(<span class="hljs-variable">$r</span>(<span class="hljs-string">'app.string.access_resource_hsp1'</span>))</li><li>Text(<span class="hljs-variable">$r</span>(<span class="hljs-string">'[hsp1].string.string_in_hsp1'</span>))</li><li>Image(<span class="hljs-variable">$r</span>(<span class="hljs-string">'[hsp1].media.image_in_hsp1'</span>))</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/CrossModuleResourceAccess/blob/master/entry/src/main/ets/pages/Index.ets#L90-L103" target="_blank">Index.ets</a></div></div></div></div></li>      <li><strong>方法二：通过createModuleContext访问资源。</strong>       <p><strong>使用场景</strong></p>       <p>根据业务逻辑需要对资源文件数据进行处理，比如图片编解码、字符串拼接处理，适合少量数据的使用。</p>       <p><strong>优点</strong></p>       <p>使用相对简单，不需要添加依赖。</p>       <p><strong>缺点</strong></p>       <p>因为需要开发者手动写资源的名称，且使用方无法感知HSP内部的资源名称变化，当引用的数据量比较多的时候，建议使用第三种方法访问资源。</p>       <p><strong>实现方式</strong></p>       <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-application#applicationcreatemodulecontext12" target="_blank">createModuleContext(context, moduleName)</a>接口创建同应用中不同module的上下文，获取resourceManager对象后，调用不同<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-resource-manager" target="_blank">资源管理接口</a>访问不同资源。</p>       <div class="screenLinkPre"><div _ngcontent-aau-c106="" class="highlight-div"><div _ngcontent-aau-c106="" class="highlight-div-header"><div _ngcontent-aau-c106="" class="highlight-div-header-left"><div _ngcontent-aau-c106="" class="handle-button expand-button"><div _ngcontent-aau-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aau-c106="" class="highlight-div-header-right"><div _ngcontent-aau-c106="" class="handle-button ai-button"></div><div _ngcontent-aau-c106="" class="handle-button line-button"><div _ngcontent-aau-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aau-c106="" class="handle-button theme-button"><div _ngcontent-aau-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aau-c106="" class="handle-button copy-button"><div _ngcontent-aau-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aau-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/CrossModuleResourceAccess/blob/master/entry/src/main/ets/pages/Index.ets#L17-L45" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { application, common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li>application.<span class="hljs-title function_">createModuleContext</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>, <span class="hljs-string">'hsp1'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {</li><li>  <span class="hljs-keyword">let</span> stringInHsp1 = data.<span class="hljs-property">resourceManager</span>.<span class="hljs-title function_">getStringByNameSync</span>(<span class="hljs-string">'string_in_hsp1'</span>);</li><li>  <span class="hljs-keyword">let</span> imgArrayInHsp2 = data.<span class="hljs-property">resourceManager</span>.<span class="hljs-title function_">getMediaByNameSync</span>(<span class="hljs-string">'image_in_hsp1'</span>);</li><li>  <span class="hljs-comment">// ...</span></li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/CrossModuleResourceAccess/blob/master/entry/src/main/ets/pages/Index.ets#L17-L45" target="_blank">Index.ets</a></div></div></div></div></li>      <li><strong>方法三：HSP导出资源给使用方使用。</strong>       <p><strong>使用场景</strong></p>       <p>根据业务逻辑需要对资源文件数据进行处理，比如图片编解码、字符串拼接处理。</p>       <p><strong>优点</strong></p>       <ul>        <li>HSP开发者可以控制自己需要导出的资源，不需要对外暴露的资源可以不用导出。</li>        <li>使用方无须感知HSP内部的资源名称。当HSP内部的资源名称发生变化时，也不需要使用方跟着修改。</li>       </ul>       <p><strong>缺点</strong></p>       <p>需要封装管理类，开发稍显复杂。</p>       <p><strong>实现方式</strong></p>       <p>跨包访问HSP内资源时，推荐实现一个资源管理类，以封装对外导出的资源，其具体实现如下。</p></li>     </ol>     <ol>      <li><span>在HSP中对外提供的资源封装为一个资源管理类：</span>       <p></p>       <div class="screenLinkPre"><div _ngcontent-aau-c106="" class="highlight-div"><div _ngcontent-aau-c106="" class="highlight-div-header"><div _ngcontent-aau-c106="" class="highlight-div-header-left"><div _ngcontent-aau-c106="" class="handle-button expand-button"><div _ngcontent-aau-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aau-c106="" class="highlight-div-header-right"><div _ngcontent-aau-c106="" class="handle-button ai-button"></div><div _ngcontent-aau-c106="" class="handle-button line-button"><div _ngcontent-aau-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aau-c106="" class="handle-button theme-button"><div _ngcontent-aau-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aau-c106="" class="handle-button copy-button"><div _ngcontent-aau-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aau-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" codehub="https://gitee.com/harmonyos_samples/CrossModuleResourceAccess/blob/master/hsp1/src/main/ets/common/ResManager.ets#L17-L25" data-highlighted="yes"><ol class="linenums"><li>export <span class="hljs-keyword">class</span> <span class="hljs-title">ResManager</span> {</li><li>  <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-title">getPic</span>(): Resource</span> {</li><li>    <span class="hljs-keyword">return</span> $r(<span class="hljs-string">'app.media.image_in_hsp1'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-title">getDesc</span>(): Resource</span> {</li><li>    <span class="hljs-keyword">return</span> $r(<span class="hljs-string">'app.string.string_in_hsp1'</span>);</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/CrossModuleResourceAccess/blob/master/hsp1/src/main/ets/common/ResManager.ets#L17-L25" target="_blank">ResManager.ets</a></div></div></div></div>       <p></p></li>      <li><span>对外暴露的接口，需要在HSP入口文件index.ets中声明：</span>       <p></p>       <div class="screenLinkPre"><div _ngcontent-aau-c106="" class="highlight-div"><div _ngcontent-aau-c106="" class="highlight-div-header"><div _ngcontent-aau-c106="" class="highlight-div-header-left"><div _ngcontent-aau-c106="" class="handle-button expand-button"><div _ngcontent-aau-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aau-c106="" class="highlight-div-header-right"><div _ngcontent-aau-c106="" class="handle-button ai-button"></div><div _ngcontent-aau-c106="" class="handle-button line-button"><div _ngcontent-aau-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aau-c106="" class="handle-button theme-button"><div _ngcontent-aau-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aau-c106="" class="handle-button copy-button"><div _ngcontent-aau-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aau-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/CrossModuleResourceAccess/blob/master/hsp1/Index.ets#L19-L19" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> { <span class="hljs-title class_">ResManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./src/main/ets/common/ResManager'</span>;</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/CrossModuleResourceAccess/blob/master/hsp1/Index.ets#L19-L19" target="_blank">Index.ets</a></div></div></div></div>       <p></p></li>      <li><span>使用方使用import导入ResManager，访问HSP导出的资源，如下所示：</span>       <p></p>       <div class="screenLinkPre"><div _ngcontent-aau-c106="" class="highlight-div"><div _ngcontent-aau-c106="" class="highlight-div-header"><div _ngcontent-aau-c106="" class="highlight-div-header-left"><div _ngcontent-aau-c106="" class="handle-button expand-button"><div _ngcontent-aau-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aau-c106="" class="highlight-div-header-right"><div _ngcontent-aau-c106="" class="handle-button ai-button"></div><div _ngcontent-aau-c106="" class="handle-button line-button"><div _ngcontent-aau-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aau-c106="" class="handle-button theme-button"><div _ngcontent-aau-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aau-c106="" class="handle-button copy-button"><div _ngcontent-aau-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aau-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/CrossModuleResourceAccess/blob/master/entry/src/main/ets/pages/GetHspResource.ets#L17-L33" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ResManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'hsp1'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">GetHspResource</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-title class_">ResManager</span>.<span class="hljs-title function_">getDesc</span>())</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>      <span class="hljs-title class_">Image</span>(<span class="hljs-title class_">ResManager</span>.<span class="hljs-title function_">getPic</span>())</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/CrossModuleResourceAccess/blob/master/entry/src/main/ets/pages/GetHspResource.ets#L17-L33" target="_blank">GetHspResource.ets</a></div></div></div></div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section1566681910427">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section1566681910427" tips="复制节点链接"></i></h2>          <ul>      <li><a href="https://gitee.com/harmonyos_samples/CrossModuleResourceAccess" target="_blank">实现跨模块访问HAR/HSP资源文件功能</a></li>     </ul>    </div>   </div>   <div></div></div>