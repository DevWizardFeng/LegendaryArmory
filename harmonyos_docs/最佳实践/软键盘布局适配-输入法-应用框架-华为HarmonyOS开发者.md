<h1 _ngcontent-tay-c119="" class="doc-title ng-star-inserted" title="软键盘布局适配"> 软键盘布局适配 </h1>

<div _ngcontent-tay-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section11696191619228">概述<i class="anchor-icon anchor-icon-link" anchorid="section11696191619228" tips="复制节点链接"></i></h2><p>软键盘是用户进行交互的重要途径之一，同时软键盘的弹出和收起，可能会影响到正在显示的UI元素，影响用户体验，出现如下常见的软键盘布局适配问题：</p> <ul><li>重要信息被软键盘遮挡：当软键盘弹出时，输入框或其它重要UI元素可能会被键盘遮挡，导致用户无法看到或访问它们。</li><li>软键盘弹出导致布局错位：内容可能会不恰当上移，影响用户体验。</li><li>软键盘弹出导致弹窗过度上抬：弹窗被键盘上顶，造成不好的体验。</li></ul> <p>本文将介绍以下知识帮助开发者了解软键盘的弹出和收起的控制、避让机制以及软键盘常见问题的解决方法。</p> </div> <div class="tiledSection"><h2 id="section117216355229">软键盘的弹出收起和监听<i class="anchor-icon anchor-icon-link" anchorid="section117216355229" tips="复制节点链接"></i></h2><p>用户点击输入框时，软键盘默认弹出。但在特定场景下，需要对软键盘的弹出和收起进行控制，如点击空白区域收起软键盘，进入页面时输入框主动获焦。开发者还需根据软键盘状态和高度调整页面布局。</p> </div> <div class="tiledSection"><h3 id="section202421510173113" class="firsth2">主动获焦弹出软键盘<i class="anchor-icon anchor-icon-link" anchorid="section202421510173113" tips="复制节点链接"></i></h3><p>有时候进入页面，希望页面中的输入框能主动获焦并且弹出软键盘，方便用户直接输入，例如，点击应用首页的搜索框，进入应用搜索页面。</p> <p><span><img height="563.0156000000001" originheight="720" originwidth="337" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163004.55436873563908681407803128983541:50001231000000:2800:73B6EBBA9A908B67F9E654DC5BD35927A3F8B4929B65DB7AF9EA3F4625B4C937.gif" title="点击放大" width="266"></span></p> <p></p> <p>可以通过将输入框的defaultFocus设置为true来实现。</p> <div class="screenLinkPre"><div _ngcontent-tay-c106="" class="highlight-div"><div _ngcontent-tay-c106="" class="highlight-div-header"><div _ngcontent-tay-c106="" class="highlight-div-header-left"><div _ngcontent-tay-c106="" class="handle-button expand-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tay-c106="" class="highlight-div-header-right"><div _ngcontent-tay-c106="" class="handle-button ai-button"></div><div _ngcontent-tay-c106="" class="handle-button line-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tay-c106="" class="handle-button theme-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tay-c106="" class="handle-button copy-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tay-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/ExamplePage.ets#L31-L32" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">TextInput</span>()</li><li>  <span class="hljs-selector-class">.defaultFocus</span>(true)</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/ExamplePage.ets#L31-L32" target="_blank">ExamplePage.ets</a></div></div></div></div> </div> <div class="tiledSection"><h3 id="section16845103043113">代码控制弹出软键盘<i class="anchor-icon anchor-icon-link" anchorid="section16845103043113" tips="复制节点链接"></i></h3><p>开发者可以使用FocusController的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-focuscontroller#requestfocus12" target="_blank">requestFocus()</a>方法，通过组件的id将焦点转移到组件树对应的实体节点，并且弹出软键盘。例如，表情面板切换到文本输入时，点击表情图标拉起系统软键盘，便于用户直接输入。</p> <p><span><img height="549.0639" originheight="720" originwidth="346" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163004.81081735329552934472518368660924:50001231000000:2800:05E5F118A8D7C3208E8C3258611BAFD7106C4F470F0885F77C554C119D00F31C.gif" title="点击放大" width="266"></span></p> <p></p> <p>示例如下：</p> <div class="screenLinkPre"><div _ngcontent-tay-c106="" class="highlight-div"><div _ngcontent-tay-c106="" class="highlight-div-header"><div _ngcontent-tay-c106="" class="highlight-div-header-left"><div _ngcontent-tay-c106="" class="handle-button expand-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tay-c106="" class="highlight-div-header-right"><div _ngcontent-tay-c106="" class="handle-button ai-button"></div><div _ngcontent-tay-c106="" class="handle-button line-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tay-c106="" class="handle-button theme-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tay-c106="" class="handle-button copy-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tay-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/ExamplePage.ets#L35-L41" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">TextInput</span>({ <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'Please enter a contact name'</span> })</li><li>  .<span class="hljs-title function_">id</span>(<span class="hljs-string">'input1'</span>)</li><li>
</li><li><span class="hljs-title class_">Button</span>(<span class="hljs-string">'login'</span>)</li><li>  .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getFocusController</span>().<span class="hljs-title function_">requestFocus</span>(<span class="hljs-string">'input1'</span>);</li><li>  })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/ExamplePage.ets#L35-L41" target="_blank">ExamplePage.ets</a></div></div></div></div> </div> <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content"><p>使用requestFocus需要保证TextInput组件已经挂载完成，应避免在组件未创建的情况下使用。</p> </div></div></div> <div class="tiledSection"><h3 id="section19809195110316">代码控制收起软键盘<i class="anchor-icon anchor-icon-link" anchorid="section19809195110316" tips="复制节点链接"></i></h3><p>通过全局的焦点控制对象FocusController的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-focuscontroller#clearfocus12" target="_blank">clearFocus</a>方法，软键盘收起，例如在下面的搜索页面中，点击搜索按钮时软键盘收起。</p> <p><span><img height="549.0639" originheight="720" originwidth="346" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163005.06802912770631026753706377099127:50001231000000:2800:306220BF7AEB51C2682C7DEBA25C3AAEDD75410CD55042220AF671141D049D62.gif" title="点击放大" width="266"></span></p> <p></p> <p>示例代码如下：</p> <div class="screenLinkPre"><div _ngcontent-tay-c106="" class="highlight-div"><div _ngcontent-tay-c106="" class="highlight-div-header"><div _ngcontent-tay-c106="" class="highlight-div-header-left"><div _ngcontent-tay-c106="" class="handle-button expand-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tay-c106="" class="highlight-div-header-right"><div _ngcontent-tay-c106="" class="handle-button ai-button"></div><div _ngcontent-tay-c106="" class="handle-button line-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tay-c106="" class="handle-button theme-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tay-c106="" class="handle-button copy-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tay-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/ExamplePage.ets#L44-L47" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Button</span>(<span class="hljs-string">'Search'</span>)</li><li>  .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getFocusController</span>().<span class="hljs-title function_">clearFocus</span>();</li><li>  })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/ExamplePage.ets#L44-L47" target="_blank">ExamplePage.ets</a></div></div></div></div> <p>此外，开发者可调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-textinput#stopediting10" target="_blank">stopEditing()</a>方法来关闭键盘，该方法需为输入框单独绑定一个TextInputController对象。在存在多个输入框的场景下，需要绑定多个TextInputController对象，使用起来较为繁琐，推荐改用clearFocus()方法来解除焦点。</p> <div class="screenLinkPre"><div _ngcontent-tay-c106="" class="highlight-div"><div _ngcontent-tay-c106="" class="highlight-div-header"><div _ngcontent-tay-c106="" class="highlight-div-header-left"><div _ngcontent-tay-c106="" class="handle-button expand-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tay-c106="" class="highlight-div-header-right"><div _ngcontent-tay-c106="" class="handle-button ai-button"></div><div _ngcontent-tay-c106="" class="handle-button line-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tay-c106="" class="handle-button theme-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tay-c106="" class="handle-button copy-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tay-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/ExamplePage.ets#L65-L79" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">StopEditingCpt</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">controller</span>: <span class="hljs-title class_">TextInputController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextInputController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">TextInput</span>({ <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'Input'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Search'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">stopEditing</span>();</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/ExamplePage.ets#L65-L79" target="_blank">ExamplePage.ets</a></div></div></div></div> </div> <div class="tiledSection"><h3 id="section3471932193214">监听获取软键盘高度<i class="anchor-icon anchor-icon-link" anchorid="section3471932193214" tips="复制节点链接"></i></h3><p>开发者可以通过获取软键盘高度、监听软键盘的弹出和收起状态，调整组件位置以适配界面或显示隐藏某些组件。通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-window" target="_blank">window</a>模块的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#onkeyboardheightchange7" target="_blank">on('keyboardHeightChange')</a>方法开启固定态软键盘高度变化的监听，实时获取软键盘宽高。例如下面这个示例软键盘弹起后显示表情栏，软键盘收起后隐藏表情栏。</p> <p><span><img height="417.9791" originheight="695" originwidth="797" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163005.26119991292534069951458682386838:50001231000000:2800:DA20596D5B2B9E62459691D30EB0C1FDD130B89AF3BCF8F26B056996AC9ECAF0.png" title="点击放大" width="478.8"></span></p> <p></p> <p>上面效果图的实现示例代码如下，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#onkeyboardheightchange7" target="_blank">on('keyboardHeightChange')</a>方法实时获取软键盘高度（返回值为整数，单位为px），并赋值给变量keyboardHeight。当keyboardHeight为0的时候表示软键盘处于收起状态，此时隐藏表情栏；keyboardHeight不为0的时候表示软键盘处于弹出状态，此时显示表情栏。</p> <div class="screenLinkPre"><div _ngcontent-tay-c106="" class="highlight-div"><div _ngcontent-tay-c106="" class="highlight-div-header"><div _ngcontent-tay-c106="" class="highlight-div-header-left"><div _ngcontent-tay-c106="" class="handle-button expand-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tay-c106="" class="highlight-div-header-right"><div _ngcontent-tay-c106="" class="handle-button ai-button"></div><div _ngcontent-tay-c106="" class="handle-button line-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tay-c106="" class="handle-button theme-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tay-c106="" class="handle-button copy-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tay-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/GetKeyboardHeightDemo.ets#L17-L58" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">GetKeyboardHeightDemo</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">keyboardHeight</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>; <span class="hljs-comment">// Soft keyboard height</span></li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getLastWindow</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>()).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">currentWindow</span> =&gt;</span> {</li><li>      currentWindow.<span class="hljs-title function_">on</span>(<span class="hljs-string">'keyboardHeightChange'</span>, <span class="hljs-function">(<span class="hljs-params">data: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">keyboardHeight</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">px2vp</span>(data);</li><li>      })</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// ...</span></li><li>      <span class="hljs-title class_">TextInput</span>()</li><li>
</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">keyboardHeight</span> &gt; <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-title class_">Row</span>() { <span class="hljs-comment">// Emoji</span></li><li>          <span class="hljs-comment">// ...</span></li><li>        }</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/GetKeyboardHeightDemo.ets#L17-L58" target="_blank">GetKeyboardHeightDemo.ets</a></div></div></div></div> </div> <div class="tiledSection"><h3 id="section02922813811">监听获取安全区域高度<i class="anchor-icon anchor-icon-link" anchorid="section02922813811" tips="复制节点链接"></i></h3><p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window" target="_blank">window</a>模块的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#onavoidareachange9" target="_blank">on('avoidAreaChange')</a>方法开启当前窗口系统规避区变化的监听，获取内容可视区域大小，同时也可以监听软键盘的弹出收起。根据软键盘弹出后的可视区域大小，动态调整布局中组件的高度以适配界面。具体运用可以参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-keyboard-layout-adapt#section085404710246" target="_blank">软键盘避让常见问题</a>中<strong>通过监听软键盘弹出，实现软键盘避让</strong>示例。</p> <div class="screenLinkPre"><div _ngcontent-tay-c106="" class="highlight-div"><div _ngcontent-tay-c106="" class="highlight-div-header"><div _ngcontent-tay-c106="" class="highlight-div-header-left"><div _ngcontent-tay-c106="" class="handle-button expand-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tay-c106="" class="highlight-div-header-right"><div _ngcontent-tay-c106="" class="handle-button ai-button"></div><div _ngcontent-tay-c106="" class="handle-button line-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tay-c106="" class="handle-button theme-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tay-c106="" class="handle-button copy-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tay-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/GetSafeAreaHeightDemo.ets#L17-L53" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">KeyboardAvoidMode</span>, <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">GetSafeAreaHeightDemo</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">screenHeight</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>; <span class="hljs-comment">// The height of the safe area</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">isKeyBoardHidden</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>; <span class="hljs-comment">// Whether the soft keyboard is hidden</span></li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getLastWindow</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>()).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">currentWindow</span> =&gt;</span> {</li><li>      <span class="hljs-keyword">let</span> property = currentWindow.<span class="hljs-title function_">getWindowProperties</span>();</li><li>      <span class="hljs-keyword">let</span> avoidArea = currentWindow.<span class="hljs-title function_">getWindowAvoidArea</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">AvoidAreaType</span>.<span class="hljs-property">TYPE_KEYBOARD</span>);</li><li>      <span class="hljs-comment">// Initialize the display area height</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">screenHeight</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">px2vp</span>(property.<span class="hljs-property">windowRect</span>.<span class="hljs-property">height</span> - avoidArea.<span class="hljs-property">topRect</span>.<span class="hljs-property">height</span> - avoidArea.<span class="hljs-property">bottomRect</span>.<span class="hljs-property">height</span>);</li><li>      <span class="hljs-comment">// Enables the monitoring of changes in the avoidance zone of the current window</span></li><li>      currentWindow.<span class="hljs-title function_">on</span>(<span class="hljs-string">'avoidAreaChange'</span>, <span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {</li><li>        <span class="hljs-keyword">if</span> (data.<span class="hljs-property">type</span> !== <span class="hljs-variable language_">window</span>.<span class="hljs-property">AvoidAreaType</span>.<span class="hljs-property">TYPE_KEYBOARD</span>) {</li><li>          <span class="hljs-keyword">return</span>;</li><li>        }</li><li>        <span class="hljs-keyword">if</span> (data.<span class="hljs-property">area</span>.<span class="hljs-property">bottomRect</span>.<span class="hljs-property">height</span> &lt;= <span class="hljs-number">0</span>) {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">isKeyBoardHidden</span> = <span class="hljs-literal">true</span>;</li><li>        } <span class="hljs-keyword">else</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">isKeyBoardHidden</span> = <span class="hljs-literal">false</span>;</li><li>        }</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">screenHeight</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">px2vp</span>(property.<span class="hljs-property">windowRect</span>.<span class="hljs-property">height</span> - data.<span class="hljs-property">area</span>.<span class="hljs-property">topRect</span>.<span class="hljs-property">height</span> - data.<span class="hljs-property">area</span>.<span class="hljs-property">bottomRect</span>.<span class="hljs-property">height</span>);</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`screen height is: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.screenHeight}</span>`</span>);</li><li>      })</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">TextInput</span>()</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/GetSafeAreaHeightDemo.ets#L17-L53" target="_blank">GetSafeAreaHeightDemo.ets</a></div></div></div></div> </div> <div class="tiledSection"><h2 id="section08221814182316">软键盘避让机制<i class="anchor-icon anchor-icon-link" anchorid="section08221814182316" tips="复制节点链接"></i></h2></div> <p>解决软键盘的界面适配问题，首先需要了解在HarmonyOS系统中软键盘的避让机制是怎么样的。</p> <div class="tiledSection"><h3 id="section15829951124116" class="firsth2">软键盘默认避让效果<i class="anchor-icon anchor-icon-link" anchorid="section15829951124116" tips="复制节点链接"></i></h3><p>为了确保输入框不被软键盘挡住，系统默认提供了输入框避让软键盘的能力，结合下面这个输入框列表，介绍软键盘避让的主要表现形式。</p> <p><span><img height="562.7363" originheight="1056" originwidth="496" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163005.29678214191140012116729858234707:50001231000000:2800:6404854102F31F87B5DF3BF441E622DA1818A098681245750F0AE61F23372AF6.png" title="点击放大" width="266"></span></p> <p>默认情况下，系统针对输入框位置，执行安全避让策略，保证输入框不会被软键盘遮挡：</p> <ul><li>如果当前输入框不会被软键盘遮挡，则不上抬组件，如图所示点击输入框1，组件不会上抬。</li><li>当前输入框会被软键盘遮挡，则上抬组件至刚好在软键盘上方显示完整的输入框，输入框上方的组件会跟着抬起，下方的组件不会露出。</li></ul>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表1 </b>默认避让规格</caption><thead><tr><th align="center" class="cellrowborder" id="mcps1.3.11.6.2.4.1.1" valign="top" width="13.58%"><p>描述</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.6.2.4.1.2" valign="top" width="43.33%"><ul><li>如果当前输入框不会被软键盘遮挡，则不上抬组件，如图所示点击输入框1，组件不会上抬。</li></ul> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.6.2.4.1.3" valign="top" width="43.09%"><p>如果当前输入框会被软键盘遮挡，则上抬组件至刚好在软键盘上方显示完整的输入框，输入框上方的组件会跟着抬起，下方的组件不会露出，可以看到输入框11下方的输入框12不会露出。</p> </th> </tr> </thead> <tbody><tr><td align="center" class="cellrowborder" valign="top" width="13.58%"><p><strong>效果图</strong></p> </td> <td align="center" class="cellrowborder" valign="top" width="43.33%"><p><span><img height="561.6191" originheight="1056" originwidth="497" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163005.29271269198620063996449164332292:50001231000000:2800:244972D681B4A412AFBC26A691E241BBCB98E89299A74587C246418D2825DBF3.png" title="点击放大" width="266"></span></p> </td> <td align="center" class="cellrowborder" valign="top" width="43.09%"><p><span><img height="562.7363" originheight="1056" originwidth="496" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163005.87918179320878241926226930735887:50001231000000:2800:8CFF8DBF4473BEDEFAFCDCB5018406FBB85C572D900DC20FE752D491319D955F.png" title="点击放大" width="266"></span></p> </td> </tr>  </tbody></table></div> </div> <p><strong>弹窗内输入框避让规则</strong></p> <p>弹窗避让可以通过BaseDialogOptions，设置弹窗的避让模式KeyboradAvoidMode，当设置为默认避让Default模式时，如果软键盘弹出会覆盖输入框，弹窗整体会上抬，并且为了UX美观，会存在默认的间隔，默认大小为16vp。</p> <p><span><img height="537.18168" originheight="707" originwidth="799" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163005.71645989218448418703436747659189:50001231000000:2800:08B8BD1FC1B1BE2031543B66F221EDB35A517C8B4484C6096313ACE48136D8A4.png" title="点击放大" width="606.48"></span></p> <p>系统默认的软键盘避让形式仅能确保输入框不被遮挡，但输入框下方的组件可能会被软键盘遮挡。要解决此问题，需要了解软键盘的避让模式。</p> </div> <div class="tiledSection"><h3 id="section19987195213425">软键盘避让模式<i class="anchor-icon anchor-icon-link" anchorid="section19987195213425" tips="复制节点链接"></i></h3><p>当用户在输入时，为了确保输入框不会被键盘遮挡，系统提供了避让模式来解决这一问题。开发者可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-expand-safe-area#setkeyboardavoidmode11" target="_blank">setKeyboardAvoidMode</a>控制虚拟键盘抬起时页面的避让模式，键盘抬起时默认页面避让模式为上抬模式，下面列举了几种常见的避让模式。</p> <ul><li>上抬模式（KeyboardAvoidMode.OFFSET）：为了避让软键盘，Page内容会整体上抬。如下示例代码，软键盘弹出时，页面整体上抬：<div class="screenLinkPre"><div _ngcontent-tay-c106="" class="highlight-div"><div _ngcontent-tay-c106="" class="highlight-div-header"><div _ngcontent-tay-c106="" class="highlight-div-header-left"><div _ngcontent-tay-c106="" class="handle-button expand-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tay-c106="" class="highlight-div-header-right"><div _ngcontent-tay-c106="" class="handle-button ai-button"></div><div _ngcontent-tay-c106="" class="handle-button line-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tay-c106="" class="handle-button theme-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tay-c106="" class="handle-button copy-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tay-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/GetSafeAreaHeightDemoMode.ets#L17-L28" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">KeyboardAvoidMode</span>, <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-attr">windowStage</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStage</span>): <span class="hljs-keyword">void</span> {</li><li>    windowStage.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/GetSafeAreaHeightDemo'</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {</li><li>      <span class="hljs-comment">// Lift up mode</span></li><li>      windowStage.<span class="hljs-title function_">getMainWindowSync</span>().<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">setKeyboardAvoidMode</span>(<span class="hljs-title class_">KeyboardAvoidMode</span>.<span class="hljs-property">OFFSET</span>);</li><li>    });</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/GetSafeAreaHeightDemoMode.ets#L17-L28" target="_blank">GetSafeAreaHeightDemoMode.ets</a></div></div></div></div> <p>示意效果如下，上抬整个页面实现软键盘避让：</p> <p><span><img height="424.536" originheight="706" originwidth="797" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163005.94289822398174534803098985706113:50001231000000:2800:E3C3318F0335B958A5730A269FB95D8E6D57A5AD3C31B0ED77224AF4DD03706F.png" title="点击放大" width="478.8"></span></p> </li><li>压缩模式（KeyboardAvoidMode.RESIZE）：当软键盘高度改变时，调整Page大小。Page下设置百分比宽高的组件会跟随压缩，直接设置宽高的组件保持固定大小。设置KeyboardAvoidMode.RESIZE时，expandSafeArea([SafeAreaType.KEYBOARD],[SafeAreaEdge.BOTTOM])不生效。<div class="screenLinkPre"><div _ngcontent-tay-c106="" class="highlight-div"><div _ngcontent-tay-c106="" class="highlight-div-header"><div _ngcontent-tay-c106="" class="highlight-div-header-left"><div _ngcontent-tay-c106="" class="handle-button expand-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tay-c106="" class="highlight-div-header-right"><div _ngcontent-tay-c106="" class="handle-button ai-button"></div><div _ngcontent-tay-c106="" class="handle-button line-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tay-c106="" class="handle-button theme-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tay-c106="" class="handle-button copy-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tay-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/ExamplePage.ets#L54-L61" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-attr">windowStage</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStage</span>): <span class="hljs-keyword">void</span> {</li><li>    windowStage.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/GetSafeAreaHeightDemo'</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {</li><li>      <span class="hljs-comment">// Compression mode</span></li><li>      windowStage.<span class="hljs-title function_">getMainWindowSync</span>().<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">setKeyboardAvoidMode</span>(<span class="hljs-title class_">KeyboardAvoidMode</span>.<span class="hljs-property">RESIZE</span>);</li><li>    });</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/ExamplePage.ets#L54-L61" target="_blank">ExamplePage.ets</a></div></div></div></div> <p>示意效果如下，通过压缩内容区域高度实现软键盘避让：</p> <p><span><img height="421.7031" originheight="703" originwidth="799" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163005.61738992967049478918926823412213:50001231000000:2800:0032CF8544987292E7545406E37E75E93D1D402948E39CAC21E2D0825038CA5C.png" title="点击放大" width="478.8"></span></p> </li><li>不避让模式（KeyboardAvoidMode.NONE）：软键盘将直接覆盖页面UI，不会触发界面布局调整。例如在全屏沉浸式场景（游戏/视频播放器等），为保障用户体验的完整性，开发者可以使用KeyboardAvoidMode.NONE模式。<div class="screenLinkPre"><div _ngcontent-tay-c106="" class="highlight-div"><div _ngcontent-tay-c106="" class="highlight-div-header"><div _ngcontent-tay-c106="" class="highlight-div-header-left"><div _ngcontent-tay-c106="" class="handle-button expand-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tay-c106="" class="highlight-div-header-right"><div _ngcontent-tay-c106="" class="handle-button ai-button"></div><div _ngcontent-tay-c106="" class="handle-button line-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tay-c106="" class="handle-button theme-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tay-c106="" class="handle-button copy-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tay-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/ExamplePage.ets#L23-L25" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">aboutToAppear</span>(): void {</li><li>  this<span class="hljs-selector-class">.getUIContext</span>()<span class="hljs-selector-class">.setKeyboardAvoidMode</span>(KeyboardAvoidMode.NONE);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/ExamplePage.ets#L23-L25" target="_blank">ExamplePage.ets</a></div></div></div></div> </li></ul> </div> <p><strong>光标避让</strong></p> <p>上抬模式和压缩模式还包括KeyboardAvoidMode.OFFSET_WITH_CARET和KeyboardAvoidMode.RESIZE_WITH_CARET两种。当输入框的光标位置发生变化时，系统会自动触发相应的界面避让行为，确保光标始终处于可视区域内，具体可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-common-components-text-input#光标避让" target="_blank">光标避让</a>。</p> <p><strong>弹窗类组件避让模式</strong></p> <p>弹窗类组件（如Dialog、Popup、Menu、BindSheet等）避让模式有KeyboardAvoidMode.DEFAULT（避让）和KeyboardAvoidMode<strong>.</strong>NONE（不避让）两种，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-promptaction#basedialogoptions11" target="_blank">BaseDialogOptions</a>中的keyboardAvoidMode属性，灵活控制是否避让软键盘。</p> <p>若未指定弹窗避让模式，则其避让行为受页面避让模式影响。例如当通过setKeyboardAvoidMode()方法设置页面避让模式为KeyboardAvoidMode<strong>.</strong>NONE时，则弹窗也不会避让软键盘。</p> <div class="screenLinkPre"><div _ngcontent-tay-c106="" class="highlight-div"><div _ngcontent-tay-c106="" class="highlight-div-header"><div _ngcontent-tay-c106="" class="highlight-div-header-left"><div _ngcontent-tay-c106="" class="handle-button expand-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tay-c106="" class="highlight-div-header-right"><div _ngcontent-tay-c106="" class="handle-button ai-button"></div><div _ngcontent-tay-c106="" class="handle-button line-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tay-c106="" class="handle-button theme-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tay-c106="" class="handle-button copy-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tay-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/CustomDialogAvoid.ets#L46-L54" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getPromptAction</span>().<span class="hljs-title function_">openCustomDialog</span>({</li><li>  <span class="hljs-variable">builder</span>: () =&gt; {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-title function_">customDialogBuilder</span>();</li><li>  },</li><li>  <span class="hljs-variable">alignment</span>: <span class="hljs-title class_">DialogAlignment</span>.<span class="hljs-title class_">Bottom</span>,</li><li>  <span class="hljs-variable">width</span>: <span class="hljs-string">'100%'</span>,</li><li>  <span class="hljs-comment">// Set not avoid keyboard</span></li><li>  <span class="hljs-variable">keyboardAvoidMode</span>: <span class="hljs-title class_">KeyboardAvoidMode</span>.<span class="hljs-title class_">NONE</span>,</li><li>});</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/CustomDialogAvoid.ets#L46-L54" target="_blank">CustomDialogAvoid.ets</a></div></div></div></div> <div class="tiledSection"><h3 id="section83633918435">设置组件不避让软键盘<i class="anchor-icon anchor-icon-link" anchorid="section83633918435" tips="复制节点链接"></i></h3><p>前面介绍了避让模式，组件会为了避让软键盘而移动。有时希望组件不避让软键盘，例如在上抬模式下，希望顶部标题栏不移动。这种需求如何实现？这就需要了解<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-expand-safe-area" target="_blank">安全区域</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-expand-safe-area#expandsafearea" target="_blank">expandSafeArea</a>属性了。</p> <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-expand-safe-area#expandsafearea" target="_blank">expandSafeArea</a>属性支持组件不改变布局情况下扩展其绘制区域至安全区外，当设置expandSafeArea属性type为SafeAreaType.KEYBOARD的时候，即expandSafeArea([SafeAreaType.KEYBOARD])，系统会将软键盘区域视作安全区，从而不会避让软键盘。如果开发者希望某些组件不避让软键盘，可以给组件设置expandSafeArea属性。组件避让软键盘的示例效果如下，软键盘弹出时页面整体上抬，自定义标题栏固定不动，具体实现可以参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-keyboard-layout-adapt#section20196428133211" target="_blank">软键盘弹出导致布局错位</a>的示例。</p> <p><span><img height="421.9159" originheight="706" originwidth="802" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163005.02400091818381243457050587700905:50001231000000:2800:1DB1F6F45AAD73C4A62F9A9A0B941AE74126D97A390AC55492E32C1C744B2222.png" title="点击放大" width="478.8"></span></p> </div> <div class="tiledSection"><h2 id="section085404710246">软键盘避让常见问题<i class="anchor-icon anchor-icon-link" anchorid="section085404710246" tips="复制节点链接"></i></h2><p>下面列举常见的软键盘适配问题，帮助开发者了解软键盘的适配方法。</p> </div> <div class="tiledSection"><h3 id="section175930125314" class="firsth2">重要信息被软键盘遮挡<i class="anchor-icon anchor-icon-link" anchorid="section175930125314" tips="复制节点链接"></i></h3><p>例如下面这个电子邮件示例，内容包括标题栏、内容区域和底部操作栏。点击输入内容的输入框时，软键盘会遮挡底部操作栏，影响用户体验。具体如下图所示。</p> <p><span><img height="423.206" originheight="702" originwidth="795" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163005.00440330470459523877075087622048:50001231000000:2800:0774D8E410A522E929B3E6E5F44A98DEAB62EEA7BCB3211AD09889BFBE13333C.png" title="点击放大" width="478.8"></span></p> <p>对应的示例代码如下，其中标题栏和底部操作栏都是固定的高度56，内容区域高度是非固定高度layoutWeight(1)，自适应高度。</p> <div class="screenLinkPre"><div _ngcontent-tay-c106="" class="highlight-div"><div _ngcontent-tay-c106="" class="highlight-div-header"><div _ngcontent-tay-c106="" class="highlight-div-header-left"><div _ngcontent-tay-c106="" class="handle-button expand-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tay-c106="" class="highlight-div-header-right"><div _ngcontent-tay-c106="" class="handle-button ai-button"></div><div _ngcontent-tay-c106="" class="handle-button line-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tay-c106="" class="handle-button theme-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tay-c106="" class="handle-button copy-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tay-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" codehub="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/MailPage.ets#L20-L178" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">@Component</span></li><li>export struct MailPage {</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-selector-tag">build</span>() {</li><li>    <span class="hljs-selector-tag">Column</span>() {</li><li>      <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.NavigationTitle</span>()</li><li>      <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.EmailContent</span>()</li><li>      <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.BottomToolbar</span>()</li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>
</li><li>  @<span class="hljs-selector-tag">Builder</span></li><li>  <span class="hljs-selector-tag">NavigationTitle</span>() {</li><li>    <span class="hljs-selector-tag">Row</span>() {</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    .<span class="hljs-built_in">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-built_in">height</span>(<span class="hljs-string">"56vp"</span>)</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>
</li><li>  <span class="hljs-variable">@Builder</span></li><li>  <span class="hljs-built_in">BottomToolbar</span>() {</li><li>    <span class="hljs-selector-tag">Row</span>({ space: 12 }) {</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    .<span class="hljs-built_in">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-built_in">height</span>(<span class="hljs-string">"56vp"</span>)</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>
</li><li>  <span class="hljs-variable">@Builder</span></li><li>  <span class="hljs-built_in">EmailContent</span>() {</li><li>    <span class="hljs-selector-tag">Column</span>() {</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    .<span class="hljs-built_in">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-built_in">layoutWeight</span>(<span class="hljs-number">1</span>)</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/MailPage.ets#L20-L178" target="_blank">MailPage.ets</a></div></div></div></div> <p>开发者可以通过设置软键盘的避让模式为KeyboardAvoidMode.RESIZE（压缩模式），来解决底部操作栏被遮挡的问题，设置该属性后，软键盘的避让会通过压缩内容区域的高度来实现。示例代码如下：</p> <div class="screenLinkPre"><div _ngcontent-tay-c106="" class="highlight-div"><div _ngcontent-tay-c106="" class="highlight-div-header"><div _ngcontent-tay-c106="" class="highlight-div-header-left"><div _ngcontent-tay-c106="" class="handle-button expand-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tay-c106="" class="highlight-div-header-right"><div _ngcontent-tay-c106="" class="handle-button ai-button"></div><div _ngcontent-tay-c106="" class="handle-button line-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tay-c106="" class="handle-button theme-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tay-c106="" class="handle-button copy-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tay-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/MailPage.ets#L24-L30" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">aboutToAppear</span>(): void {</li><li>  this<span class="hljs-selector-class">.getUIContext</span>()<span class="hljs-selector-class">.setKeyboardAvoidMode</span>(KeyboardAvoidMode.RESIZE);</li><li>}</li><li>
</li><li><span class="hljs-built_in">aboutToDisappear</span>(): void {</li><li>  this<span class="hljs-selector-class">.getUIContext</span>()<span class="hljs-selector-class">.setKeyboardAvoidMode</span>(KeyboardAvoidMode.OFFSET);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/MailPage.ets#L24-L30" target="_blank">MailPage.ets</a></div></div></div></div> <p>需要注意的是内容区域高度的设置需要用百分比的方式实现，效果图如下：</p> <p><span><img height="423.2858" originheight="726" originwidth="822" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163005.27436773067882416879719233595021:50001231000000:2800:CC66F68FBED27BCBF1F1C1F72852A46434C3081A5E020BF9E57E450EFEE6A7A1.png" title="点击放大" width="478.8"></span></p> <p></p> <p><strong>通过监听软键盘弹出，实现软键盘避让</strong></p> <p>上面这个示例开发者还可以通过window模块的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#getwindowavoidarea9" target="_blank">getWindowAvoidArea</a>方法，监听获取软键盘弹出，获取安全显示区域高度动态设置页面高度。示例代码如下：</p> <div class="screenLinkPre"><div _ngcontent-tay-c106="" class="highlight-div"><div _ngcontent-tay-c106="" class="highlight-div-header"><div _ngcontent-tay-c106="" class="highlight-div-header-left"><div _ngcontent-tay-c106="" class="handle-button expand-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tay-c106="" class="highlight-div-header-right"><div _ngcontent-tay-c106="" class="handle-button ai-button"></div><div _ngcontent-tay-c106="" class="handle-button line-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tay-c106="" class="handle-button theme-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tay-c106="" class="handle-button copy-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tay-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/MailHomePage2.ets#L17-L179" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { CommonConstants <span class="hljs-keyword">as</span> Const } from <span class="hljs-string">'../common/constants/CommonConstants'</span>;</li><li><span class="hljs-keyword">import</span> { window } from <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct MailHomePage2 {</li><li>  <span class="hljs-meta">@State</span> message: string = <span class="hljs-string">'Hello World'</span>;</li><li>  <span class="hljs-meta">@State</span> screenHeight: number = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@State</span> isKeyBoardHidden: boolean = <span class="hljs-literal">false</span>;</li><li>
</li><li>  aboutToAppear(): void {</li><li>    window.getLastWindow(<span class="hljs-keyword">this</span>.getUIContext().getHostContext()).then(currentWindow =&gt; {</li><li>      let property = currentWindow.getWindowProperties();</li><li>      let avoidArea = currentWindow.getWindowAvoidArea(window.AvoidAreaType.TYPE_SYSTEM);</li><li>      <span class="hljs-comment">// Initialize the display area height</span></li><li>      <span class="hljs-keyword">this</span>.screenHeight = <span class="hljs-keyword">this</span>.getUIContext().px2vp(property.windowRect.height - avoidArea.topRect.height - avoidArea.bottomRect.height);</li><li>      <span class="hljs-comment">// Monitor the ejection and retraction of the soft keyboard</span></li><li>      currentWindow.on(<span class="hljs-string">'avoidAreaChange'</span>, async <span class="hljs-keyword">data</span> =&gt; {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">data</span>.type !== window.AvoidAreaType.TYPE_KEYBOARD) {</li><li>          <span class="hljs-keyword">return</span>;</li><li>        }</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">data</span>.area.bottomRect.height &lt;= <span class="hljs-number">0</span>) {</li><li>          <span class="hljs-keyword">this</span>.isKeyBoardHidden = <span class="hljs-literal">true</span>;</li><li>        } <span class="hljs-keyword">else</span> {</li><li>          <span class="hljs-keyword">this</span>.isKeyBoardHidden = <span class="hljs-literal">false</span>;</li><li>        }</li><li>        <span class="hljs-keyword">this</span>.screenHeight = <span class="hljs-keyword">this</span>.getUIContext().px2vp(property.windowRect.height - avoidArea.topRect.height - <span class="hljs-keyword">data</span>.area.bottomRect.height);</li><li>      })</li><li>    })</li><li>  }</li><li>
</li><li>  build() {</li><li>    Column() {</li><li>      <span class="hljs-keyword">this</span>.NavigationTitle()</li><li>      <span class="hljs-keyword">this</span>.EmailContent()</li><li>      <span class="hljs-keyword">this</span>.BottomToolbar()</li><li>    }</li><li>    .width(<span class="hljs-string">'100%'</span>)</li><li>    .height(<span class="hljs-keyword">this</span>.screenHeight) <span class="hljs-comment">// Dynamically sets the viewport height</span></li><li>    .expandSafeArea([SafeAreaType.KEYBOARD])</li><li>    .backgroundColor(<span class="hljs-string">'#F1F3F5'</span>)</li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/MailHomePage2.ets#L17-L179" target="_blank">MailHomePage2.ets</a></div></div></div></div> <p>当系统的避让机制无法满足开发者需求时，开发者可以监听软键盘弹出，根据获取的安全区域或软键盘高度，调整布局大小和位置以避让软键盘。</p> </div> <div class="tiledSection"><h3 id="section20196428133211">软键盘弹出导致布局错位<i class="anchor-icon anchor-icon-link" anchorid="section20196428133211" tips="复制节点链接"></i></h3><p><strong>内容向上滚动避让，顶部固定</strong></p> <p>例如下面这样的一个聊天界面，顶部是一个自定义的标题，下方为可滚动聊天消息区域，底部是消息输入框，示例代码如下：</p> <div class="screenLinkPre"><div _ngcontent-tay-c106="" class="highlight-div"><div _ngcontent-tay-c106="" class="highlight-div-header"><div _ngcontent-tay-c106="" class="highlight-div-header-left"><div _ngcontent-tay-c106="" class="handle-button expand-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tay-c106="" class="highlight-div-header-right"><div _ngcontent-tay-c106="" class="handle-button ai-button"></div><div _ngcontent-tay-c106="" class="handle-button line-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tay-c106="" class="handle-button theme-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tay-c106="" class="handle-button copy-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tay-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" codehub="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/ContactPage.ets#L20-L201" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">@Entry</span></li><li><span class="hljs-variable">@Component</span></li><li>export struct ContactPage {</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-selector-tag">build</span>() {</li><li>    <span class="hljs-selector-tag">Row</span>() {</li><li>      <span class="hljs-selector-tag">Column</span>() {</li><li>        <span class="hljs-selector-tag">Row</span>() {</li><li>          <span class="hljs-comment">// ...</span></li><li>        }</li><li>        <span class="hljs-comment">// ...</span></li><li>        .<span class="hljs-built_in">height</span>(<span class="hljs-string">'12%'</span>)</li><li>        <span class="hljs-comment">// ...</span></li><li>        .<span class="hljs-built_in">expandSafeArea</span>([SafeAreaType.KEYBOARD])</li><li>        .<span class="hljs-built_in">zIndex</span>(<span class="hljs-number">1</span>)</li><li>        <span class="hljs-comment">// ...</span></li><li>
</li><li>        <span class="hljs-built_in">List</span>() {</li><li>          <span class="hljs-comment">// ...</span></li><li>        }</li><li>        .<span class="hljs-built_in">height</span>(<span class="hljs-string">'76%'</span>)</li><li>        <span class="hljs-comment">// ...</span></li><li>
</li><li>        <span class="hljs-built_in">Column</span>() {</li><li>          <span class="hljs-comment">// ...</span></li><li>        }</li><li>        .<span class="hljs-built_in">height</span>(<span class="hljs-string">'12%'</span>)</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>      <span class="hljs-selector-class">.width</span>(<span class="hljs-string">'100%'</span>)</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-selector-class">.height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/ContactPage.ets#L20-L201" target="_blank">ContactPage.ets</a></div></div></div></div> <p>由于软键盘避让默认为上抬模式，会将整个页面向上抬起，因此标题也会被顶上去，如图所示。</p> <p><span><img height="423.41880000000003" originheight="728" originwidth="824" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163005.26198988686615836877777552476940:50001231000000:2800:4E0987983F90B56C495BAC262EA0C990C74B0C6EE0869E80AE6EA8F85B704912.png" title="点击放大" width="478.8"></span></p> <p>现在需求是希望顶部标题固定，点击底部输入框软键盘弹起的时候，标题不上抬，只有内容区域上抬。效果图如下：</p> <p><span><img height="424.5094" originheight="729" originwidth="823" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163005.55446071061273681750604223219957:50001231000000:2800:3165E40B2F2315D2E79E966860A98F9EA5195A652FD2503CD7986D1010C94E26.png" title="点击放大" width="478.8"></span></p> <p>想要顶部标题不被软键盘向上抬，需要给对应的组件设置 .expandSafeArea([SafeAreaType.KEYBOARD])属性，使标题组件不避让键盘，示例代码如下：</p> <div class="screenLinkPre"><div _ngcontent-tay-c106="" class="highlight-div"><div _ngcontent-tay-c106="" class="highlight-div-header"><div _ngcontent-tay-c106="" class="highlight-div-header-left"><div _ngcontent-tay-c106="" class="handle-button expand-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tay-c106="" class="highlight-div-header-right"><div _ngcontent-tay-c106="" class="handle-button ai-button"></div><div _ngcontent-tay-c106="" class="handle-button line-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tay-c106="" class="handle-button theme-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tay-c106="" class="handle-button copy-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tay-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" codehub="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/ContactPage.ets#L20-L201" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">@Entry</span></li><li><span class="hljs-variable">@Component</span></li><li>export struct ContactPage {</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-selector-tag">build</span>() {</li><li>    <span class="hljs-selector-tag">Row</span>() {</li><li>      <span class="hljs-selector-tag">Column</span>() {</li><li>        <span class="hljs-selector-tag">Row</span>() {</li><li>          <span class="hljs-comment">// ...</span></li><li>        }</li><li>        <span class="hljs-comment">// ...</span></li><li>        .<span class="hljs-built_in">height</span>(<span class="hljs-string">'12%'</span>)</li><li>        <span class="hljs-comment">// ...</span></li><li>        .<span class="hljs-built_in">expandSafeArea</span>([SafeAreaType.KEYBOARD])</li><li>        .<span class="hljs-built_in">zIndex</span>(<span class="hljs-number">1</span>)</li><li>        <span class="hljs-comment">// ...</span></li><li>
</li><li>        <span class="hljs-built_in">List</span>() {</li><li>          <span class="hljs-comment">// ...</span></li><li>        }</li><li>        .<span class="hljs-built_in">height</span>(<span class="hljs-string">'76%'</span>)</li><li>        <span class="hljs-comment">// ...</span></li><li>
</li><li>        <span class="hljs-built_in">Column</span>() {</li><li>          <span class="hljs-comment">// ...</span></li><li>        }</li><li>        .<span class="hljs-built_in">height</span>(<span class="hljs-string">'12%'</span>)</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>      <span class="hljs-selector-class">.width</span>(<span class="hljs-string">'100%'</span>)</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-selector-class">.height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/ContactPage.ets#L20-L201" target="_blank">ContactPage.ets</a></div></div></div></div> <p>具体实现可以参考Sample代码<a href="https://gitee.com/harmonyos_samples/keyboard" target="_blank">Keyboard</a>。</p> </div> <div class="tiledSection"><h3 id="section381324419328">软键盘弹出导致弹窗过度上抬<i class="anchor-icon anchor-icon-link" anchorid="section381324419328" tips="复制节点链接"></i></h3><p><strong>自定义弹窗被键盘顶起</strong><strong> ，影响用户体验</strong></p> <p>在软键盘系统避让机制中介绍过，弹窗为避让软键盘会整体向上抬，这样可能会影响用户体验。比如下面这个评论列表的弹窗，使用@CustomDialog实现的，示例代码如下：</p> <div class="screenLinkPre"><div _ngcontent-tay-c106="" class="highlight-div"><div _ngcontent-tay-c106="" class="highlight-div-header"><div _ngcontent-tay-c106="" class="highlight-div-header-left"><div _ngcontent-tay-c106="" class="handle-button expand-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tay-c106="" class="highlight-div-header-right"><div _ngcontent-tay-c106="" class="handle-button ai-button"></div><div _ngcontent-tay-c106="" class="handle-button line-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tay-c106="" class="handle-button theme-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tay-c106="" class="handle-button copy-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tay-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/view/dialog/CommentDialog.ets#L2-L63" data-highlighted="yes"><ol class="linenums"><li>@<span class="hljs-title function_">CustomDialog</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">CommentDialog</span> {</li><li>  <span class="hljs-variable">listData</span>: <span class="hljs-title class_">string</span>[] = [<span class="hljs-string">'comments1'</span>, <span class="hljs-string">'comments2'</span>, <span class="hljs-string">'comments3'</span>, <span class="hljs-string">'comments4'</span>, <span class="hljs-string">'comments5'</span>, <span class="hljs-string">'comments6'</span>, <span class="hljs-string">'comments7'</span>, <span class="hljs-string">'comments8'</span>];</li><li>  <span class="hljs-variable">controller</span>?: <span class="hljs-title class_">CustomDialogController</span>;</li><li>
</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Column</span>() {</li><li>      <span class="hljs-title function_">Text</span>(<span class="hljs-string">'comments'</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-variable">FontWeight</span>.<span class="hljs-variable">Medium</span>)</li><li>
</li><li>
</li><li>      <span class="hljs-title function_">List</span>() {</li><li>        <span class="hljs-title function_">ForEach</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">listData</span>, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">string</span>) =&gt; {</li><li>          <span class="hljs-title function_">ListItem</span>() {</li><li>            <span class="hljs-title function_">Text</span>(<span class="hljs-variable">item</span>)</li><li>              .<span class="hljs-title function_">height</span>(<span class="hljs-number">80</span>)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>          }</li><li>        }, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">string</span>) =&gt; <span class="hljs-variable">item</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">scrollBar</span>(<span class="hljs-variable">BarState</span>.<span class="hljs-variable">Off</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>)</li><li>
</li><li>
</li><li>      <span class="hljs-title function_">TextInput</span>({ <span class="hljs-variable">placeholder</span>: <span class="hljs-string">'Please input content'</span> })</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">padding</span>(<span class="hljs-number">12</span>)</li><li>  }</li><li>}</li><li>
</li><li>
</li><li>@<span class="hljs-title function_">Entry</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">CustomDialogDemo</span> {</li><li>  <span class="hljs-variable">dialogController</span>: <span class="hljs-title class_">CustomDialogController</span> | <span class="hljs-title class_">null</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">CustomDialogController</span>({</li><li>    <span class="hljs-variable">builder</span>: <span class="hljs-title class_">CommentDialog</span>(),</li><li>    <span class="hljs-variable">alignment</span>: <span class="hljs-title class_">DialogAlignment</span>.<span class="hljs-title class_">Bottom</span>,</li><li>    <span class="hljs-variable">cornerRadius</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-variable">width</span>: <span class="hljs-string">'100%'</span>,</li><li>    <span class="hljs-variable">height</span>: <span class="hljs-string">'80%'</span></li><li>  })</li><li>
</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Column</span>() {</li><li>      <span class="hljs-title function_">Button</span>(<span class="hljs-string">'click me'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(() =&gt; {</li><li>          <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.<span class="hljs-variable">dialogController</span> !== <span class="hljs-variable">null</span>) {</li><li>            <span class="hljs-keyword">this</span>.<span class="hljs-variable">dialogController</span>.<span class="hljs-keyword">open</span>();</li><li>          }</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-variable">FlexAlign</span>.<span class="hljs-variable">Center</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/view/dialog/CommentDialog.ets#L2-L63" target="_blank">CommentDialog.ets</a></div></div></div></div> <p>当用户点击弹窗底部的输入框的时候，弹窗会整体上抬，输入框上抬的距离也过多。</p> <p><span><img height="424.9616" originheight="728" originwidth="821" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163005.23554730757874690784997315942194:50001231000000:2800:4D6AA73A48A196D3675AA6FFADA64963152006E80E67157F55F5E7D519EFB7BC.png" title="点击放大" width="478.8"></span></p> <p>为了解决以上问题，可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-navigation-navigation#页面显示类型" target="_blank">Navigation.Dialog</a>，通过设置NavDestination的mode为NavDestinationMode.DIALOG弹窗类型，此时整个NavDestination默认透明显示，示例代码如下：</p> <div class="screenLinkPre"><div _ngcontent-tay-c106="" class="highlight-div"><div _ngcontent-tay-c106="" class="highlight-div-header"><div _ngcontent-tay-c106="" class="highlight-div-header-left"><div _ngcontent-tay-c106="" class="handle-button expand-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tay-c106="" class="highlight-div-header-right"><div _ngcontent-tay-c106="" class="handle-button ai-button"></div><div _ngcontent-tay-c106="" class="handle-button line-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tay-c106="" class="handle-button theme-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tay-c106="" class="handle-button copy-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tay-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/NavDestinationModeDemo.ets#L17-L88" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">NavDestinationModeDemo</span> {</li><li>  <span class="hljs-meta">@Provide</span>(<span class="hljs-string">'NavPathStack'</span>) <span class="hljs-attr">pageStack</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NavPathStack</span>()</li><li>
</li><li>  <span class="hljs-meta">@Builder</span></li><li>  <span class="hljs-title class_">PagesMap</span>(<span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>) {</li><li>    <span class="hljs-keyword">if</span> (name === <span class="hljs-string">'DialogPage'</span>) {</li><li>      <span class="hljs-title class_">DialogPage</span>()</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Navigation</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pageStack</span>) {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'click me'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageStack</span>.<span class="hljs-title function_">pushPathByName</span>(<span class="hljs-string">'DialogPage'</span>, <span class="hljs-string">''</span>);</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">mode</span>(<span class="hljs-title class_">NavigationMode</span>.<span class="hljs-property">Stack</span>)</li><li>    .<span class="hljs-title function_">navDestination</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">PagesMap</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li><span class="hljs-keyword">export</span> struct <span class="hljs-title class_">DialogPage</span> {</li><li>  <span class="hljs-meta">@Consume</span>(<span class="hljs-string">'NavPathStack'</span>) <span class="hljs-attr">pageStack</span>: <span class="hljs-title class_">NavPathStack</span>;</li><li>  <span class="hljs-attr">listData</span>: <span class="hljs-built_in">string</span>[] = [<span class="hljs-string">'评论1'</span>, <span class="hljs-string">'评论2'</span>, <span class="hljs-string">'评论3'</span>, <span class="hljs-string">'评论4'</span>, <span class="hljs-string">'评论5'</span>, <span class="hljs-string">'评论6'</span>, <span class="hljs-string">'评论7'</span>, <span class="hljs-string">'评论8'</span>];</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Stack</span>({ <span class="hljs-attr">alignContent</span>: <span class="hljs-title class_">Alignment</span>.<span class="hljs-property">Bottom</span> }) {</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">'评论'</span>)</li><li>            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>            .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Medium</span>)</li><li>
</li><li>          <span class="hljs-title class_">List</span>() {</li><li>            <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">listData</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>              <span class="hljs-title class_">ListItem</span>() {</li><li>                <span class="hljs-title class_">Text</span>(item)</li><li>                  .<span class="hljs-title function_">height</span>(<span class="hljs-number">80</span>)</li><li>                  .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>              }</li><li>            }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>          }</li><li>          .<span class="hljs-title function_">scrollBar</span>(<span class="hljs-title class_">BarState</span>.<span class="hljs-property">Off</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>)</li><li>
</li><li>          <span class="hljs-title class_">TextInput</span>({ <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'Please input content'</span> })</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        }</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'75%'</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">padding</span>(<span class="hljs-number">12</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'rgba(0,0,0,0.2)'</span>)</li><li>    .<span class="hljs-title function_">hideTitleBar</span>(<span class="hljs-literal">true</span>)</li><li>    .<span class="hljs-title function_">mode</span>(<span class="hljs-title class_">NavDestinationMode</span>.<span class="hljs-property">DIALOG</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/NavDestinationModeDemo.ets#L17-L88" target="_blank">NavDestinationModeDemo.ets</a></div></div></div></div> <p>还需设置软键盘避让模式为压缩模式，示例代码如下：</p> <div class="screenLinkPre"><div _ngcontent-tay-c106="" class="highlight-div"><div _ngcontent-tay-c106="" class="highlight-div-header"><div _ngcontent-tay-c106="" class="highlight-div-header-left"><div _ngcontent-tay-c106="" class="handle-button expand-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tay-c106="" class="highlight-div-header-right"><div _ngcontent-tay-c106="" class="handle-button ai-button"></div><div _ngcontent-tay-c106="" class="handle-button line-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tay-c106="" class="handle-button theme-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tay-c106="" class="handle-button copy-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tay-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/ExamplePageMode.ets#L17-L28" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@kit.AbilityKit"</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span>, <span class="hljs-title class_">KeyboardAvoidMode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@kit.ArkUI"</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-attr">windowStage</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStage</span>): <span class="hljs-keyword">void</span> {</li><li>    windowStage.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/GetSafeAreaHeightDemo'</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {</li><li>      <span class="hljs-comment">// Compression mode</span></li><li>      windowStage.<span class="hljs-title function_">getMainWindowSync</span>().<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">setKeyboardAvoidMode</span>(<span class="hljs-title class_">KeyboardAvoidMode</span>.<span class="hljs-property">RESIZE</span>);</li><li>    });</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/ExamplePageMode.ets#L17-L28" target="_blank">ExamplePageMode.ets</a></div></div></div></div> <p>运行效果如下，点击输入框后，内容区域会进行压缩，弹窗整体不会发生上抬。</p> <p><span><img height="421.92920000000004" originheight="721" originwidth="819" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163005.35372005886415312694340529345953:50001231000000:2800:A6B01F5300BADB9EE34659B25216A9467D6A934797BC8125BF6A0499BEFC334C.png" title="点击放大" width="478.8"></span></p> <p>关于评论回复场景的实现，可以参考：<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-comment-reply-pop-up-window" target="_blank">评论回复弹窗</a>。</p> </div> <div class="tiledSection"><h3 id="section1921417165715">设置软键盘和弹窗组件距离<i class="anchor-icon anchor-icon-link" anchorid="section1921417165715" tips="复制节点链接"></i></h3><p>弹窗类组件默认避让模式下，软键盘弹起之后弹窗组件之间16vp间隔，开发者可以通过弹窗参数<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-promptaction#basedialogoptions11" target="_blank">BaseDialogOptions</a>中keyboardAvoidDistance，调整弹窗组件与软键盘之间的避让距离。设置软键盘间距时，需要将keyboardAvoidMode值设为KeyboardAvoidMode.DEFAULT。</p> <div class="screenLinkPre"><div _ngcontent-tay-c106="" class="highlight-div"><div _ngcontent-tay-c106="" class="highlight-div-header"><div _ngcontent-tay-c106="" class="highlight-div-header-left"><div _ngcontent-tay-c106="" class="handle-button expand-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tay-c106="" class="highlight-div-header-right"><div _ngcontent-tay-c106="" class="handle-button ai-button"></div><div _ngcontent-tay-c106="" class="handle-button line-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tay-c106="" class="handle-button theme-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tay-c106="" class="handle-button copy-button"><div _ngcontent-tay-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tay-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/CustomDialogAvoid.ets#L61-L69" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getPromptAction</span>().<span class="hljs-title function_">openCustomDialog</span>({</li><li>  <span class="hljs-variable">builder</span>: () =&gt; {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-title function_">customDialogBuilder</span>();</li><li>  },</li><li>  <span class="hljs-variable">alignment</span>: <span class="hljs-title class_">DialogAlignment</span>.<span class="hljs-title class_">Bottom</span>,</li><li>  <span class="hljs-variable">width</span>: <span class="hljs-string">'100%'</span>,</li><li>  <span class="hljs-comment">// Set the distance between the soft keyboard and custom dialog to 0</span></li><li>  <span class="hljs-variable">keyboardAvoidDistance</span>:<span class="hljs-title class_">LengthMetrics</span>.<span class="hljs-title class_">vp</span>(<span class="hljs-number">0</span>)</li><li>});</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/keyboard/blob/master/entry/src/main/ets/pages/CustomDialogAvoid.ets#L61-L69" target="_blank">CustomDialogAvoid.ets</a></div></div></div></div> </div> <div class="tiledSection"><h3 id="section24833337571">Web组件内容输入框<i class="anchor-icon anchor-icon-link" anchorid="section24833337571" tips="复制节点链接"></i></h3><p>针对由Web组件内容输入组件拉起软键盘以及避让软键盘的内容，可以参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/web-docking-softkeyboard" target="_blank">Web组件对接软键盘</a>。</p> <p></p> </div> <div class="tiledSection"><h2 id="section18571548184811">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section18571548184811" tips="复制节点链接"></i></h2><ul><li><a href="https://gitee.com/harmonyos_samples/keyboard" target="_blank">Keyboard</a></li></ul> </div> </div> <div></div></div>