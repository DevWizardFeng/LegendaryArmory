<h1 _ngcontent-waj-c119="" class="doc-title ng-star-inserted" title="轻量级智能穿戴应用开发"> 轻量级智能穿戴应用开发 </h1>

<div _ngcontent-waj-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section8618133925012">概述<i class="anchor-icon anchor-icon-link" anchorid="section8618133925012" tips="复制节点链接"></i></h2><p>对于轻量级智能穿戴（Lite Wearable），应用可以通过HarmonyOS提供的接口实现传感器、UI交互等常规业务的开发。开发者可以根据轻量级智能穿戴的特点，打造针对轻量级智能穿戴的独特应用。当前支持产品有：HUAWEI WATCH GT系列、Watch D系列、Fit系列、Watch Ultimate系列。</p> <p>轻量级智能穿戴产品系列对应的分辨率和支持API如下表所示：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.1.4.1.4.1.1" valign="top" width="33.33333333333333%"><p>产品系列</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.1.4.1.4.1.2" valign="top" width="33.33333333333333%"><p>分辨率（px）</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.1.4.1.4.1.3" valign="top" width="33.33333333333333%"><p>支持API</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>WATCH GT 2</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>390*390</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>5</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>WATCH GT 2 Pro</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>454*454</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>6</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>WATCH GT 3</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>466*466</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>6</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>WATCH GT 4</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>466*466</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>10</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>WATCH GT 5</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>466*466</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>12</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>WATCH GT 6</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>466*466</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>20</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>WATCH D</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>280*456</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>6</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>WATCH D2</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>408*480</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>12</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>WATCH FIT 2</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>336*480</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>6</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>WATCH FIT 3</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>408*480</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>12</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>WATCH FIT 4</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>408*480</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>19</p> </td> </tr>  </tbody></table></div> </div> <p>本章节后续部分将以创建“Hello World”的轻量级智能穿戴应用为例，逐步讲解如何在应用中构建布局、绘制样式、添加组件、绑定事件、实现页面路由跳转等。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>本文档适用于轻量级智能穿戴应用开发，针对智能穿戴应用请参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-smartwatch" target="_blank">智能穿戴</a>。</p> </div></div></div> </div> <div class="tiledSection"><h2 id="section1610013213814">体验应用<i class="anchor-icon anchor-icon-link" anchorid="section1610013213814" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section146851747484" class="firsth2">搭建环境和创建项目<i class="anchor-icon anchor-icon-link" anchorid="section146851747484" tips="复制节点链接"></i></h3><ul><li>搭建环境：请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-software-install" target="_blank">安装DevEco Studio</a>，配置开发环境。</li><li>创建项目：请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-create-new-project" target="_blank">创建一个新的工程</a>，模板选择“[Lite]Empty Ability”，设备类型选择“Lite Wearable”。<p><span><img height="533.0773" originheight="656" originwidth="982" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163327.38806764494523631517746215990945:50001231000000:2800:07606CF7EC89DD19DFBA50E2E5AD6B88DFEAE758C52FE3B6E3EE047E6A2D08CE.png" title="点击放大" width="798"></span></p> </li></ul> </div> <div class="tiledSection"><h3 id="section14714318182215">工程目录介绍<i class="anchor-icon anchor-icon-link" anchorid="section14714318182215" tips="复制节点链接"></i></h3><p>HelloWorld工程目录如下图所示：</p> <p><span><img height="240.34430000000003" originheight="431" originwidth="477" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163327.80119291813064674730850297346521:50001231000000:2800:DEAE6CB3D7BC6A07B47C065054008B4BDB0965A327D2961AFDC5028EDBBC9AA8.png" title="点击放大" width="266"></span></p> <p><strong>pages/index/index.hml</strong><strong>：</strong>此文件定义了index页面的布局，在index页面中用到的组件，以及这些组件的层级关系。以下示例代码包含了一个text组件，内容为“Hello World”。</p> <div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-php-template" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/initpage/initpage.hml#L2-L7" data-highlighted="yes"><ol class="linenums"><li><span class="language-xml"><span class="hljs-comment">&lt;!-- Output the content of the text component. --&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span></span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title"</span>&gt;</span></span></li><li><span class="language-xml">        Hello {{ title }}</span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/initpage/initpage.hml#L2-L7" target="_blank">initpage.hml</a></div></div></div></div> <p><strong>pages/index/index.css</strong><strong>：</strong>此文件定义了index页面的样式。以下示例代码定义了“container”和“title”的样式。</p> <div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-css" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-selector-class">.container</span> {</li><li>    <span class="hljs-attribute">display</span>: flex;</li><li>    <span class="hljs-attribute">justify-content</span>: center;</li><li>    <span class="hljs-attribute">align-items</span>: center;</li><li>    <span class="hljs-attribute">left</span>: <span class="hljs-number">0px</span>;</li><li>    <span class="hljs-attribute">top</span>: <span class="hljs-number">0px</span>;</li><li>    <span class="hljs-attribute">width</span>: <span class="hljs-number">466px</span>;</li><li>    <span class="hljs-attribute">height</span>: <span class="hljs-number">466px</span>;</li><li>}</li><li><span class="hljs-selector-class">.title</span> {</li><li>    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">30px</span>;</li><li>    <span class="hljs-attribute">text-align</span>: center;</li><li>    <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;</li><li>    <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;</li><li>}</li></ol></pre></div></div> <p><strong>pages/index/index.js</strong><strong>：</strong>此文件定义了index页面的业务逻辑，比如数据绑定，事件处理等。以下示例代码变量通过动态绑定的形式定义“title”字符串为“World”。</p> <div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-css" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/initpage/initpage.js#L2-L6" data-highlighted="yes"><ol class="linenums"><li>export default {</li><li>    data: {</li><li>        title: <span class="hljs-string">'World'</span></li><li>    }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/initpage/initpage.js#L2-L6" target="_blank">initpage.js</a></div></div></div></div> <p><strong>resources</strong><strong>：</strong>此目录用于存放系统级资源配置文件，如应用图标等。</p> <p><strong>config.json</strong><strong>：</strong>此文件是配置文件，主要定义了页面路由和应用信息，可根据DevEco Studio的工程和页面创建向导自动完成填充。</p> <div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"app"</span>: {</li><li>    <span class="hljs-string">"bundleName"</span>: <span class="hljs-string">"com.example.litewearable"</span>,</li><li>    <span class="hljs-string">"vendor"</span>: <span class="hljs-string">"example"</span>,</li><li>    <span class="hljs-string">"version"</span>: {</li><li>      <span class="hljs-string">"code"</span>: <span class="hljs-number">1000000</span>,</li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"1.0.0"</span></li><li>    }</li><li>  },</li><li>  <span class="hljs-string">"deviceConfig"</span>: {},</li><li>  <span class="hljs-string">"module"</span>: {</li><li>    <span class="hljs-string">"deviceType"</span>: [</li><li>      <span class="hljs-string">"liteWearable"</span></li><li>    ],</li><li>    <span class="hljs-string">"distro"</span>: {</li><li>      <span class="hljs-string">"deliveryWithInstall"</span>: <span class="hljs-keyword">true</span>,</li><li>      <span class="hljs-string">"moduleName"</span>: <span class="hljs-string">"entry"</span>,</li><li>      <span class="hljs-string">"moduleType"</span>: <span class="hljs-string">"entry"</span></li><li>    },</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-string">"abilities"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"name"</span>: <span class="hljs-string">".MainAbility"</span>,</li><li>        <span class="hljs-string">"srcLanguage"</span>: <span class="hljs-string">"js"</span>,</li><li>        <span class="hljs-string">"srcPath"</span>: <span class="hljs-string">"MainAbility"</span>,</li><li>        <span class="hljs-string">"icon"</span>: <span class="hljs-string">"$media:icon"</span>,</li><li>        <span class="hljs-string">"description"</span>: <span class="hljs-string">"$string:MainAbility_desc"</span>,</li><li>        <span class="hljs-string">"label"</span>: <span class="hljs-string">"$string:MainAbility_label"</span>,</li><li>        <span class="hljs-string">"type"</span>: <span class="hljs-string">"page"</span></li><li>      }</li><li>    ],</li><li>    <span class="hljs-string">"js"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"pages"</span>: [</li><li>          <span class="hljs-string">"pages/index/index"</span>,</li><li>          <span class="hljs-comment">// ...</span></li><li>        ],</li><li>        <span class="hljs-string">"name"</span>: <span class="hljs-string">".MainAbility"</span></li><li>      }</li><li>    ]</li><li>  }</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h3 id="section489201684214">运行应用<i class="anchor-icon anchor-icon-link" anchorid="section489201684214" tips="复制节点链接"></i></h3><p>使用预览器查看效果，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-previewer-arkts-js" target="_blank">查看ArkTS/JS预览效果</a>。</p> <p>在Lite Wearable中运行应用/服务，依赖HarmonyOS NEXT版本以前的华为手机上的<strong>运动健康</strong>和<strong>应用调测助手</strong>APP辅助进行。</p> <p><strong>前提条件</strong></p> <ul><li>已将<strong>运动健康APP</strong>升级至最新版本。</li><li>从华为应用市场安装<strong>应用调测助手APP</strong>。</li><li>在Lite Wearable中运行应用/服务，需要根据<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-signing" target="_blank">应用/元服务签名</a>，提前对应用/服务进行签名。<div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>因Lite Wearable设备无法与DevEco Studio进行连接，因此在对Lite Wearable应用/服务签名时，不能采用自动化签名方案，只能使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-signing#section297715173233" target="_blank">手动签名</a>，然后再手动配置签名信息。</p> </div></div></div> </li></ul> </div> <p><strong>操作步骤</strong></p> <ol><li>使用USB连接线将手机和电脑进行连接，确保连接状态是正常的。</li><li>手机与电脑使用USB连接时，在手机上选择<strong>传输文件</strong>连接方式。</li><li>在工程目录中的<strong>Build &gt; outputs &gt;hap</strong>中选择生成的HAP，通过手工拷贝的方式将HAP拷贝至手机中的“/sdcard/haps/”目录。</li><li>将Lite Wearable通过蓝牙与华为手机进行连接。<ol><li>进入<strong>运动健康</strong>APP，在设备页签中，单击<strong>添加设备</strong>按钮。</li><li>进入<strong>手表</strong>列表中，选择对应的Lite Wearable型号。</li><li>单击<strong>开始配对</strong>，按照界面指引完成Lite Wearable与华为手机之间的连接。</li></ol> </li><li>打开<strong>应用调测助手</strong>APP，界面会显示已经与华为手机连接的Lite Wearable。<div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>如果Lite Wearable与华为手机未连接，请单击<strong>应用调测助手</strong>APP界面的<strong>连接设备</strong>按钮，手机会自动打开<strong>运动健康</strong>APP添加Lite Wearable。</p> </div></div></div> </li><li>单击<strong>应用调测助手</strong>APP界面中的<strong>应用管理</strong>按钮，选择需要安装的HarmonyOS安装包进行安装。</li><li>安装完成后，单击Lite Wearable中的应用图标，运行HarmonyOS应用。</li></ol> <div class="tiledSection"><h2 id="section827315195333">构建布局<i class="anchor-icon anchor-icon-link" anchorid="section827315195333" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section184041157133514" class="firsth2">布局说明<i class="anchor-icon anchor-icon-link" anchorid="section184041157133514" tips="复制节点链接"></i></h3><p>本文以轻量级智能穿戴中的圆形表盘为例，把466px（px为逻辑像素，非物理像素）作为基准宽度。在构建页面布局时，需要对基本元素进行分析：</p> <ul><li>元素的尺寸和排列位置是否合理</li><li>是否有重叠的元素</li><li>是否需要设置对齐、内间距或者边界</li><li>是否包含子元素及其排列位置</li><li>是否需要容器组件<div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>将页面中的元素分解之后再逐个对基本元素进行自上而下的实现，可以减少多层嵌套造成的视觉混乱，尽可能的避免出现逻辑混乱，还可以提高代码的可读性，方便对页面做后续的调整和增改。</p> </div></div></div> </li></ul> </div> <div class="tiledSection"><h3 id="section73791310153011">实现应用页面<i class="anchor-icon anchor-icon-link" anchorid="section73791310153011" tips="复制节点链接"></i></h3><p>应用页面由组件声明（.hml）、css样式（.css）和script脚本（.js）三部分构成。组件声明在“pages/index/index.hml”文件中实现，使用&lt;text&gt;组件显示文字，并用一个容器组件来包裹&lt;text&gt;组件，这里以&lt;div&gt;为例进行说明。示例代码如下：</p> <div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-php-template" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/style1/style1.hml#L2-L9" data-highlighted="yes"><ol class="linenums"><li><span class="language-xml"><span class="hljs-comment">&lt;!-- The "style" contains the style information of the component. --&gt;</span></span></li><li><span class="language-xml"><span class="hljs-comment">&lt;!-- The detailed introduction about the style will be presented in the next subsection. --&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 466px; height: 466px;"</span>&gt;</span></span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 200px; height: 100px;"</span>&gt;</span></span></li><li><span class="language-xml">    <span class="hljs-comment">&lt;!-- The content to be displayed in the &lt;text&gt; component. --&gt;</span></span></li><li><span class="language-xml">        Hello World</span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/style1/style1.hml#L2-L9" target="_blank">style1.hml</a></div></div></div></div> <p>现在已经完成了一个简单应用开发的第一步，在后续章节中将继续介绍样式、事件的开发方法，不断优化和完善应用。</p> </div> <div class="tiledSection"><h2 id="section617931013312">绘制样式<i class="anchor-icon anchor-icon-link" anchorid="section617931013312" tips="复制节点链接"></i></h2><p>组件标签中类似“style="width:466px;height:466px;"”的语句即为样式设置语句，通过样式可以设置组件的显示大小、背景颜色、对齐方式等属性。本章节以&lt;div&gt;和&lt;text&gt;组件为例来介绍如何设置样式，样式主要有三种设置方式：行内样式、选择器样式和动态绑定样式，三种方式设置的样式效果一致。</p> </div> <div class="tiledSection"><h3 id="section13970151363010" class="firsth2">行内样式<i class="anchor-icon anchor-icon-link" anchorid="section13970151363010" tips="复制节点链接"></i></h3><p>行内样式是将样式内容直接放到组件的style属性中，多个样式值则是通过分号间隔。以下示例代码通过行内样式对div和text组件设置了高度、宽度或其他属性。</p> <div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-php-template" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/style2/style2.hml#L2-L10" data-highlighted="yes"><ol class="linenums"><li><span class="language-xml"><span class="hljs-comment">&lt;!-- Set the child components within the div to be flexible layout and display them centered; --&gt;</span></span></li><li><span class="language-xml"><span class="hljs-comment">&lt;!-- ensure that the text component is displayed in the middle of the screen. --&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 466px; height: 466px; display: flex; justify-content: center; align-items: center;"</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-comment">&lt;!-- Set the text component to display the text centered; --&gt;</span></span></li><li><span class="language-xml"><span class="hljs-comment">&lt;!-- ensure that "Hello World" is displayed right in the middle of the screen. --&gt;</span></span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 200px; height: 100px; font-size: 30px; text-align: center;"</span>&gt;</span></span></li><li><span class="language-xml">        Hello World</span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/style2/style2.hml#L2-L10" target="_blank">style2.hml</a></div></div></div></div> </div> <div class="tiledSection"><h3 id="section0972111693319">选择器样式<i class="anchor-icon anchor-icon-link" anchorid="section0972111693319" tips="复制节点链接"></i></h3><p>使用行内样式存在以下缺点：</p> <ul><li>针对每个组件都要设置样式。</li><li>如果多个组件需要设置相同的样式，则每个组件都写同样的样式，导致代码冗余；而且修改样式时，需要修改所有代码，工作量大。</li></ul> <p>针对以上问题，我们可以采用选择器样式，将所有的样式代码写到pages/index/index.css文件中，然后通过class、id等方式和组件关联起来。以上节中的代码为例，修改后的代码如下：</p> <div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-css" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/* index.css */</span></li><li><span class="hljs-comment">/* . For the class selector, all components with the class attribute set to "container" will apply this style. */</span> </li><li><span class="hljs-selector-class">.container</span> {  </li><li>    <span class="hljs-attribute">display</span>: flex; </li><li>    <span class="hljs-attribute">justify-content</span>: center; </li><li>    <span class="hljs-attribute">align-items</span>: center; </li><li>    <span class="hljs-attribute">width</span>: <span class="hljs-number">466px</span>; </li><li>    <span class="hljs-attribute">height</span>: <span class="hljs-number">466px</span>; </li><li>} <span class="hljs-comment">/* # For the ID selector, the component with the ID "title" will apply this style. */</span> </li><li><span class="hljs-selector-id">#title</span> {</li><li>    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">30px</span>; </li><li>    <span class="hljs-attribute">text-align</span>: center; </li><li>    <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>; </li><li>    <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>; </li><li>}</li></ol></pre></div></div> </div> <div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-php-template" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/style3/style3.hml#L2-L9" data-highlighted="yes"><ol class="linenums"><li><span class="language-xml"><span class="hljs-comment">&lt;!-- index.hml --&gt;</span></span></li><li><span class="language-xml"><span class="hljs-comment">&lt;!-- Link the style code block of .container in index.css --&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-comment">&lt;!-- Link to the #title style code block in index.css --&gt;</span></span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"title"</span>&gt;</span></span></li><li><span class="language-xml">        Hello World</span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/style3/style3.hml#L2-L9" target="_blank">style3.hml</a></div></div></div></div> <div class="tiledSection"><h3 id="section97813316383">动态绑定样式<i class="anchor-icon anchor-icon-link" anchorid="section97813316383" tips="复制节点链接"></i></h3><p>在行内样式和选择器样式中，样式设置方式是静态的，即代码开发中设置的样式在程序运行的时候不能更改，这种方式限制了程序的显示效果。如果要在程序运行过程中动态地改变样式，需要用到动态绑定样式。动态绑定就是值和变量动态关联，随着值的变更而显示不同的效果。动态绑定的使用方式为“{{变量名}}”，其中变量名是js文件中data对象的属性值。目前动态绑定样式只支持绑定行内样式。</p> <p>以下示例代码中，text的字体大小和data中的fontSize属性绑定，字体颜色和data中的fontColor属性绑定：</p> <div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-php-template" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/style4/style4.hml#L2-L7" data-highlighted="yes"><ol class="linenums"><li><span class="language-xml"><span class="hljs-comment">&lt;!-- index.hml --&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span></span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"font-size: {{fontSize}}; color: {{fontColor}};"</span>&gt;</span></span></li><li><span class="language-xml">        Hello World</span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/style4/style4.hml#L2-L7" target="_blank">style4.hml</a></div></div></div></div> <div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/style4/style4.js#L2-L8" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.js:</span></li><li><span class="hljs-variable">export</span> <span class="hljs-variable">default</span> {</li><li>    <span class="hljs-variable">data</span>: {</li><li>        <span class="hljs-variable">fontSize</span>: <span class="hljs-string">'30px'</span>,</li><li>        <span class="hljs-variable">fontColor</span>: <span class="hljs-string">'#FF0000'</span>,</li><li>    }</li><li>};</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/style4/style4.js#L2-L8" target="_blank">style4.js</a></div></div></div></div> <p>现在已经完成了字体大小和颜色的样式绑定，下一节交互事件将介绍如何通过按钮的点击事件实现动态改变字体的样式。</p> </div> <div class="tiledSection"><h2 id="section10436439104516">交互事件<i class="anchor-icon anchor-icon-link" anchorid="section10436439104516" tips="复制节点链接"></i></h2><p>每个组件都有一些通用事件和特有事件，开发者可在这些事件中实现应用的功能和逻辑。组件中添加事件的格式如下：</p> <div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-php-template" data-highlighted="yes"><ol class="linenums"><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">element</span> <span class="hljs-attr">onevent</span>=<span class="hljs-string">"eventAction"</span>&gt;</span></span></li></ol></pre></div></div> <p>常见的组件事件如下表所示：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.16.5.1.3.1.1" valign="top" width="34.339999999999996%"><p>事件</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.16.5.1.3.1.2" valign="top" width="65.66%"><p>描述</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="34.339999999999996%"><p>click</p> </td> <td class="cellrowborder" valign="top" width="65.66%"><p>组件被点击时触发，使用方法参见下面示例。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="34.339999999999996%"><p>longpress</p> </td> <td class="cellrowborder" valign="top" width="65.66%"><p>组件被长按时触发，使用方法与click相同。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="34.339999999999996%"><p>swipe</p> </td> <td class="cellrowborder" valign="top" width="65.66%"><p>组件上快速滑动时触发，使用方法参见应用退出章节。</p> </td> </tr>  </tbody></table></div> </div> <p>以&lt;input&gt;组件的onclick事件为例，介绍事件的使用方法。首先，在index.hml文件中添加一个&lt;input&gt;组件，添加后的代码示例如下：</p> <div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-php-template" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/event/event.hml#L2-L8" data-highlighted="yes"><ol class="linenums"><li><span class="language-xml"><span class="hljs-comment">&lt;!-- index.hml --&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span></span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"font-size: {{fontSize}}; color: {{fontColor}};"</span>&gt;</span></span></li><li><span class="language-xml">        Hello World</span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span></span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Change"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 200px; height: 50px;"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"clickAction"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">input</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/event/event.hml#L2-L8" target="_blank">event.hml</a></div></div></div></div> <p>在以上代码中，页面里添加了一个&lt;input&gt;组件，包含了onclick事件及其处理函数。clickAction()是一个JavaScript函数，点击按钮改变字体的大小和颜色。它的实现在pages/index/index.js文件中，示例代码如下：</p> <div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/event/event.js#L2-L12" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.js:</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {</li><li>    <span class="hljs-attr">data</span>: {</li><li>        <span class="hljs-attr">fontSize</span>: <span class="hljs-string">'30px'</span>,</li><li>        <span class="hljs-attr">fontColor</span>: <span class="hljs-string">'#FF0000'</span>,</li><li>    },</li><li>    <span class="hljs-title function_">clickAction</span>(<span class="hljs-params"></span>) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">fontSize</span> = <span class="hljs-string">'38px'</span>;</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">fontColor</span> = <span class="hljs-string">'#FFFFFF'</span>;</li><li>    }</li><li>};</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/event/event.js#L2-L12" target="_blank">event.js</a></div></div></div></div> </div> <div class="tiledSection"><h2 id="section578291294918">页面路由<i class="anchor-icon anchor-icon-link" anchorid="section578291294918" tips="复制节点链接"></i></h2><p>应用通常由多个页面组成，需要页面路由来实现页面间的跳转。页面路由router根据uri的地址来找到目标页面，实现跳转。下面以两个简单页面之间的跳转为例说明页面跳转的操作，具体实现步骤如下：</p> <ol><li><span>在“pages”目录右键，选择“New &gt;  Page”，将“Page name”设置为“details”。如果使用其他方式添加页面，则在添加页面后需要修改配置文件config.json中的pages标签。</span><p></p><p><span><img height="533.0640000000001" originheight="656" originwidth="982" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163327.23109933999943479067804088305262:50001231000000:2800:8AFB980E1147119225B3D35765A38595E15A779623BBD9E17631E43CFA661647.png" title="点击放大" width="798"></span></p> <p></p></li><li><span>在index.hml页面添加一个文本和一个按钮，文本通过用来指明当前页面，按钮绑定clickAction()方法，用来实现两个页面之间的相互跳转。</span><p></p><div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-php-template" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/detail/detail.hml#L2-L8" data-highlighted="yes"><ol class="linenums"><li><span class="language-xml"><span class="hljs-comment">&lt;!-- index.hml --&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span></span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title"</span>&gt;</span></span></li><li><span class="language-xml">        Hello World</span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span></span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"View"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"clickAction"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">input</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/detail/detail.hml#L2-L8" target="_blank">detail.hml</a></div></div></div></div> <p></p></li><li><span>在details.hml页面添加一个文本和一个按钮，按钮绑定clickAction()方法。</span><p></p><div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-php-template" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/details/details.hml#L2-L8" data-highlighted="yes"><ol class="linenums"><li><span class="language-xml"><span class="hljs-comment">&lt;!-- details.hml --&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span></span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title"</span>&gt;</span></span></li><li><span class="language-xml">        Details Page</span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span></span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Back"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"clickAction"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">input</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/details/details.hml#L2-L8" target="_blank">details.hml</a></div></div></div></div> <p></p></li><li><span>在index.js文件中实现clickAction()方法，调用router.replaceUrl()函数跳转到详情页。</span><p></p><div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/detail/detail.js#L2-L11" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.js</span></li><li><span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.router'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {</li><li>    <span class="hljs-title function_">clickAction</span>(<span class="hljs-params"></span>) {</li><li>        router.<span class="hljs-title function_">replaceUrl</span>({</li><li>            <span class="hljs-attr">uri</span>: <span class="hljs-string">'pages/details/details'</span></li><li>        });</li><li>    }</li><li>};</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/detail/detail.js#L2-L11" target="_blank">detail.js</a></div></div></div></div> <p></p></li><li><span>在details.js文件中实现clickAction()方法点击按钮调用router.replaceUrl()回到首页。</span><p></p><div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/details/details.js#L2-L11" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// details.js</span></li><li><span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.router'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {</li><li>    <span class="hljs-title function_">clickAction</span>(<span class="hljs-params"></span>) {</li><li>        router.<span class="hljs-title function_">replaceUrl</span>({</li><li>            <span class="hljs-attr">uri</span>: <span class="hljs-string">'pages/index/index'</span></li><li>        });</li><li>    }</li><li>};</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/details/details.js#L2-L11" target="_blank">details.js</a></div></div></div></div> <p></p></li><li><span>使用Preview预览效果，详情请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-previewer-arkts-js" target="_blank">查看ArkTS/JS预览效果</a>。</span><p></p><p><span><img originheight="356" originwidth="821" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163327.03531540325483271518868267276083:50001231000000:2800:C3A2C0765EE7FFE5E02BBCB9AD07F6E57345321B7E0AFA66F18CB9453773E5D3.png" width="821" height="356"></span></p> <p></p></li></ol> </div> <div class="tiledSection"><h2 id="section1356191810495">应用退出<i class="anchor-icon anchor-icon-link" anchorid="section1356191810495" tips="复制节点链接"></i></h2><p>应用退出除使用物理按键触发外，还可以通过组件的事件触发。本章节以右滑表盘退出为例，讲解实现应用退出的方式。</p> <ol><li><span>在index.hml页面的最外层父容器中绑定onswipe事件，当页面右滑的时候会触发onswipe事件绑定的函数。示例代码如下：</span><p></p><div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-php-template" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/exit/exit.hml#L2-L8" data-highlighted="yes"><ol class="linenums"><li><span class="language-xml"><span class="hljs-comment">&lt;!-- index.hml: Binding swipe event to div element --&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span> <span class="hljs-attr">onswipe</span>=<span class="hljs-string">"touchMove"</span>&gt;</span></span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"title"</span>&gt;</span></span></li><li><span class="language-xml">        Hello {{ title }}</span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span></span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"View"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 200px; height: 50px;"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"clickAction"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">input</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/exit/exit.hml#L2-L8" target="_blank">exit.hml</a></div></div></div></div> <p></p></li><li><span>在index.js文件中实现touchMove()方法，调用app模块的terminate()方法实现应用退出。因为swipe是有方向属性的，在事件函数处理中要注意判断方向，否则任意方向的滑动都会触发退出应用操作，示例代码如下：</span><p></p><div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/exit/exit.js#L2-L21" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.js</span></li><li><span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.router'</span>;</li><li><span class="hljs-comment">// Import the app module.</span></li><li><span class="hljs-keyword">import</span> app <span class="hljs-keyword">from</span> <span class="hljs-string">'@system.app'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {</li><li>    <span class="hljs-attr">data</span>: {</li><li>        <span class="hljs-attr">title</span>: <span class="hljs-string">'World'</span></li><li>    },</li><li>    <span class="hljs-title function_">clickAction</span>(<span class="hljs-params"></span>) {</li><li>        router.<span class="hljs-title function_">replaceUrl</span>({</li><li>            <span class="hljs-attr">uri</span>: <span class="hljs-string">'pages/details/details'</span></li><li>        });</li><li>    },</li><li>    <span class="hljs-title function_">touchMove</span>(<span class="hljs-params">e</span>) { <span class="hljs-comment">// Handle swipe events.</span></li><li>        <span class="hljs-keyword">if</span> (e.<span class="hljs-property">direction</span> == <span class="hljs-string">'right'</span>) { <span class="hljs-comment">// Swipe right to exit.</span></li><li>            app.<span class="hljs-title function_">terminate</span>();</li><li>        }</li><li>    }</li><li>};</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/exit/exit.js#L2-L21" target="_blank">exit.js</a></div></div></div></div> <p></p></li></ol> </div> <div class="tiledSection"><h2 id="section11670192213495">应用与页面的生命周期<i class="anchor-icon anchor-icon-link" anchorid="section11670192213495" tips="复制节点链接"></i></h2><p>轻量级智能穿戴应用的生命周期主要有两个：应用创建时会触发app.js文件中的的onCreate()，应用销毁时触发onDestroy()。</p> <p>一个应用中可能会有多个页面，每个页面都包括onInit()、onReady()、onShow()、onHide()和onDestroy()，在页面初始化、准备、显示、隐藏和销毁时触发调用的事件：</p> <ul><li>onInit()：表示页面的数据已经准备好，可以使用js文件中的data数据。</li><li>onReady()：表示页面已经编译完成，可以将界面显示给用户。</li><li>onShow()：方舟开发框架只支持应用同时运行并展示一个页面，当打开一个页面时，上一个页面会被销毁。当一个页面显示的时候，会调用onShow。</li><li>onHide()：页面消失时被调用。</li><li>onDestroy()：页面销毁时被调用。</li></ul> <p><span><img height="693.0364000000001" originheight="1171" originwidth="809" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163328.42578001829664272503943501781274:50001231000000:2800:018078A35A415CE2A8B13FFBF0D0D78A3A1314A2002B7864D793E23F3B691160.png" title="点击放大" width="478.8"></span></p> <p>当应用从页面A跳转到页面B时，首先调用页面A的onDestroy()函数。页面A销毁后，依次调用页面B的onInit()、onReady()、onShow()函数来初始化和显示页面B。</p> </div> <div class="tiledSection"><h2 id="section969242611491">百分比使用<i class="anchor-icon anchor-icon-link" anchorid="section969242611491" tips="复制节点链接"></i></h2><div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>从API Version 5 开始支持。</p> </div></div></div> </div> <p>绘制样式中的部分字段（width，height，margin，top，left）支持使用百分比设置，通过指定百分比，应用在运行时可以自动换算成真实像素值。百分比可以在一定程度上帮助应用进行显示自适应，在不同尺寸的屏幕上显示尽可能做到一致或合理的布局。本章节将介绍百分比在绘制样式中具体的使用。</p> <ol><li><span>在index.hml首页中定义一个div容器，在容器内添加一个包含按钮的stack容器和另一个按钮。</span><p></p><div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-php-template" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/pages/index/index.hml#L2-L8" data-highlighted="yes"><ol class="linenums"><li><span class="language-xml"><span class="hljs-comment">&lt;!-- index.hml --&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span></span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">stack</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stackContainer"</span>&gt;</span></span></li><li><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Button"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">input</span>&gt;</span></span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">stack</span>&gt;</span></span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button2"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Exit"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">input</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/pages/index/index.hml#L2-L8" target="_blank">index.hml</a></div></div></div></div> <p></p></li><li><span>在index.css文件中，对container的class，设置width和height为100%，设置背景色为碧绿色，效果将覆盖整个屏幕。</span><p></p><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-css" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/* index.css */</span> </li><li><span class="hljs-selector-class">.container</span> { </li><li>     <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;   <span class="hljs-comment">/* The width of the container is set to 100%. */</span> </li><li>     <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;  <span class="hljs-comment">/* The height of the container is set to 100%. */</span> </li><li>     <span class="hljs-attribute">justify-content</span>: center; </li><li>     <span class="hljs-attribute">align-items</span>: center; </li><li>     <span class="hljs-attribute">flex-direction</span>: column; </li><li>     <span class="hljs-attribute">background-color</span>: aquamarine;  <span class="hljs-comment">/* Set the background color to light green. */</span> </li><li>}</li></ol></pre></div></div> <p></p></li><li><span>在index.css文件中，对stackContainer的class，设置width和height为50%，背景色为白色，stack容器的宽高则均为父组件的一半。对button的class，设置width为父组件（stack容器）宽度的50%，height为stack容器高度的30%，top距离顶部为stack容器高度的10%，left距离左侧为stack容器宽度的10%；对button2的class，设置width为父组件（div容器）宽度的50%，height为div容器高度的20%，margin-top上方距离stack容器为div容器高度的2%。</span><p></p><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-css" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/* index.css */</span> </li><li><span class="hljs-selector-class">.stackContainer</span> {</li><li>  <span class="hljs-attribute">width</span>: <span class="hljs-number">50%</span>;</li><li>  <span class="hljs-attribute">height</span>: <span class="hljs-number">50%</span>;</li><li>  <span class="hljs-attribute">background-color</span>: white;</li><li>}</li><li>
</li><li><span class="hljs-selector-class">.button</span> {</li><li>  <span class="hljs-attribute">top</span>: <span class="hljs-number">10%</span>;   <span class="hljs-comment">/* Set the position on the y-axis to be 10% of the height of the parent component from the top. */</span></li><li>  <span class="hljs-attribute">left</span>: <span class="hljs-number">10%</span>;  <span class="hljs-comment">/* Set the position on the x-axis to be 10% of the width of the parent component from the parent component itself. */</span></li><li>  <span class="hljs-attribute">width</span>: <span class="hljs-number">50%</span>;</li><li>  <span class="hljs-attribute">height</span>: <span class="hljs-number">30%</span>;</li><li>  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">30px</span>;</li><li>  <span class="hljs-attribute">background-color</span>: black;</li><li>}</li><li>
</li><li>
</li><li><span class="hljs-selector-class">.button2</span> {</li><li>  <span class="hljs-attribute">width</span>: <span class="hljs-number">50%</span>;</li><li>  <span class="hljs-attribute">height</span>: <span class="hljs-number">20%</span>;</li><li>  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">30px</span>;</li><li>  <span class="hljs-attribute">background-color</span>: black;</li><li>  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">2%</span>;  <span class="hljs-comment">/* 2% of the height of the parent component. */</span></li><li>}</li></ol></pre></div></div> <p></p></li><li><span>在preview中预览在轻量级智能穿戴上的显示效果，如下图所示。</span><p></p><p><span><img height="338.47170000000006" originheight="453" originwidth="356" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163328.25188044545120182193339286189583:50001231000000:2800:C11A15B2337F055E6DFFAEF2CF498952246C47A73E25BCCD91D4F39E84337BF4.png" title="点击放大" width="266"></span></p> <p></p></li></ol> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>百分比计算会通过浮点数计算后保留整数部分。</p> </div></div></div> <div class="tiledSection"><h2 id="section165751615411">方表适配<i class="anchor-icon anchor-icon-link" anchorid="section165751615411" tips="复制节点链接"></i></h2><p>应用如果需要同时适配方形的轻量级智能穿戴设备，需要完成以下步骤。</p> <ol><li><span>在DevEco Studio中右键工程目录，选择“New -&gt; Module ”，创建新的“Empty Ability”，将已有entry的内容拷贝至新建的entry，并修改Module的Name。</span></li><li><span>打开新建entry的config.json文件，修改deviceType为liteWearable，并添加distroFilter属性如下：（以方表分辨率408*480为例）</span><p></p><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-string">"module"</span>: {</li><li>    <span class="hljs-string">"deviceType"</span>: [</li><li>      <span class="hljs-string">"liteWearable"</span></li><li>    ],</li><li>    <span class="hljs-string">"distro"</span>: {</li><li>      <span class="hljs-string">"deliveryWithInstall"</span>: <span class="hljs-keyword">true</span></li><li>      <span class="hljs-string">"moduleName"</span>: <span class="hljs-string">"entry"</span>,</li><li>      <span class="hljs-string">"moduleType"</span>: <span class="hljs-string">"entry"</span></li><li>    },</li><li>    <span class="hljs-string">"distroFilter"</span>: {</li><li>      <span class="hljs-string">"screenShape"</span>: {</li><li>        <span class="hljs-string">"policy"</span>: <span class="hljs-string">"include"</span>,</li><li>        <span class="hljs-string">"value"</span>: [</li><li>          <span class="hljs-string">"rect"</span></li><li>        ]</li><li>      },</li><li>      <span class="hljs-string">"screenWindow"</span>: {</li><li>        <span class="hljs-string">"policy"</span>: <span class="hljs-string">"include"</span>,</li><li>        <span class="hljs-string">"value"</span>: [</li><li>          <span class="hljs-string">"408*480"</span></li><li>        ]</li><li>      }</li><li>    },</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre></div></div> <p></p></li><li><span>参考绘制样式章节，将方表对应的页面布局参数修改为408*480或百分比。修改完成后，点击“File -&gt; Sync And Refresh Project”重新同步工程。</span><p></p><div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>应用上架时，应用市场会根据“distroFilter”属性对方形和圆形的轻量级智能穿戴进行分发。</p> </div></div></div> <p></p></li></ol> </div> <div class="tiledSection"><h2 id="section195968314497">安全接口的使用<i class="anchor-icon anchor-icon-link" anchorid="section195968314497" tips="复制节点链接"></i></h2><p>轻量级智能穿戴设备应用开发的安全相关接口，包含通用密钥库系统、加解密算法库框架和锁屏管理。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>轻量级智能穿戴设备目前不支持异步接口，所有异步接口会等待回调函数执行完成，再执行下一行代码。本章节所有异步接口可理解为同步接口。</p> </div></div></div> </div> <div class="tiledSection"><h3 id="section86272017568" class="firsth2">@ohos.security.huks（通用密钥库系统）<i class="anchor-icon anchor-icon-link" anchorid="section86272017568" tips="复制节点链接"></i></h3><p>通用密钥库系统提供的接口，包含常见的对称加密算法、常见的非对称加密算法、常见的消息认证码（MAC）算法和公共接口。</p> <p><strong>常见的对称加密算法</strong>如下表所示：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.26.4.1.7.1.1" valign="top" width="10.797840431913617%"><p>算法类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.26.4.1.7.1.2" valign="top" width="9.218156368726255%"><p>算法</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.26.4.1.7.1.3" valign="top" width="20.245950809838035%"><p>用法</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.26.4.1.7.1.4" valign="top" width="11.89762047590482%"><p>分组模式</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.26.4.1.7.1.5" valign="top" width="16.446710657868426%"><p>填充模式</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.26.4.1.7.1.6" valign="top" width="31.39372125574885%"><p>密钥长度</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" rowspan="7" valign="top" width="10.797840431913617%"><p>对称算法</p> </td> <td class="cellrowborder" rowspan="3" valign="top" width="9.218156368726255%"><p>AES</p> </td> <td class="cellrowborder" rowspan="3" valign="top" width="20.245950809838035%"><p>密钥生成、加密、解密</p> </td> <td class="cellrowborder" valign="top" width="11.89762047590482%"><p>CBC</p> </td> <td class="cellrowborder" valign="top" width="16.446710657868426%"><p>NoPadding</p> </td> <td class="cellrowborder" valign="top" width="31.39372125574885%"><p>128/192/256</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>ECB</p> </td> <td class="cellrowborder" valign="top"><p>NoPadding</p> </td> <td class="cellrowborder" valign="top"><p>128/192/256</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>GCM</p> </td> <td class="cellrowborder" valign="top"><p>NoPadding</p> </td> <td class="cellrowborder" valign="top"><p>128/192/256</p> </td> </tr> <tr><td class="cellrowborder" rowspan="2" valign="top"><p>DES</p> </td> <td class="cellrowborder" rowspan="2" valign="top"><p>密钥生成、加密、解密</p> </td> <td class="cellrowborder" valign="top"><p>CBC</p> </td> <td class="cellrowborder" valign="top"><p>NoPadding</p> </td> <td class="cellrowborder" valign="top"><p>64</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>ECB</p> </td> <td class="cellrowborder" valign="top"><p>NoPadding</p> </td> <td class="cellrowborder" valign="top"><p>64</p> </td> </tr> <tr><td class="cellrowborder" rowspan="2" valign="top"><p>3DES</p> </td> <td class="cellrowborder" rowspan="2" valign="top"><p>密钥生成、加密、解密</p> </td> <td class="cellrowborder" valign="top"><p>CBC</p> </td> <td class="cellrowborder" valign="top"><p>NoPadding</p> </td> <td class="cellrowborder" valign="top"><p>128/192</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>ECB</p> </td> <td class="cellrowborder" valign="top"><p>NoPadding</p> </td> <td class="cellrowborder" valign="top"><p>128/192</p> </td> </tr>  </tbody></table></div> </div> <p>DES加密算法是一种对称加密算法，支持按照CBC/ECB 两种分组模式，填充模式为NoPadding，密钥长度为64位。下文以DES算法CBC分组模式为例，介绍在轻量级穿戴设备应用中实现密钥生成、加密和解密。</p> <ol><li><span><span style="color: rgb(64,64,64);">生成DES-CBC算法密钥：定义一个 </span>getDesCBCEncryptProperties<span style="color: rgb(64,64,64);">()的函数，用于生成一个包含 DES-CBC加密算法相关属性的数组。这些属性用于配置加密操作的参数，并在generateDESKey()方法中生成密钥。</span></span><p></p><div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/security/DES.js#L2-L56" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> <span class="hljs-package">huks</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.security.huks'</span>;</li><li>
</li><li><span class="hljs-comment">// Alias, used to distinguish the generated KEY.</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">DES_CBC_64_KEY_ALIAS</span> = <span class="hljs-string">'DesCBC64KeyAlias'</span>;</li><li><span class="hljs-comment">// ...</span></li><li>
</li><li><span class="hljs-comment">// Configure the Tag required for generating the key.</span></li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">getDesGenProperties</span>() {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">properties</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">Array</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">index</span> = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-comment">// DES algorithm.</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_ALGORITHM</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyAlg</span>.<span class="hljs-title class_">HUKS_ALG_DES</span></li><li>    };</li><li>    <span class="hljs-comment">// Key length: 64.</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_KEY_SIZE</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeySize</span>.<span class="hljs-title class_">HUKS_DES_KEY_SIZE_64</span></li><li>    };</li><li>    <span class="hljs-comment">// Key usage, encryption and decryption.</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_PURPOSE</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyPurpose</span>.<span class="hljs-title class_">HUKS_KEY_PURPOSE_DECRYPT</span> | <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyPurpose</span>.<span class="hljs-title class_">HUKS_KEY_PURPOSE_ENCRYPT</span></li><li>    };</li><li>
</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">properties</span>;</li><li>}</li><li>
</li><li><span class="hljs-comment">// Generate a key.</span></li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">generateDESKey</span>() {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">huksInfo</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">options</span> = { <span class="hljs-variable">properties</span>: <span class="hljs-title class_">getDesGenProperties</span>() }</li><li>    <span class="hljs-variable">huks</span>.<span class="hljs-title function_">generateKeyItem</span>(<span class="hljs-variable">DES_CBC_64_KEY_ALIAS</span>, <span class="hljs-variable">options</span>, (<span class="hljs-variable">err</span>, <span class="hljs-variable">data</span>) =&gt; {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">err</span>) {</li><li>            <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'generateKeyDES return code:'</span> + <span class="hljs-variable">err</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>;</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'The key has been generated:'</span> + <span class="hljs-variable">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable">data</span>);</li><li>        }</li><li>    });</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">huksInfo</span>;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/security/DES.js#L2-L56" target="_blank">DES.js</a></div></div></div></div> <p></p></li><li><span>使用DES-CBC算法进行加密：调用huks.initSession()初始化加密会话，并设置相关属性；调用huks.updateSession()处理明文的前16个字符；调用huks.finishSession()处理明文的剩余16个字符，并完成加密。</span><p></p><div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/security/DES.js#L5-L191" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Alias, used to distinguish the generated KEY.</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">DES_CBC_64_KEY_ALIAS</span> = <span class="hljs-string">'DesCBC64KeyAlias'</span>;</li><li><span class="hljs-comment">// Three-part handle, used for connecting three-part context.</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">handle</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">IV</span> = <span class="hljs-string">'12345678'</span>;</li><li><span class="hljs-comment">// Plain text, data before encryption.</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">plainText</span> = <span class="hljs-string">'DESAAAdffssghCBC5612345612345L64'</span>;</li><li><span class="hljs-comment">// Ciphertext, storing the encrypted data.</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">cipherText</span> = <span class="hljs-string">''</span>;</li><li>
</li><li><span class="hljs-comment">// ...</span></li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">getDesCBCEncryptProperties</span>() {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">properties</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">Array</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">index</span> = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-comment">// algorithm.</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_ALGORITHM</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyAlg</span>.<span class="hljs-title class_">HUKS_ALG_DES</span></li><li>    };</li><li>
</li><li>    <span class="hljs-comment">// key length.</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_KEY_SIZE</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeySize</span>.<span class="hljs-title class_">HUKS_DES_KEY_SIZE_64</span></li><li>    };</li><li>
</li><li>    <span class="hljs-comment">// Key usage.</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_PURPOSE</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyPurpose</span>.<span class="hljs-title class_">HUKS_KEY_PURPOSE_ENCRYPT</span></li><li>    };</li><li>
</li><li>    <span class="hljs-comment">// Filling method.</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_PADDING</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyPadding</span>.<span class="hljs-title class_">HUKS_PADDING_NONE</span></li><li>    };</li><li>
</li><li>    <span class="hljs-comment">// packet mode.</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_BLOCK_MODE</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksCipherMode</span>.<span class="hljs-title class_">HUKS_MODE_CBC</span></li><li>    };</li><li>
</li><li>    <span class="hljs-comment">// Group encryption offset vector, more secure.</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_IV</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">stringToUint8Array</span>(<span class="hljs-title class_">IV</span>)</li><li>    };</li><li>
</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">properties</span>;</li><li>}</li><li>
</li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">encryptDES</span>() {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">huksInfo</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">ret</span> = <span class="hljs-keyword">true</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">initOptions</span> = {</li><li>        <span class="hljs-variable">properties</span>: <span class="hljs-title class_">getDesCBCEncryptProperties</span>(),</li><li>        <span class="hljs-variable">inData</span>: <span class="hljs-title class_">new</span> <span class="hljs-title class_">Uint8Array</span>()</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">updateOptions</span> = {</li><li>        <span class="hljs-variable">properties</span>: <span class="hljs-title class_">getDesCBCEncryptProperties</span>(),</li><li>        <span class="hljs-variable">inData</span>: <span class="hljs-title class_">stringToUint8Array</span>(<span class="hljs-title class_">plainText</span>.<span class="hljs-title class_">substring</span>(<span class="hljs-number">0</span>, <span class="hljs-number">16</span>))</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">finishOptions</span> = {</li><li>        <span class="hljs-variable">properties</span>: <span class="hljs-title class_">getDesCBCEncryptProperties</span>(),</li><li>        <span class="hljs-variable">inData</span>: <span class="hljs-title class_">stringToUint8Array</span>(<span class="hljs-title class_">plainText</span>.<span class="hljs-title class_">substring</span>(<span class="hljs-number">16</span>, <span class="hljs-number">32</span>))</li><li>    }</li><li>
</li><li>    <span class="hljs-variable">huks</span>.<span class="hljs-title function_">initSession</span>(<span class="hljs-variable">DES_CBC_64_KEY_ALIAS</span>, <span class="hljs-variable">initOptions</span>, (<span class="hljs-variable">initErr</span>, <span class="hljs-variable">initData</span>) =&gt; {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">initErr</span>) {</li><li>            <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'encryptDES initSession return code:'</span> + <span class="hljs-variable">initErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">initErr</span>.<span class="hljs-variable">message</span>;</li><li>            <span class="hljs-variable">ret</span> = <span class="hljs-keyword">false</span>;</li><li>            <span class="hljs-variable">huks</span>.<span class="hljs-title function_">abortSession</span>(<span class="hljs-variable">initData</span>.<span class="hljs-variable">handle</span>, <span class="hljs-variable">initOptions</span>, (<span class="hljs-variable">abortErr</span>, <span class="hljs-variable">abortData</span>) =&gt; {</li><li>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">abortErr</span>) {</li><li>                    <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'encryptDES init abortSession return code:'</span> + <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">message</span>;</li><li>                }</li><li>            });</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-variable">handle</span> = <span class="hljs-variable">initData</span>.<span class="hljs-variable">handle</span>;</li><li>        }</li><li>    });</li><li>
</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable">ret</span>) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-variable">huksInfo</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-variable">huks</span>.<span class="hljs-title function_">updateSession</span>(<span class="hljs-variable">handle</span>, <span class="hljs-variable">updateOptions</span>, (<span class="hljs-variable">updateErr</span>, <span class="hljs-variable">updateData</span>) =&gt; {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">updateErr</span>) {</li><li>            <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'encryptDES updateSession return code:'</span> + <span class="hljs-variable">updateErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">updateErr</span>.<span class="hljs-variable">message</span>;</li><li>            <span class="hljs-variable">ret</span> = <span class="hljs-keyword">false</span>;</li><li>            <span class="hljs-variable">huks</span>.<span class="hljs-title function_">abortSession</span>(<span class="hljs-variable">handle</span>, <span class="hljs-variable">updateOptions</span>, (<span class="hljs-variable">abortErr</span>, <span class="hljs-variable">abortData</span>) =&gt; {</li><li>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">abortErr</span>) {</li><li>                    <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'encryptDES update abortSession return code:'</span> + <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">message</span>;</li><li>                }</li><li>            });</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-comment">// Encrypted message reception</span></li><li>            <span class="hljs-variable">cipherText</span> = <span class="hljs-title function_">uint8ArrayToString</span>(<span class="hljs-variable">updateData</span>.<span class="hljs-variable">outData</span>);</li><li>            <span class="hljs-variable">huksInfo</span> = <span class="hljs-variable">cipherText</span></li><li>        }</li><li>    });</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable">ret</span>) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-variable">huksInfo</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-variable">huks</span>.<span class="hljs-title function_">finishSession</span>(<span class="hljs-variable">handle</span>, <span class="hljs-variable">finishOptions</span>, (<span class="hljs-variable">finishErr</span>, <span class="hljs-variable">finishData</span>) =&gt; {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">finishErr</span>) {</li><li>            <span class="hljs-variable">ret</span> = <span class="hljs-keyword">false</span>;</li><li>            <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'encryptDES finishSession return code:'</span> + <span class="hljs-variable">finishErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">finishErr</span>.<span class="hljs-variable">message</span>;</li><li>            <span class="hljs-variable">huks</span>.<span class="hljs-title function_">abortSession</span>(<span class="hljs-variable">handle</span>, <span class="hljs-variable">finishOptions</span>, (<span class="hljs-variable">abortErr</span>, <span class="hljs-variable">abortData</span>) =&gt; {</li><li>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">abortErr</span>) {</li><li>                    <span class="hljs-variable">huksInfo</span> =</li><li>                        <span class="hljs-string">'encryptDES finish  abortSession return code:'</span> + <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">message</span>;</li><li>                }</li><li>            });</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-comment">// Encrypted message reception</span></li><li>            <span class="hljs-variable">cipherText</span> = <span class="hljs-variable">cipherText</span> + <span class="hljs-title function_">uint8ArrayToString</span>(<span class="hljs-variable">finishData</span>.<span class="hljs-variable">outData</span>);</li><li>            <span class="hljs-variable">huksInfo</span> = <span class="hljs-variable">cipherText</span></li><li>        }</li><li>    });</li><li>
</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">huksInfo</span>;</li><li>}</li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">stringToUint8Array</span>(<span class="hljs-variable">str</span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">arr</span> = [];</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> <span class="hljs-variable">i</span> = <span class="hljs-number">0</span>, <span class="hljs-variable">j</span> = <span class="hljs-variable">str</span>.<span class="hljs-variable">length</span>; <span class="hljs-variable">i</span> &lt; <span class="hljs-title class_">j</span>; ++<span class="hljs-title class_">i</span>) {</li><li>        <span class="hljs-variable">arr</span>.<span class="hljs-title function_">push</span>(<span class="hljs-variable">str</span>.<span class="hljs-title function_">charCodeAt</span>(<span class="hljs-variable">i</span>));</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">new</span> <span class="hljs-title function_">Uint8Array</span>(<span class="hljs-variable">arr</span>);</li><li>}</li><li>
</li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">uint8ArrayToString</span>(<span class="hljs-variable">fileData</span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">dataString</span> = <span class="hljs-string">''</span>;</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> <span class="hljs-variable">i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">i</span> &lt; <span class="hljs-title class_">fileData</span>.<span class="hljs-title class_">length</span>; <span class="hljs-title class_">i</span>++) {</li><li>        <span class="hljs-variable">dataString</span> += <span class="hljs-variable">String</span>.<span class="hljs-title function_">fromCharCode</span>(<span class="hljs-variable">fileData</span>[<span class="hljs-variable">i</span>]);</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">dataString</span>;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/security/DES.js#L5-L191" target="_blank">DES.js</a></div></div></div></div> <p></p></li><li><span>使用DES-CBC算法进行解密：调用huks.initSession()初始化解密会话；调用huks.updateSession()处理密文的前16个字节，并将解密后的数据转换为字符串存储在outPlainText中；调用huks.finishSession()处理密文的剩余16个字节，并将解密后的数据追加到outPlainText中。</span><p></p><div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/security/DES.js#L6-L305" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Alias, used to distinguish the generated KEY.</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">DES_CBC_64_KEY_ALIAS</span> = <span class="hljs-string">'DesCBC64KeyAlias'</span>;</li><li><span class="hljs-comment">// Three-part handle, used for connecting three-part context.</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">handle</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">IV</span> = <span class="hljs-string">'12345678'</span>;</li><li><span class="hljs-comment">// Plain text, data before encryption.</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">plainText</span> = <span class="hljs-string">'DESAAAdffssghCBC5612345612345L64'</span>;</li><li><span class="hljs-comment">// Ciphertext, storing the encrypted data.</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">cipherText</span> = <span class="hljs-string">''</span>;</li><li>
</li><li><span class="hljs-comment">// ...</span></li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">stringToUint8Array</span>(<span class="hljs-variable">str</span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">arr</span> = [];</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> <span class="hljs-variable">i</span> = <span class="hljs-number">0</span>, <span class="hljs-variable">j</span> = <span class="hljs-variable">str</span>.<span class="hljs-variable">length</span>; <span class="hljs-variable">i</span> &lt; <span class="hljs-title class_">j</span>; ++<span class="hljs-title class_">i</span>) {</li><li>        <span class="hljs-variable">arr</span>.<span class="hljs-title function_">push</span>(<span class="hljs-variable">str</span>.<span class="hljs-title function_">charCodeAt</span>(<span class="hljs-variable">i</span>));</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">new</span> <span class="hljs-title function_">Uint8Array</span>(<span class="hljs-variable">arr</span>);</li><li>}</li><li>
</li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">uint8ArrayToString</span>(<span class="hljs-variable">fileData</span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">dataString</span> = <span class="hljs-string">''</span>;</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> <span class="hljs-variable">i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">i</span> &lt; <span class="hljs-title class_">fileData</span>.<span class="hljs-title class_">length</span>; <span class="hljs-title class_">i</span>++) {</li><li>        <span class="hljs-variable">dataString</span> += <span class="hljs-variable">String</span>.<span class="hljs-title function_">fromCharCode</span>(<span class="hljs-variable">fileData</span>[<span class="hljs-variable">i</span>]);</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">dataString</span>;</li><li>}</li><li>
</li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">GetDesCBCDecryptProperties</span>() {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">properties</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">Array</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">index</span> = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-comment">// algorithm</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_ALGORITHM</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyAlg</span>.<span class="hljs-title class_">HUKS_ALG_DES</span></li><li>    };</li><li>    <span class="hljs-comment">// key length</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_KEY_SIZE</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeySize</span>.<span class="hljs-title class_">HUKS_DES_KEY_SIZE_64</span></li><li>    };</li><li>    <span class="hljs-comment">// Key usage</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_PURPOSE</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyPurpose</span>.<span class="hljs-title class_">HUKS_KEY_PURPOSE_DECRYPT</span></li><li>    };</li><li>    <span class="hljs-comment">// Filling method</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_PADDING</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyPadding</span>.<span class="hljs-title class_">HUKS_PADDING_NONE</span></li><li>    };</li><li>    <span class="hljs-comment">// packet mode</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_BLOCK_MODE</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksCipherMode</span>.<span class="hljs-title class_">HUKS_MODE_CBC</span></li><li>    };</li><li>    <span class="hljs-comment">// Group encryption offset vector, more secure</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_IV</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">stringToUint8Array</span>(<span class="hljs-title class_">IV</span>)</li><li>    };</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">properties</span>;</li><li>}</li><li>
</li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">decryptDES</span>() {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">huksInfo</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">ret</span> = <span class="hljs-keyword">true</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">outPlainText</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">initOptions</span> = {</li><li>        <span class="hljs-variable">properties</span>: <span class="hljs-title class_">GetDesCBCDecryptProperties</span>(),</li><li>        <span class="hljs-variable">inData</span>: <span class="hljs-title class_">new</span> <span class="hljs-title class_">Uint8Array</span>()</li><li>    }</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">updateOptions</span> = {</li><li>        <span class="hljs-variable">properties</span>: <span class="hljs-title class_">GetDesCBCDecryptProperties</span>(),</li><li>        <span class="hljs-variable">inData</span>: <span class="hljs-title class_">stringToUint8Array</span>(<span class="hljs-title class_">cipherText</span>.<span class="hljs-title class_">substring</span>(<span class="hljs-number">0</span>, <span class="hljs-number">16</span>))</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">finishOptions</span> = {</li><li>        <span class="hljs-variable">properties</span>: <span class="hljs-title class_">GetDesCBCDecryptProperties</span>(),</li><li>        <span class="hljs-variable">inData</span>: <span class="hljs-title class_">stringToUint8Array</span>(<span class="hljs-title class_">cipherText</span>.<span class="hljs-title class_">substring</span>(<span class="hljs-number">16</span>, <span class="hljs-number">32</span>))</li><li>    }</li><li>
</li><li>    <span class="hljs-variable">huks</span>.<span class="hljs-title function_">initSession</span>(<span class="hljs-variable">DES_CBC_64_KEY_ALIAS</span>, <span class="hljs-variable">initOptions</span>, (<span class="hljs-variable">initErr</span>, <span class="hljs-variable">initData</span>) =&gt; {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">initErr</span>) {</li><li>            <span class="hljs-variable">ret</span> = <span class="hljs-keyword">false</span>;</li><li>            <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'decryptDES initSession return code:'</span> + <span class="hljs-variable">initErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">initErr</span>.<span class="hljs-variable">message</span>;</li><li>            <span class="hljs-variable">huks</span>.<span class="hljs-title function_">abortSession</span>(<span class="hljs-variable">initData</span>.<span class="hljs-variable">handle</span>, <span class="hljs-variable">initOptions</span>, (<span class="hljs-variable">abortErr</span>, <span class="hljs-variable">abortData</span>) =&gt; {</li><li>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">abortErr</span>) {</li><li>                    <span class="hljs-variable">huksInfo</span> =</li><li>                        <span class="hljs-string">'decryptDES initSession abortSession return code:'</span> + <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">message</span>;</li><li>                }</li><li>            });</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-variable">handle</span> = <span class="hljs-variable">initData</span>.<span class="hljs-variable">handle</span>;</li><li>        }</li><li>    });</li><li>
</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable">ret</span>) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-variable">huksInfo</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-variable">huks</span>.<span class="hljs-title function_">updateSession</span>(<span class="hljs-variable">handle</span>, <span class="hljs-variable">updateOptions</span>, (<span class="hljs-variable">updateErr</span>, <span class="hljs-variable">updateData</span>) =&gt; {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">updateErr</span>) {</li><li>            <span class="hljs-variable">ret</span> = <span class="hljs-keyword">false</span>;</li><li>            <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'decryptDES updateSession return code:'</span> + <span class="hljs-variable">updateErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">updateErr</span>.<span class="hljs-variable">message</span>;</li><li>            <span class="hljs-variable">huks</span>.<span class="hljs-title function_">abortSession</span>(<span class="hljs-variable">handle</span>, <span class="hljs-variable">updateOptions</span>, (<span class="hljs-variable">abortErr</span>, <span class="hljs-variable">abortData</span>) =&gt; {</li><li>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">abortErr</span>) {</li><li>                    <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'decryptDES update abortSession return code:'</span> + <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">message</span>;</li><li>                }</li><li>            });</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-comment">// Clear text reception</span></li><li>            <span class="hljs-variable">outPlainText</span> = <span class="hljs-title function_">uint8ArrayToString</span>(<span class="hljs-variable">updateData</span>.<span class="hljs-variable">outData</span>);</li><li>            <span class="hljs-variable">huksInfo</span> = <span class="hljs-variable">outPlainText</span>;</li><li>        }</li><li>    });</li><li>
</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable">ret</span>) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-variable">huksInfo</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-variable">huks</span>.<span class="hljs-title function_">finishSession</span>(<span class="hljs-variable">handle</span>, <span class="hljs-variable">finishOptions</span>, (<span class="hljs-variable">finishErr</span>, <span class="hljs-variable">finishData</span>) =&gt; {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">finishErr</span>) {</li><li>            <span class="hljs-variable">ret</span> = <span class="hljs-keyword">false</span>;</li><li>            <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'decryptDES finishSession return code:'</span> + <span class="hljs-variable">finishErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">finishErr</span>.<span class="hljs-variable">message</span>;</li><li>            <span class="hljs-variable">huks</span>.<span class="hljs-title function_">abortSession</span>(<span class="hljs-variable">handle</span>, <span class="hljs-variable">finishOptions</span>, (<span class="hljs-variable">abortErr</span>, <span class="hljs-variable">abortData</span>) =&gt; {</li><li>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">abortErr</span>) {</li><li>                    <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'decryptDES abortSession return code:'</span> + <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">message</span>;</li><li>                }</li><li>            });</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-comment">// Clear text reception</span></li><li>            <span class="hljs-variable">outPlainText</span> = <span class="hljs-variable">outPlainText</span> + <span class="hljs-title function_">uint8ArrayToString</span>(<span class="hljs-variable">finishData</span>.<span class="hljs-variable">outData</span>);</li><li>            <span class="hljs-variable">huksInfo</span> = <span class="hljs-variable">outPlainText</span>;</li><li>        }</li><li>    });</li><li>
</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">huksInfo</span>;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/security/DES.js#L6-L305" target="_blank">DES.js</a></div></div></div></div> <p></p></li></ol> <p><strong>常见的非对称加密算法</strong>如下表所示：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.26.8.1.10.1.1" valign="top" width="8.930893089308931%"><p>算法类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.26.8.1.10.1.2" valign="top" width="8.270827082708271%"><p>算法</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.26.8.1.10.1.3" valign="top" width="13.701370137013702%"><p>用法</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.26.8.1.10.1.4" valign="top" width="7.84078407840784%"><p>分组模式</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.26.8.1.10.1.5" valign="top" width="9.340934093409341%"><p>摘要模式</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.26.8.1.10.1.6" valign="top" width="13.371337133713373%"><p>填充模式</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.26.8.1.10.1.7" valign="top" width="11.6011601160116%"><p>密钥长度</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.26.8.1.10.1.8" valign="top" width="12.89128912891289%"><p>标准</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.26.8.1.10.1.9" valign="top" width="14.051405140514053%"><p>开闭源</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" rowspan="6" valign="top" width="8.930893089308931%"><p>非对称算法</p> </td> <td class="cellrowborder" rowspan="6" valign="top" width="8.270827082708271%"><p>RSA</p> </td> <td class="cellrowborder" rowspan="3" valign="top" width="13.701370137013702%"><p>密钥生成、加密、解密</p> </td> <td class="cellrowborder" valign="top" width="7.84078407840784%"><p>ECB</p> </td> <td class="cellrowborder" valign="top" width="9.340934093409341%">&nbsp;&nbsp;</td> <td class="cellrowborder" valign="top" width="13.371337133713373%"><p>NoPadding</p> </td> <td class="cellrowborder" valign="top" width="11.6011601160116%"><p>[1024,2048]</p> </td> <td class="cellrowborder" valign="top" width="12.89128912891289%"><p>RFC</p> </td> <td class="cellrowborder" valign="top" width="14.051405140514053%"><p>开源</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>ECB</p> </td> <td class="cellrowborder" valign="top">&nbsp;&nbsp;</td> <td class="cellrowborder" valign="top"><p><span style="color: rgb(64,64,64);">PKCS#1 V1.5</span></p> </td> <td class="cellrowborder" valign="top"><p>[1024,2048]</p> </td> <td class="cellrowborder" valign="top"><p>RFC</p> </td> <td class="cellrowborder" valign="top"><p>开源</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>ECB</p> </td> <td class="cellrowborder" valign="top"><p>SHA256</p> </td> <td class="cellrowborder" valign="top"><p>OAEP</p> </td> <td class="cellrowborder" valign="top"><p>[1024,2048]</p> </td> <td class="cellrowborder" valign="top"><p>RFC</p> </td> <td class="cellrowborder" valign="top"><p>开源</p> </td> </tr> <tr><td class="cellrowborder" rowspan="3" valign="top"><p>密钥生成、签名、验签</p> </td> <td class="cellrowborder" valign="top">&nbsp;&nbsp;</td> <td class="cellrowborder" valign="top"><p>SHA256</p> </td> <td class="cellrowborder" valign="top"><p><span style="color: rgb(64,64,64);">PKCS#1 V1.5</span></p> </td> <td class="cellrowborder" valign="top"><p>[1024,2048]</p> </td> <td class="cellrowborder" valign="top"><p>RFC</p> </td> <td class="cellrowborder" valign="top"><p>开源</p> </td> </tr> <tr><td class="cellrowborder" valign="top">&nbsp;&nbsp;</td> <td class="cellrowborder" valign="top"><p>SHA256</p> </td> <td class="cellrowborder" valign="top"><p>PSS</p> </td> <td class="cellrowborder" valign="top"><p>[1024,2048]</p> </td> <td class="cellrowborder" valign="top"><p>RFC</p> </td> <td class="cellrowborder" valign="top"><p>开源</p> </td> </tr> <tr><td class="cellrowborder" valign="top">&nbsp;&nbsp;</td> <td class="cellrowborder" valign="top"><p>SHA1</p> </td> <td class="cellrowborder" valign="top"><p>ISO/IEC 9796-2</p> </td> <td class="cellrowborder" valign="top"><p>[1024,2048]</p> </td> <td class="cellrowborder" valign="top"><p>ISO-9796</p> </td> <td class="cellrowborder" valign="top"><p>闭源</p> </td> </tr>  </tbody></table></div> </div> <p><span style="color: rgb(64,64,64);">RSA加密算法是一种非对称加密算法，支持密钥对生成、加解密、签名和验签操作。RSA的填充模式通常为PKCS#1 V1.5或OAEP，密钥长度通常为1024位、2048位，密钥长度越长，安全性越高，但计算开销也越大。下文以RSA算法、填充模式PKCS#1 V1.5为例，介绍在轻量级穿戴设备应用中实现密钥对生成、加解密、签名和验签。</span></p> <ol><li><span><span style="color: rgb(64,64,64);">生成RSA算法密钥：定义一个 </span>getRSAGenProperties<span style="color: rgb(64,64,64);">()的函数，用于生成一个包含 RSA加密算法相关属性的数组。这些属性用于配置加密操作的参数，</span><span style="color: rgb(64,64,64);">并在generateRSAKey()方法中生成密钥。</span></span><p></p><div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/security/RSA.js#L2-L56" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> <span class="hljs-package">huks</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.security.huks'</span>;</li><li>
</li><li><span class="hljs-comment">// Alias, used to distinguish the generated KEY.</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">RSA_KEY_ALIAS</span> = <span class="hljs-string">'RSAKeyAlias'</span>;</li><li><span class="hljs-comment">// The custom key length must be between 1024 and 2048, and it must be a multiple of 8.</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">HUKS_RSA_KEY_SIZE_1024</span> = <span class="hljs-number">1024</span>;</li><li><span class="hljs-comment">// ...</span></li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">getRSAGenProperties</span>() {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">properties</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">Array</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">index</span> = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-comment">// algorithm.</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_ALGORITHM</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyAlg</span>.<span class="hljs-title class_">HUKS_ALG_RSA</span></li><li>    };</li><li>    <span class="hljs-comment">// key length.</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_KEY_SIZE</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">HUKS_RSA_KEY_SIZE_1024</span></li><li>    };</li><li>    <span class="hljs-comment">// Key usage.</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_PURPOSE</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyPurpose</span>.<span class="hljs-title class_">HUKS_KEY_PURPOSE_DECRYPT</span> | <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyPurpose</span>.<span class="hljs-title class_">HUKS_KEY_PURPOSE_ENCRYPT</span></li><li>    };</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">properties</span>;</li><li>}</li><li>
</li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">generateRSAKey</span>() {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">huksInfo</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">options</span> = { <span class="hljs-variable">properties</span>: <span class="hljs-title class_">getRSAGenProperties</span>() };</li><li>    <span class="hljs-variable">huks</span>.<span class="hljs-title function_">generateKeyItem</span>(<span class="hljs-variable">HUKS_RSA_KEY_SIZE_1024</span>, <span class="hljs-variable">options</span>, (<span class="hljs-variable">err</span>, <span class="hljs-variable">data</span>) =&gt; {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">err</span>) {</li><li>            <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'generateRSAKey return code:'</span> + <span class="hljs-variable">err</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>;</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'The key has been generated:'</span> + <span class="hljs-variable">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable">data</span>);</li><li>        }</li><li>    });</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">huksInfo</span>;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/security/RSA.js#L2-L56" target="_blank">RSA.js</a></div></div></div></div> <p></p></li><li><span>使用RSA算法进行加密：调用huks.initSession()初始化加密会话，并设置相关属性；调用huks.updateSession()<span style="color: rgb(64,64,64);">对明文的前半部分进行加密</span>；调用huks.finishSession()<span style="color: rgb(64,64,64);">对明文的后半部分进行加密</span>，并获取最终的密文。</span><p></p><div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/security/RSA.js#L6-L174" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Alias, used to distinguish the generated KEY.</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">RSA_KEY_ALIAS</span> = <span class="hljs-string">'RSAKeyAlias'</span>;</li><li><span class="hljs-comment">// The custom key length must be between 1024 and 2048, and it must be a multiple of 8.</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">HUKS_RSA_KEY_SIZE_1024</span> = <span class="hljs-number">1024</span>;</li><li><span class="hljs-comment">// Plain text, data before encryption.</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">plainText</span> = <span class="hljs-string">'RSASSAdffssghCBC5612345612345192'</span>;</li><li><span class="hljs-comment">// Plain text, the length of the data before encryption.</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">plainTextLen</span> = <span class="hljs-number">32</span>;</li><li><span class="hljs-comment">// Ciphertext, storing the encrypted data.</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">cipherText</span> = <span class="hljs-string">''</span>;</li><li><span class="hljs-comment">// Operation handle.</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">handle</span>;</li><li>
</li><li><span class="hljs-comment">// ...</span></li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">getRSAEncryptProperties</span>() {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">properties</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">Array</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">index</span> = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-comment">// algorithm.</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_ALGORITHM</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyAlg</span>.<span class="hljs-title class_">HUKS_ALG_RSA</span></li><li>    };</li><li>    <span class="hljs-comment">// key length.</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_KEY_SIZE</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">HUKS_RSA_KEY_SIZE_1024</span></li><li>    };</li><li>
</li><li>    <span class="hljs-comment">// Key usage.</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_PURPOSE</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyPurpose</span>.<span class="hljs-title class_">HUKS_KEY_PURPOSE_ENCRYPT</span></li><li>    };</li><li>    <span class="hljs-comment">// Key PADDING method.</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_PADDING</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyPadding</span>.<span class="hljs-title class_">HUKS_PADDING_PKCS1_V1_5</span></li><li>    };</li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_DIGEST</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyDigest</span>.<span class="hljs-title class_">HUKS_DIGEST_SHA256</span></li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">properties</span>;</li><li>}</li><li>
</li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">encryptProcess</span>() {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">ret</span> = <span class="hljs-keyword">true</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">huksInfo</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">initOptions</span> = {</li><li>        <span class="hljs-variable">properties</span>: <span class="hljs-title class_">getRSAEncryptProperties</span>(),</li><li>        <span class="hljs-variable">inData</span>: <span class="hljs-title class_">new</span> <span class="hljs-title class_">Uint8Array</span>()</li><li>    }</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">updateOptions</span> = {</li><li>        <span class="hljs-variable">properties</span>: <span class="hljs-title class_">getRSAEncryptProperties</span>(),</li><li>        <span class="hljs-variable">inData</span>: <span class="hljs-title class_">stringToUint8Array</span>(<span class="hljs-title class_">plainText</span>.<span class="hljs-title class_">substring</span>(<span class="hljs-number">0</span>, <span class="hljs-variable">plainTextLen</span> / <span class="hljs-number">2</span>))</li><li>    }</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">finishOptions</span> = {</li><li>        <span class="hljs-variable">properties</span>: <span class="hljs-title class_">getRSAEncryptProperties</span>(),</li><li>        <span class="hljs-variable">inData</span>: <span class="hljs-title class_">stringToUint8Array</span>(<span class="hljs-title class_">plainText</span>.<span class="hljs-title class_">substring</span>(<span class="hljs-variable">plainTextLen</span> / <span class="hljs-number">2</span>, <span class="hljs-title class_">plainTextLen</span>))</li><li>    }</li><li>    <span class="hljs-variable">huks</span>.<span class="hljs-title function_">initSession</span>(<span class="hljs-variable">RSA_KEY_ALIAS</span>, <span class="hljs-variable">initOptions</span>, (<span class="hljs-variable">initErr</span>, <span class="hljs-variable">initData</span>) =&gt; {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">initErr</span>) {</li><li>            <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'encryptProcess initSession return code:'</span> + <span class="hljs-variable">initErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">initErr</span>.<span class="hljs-variable">message</span>;</li><li>            <span class="hljs-variable">ret</span> = <span class="hljs-keyword">false</span>;</li><li>            <span class="hljs-variable">huks</span>.<span class="hljs-title function_">abortSession</span>(<span class="hljs-variable">initData</span>.<span class="hljs-variable">handle</span>, <span class="hljs-variable">initOptions</span>, (<span class="hljs-variable">abortErr</span>, <span class="hljs-variable">abortData</span>) =&gt; {</li><li>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">abortErr</span>) {</li><li>                    <span class="hljs-variable">huksInfo</span> =</li><li>                        <span class="hljs-string">'encryptProcess init abortSession return code:'</span> + <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">message</span>;</li><li>                }</li><li>            });</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-variable">handle</span> = <span class="hljs-variable">initData</span>.<span class="hljs-variable">handle</span>;</li><li>        }</li><li>    });</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable">ret</span>) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-variable">huksInfo</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-variable">huks</span>.<span class="hljs-title function_">updateSession</span>(<span class="hljs-variable">handle</span>, <span class="hljs-variable">updateOptions</span>, (<span class="hljs-variable">updateErr</span>, <span class="hljs-variable">updateData</span>) =&gt; {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">updateErr</span>) {</li><li>            <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'encryptProcess updateSession return code:'</span> + <span class="hljs-variable">updateErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">updateErr</span>.<span class="hljs-variable">message</span>;</li><li>            <span class="hljs-variable">ret</span> = <span class="hljs-keyword">false</span>;</li><li>            <span class="hljs-variable">huks</span>.<span class="hljs-title function_">abortSession</span>(<span class="hljs-variable">handle</span>, <span class="hljs-variable">updateOptions</span>, (<span class="hljs-variable">abortErr</span>, <span class="hljs-variable">abortData</span>) =&gt; {</li><li>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">abortErr</span>) {</li><li>                    <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'encryptProcess updateSession abortSession return code:'</span> + <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> +</li><li>                    <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">message</span>;</li><li>                }</li><li>            });</li><li>        }</li><li>    });</li><li>
</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable">ret</span>) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-variable">huksInfo</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-variable">huks</span>.<span class="hljs-title function_">finishSession</span>(<span class="hljs-variable">handle</span>, <span class="hljs-variable">finishOptions</span>, (<span class="hljs-variable">finishErr</span>, <span class="hljs-variable">finishData</span>) =&gt; {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">finishErr</span>) {</li><li>            <span class="hljs-variable">ret</span> = <span class="hljs-keyword">false</span>;</li><li>            <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'encryptProcess finishSession return code:'</span> + <span class="hljs-variable">finishErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">finishErr</span>.<span class="hljs-variable">message</span>;</li><li>            <span class="hljs-variable">huks</span>.<span class="hljs-title function_">abortSession</span>(<span class="hljs-variable">handle</span>, <span class="hljs-variable">finishOptions</span>, (<span class="hljs-variable">abortErr</span>, <span class="hljs-variable">abortData</span>) =&gt; {</li><li>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">abortErr</span>) {</li><li>                    <span class="hljs-variable">huksInfo</span> =</li><li>                        <span class="hljs-string">'encryptProcess finish  abortSession return code:'</span> + <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">message</span>;</li><li>                }</li><li>            });</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-comment">// Encrypted message reception.</span></li><li>            <span class="hljs-variable">cipherText</span> = <span class="hljs-title function_">uint8ArrayToString</span>(<span class="hljs-variable">finishData</span>.<span class="hljs-variable">outData</span>);</li><li>            <span class="hljs-variable">huksInfo</span> = <span class="hljs-variable">cipherText</span>;</li><li>        }</li><li>    });</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">huksInfo</span>;</li><li>}</li><li>
</li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">uint8ArrayToString</span>(<span class="hljs-variable">fileData</span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">dataString</span> = <span class="hljs-string">''</span>;</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> <span class="hljs-variable">i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">i</span> &lt; <span class="hljs-title class_">fileData</span>.<span class="hljs-title class_">length</span>; <span class="hljs-title class_">i</span>++) {</li><li>        <span class="hljs-variable">dataString</span> += <span class="hljs-variable">String</span>.<span class="hljs-title function_">fromCharCode</span>(<span class="hljs-variable">fileData</span>[<span class="hljs-variable">i</span>]);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">dataString</span>;</li><li>}</li><li>
</li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">stringToUint8Array</span>(<span class="hljs-variable">str</span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">arr</span> = [];</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> <span class="hljs-variable">i</span> = <span class="hljs-number">0</span>, <span class="hljs-variable">j</span> = <span class="hljs-variable">str</span>.<span class="hljs-variable">length</span>; <span class="hljs-variable">i</span> &lt; <span class="hljs-title class_">j</span>; ++<span class="hljs-title class_">i</span>) {</li><li>        <span class="hljs-variable">arr</span>.<span class="hljs-title function_">push</span>(<span class="hljs-variable">str</span>.<span class="hljs-title function_">charCodeAt</span>(<span class="hljs-variable">i</span>));</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">new</span> <span class="hljs-title function_">Uint8Array</span>(<span class="hljs-variable">arr</span>);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/security/RSA.js#L6-L174" target="_blank">RSA.js</a></div></div></div></div> <p></p></li><li><span>使用RSA算法进行解密：调用huks.getRSADecryptProperties()设置RSA算法的秘钥长度、填充模式、摘要算法等属性；调用huks.initSession()初始化解密会话；调用huks.updateSession()处理密文的前半部分，并将解密后的数据转换为字符串存储在outPlainText中；调用huks.finishSession()处理密文的后半部分，并将解密后的数据追加到outPlainText中。</span><p></p><div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/security/RSA.js#L3-L285" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> <span class="hljs-package">huks</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.security.huks'</span>;</li><li>
</li><li><span class="hljs-comment">// Alias, used to distinguish the generated KEY.</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">RSA_KEY_ALIAS</span> = <span class="hljs-string">'RSAKeyAlias'</span>;</li><li><span class="hljs-comment">// The custom key length must be between 1024 and 2048, and it must be a multiple of 8.</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">HUKS_RSA_KEY_SIZE_1024</span> = <span class="hljs-number">1024</span>;</li><li><span class="hljs-comment">// Plain text, data before encryption.</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">plainText</span> = <span class="hljs-string">'RSASSAdffssghCBC5612345612345192'</span>;</li><li><span class="hljs-comment">// Plain text, the length of the data before encryption.</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">plainTextLen</span> = <span class="hljs-number">32</span>;</li><li><span class="hljs-comment">// Ciphertext, storing the encrypted data.</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">cipherText</span> = <span class="hljs-string">''</span>;</li><li><span class="hljs-comment">// Operation handle.</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">handle</span>;</li><li>
</li><li><span class="hljs-comment">// ...</span></li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">getRSADecryptProperties</span>() {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">properties</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">Array</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">index</span> = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-comment">// algorithm.</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_ALGORITHM</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyAlg</span>.<span class="hljs-title class_">HUKS_ALG_RSA</span></li><li>    };</li><li>    <span class="hljs-comment">// key length.</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_KEY_SIZE</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">HUKS_RSA_KEY_SIZE_1024</span></li><li>    };</li><li>
</li><li>    <span class="hljs-comment">// Key usage.</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_PURPOSE</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyPurpose</span>.<span class="hljs-title class_">HUKS_KEY_PURPOSE_DECRYPT</span></li><li>    };</li><li>
</li><li>    <span class="hljs-comment">// Key PADDING method.</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_PADDING</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyPadding</span>.<span class="hljs-title class_">HUKS_PADDING_PKCS1_V1_5</span></li><li>    };</li><li>
</li><li>    <span class="hljs-comment">// digest algorithm.</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_DIGEST</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyDigest</span>.<span class="hljs-title class_">HUKS_DIGEST_SHA256</span></li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">properties</span>;</li><li>}</li><li>
</li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">decryptProcess</span>() {</li><li>    <span class="hljs-comment">// Length of encrypted ciphertext.</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">len</span> = <span class="hljs-variable">HUKS_RSA_KEY_SIZE_1024</span> / <span class="hljs-number">8</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">ret</span> = <span class="hljs-keyword">true</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">outPlainText</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">huksInfo</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">initOptions</span> = {</li><li>        <span class="hljs-variable">properties</span>: <span class="hljs-title class_">getRSADecryptProperties</span>(),</li><li>        <span class="hljs-variable">inData</span>: <span class="hljs-title class_">new</span> <span class="hljs-title class_">Uint8Array</span>()</li><li>    }</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">updateOptions</span> = {</li><li>        <span class="hljs-variable">properties</span>: <span class="hljs-title class_">getRSADecryptProperties</span>(),</li><li>        <span class="hljs-variable">inData</span>: <span class="hljs-title class_">stringToUint8Array</span>(<span class="hljs-title class_">cipherText</span>.<span class="hljs-title class_">substring</span>(<span class="hljs-number">0</span>, <span class="hljs-variable">len</span> / <span class="hljs-number">2</span>))</li><li>    }</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">finishOptions</span> = {</li><li>        <span class="hljs-variable">properties</span>: <span class="hljs-title class_">getRSADecryptProperties</span>(),</li><li>        <span class="hljs-variable">inData</span>: <span class="hljs-title class_">stringToUint8Array</span>(<span class="hljs-title class_">cipherText</span>.<span class="hljs-title class_">substring</span>(<span class="hljs-variable">len</span> / <span class="hljs-number">2</span>, <span class="hljs-title class_">len</span>))</li><li>    }</li><li>    <span class="hljs-variable">huks</span>.<span class="hljs-title function_">initSession</span>(<span class="hljs-variable">RSA_KEY_ALIAS</span>, <span class="hljs-variable">initOptions</span>, (<span class="hljs-variable">initErr</span>, <span class="hljs-variable">initData</span>) =&gt; {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">initErr</span>) {</li><li>            <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'decryptProcess initSession return code:'</span> + <span class="hljs-variable">initErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">initErr</span>.<span class="hljs-variable">message</span>;</li><li>            <span class="hljs-variable">ret</span> = <span class="hljs-keyword">false</span>;</li><li>            <span class="hljs-variable">huks</span>.<span class="hljs-title function_">abortSession</span>(<span class="hljs-variable">initData</span>.<span class="hljs-variable">handle</span>, <span class="hljs-variable">initOptions</span>, (<span class="hljs-variable">abortErr</span>, <span class="hljs-variable">abortData</span>) =&gt; {</li><li>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">abortErr</span>) {</li><li>                    <span class="hljs-variable">huksInfo</span> =</li><li>                        <span class="hljs-string">'decryptProcess init abortSession return code:'</span> + <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">message</span>;</li><li>                }</li><li>            });</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-variable">handle</span> = <span class="hljs-variable">initData</span>.<span class="hljs-variable">handle</span>;</li><li>        }</li><li>    });</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable">ret</span>) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-variable">huksInfo</span>;</li><li>    }</li><li>    <span class="hljs-variable">huks</span>.<span class="hljs-title function_">updateSession</span>(<span class="hljs-variable">handle</span>, <span class="hljs-variable">updateOptions</span>, (<span class="hljs-variable">updateErr</span>, <span class="hljs-variable">updateData</span>) =&gt; {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">updateErr</span>) {</li><li>            <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'decryptProcess updateSession return code:'</span> + <span class="hljs-variable">updateErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">updateErr</span>.<span class="hljs-variable">message</span>;</li><li>            <span class="hljs-variable">ret</span> = <span class="hljs-keyword">false</span>;</li><li>            <span class="hljs-variable">huks</span>.<span class="hljs-title function_">abortSession</span>(<span class="hljs-variable">handle</span>, <span class="hljs-variable">updateOptions</span>, (<span class="hljs-variable">abortErr</span>, <span class="hljs-variable">abortData</span>) =&gt; {</li><li>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">abortErr</span>) {</li><li>                    <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'decryptProcess updateSession abortSession return code:'</span> + <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> +</li><li>                    <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">message</span>;</li><li>                }</li><li>            });</li><li>        }</li><li>    });</li><li>
</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable">ret</span>) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-variable">huksInfo</span>;</li><li>    }</li><li>    <span class="hljs-variable">huks</span>.<span class="hljs-title function_">finishSession</span>(<span class="hljs-variable">handle</span>, <span class="hljs-variable">finishOptions</span>, (<span class="hljs-variable">finishErr</span>, <span class="hljs-variable">finishData</span>) =&gt; {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">finishErr</span>) {</li><li>            <span class="hljs-variable">ret</span> = <span class="hljs-keyword">false</span>;</li><li>            <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'decryptProcess finishSession return code:'</span> + <span class="hljs-variable">finishErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">finishErr</span>.<span class="hljs-variable">message</span>;</li><li>            <span class="hljs-variable">huks</span>.<span class="hljs-title function_">abortSession</span>(<span class="hljs-variable">handle</span>, <span class="hljs-variable">finishOptions</span>, (<span class="hljs-variable">abortErr</span>, <span class="hljs-variable">abortData</span>) =&gt; {</li><li>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">abortErr</span>) {</li><li>                    <span class="hljs-variable">huksInfo</span> =</li><li>                        <span class="hljs-string">'decryptProcess finish  abortSession return code:'</span> + <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">message</span>;</li><li>                }</li><li>            });</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-comment">// Clear text reception.</span></li><li>            <span class="hljs-variable">outPlainText</span> = <span class="hljs-title function_">uint8ArrayToString</span>(<span class="hljs-variable">finishData</span>.<span class="hljs-variable">outData</span>);</li><li>        }</li><li>    });</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable">ret</span>) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-variable">huksInfo</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'Success:'</span> + <span class="hljs-variable">outPlainText</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">huksInfo</span>;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/security/RSA.js#L3-L285" target="_blank">RSA.js</a></div></div></div></div> <p></p></li></ol> <p><strong>常见的消息认证码（MAC）算法</strong>如下：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.26.12.1.11.1.1" valign="top" width="10.3010301030103%"><p>算法类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.26.12.1.11.1.2" valign="top" width="7.3007300730072995%"><p>算法</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.26.12.1.11.1.3" valign="top" width="6.780678067806781%"><p>用途</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.26.12.1.11.1.4" valign="top" width="7.020702070207021%"><p>分组模式</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.26.12.1.11.1.5" valign="top" width="13.071307130713073%"><p>填充模式</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.26.12.1.11.1.6" valign="top" width="14.981498149814982%"><p>密钥长度</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.26.12.1.11.1.7" valign="top" width="10.101010101010102%"><p>标准</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.26.12.1.11.1.8" valign="top" width="8.52085208520852%"><p>开闭源</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.26.12.1.11.1.9" valign="top" width="8.54085408540854%"><p>摘要算法</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.26.12.1.11.1.10" valign="top" width="13.381338133813381%"><p>加密算法</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" rowspan="2" valign="top" width="10.3010301030103%"><p>消息认证码（MAC）算法</p> </td> <td class="cellrowborder" valign="top" width="7.3007300730072995%"><p>CMAC</p> </td> <td class="cellrowborder" valign="top" width="6.780678067806781%"><p>MAC</p> </td> <td class="cellrowborder" valign="top" width="7.020702070207021%"><p>CBC</p> </td> <td class="cellrowborder" valign="top" width="13.071307130713073%"><p>ISO/IEC-9797_1</p> </td> <td class="cellrowborder" valign="top" width="14.981498149814982%"><p>128</p> </td> <td class="cellrowborder" valign="top" width="10.101010101010102%"><p>ISO-9797</p> </td> <td class="cellrowborder" valign="top" width="8.52085208520852%"><p>闭源</p> </td> <td class="cellrowborder" valign="top" width="8.54085408540854%">&nbsp;&nbsp;</td> <td class="cellrowborder" valign="top" width="13.381338133813381%"><p>3DES</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>HMAC</p> </td> <td class="cellrowborder" valign="top"><p>MAC</p> </td> <td class="cellrowborder" valign="top">&nbsp;&nbsp;</td> <td class="cellrowborder" valign="top">&nbsp;&nbsp;</td> <td class="cellrowborder" valign="top"><p>按照现有密钥规格</p> </td> <td class="cellrowborder" valign="top"><p>RFC</p> </td> <td class="cellrowborder" valign="top"><p>开源</p> </td> <td class="cellrowborder" valign="top"><p>SHA256</p> </td> <td class="cellrowborder" valign="top">&nbsp;&nbsp;</td> </tr>  </tbody></table></div> </div> <p>HMAC是基于哈希函数的消息认证码算法，用于验证消息的完整性和真实性。下文将以HMAC为例，介绍消息认证码算法的使用。</p> <ol><li><span>生成HMAC密钥：<span style="color: rgb(64,64,64);">定义一个 </span>getRSAGenProperties<span style="color: rgb(64,64,64);">()的函数，用于生成一个包含 RSA加密算法相关属性的数组。这些属性用于配置加密操作的参数，并在generateHMACKey()方法中生成密钥。</span></span><p></p><div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/security/HMAC.js#L2-L50" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> <span class="hljs-package">huks</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.security.huks'</span>;</li><li>
</li><li><span class="hljs-comment">// HMACKeyAlias - Alias used to distinguish the generated KEY.</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">HMAC_KEY_ALIAS</span> = <span class="hljs-string">'HMACKeyAlias'</span>;</li><li><span class="hljs-comment">// ...</span></li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">getHMACGenProperties</span>() {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">properties</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">Array</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">index</span> = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-comment">// algorithm</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_ALGORITHM</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyAlg</span>.<span class="hljs-title class_">HUKS_ALG_AES</span></li><li>    };</li><li>    <span class="hljs-comment">// key length.</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_KEY_SIZE</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeySize</span>.<span class="hljs-title class_">HUKS_AES_KEY_SIZE_256</span></li><li>    };</li><li>    <span class="hljs-comment">// Key usage.</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_PURPOSE</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyPurpose</span>.<span class="hljs-title class_">HUKS_KEY_PURPOSE_MAC</span></li><li>    };</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">properties</span>;</li><li>}</li><li>
</li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">generateHMACKey</span>() {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">huksInfo</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">options</span> = {</li><li>        <span class="hljs-variable">properties</span>: <span class="hljs-title class_">getHMACGenProperties</span>()</li><li>    }</li><li>    <span class="hljs-variable">huks</span>.<span class="hljs-title function_">generateKeyItem</span>(<span class="hljs-variable">HMAC_KEY_ALIAS</span>, <span class="hljs-variable">options</span>, (<span class="hljs-variable">err</span>, <span class="hljs-variable">data</span>) =&gt; {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">err</span>) {</li><li>            <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'generateKeyHMAC return code:'</span> + <span class="hljs-variable">err</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>;</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'The key has been generated'</span> + <span class="hljs-variable">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable">data</span>);</li><li>        }</li><li>    });</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">huksInfo</span>;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/security/HMAC.js#L2-L50" target="_blank">HMAC.js</a></div></div></div></div> <p></p></li><li><span>生成HMAC密文：定义getHMACProperties()方法，生成一个包含HMAC操作所需属性的数组，包括HMAC算法、密钥长度、密钥用途和摘要算法；并在HMACProcess()方法中分别调用huks.initSession()、huks.updateSession()、huks.finishSession()生成HMAC密文。</span><p></p><div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/security/HMAC.js#L3-L165" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> <span class="hljs-package">huks</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.security.huks'</span>;</li><li>
</li><li><span class="hljs-comment">// HMACKeyAlias - Alias used to distinguish the generated KEY.</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">HMAC_KEY_ALIAS</span> = <span class="hljs-string">'HMACKeyAlias'</span>;</li><li><span class="hljs-comment">// Plain text, data before encryption.</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">plainText</span> = <span class="hljs-string">'HMACSAdffssghABC5612345612345192'</span>;</li><li><span class="hljs-comment">// Ciphertext, storing the encrypted data.</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">cipherText</span> = <span class="hljs-string">''</span>;</li><li><span class="hljs-comment">// Operation handle.</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">handle</span>;</li><li><span class="hljs-comment">// ...</span></li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">uint8ArrayToString</span>(<span class="hljs-variable">fileData</span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">dataString</span> = <span class="hljs-string">''</span>;</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> <span class="hljs-variable">i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">i</span> &lt; <span class="hljs-title class_">fileData</span>.<span class="hljs-title class_">length</span>; <span class="hljs-title class_">i</span>++) {</li><li>        <span class="hljs-variable">dataString</span> += <span class="hljs-variable">String</span>.<span class="hljs-title function_">fromCharCode</span>(<span class="hljs-variable">fileData</span>[<span class="hljs-variable">i</span>]);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">dataString</span>;</li><li>}</li><li>
</li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">stringToUnit8Array</span>(<span class="hljs-variable">str</span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">arr</span> = [];</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> <span class="hljs-variable">i</span> = <span class="hljs-number">0</span>, <span class="hljs-variable">j</span> = <span class="hljs-variable">str</span>.<span class="hljs-variable">length</span>; <span class="hljs-variable">i</span> &lt; <span class="hljs-title class_">j</span>; ++<span class="hljs-title class_">i</span>) {</li><li>        <span class="hljs-variable">arr</span>.<span class="hljs-title function_">push</span>(<span class="hljs-variable">str</span>.<span class="hljs-title function_">charCodeAt</span>(<span class="hljs-variable">i</span>));</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">new</span> <span class="hljs-title function_">Uint8Array</span>(<span class="hljs-variable">arr</span>);</li><li>}</li><li>
</li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">getHMACProperties</span>() {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">properties</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">Array</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">index</span> = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-comment">// algorithm.</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_ALGORITHM</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyAlg</span>.<span class="hljs-title class_">HUKS_ALG_HMAC</span></li><li>    };</li><li>    <span class="hljs-comment">// key length.</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_KEY_SIZE</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeySize</span>.<span class="hljs-title class_">HUKS_AES_KEY_SIZE_256</span></li><li>    };</li><li>    <span class="hljs-comment">// Key usage.</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_PURPOSE</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyPurpose</span>.<span class="hljs-title class_">HUKS_KEY_PURPOSE_MAC</span></li><li>    };</li><li>    <span class="hljs-comment">// digest algorithm.</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_DIGEST</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyPurpose</span>.<span class="hljs-title class_">HUKS_DIGEST_SHA256</span></li><li>    };</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">properties</span>;</li><li>}</li><li>
</li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">HMACProcess</span>() {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">huksInfo</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">ret</span> = <span class="hljs-keyword">true</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">initOptions</span> = {</li><li>        <span class="hljs-variable">properties</span>: <span class="hljs-title class_">getHMACProperties</span>(),</li><li>        <span class="hljs-variable">inData</span>: <span class="hljs-title class_">new</span> <span class="hljs-title class_">Uint8Array</span>()</li><li>    }</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">updateOptions</span> = {</li><li>        <span class="hljs-variable">properties</span>: <span class="hljs-title class_">getHMACProperties</span>(),</li><li>        <span class="hljs-variable">inData</span>: <span class="hljs-title class_">stringToUnit8Array</span>(<span class="hljs-title class_">plainText</span>.<span class="hljs-title class_">substring</span>(<span class="hljs-number">0</span>, <span class="hljs-number">16</span>))</li><li>    }</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">finishOptions</span> = {</li><li>        <span class="hljs-variable">properties</span>: <span class="hljs-title class_">getHMACProperties</span>(),</li><li>        <span class="hljs-variable">inData</span>: <span class="hljs-title class_">stringToUnit8Array</span>(<span class="hljs-title class_">plainText</span>.<span class="hljs-title class_">substring</span>(<span class="hljs-number">16</span>, <span class="hljs-number">32</span>))</li><li>    }</li><li>
</li><li>    <span class="hljs-variable">huks</span>.<span class="hljs-title function_">initSession</span>(<span class="hljs-variable">HMAC_KEY_ALIAS</span>, <span class="hljs-variable">initOptions</span>, (<span class="hljs-variable">initErr</span>, <span class="hljs-variable">initData</span>) =&gt; {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">initErr</span>) {</li><li>            <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'HMAC initSession return code:'</span> + <span class="hljs-variable">initErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">initErr</span>.<span class="hljs-variable">message</span>;</li><li>            <span class="hljs-variable">ret</span> = <span class="hljs-keyword">false</span>;</li><li>            <span class="hljs-variable">huks</span>.<span class="hljs-title function_">abortSession</span>(<span class="hljs-variable">initData</span>.<span class="hljs-variable">handle</span>, <span class="hljs-variable">initOptions</span>, (<span class="hljs-variable">abortErr</span>, <span class="hljs-variable">abortData</span>) =&gt; {</li><li>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">abortErr</span>) {</li><li>                    <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'HMAC init abortSession return code:'</span> + <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">message</span>;</li><li>                }</li><li>            });</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-variable">handle</span> = <span class="hljs-variable">initData</span>.<span class="hljs-variable">handle</span>;</li><li>        }</li><li>    });</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable">ret</span>) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-variable">huksInfo</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-variable">huks</span>.<span class="hljs-title function_">updateSession</span>(<span class="hljs-variable">handle</span>, <span class="hljs-variable">updateOptions</span>, (<span class="hljs-variable">updateErr</span>, <span class="hljs-variable">updateData</span>) =&gt; {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">updateErr</span>) {</li><li>            <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'HMAC updateSession return code:'</span> + <span class="hljs-variable">updateErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">updateErr</span>.<span class="hljs-variable">message</span>;</li><li>            <span class="hljs-variable">ret</span> = <span class="hljs-keyword">false</span>;</li><li>            <span class="hljs-variable">huks</span>.<span class="hljs-title function_">abortSession</span>(<span class="hljs-variable">handle</span>, <span class="hljs-variable">updateOptions</span>, (<span class="hljs-variable">abortErr</span>, <span class="hljs-variable">abortData</span>) =&gt; {</li><li>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">abortErr</span>) {</li><li>                    <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'HMAC update abortSession return code:'</span> + <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">message</span>;</li><li>                }</li><li>            });</li><li>        }</li><li>    });</li><li>
</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable">ret</span>) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-variable">huksInfo</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-variable">huks</span>.<span class="hljs-title function_">finishSession</span>(<span class="hljs-variable">handle</span>, <span class="hljs-variable">finishOptions</span>, (<span class="hljs-variable">finishErr</span>, <span class="hljs-variable">finishData</span>) =&gt; {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">finishErr</span>) {</li><li>            <span class="hljs-variable">ret</span> = <span class="hljs-keyword">false</span>;</li><li>            <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'encrypt HMAC finishSession return code:'</span> + <span class="hljs-variable">finishErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">finishErr</span>.<span class="hljs-variable">message</span>;</li><li>            <span class="hljs-variable">huks</span>.<span class="hljs-title function_">abortSession</span>(<span class="hljs-variable">handle</span>, <span class="hljs-variable">finishOptions</span>, (<span class="hljs-variable">abortErr</span>, <span class="hljs-variable">abortData</span>) =&gt; {</li><li>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">abortErr</span>) {</li><li>                    <span class="hljs-variable">huksInfo</span> =</li><li>                        <span class="hljs-string">'encrypt HMAC finish abortSession return code:'</span> + <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">message</span>;</li><li>                }</li><li>            });</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-comment">// HMAC ciphertext reception.</span></li><li>            <span class="hljs-variable">cipherText</span> = <span class="hljs-title function_">uint8ArrayToString</span>(<span class="hljs-variable">finishData</span>.<span class="hljs-variable">outData</span>);</li><li>        }</li><li>    });</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable">ret</span>) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-variable">huksInfo</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'success:'</span> + <span class="hljs-variable">cipherText</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">huksInfo</span>;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/security/HMAC.js#L3-L165" target="_blank">HMAC.js</a></div></div></div></div> <p></p></li></ol> <p><strong>公共接口</strong>包含导入密钥、导出密钥、查询密钥是否存在和删除密钥。</p> <ul><li>导入密钥<p>定义导入密钥的相关配置项，并调用huks.importKeyItem()方法导入密钥。</p> <div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/security/KeyAlias.js#L2-L74" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> <span class="hljs-package">huks</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.security.huks'</span>;</li><li>
</li><li><span class="hljs-comment">// Key material.</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">plainTextKey</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">Uint8Array</span>([</li><li>    <span class="hljs-number">0x1d</span>, <span class="hljs-number">0x2c</span>, <span class="hljs-number">0x3a</span>, <span class="hljs-number">0x4b</span>, <span class="hljs-number">0x5e</span>, <span class="hljs-number">0x6f</span>, <span class="hljs-number">0x7d</span>, <span class="hljs-number">0x8a</span>, <span class="hljs-number">0x9c</span>, <span class="hljs-number">0xab</span>, <span class="hljs-number">0xbc</span>, <span class="hljs-number">0xcd</span>, <span class="hljs-number">0xde</span>, <span class="hljs-number">0xef</span>, <span class="hljs-number">0xf1</span>, <span class="hljs-number">0x23</span></li><li>]);</li><li><span class="hljs-comment">// Confirm the key alias.</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">KEY_ALIAS</span> = <span class="hljs-string">'keyAlias'</span>;</li><li>
</li><li><span class="hljs-comment">// Package the set of key attributes and key materials.</span></li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">getImportKeyProperties</span>() {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">properties</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">Array</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">index</span> = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-comment">// algorithm.</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_ALGORITHM</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyAlg</span>.<span class="hljs-title class_">HUKS_ALG_AES</span></li><li>    };</li><li>    <span class="hljs-comment">// Key length (128/192/256).</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_KEY_SIZE</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeySize</span>.<span class="hljs-title class_">HUKS_AES_KEY_SIZE_128</span></li><li>    };</li><li>    <span class="hljs-comment">// Key usage: When generating the key,</span></li><li>    <span class="hljs-comment">// using it can limit the usage rights of the key (AES is generally used for encryption and decryption).</span></li><li>    <span class="hljs-variable">properties</span>[<span class="hljs-variable">index</span>++] = {</li><li>        <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_PURPOSE</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyPurpose</span>.<span class="hljs-title class_">HUKS_KEY_PURPOSE_DECRYPT</span> | <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyPurpose</span>.<span class="hljs-title class_">HUKS_KEY_PURPOSE_ENCRYPT</span></li><li>    };</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">properties</span></li><li>}</li><li>
</li><li><span class="hljs-comment">// Explicitly imported key.</span></li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">importKey</span>() {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">huksInfo</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">ret</span> = <span class="hljs-keyword">true</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">options</span> = {</li><li>        <span class="hljs-variable">properties</span>: <span class="hljs-title class_">getImportKeyProperties</span>(),</li><li>        <span class="hljs-variable">inData</span>: <span class="hljs-title class_">plainTextKey</span></li><li>    }</li><li>    <span class="hljs-variable">huks</span>.<span class="hljs-title function_">importKeyItem</span>(<span class="hljs-variable">KEY_ALIAS</span>, <span class="hljs-variable">options</span>, (<span class="hljs-variable">initErr</span>, <span class="hljs-variable">initData</span>) =&gt; {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">initErr</span>) {</li><li>            <span class="hljs-variable">ret</span> = <span class="hljs-keyword">false</span>;</li><li>            <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'import key:'</span> + <span class="hljs-variable">initErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">initErr</span>.<span class="hljs-variable">message</span>;</li><li>            <span class="hljs-variable">huks</span>.<span class="hljs-title function_">abortSession</span>(<span class="hljs-variable">initData</span>.<span class="hljs-variable">handle</span>, <span class="hljs-variable">options</span>, (<span class="hljs-variable">abortErr</span>, <span class="hljs-variable">abortData</span>) =&gt; {</li><li>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">abortErr</span>) {</li><li>                    <span class="hljs-variable">huksInfo</span> = <span class="hljs-string">'import key init abortSession return code:'</span> + <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">code</span> + <span class="hljs-string">' ： '</span> + <span class="hljs-variable">abortErr</span>.<span class="hljs-variable">message</span>;</li><li>                }</li><li>            });</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-variable">huksInfo</span> = <span class="hljs-title function_">uint8ArrayToString</span>(<span class="hljs-variable">initData</span>.<span class="hljs-variable">outData</span>);</li><li>        }</li><li>    });</li><li>
</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable">ret</span>) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-variable">huksInfo</span> + <span class="hljs-string">' import failed'</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">huksInfo</span> + <span class="hljs-string">' import succeed'</span>;</li><li>}</li><li>
</li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">uint8ArrayToString</span>(<span class="hljs-variable">fileData</span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">dataString</span> = <span class="hljs-string">''</span>;</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> <span class="hljs-variable">i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">i</span> &lt; <span class="hljs-title class_">fileData</span>.<span class="hljs-title class_">length</span>; <span class="hljs-title class_">i</span>++) {</li><li>        <span class="hljs-variable">dataString</span> += <span class="hljs-variable">String</span>.<span class="hljs-title function_">fromCharCode</span>(<span class="hljs-variable">fileData</span>[<span class="hljs-variable">i</span>]);</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">dataString</span>;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/security/KeyAlias.js#L2-L74" target="_blank">KeyAlias.js</a></div></div></div></div> </li></ul> <ul><li>导出密钥<div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/security/KeyAlias.js#L3-L92" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> huks <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.security.huks'</span>;</li><li>
</li><li><span class="hljs-comment">// ...</span></li><li><span class="hljs-comment">// Confirm the key alias.</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">KEY_ALIAS</span> = <span class="hljs-string">'keyAlias'</span>;</li><li>
</li><li><span class="hljs-comment">// ...</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">exportKeyProcess</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> huksInfo;</li><li>    <span class="hljs-keyword">let</span> emptyOptions = {</li><li>        <span class="hljs-attr">properties</span>: []</li><li>    }</li><li>
</li><li>    huks.<span class="hljs-title function_">exportKeyItem</span>(<span class="hljs-variable constant_">KEY_ALIAS</span>, emptyOptions, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">if</span> (err) {</li><li>            huksInfo = <span class="hljs-string">'exportKeyItem error return code:'</span> + err.<span class="hljs-property">code</span> + <span class="hljs-string">' ： '</span> + err.<span class="hljs-property">message</span>;</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            huksInfo = <span class="hljs-title function_">uint8ArrayToString</span>(data.<span class="hljs-property">outData</span>);</li><li>        }</li><li>    })</li><li>
</li><li>    <span class="hljs-keyword">return</span> huksInfo;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/security/KeyAlias.js#L3-L92" target="_blank">KeyAlias.js</a></div></div></div></div> </li><li>查询密钥是否存在<p>调用huks.isKeyItemExist()方法，检查指定别名（KEY_ALIAS）的密钥项是否存在于密钥管理系统中。</p> <div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/security/DesCBC64.js#L2-L22" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> huks <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.security.huks'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">KEY_ALIAS</span> = <span class="hljs-string">'DesCBC64KeyAlias'</span>;</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">isKeyItemExist</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> huksInfo;</li><li>    <span class="hljs-keyword">let</span> emptyOptions = {</li><li>        <span class="hljs-attr">properties</span>: []</li><li>    };</li><li>
</li><li>    huks.<span class="hljs-title function_">isKeyItemExist</span>(<span class="hljs-variable constant_">KEY_ALIAS</span>, emptyOptions, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">if</span> (data) {</li><li>            huksInfo = <span class="hljs-string">'The key:'</span> + <span class="hljs-variable constant_">KEY_ALIAS</span> + <span class="hljs-string">' exists'</span>;</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            huksInfo = <span class="hljs-string">'The key doesn\'t exist errcode:'</span> + err.<span class="hljs-property">code</span> + <span class="hljs-string">' ： '</span> + err.<span class="hljs-property">message</span>;</li><li>        }</li><li>    });</li><li>
</li><li>    <span class="hljs-keyword">return</span> huksInfo;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/security/DesCBC64.js#L2-L22" target="_blank">DesCBC64.js</a></div></div></div></div> </li><li>删除密钥<div class="p">调用huks.deleteKeyItem()方法，删除指定别名的密钥。<div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/security/DesCBC64.js#L3-L38" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> huks <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.security.huks'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">KEY_ALIAS</span> = <span class="hljs-string">'DesCBC64KeyAlias'</span>;</li><li><span class="hljs-comment">// ...</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">deleteKeyProcess</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> huksInfo;</li><li>    <span class="hljs-keyword">let</span> emptyOptions = {</li><li>        <span class="hljs-attr">properties</span>: []</li><li>    };</li><li>    huks.<span class="hljs-title function_">deleteKeyItem</span>(<span class="hljs-variable constant_">KEY_ALIAS</span>, emptyOptions, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">if</span> (err) {</li><li>            huksInfo = <span class="hljs-string">'deleteKeyItem error return code:'</span> + err.<span class="hljs-property">code</span> + <span class="hljs-string">' ： '</span> + err.<span class="hljs-property">message</span>;</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            huksInfo = <span class="hljs-string">'The key has been deleted'</span>;</li><li>        }</li><li>    })</li><li>    <span class="hljs-keyword">return</span> huksInfo;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/security/DesCBC64.js#L3-L38" target="_blank">DesCBC64.js</a></div></div></div></div> </div> </li></ul> </div> <div class="tiledSection"><h3 id="section63154003420">@ohos.security.cryptoFramework (加解密算法库框架)<i class="anchor-icon anchor-icon-link" anchorid="section63154003420" tips="复制节点链接"></i></h3><p>加解密算法库框架包含消息摘要算法和安全随机数的生成。消息摘要算法是一种能将任意长度的输入消息，通过特定运算生成固定长度摘要的算法；安全随机数能够生成不可预测、均匀分布的随机数，确保系统的安全性和可靠性。</p> <ul><li>消息摘要算法<p>首先通过cryptoFramework.createMd()方法创建基于SHA256算法的摘要操作实例，将其赋值给handle；其次调用handle的updateSync()方法，将待摘要的消息转换为Uint8Array后传入，用于更新摘要操作实例中的数据；最后调用handle的digest方法，获取摘要计算的结果，并用handle的getMdLength()方法获取摘要的长度。</p> <div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/cryptoFramework/cryptoFramework.js#L2-L55" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> cryptoFramework <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.security.cryptoFramework'</span>;</li><li><span class="hljs-comment">// ...</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">stringToUint8Array</span>(<span class="hljs-params">str</span>) {</li><li>    <span class="hljs-keyword">let</span> arr = [];</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>, j = str.<span class="hljs-property">length</span>; i &lt; j; ++i) {</li><li>        arr.<span class="hljs-title function_">push</span>(str.<span class="hljs-title function_">charCodeAt</span>(i));</li><li>    }</li><li>    <span class="hljs-keyword">let</span> tmpUint8Array = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(arr);</li><li>    <span class="hljs-keyword">return</span> tmpUint8Array;</li><li>}</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">doMd</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> mdAlgName = <span class="hljs-string">'SHA256'</span>; <span class="hljs-comment">// Abstract algorithm name.</span></li><li>    <span class="hljs-keyword">let</span> message = <span class="hljs-string">'mdTestMessage'</span>; <span class="hljs-comment">// The data to be summarized.</span></li><li>    <span class="hljs-keyword">let</span> handle;</li><li>    <span class="hljs-keyword">let</span> mdResult;</li><li>    <span class="hljs-keyword">let</span> mdLen;</li><li>    <span class="hljs-comment">// Specify the digest algorithm SHA256 and generate an instance of the digest operation.</span></li><li>    <span class="hljs-keyword">try</span> {</li><li>        handle = cryptoFramework.<span class="hljs-title function_">createMd</span>(mdAlgName);</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`createMd error, code: <span class="hljs-subst">${error.code}</span>, msg: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    }</li><li>    <span class="hljs-keyword">try</span> {</li><li>        <span class="hljs-comment">// When the data volume is small, only one update operation can be performed, and all the data can be sent in.</span></li><li>        <span class="hljs-comment">// The interface does not impose any restrictions on the length of the input parameters.</span></li><li>        handle?.<span class="hljs-title function_">updateSync</span>({ <span class="hljs-attr">data</span>: <span class="hljs-title function_">stringToUint8Array</span>(message) });</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`updateSync error, code:+<span class="hljs-subst">${error.code}</span>, msg: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    }</li><li>    <span class="hljs-comment">// Obtain the summary calculation results.</span></li><li>    <span class="hljs-keyword">try</span> {</li><li>        mdResult = handle?.<span class="hljs-title function_">digest</span>();</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`digest error, code: <span class="hljs-subst">${error.code}</span>, msg: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Md result:'</span> + mdResult?.<span class="hljs-property">data</span>);</li><li>    <span class="hljs-comment">// Obtain the length of the summary calculation, with the unit being bytes.</span></li><li>    <span class="hljs-keyword">try</span> {</li><li>        mdLen = handle?.<span class="hljs-title function_">getMdLength</span>();</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`getMdLength error, code: <span class="hljs-subst">${error.code}</span>, msg: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`md len: <span class="hljs-subst">${mdLen}</span>`</span>);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/cryptoFramework/cryptoFramework.js#L2-L55" target="_blank">cryptoFramework.js</a></div></div></div></div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>在同一应用内，开发者应该避免连续多次调用handle.digest()接口，否则会导致不必要的内存开销。</p> </div></div></div> </li><li>安全随机数的生成<div class="p">首先调用cryptoFramework.createRandom()方法创建随机数操作实例，并赋值给rand；其次调用rand的setSeed()方法为随机数生成池设置种子（可选）；最后调用rand的generateRandomSync()方法生成指定长度的随机安全数，并将结果赋值给randData。<div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/cryptoFramework/cryptoFramework.js#L58-L92" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">doRand</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> rand;</li><li>    <span class="hljs-keyword">let</span> ret = <span class="hljs-literal">true</span>;</li><li>    <span class="hljs-keyword">let</span> randData</li><li>    <span class="hljs-comment">// Example of generating random numbers operation.</span></li><li>    <span class="hljs-keyword">try</span> {</li><li>        rand = cryptoFramework.<span class="hljs-title function_">createRandom</span>();</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>        ret = <span class="hljs-literal">false</span>;</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`createRandom error, code:+<span class="hljs-subst">${error.code}</span>, msg: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    }</li><li>    <span class="hljs-keyword">let</span> len = <span class="hljs-number">24</span>; <span class="hljs-comment">// Generate a 24-byte random number.</span></li><li>    <span class="hljs-comment">// (Optional) Call Random.setSeed to set the seed for the random number generation pool.</span></li><li>    <span class="hljs-keyword">let</span> seed = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);</li><li>    <span class="hljs-keyword">try</span> {</li><li>        rand?.<span class="hljs-title function_">setSeed</span>({ <span class="hljs-attr">data</span>: seed });</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>        ret = <span class="hljs-literal">false</span>;</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`setSeed error, code:+<span class="hljs-subst">${error.code}</span>, msg: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">try</span> {</li><li>        <span class="hljs-comment">// Generate secure random numbers.</span></li><li>        randData = rand?.<span class="hljs-title function_">generateRandomSync</span>(len);</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>        ret = <span class="hljs-literal">false</span>;</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`generateRandomSync error, code:+<span class="hljs-subst">${error.code}</span>, msg: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (ret) {</li><li>        <span class="hljs-keyword">return</span> randData?.<span class="hljs-property">data</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`doRand error`</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-string">'doRand error'</span>;</li><li>    }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/cryptoFramework/cryptoFramework.js#L58-L92" target="_blank">cryptoFramework.js</a></div></div></div></div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>在同一应用内，开发者应该避免连续多次调用rand.generateRandomSync()接口，否则会导致不必要的内存开销。</p> </div></div></div> </div> </li></ul> </div> <div class="tiledSection"><h3 id="section1493413452217">@ohos.screenLock (锁屏管理)<i class="anchor-icon anchor-icon-link" anchorid="section1493413452217" tips="复制节点链接"></i></h3><p>锁屏管理服务向三方应用提供解锁屏幕、查询锁屏状态、查询当前锁屏是否安全的能力。</p> <ul><li>解锁屏幕：调用screen.unlockScreen()方法解锁。<div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/screenLock/screenLock.js#L2-L27" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> screenLock <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.screenLock'</span>;</li><li>
</li><li><span class="hljs-comment">// ...</span></li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">unlockScreen</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> result;</li><li>    screenLock.<span class="hljs-title function_">unlockScreen</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">if</span> (err) {</li><li>            result = <span class="hljs-string">`Failed to unlock the screen, Code: <span class="hljs-subst">${err.code}</span>, <span class="hljs-subst">${err.message}</span>`</span>;</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            result = <span class="hljs-string">`call unlockScreen sucess`</span>;</li><li>        }</li><li>    });</li><li>
</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/screenLock/screenLock.js#L2-L27" target="_blank">screenLock.js</a></div></div></div></div> </li><li>查询锁屏状态：调用screenLock.isScreenLocked()方法查询。<div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/screenLock/screenLock.js#L30-L42" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">isScreenLocked</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> isLocked = <span class="hljs-literal">false</span>;</li><li>    <span class="hljs-keyword">let</span> result;</li><li>    screenLock.<span class="hljs-title function_">isScreenLocked</span>(<span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">if</span> (err) {</li><li>            result = <span class="hljs-string">`call isScreenLocked erro <span class="hljs-subst">${err.message}</span>`</span>;</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            isLocked = data</li><li>            result = <span class="hljs-string">`call isScreenLocked sucess islocked: <span class="hljs-subst">${isLocked}</span>`</span></li><li>        }</li><li>    });</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/screenLock/screenLock.js#L30-L42" target="_blank">screenLock.js</a></div></div></div></div> </li><li>查询当前锁屏是否安全：调用screenLock.isSecureMode()方法查询。<div class="screenLinkPre"><div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/screenLock/screenLock.js#L45-L57" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">isSecureMode</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> result;</li><li>    <span class="hljs-keyword">let</span> isSafety = <span class="hljs-literal">false</span>;</li><li>    screenLock.<span class="hljs-title function_">isSecureMode</span>(<span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">if</span> (err) {</li><li>            result = <span class="hljs-string">`call isSecureMode erro <span class="hljs-subst">${err.message}</span>`</span>;</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            isSafety = data</li><li>            result = <span class="hljs-string">`call isSecureMode sucess isSafety <span class="hljs-subst">${isSafety}</span>`</span>;</li><li>        }</li><li>    });</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LiteWearable/entry/src/main/js/MainAbility/screenLock/screenLock.js#L45-L57" target="_blank">screenLock.js</a></div></div></div></div> </li></ul> </div> <div class="tiledSection"><h2 id="section24717494507">常见问题<i class="anchor-icon anchor-icon-link" anchorid="section24717494507" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section17506836189" class="firsth2">轻量级智能穿戴调试问题<i class="anchor-icon anchor-icon-link" anchorid="section17506836189" tips="复制节点链接"></i></h3><p>问题现象：运动表（如GT/FIT系列）在系统设置中无WiFi调试选项，运动表该如何进行调试</p> <p>解决方案：</p> <p>运动表无法通过WiFi进行调试，需要通过<strong>应用调测助手APP</strong>进行调试，具体流程开发者可参考<a href="/consumer/cn/doc/best-practices/bpta-lite-wearable-guide#section489201684214">运行应用</a>章节。</p> </div> <div class="tiledSection"><h3 id="section629020275119">轻量级智能穿戴网络请求大小限制问题<i class="anchor-icon anchor-icon-link" anchorid="section629020275119" tips="复制节点链接"></i></h3><p>问题现象：运动表发起fetch请求时，请求失败。</p> <p>可能原因：</p> <p>1. WATCH GT5及更早运动表版本与iOS手机配对，无法发起fetch请求。</p> <p>2. 欧洲地区运动表均无法发起fetch请求。</p> <p>3. fetch请求携带数据过大，例如 请求头大小超过2KB，或者传输层单包数据超过7KB。</p> <p>解决方案：</p> <p>针对原因3，需要减少对应fetch请求数据的大小。</p> </div> <div class="tiledSection"><h3 id="section10166603100">轻量级智能穿戴安装app包常见错误<i class="anchor-icon anchor-icon-link" anchorid="section10166603100" tips="复制节点链接"></i></h3><p><strong>问题现象</strong><strong>：</strong>运动表安装hap出现的常见问题以及对应的解决方案。</p> <p><strong>可能原因：</strong></p> <ol><li>错误码40：配置文件格式错误</li><li>错误码31：签名验证错误</li><li>错误码47：配置文件app.apiVersion字段不合法</li><li>错误码34：内部错误</li></ol> <p><strong>解决方案：</strong></p> <p><strong>错误码40：配置文件格式错误</strong></p> <p>1.检查一下配置文件，比如compileSdkVersion 的配置。</p> <p>2.检查config.json中"label": "$string:squarewatch_MainAbility"，label的string名字是否过长（不要超过22个字符）</p> <p>3.排查下应用图标是否太大（正常图标大小为80×80和114×114）</p> <p></p> <p><strong>错误码31：签名验证错误</strong></p> <ol><li>检查签名中是否添加了手表的udid。</li><li>检查添加的udid是否超过10个。</li><li>检查签名证书是否过期。</li></ol> <p></p> <p><strong>错误码47：配置文件app.apiVersion字段不合法</strong></p> <p>原因：</p> <p>厂商配置sdk版本如下，compatibleSdkVersion的版本过高导致。</p> <div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" data-highlighted="yes"><ol class="linenums"><li>compileSdkVersion 6</li><li>    defaultConfig {</li><li>        compatibleSdkVersion 6</li><li>    }</li></ol></pre></div></div> <p>解决：</p> <p>compatibleSdkVersion版本改为3，如下所示</p> <div _ngcontent-waj-c106="" class="highlight-div"><div _ngcontent-waj-c106="" class="highlight-div-header"><div _ngcontent-waj-c106="" class="highlight-div-header-left"><div _ngcontent-waj-c106="" class="handle-button expand-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-waj-c106="" class="highlight-div-header-right"><div _ngcontent-waj-c106="" class="handle-button ai-button"></div><div _ngcontent-waj-c106="" class="handle-button line-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-waj-c106="" class="handle-button theme-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-waj-c106="" class="handle-button copy-button"><div _ngcontent-waj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-waj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" data-highlighted="yes"><ol class="linenums"><li>compileSdkVersion 6</li><li>    defaultConfig {</li><li>        compatibleSdkVersion  3</li><li>    }</li></ol></pre></div></div> <p></p> <p><strong>安装失败34：内部错误</strong></p> <p>解决：</p> <p>单个js页面过大，超过48kb，减小单个js页面。</p> </div> <div class="tiledSection"><h2 id="section177811251793">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section177811251793" tips="复制节点链接"></i></h2><ul><li><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/tree/master/LiteWearable" target="_blank">轻量级智能穿戴开发实践同源工程</a></li></ul> </div> </div> <div></div></div>