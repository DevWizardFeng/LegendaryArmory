<h1 _ngcontent-bta-c119="" class="doc-title ng-star-inserted" title="隔空传送快速分享"> 隔空传送快速分享 </h1>

<div _ngcontent-bta-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section264013514247">概述<i class="anchor-icon anchor-icon-link" anchorid="section264013514247" tips="复制节点链接"></i></h2><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/share-kit-guide" target="_blank">Share Kit（分享服务）</a>提供隔空传送分享，支持用户通过“一抓一放”手势实现跨设备文件分享（图片、视频、文档等）以及跨设备链接分享。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><tbody><tr><th class="firstcol" id="mcps1.3.1.3.1.3.1.1" valign="top" width="11.58%"><p>隔空传送分享文件</p> </th> <td class="cellrowborder" valign="top" width="88.42%"><p>通过隔空传送手势触发文件分享，接收端为phone、tablet设备会将媒体文件存储至图库，非媒体文件存储至文件管理器，接收端为PC/2in1设备则会将媒体以及非媒体文件存储至文件管理器。</p> <p><span><img height="565.0239" originheight="1080" originwidth="1144" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163253.55511070611448925858850440713896:50001231000000:2800:308C07D141030179FDA58B4E566712783B3B7FC16BB53A1BCF2F7AE8EA7EB4C2.gif" title="点击放大" width="598.5"></span></p> </td> </tr> <tr><th class="firstcol" id="mcps1.3.1.3.1.3.2.1" valign="top" width="11.58%"><p>隔空传送分享链接</p> </th> <td class="cellrowborder" valign="top" width="88.42%"><p>通过隔空传送手势触发分享App Linking链接，接收端已安装应用可直接打开应用查看内容。</p> <p><span><img height="565.0239" originheight="1080" originwidth="1144" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163253.10933768047924145669421315149173:50001231000000:2800:AABA45E79C96E5E50FFDAEBEC6A511F1F86A3386ACF102A591A74D5EA90C9A8D.gif" title="点击放大" width="598.5"></span></p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section930035717576">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section930035717576" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section1065412435817" class="firsth2">关键技术<i class="anchor-icon anchor-icon-link" anchorid="section1065412435817" tips="复制节点链接"></i></h3><p><span><img height="416.76880000000006" originheight="551" originwidth="1055" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163253.11316698093882013840000843427454:50001231000000:2800:4344464159B0220CC1AF0ADEC3519B95FAFA9B3E0274006A6AA7BB1B75108461.jpg" title="点击放大" width="798"></span></p> <p>隔空传送基于分享服务，允许用户通过简单的“一抓一放”手势实现跨设备分享，当前支持手机、平板、PC，使用体验无差异，应用接入只需监听harmonyShare.on('gesturesShare')方法。</p> <p>当用户做出手势进行隔空传送分享时，系统触发回调，应用可以在回调中实现数据分享。</p> <p>接收端的处理由系统统一管理：</p> <ul><li>媒体文件（如图片、视频）将存储到图库。</li><li>普通文件将存储到文件管理。</li><li>App Linking链接将自动打开目标应用，并由应用处理链接传递的参数，实现内容的快速访问。</li></ul> </div> <div class="tiledSection"><h3 id="section3921174315586">开发流程<i class="anchor-icon anchor-icon-link" anchorid="section3921174315586" tips="复制节点链接"></i></h3><p><span><img height="477.23060000000004" originheight="668" originwidth="1117" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163253.31767461288492546148891677769161:50001231000000:2800:2E338CA855F1E9C5D75AF16F0B1A83E9EFF0DF940C5A1B8B78B9C443D143AC9E.jpg" title="点击放大" width="798"></span></p> <ol><li><strong>分享注册监听与取消监听</strong>：在分享页面的生命周期函数（如aboutToAppear或onPageShow）中，注册 harmonyShare.on('gesturesShare') 事件监听，以监听隔空传送事件。当页面即将隐藏或应用退至后台时（如在onPageHide生命周期函数中），通过harmonyShare.off('gesturesShare')取消该监听。</li><li><strong>构建分享数据</strong>：定义需要分享的数据<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/share-system-share#section816451553012" target="_blank">SharedData</a>。</li><li><strong>分享数据</strong>：在监听回调中调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/share-harmony-share#section1862171812120" target="_blank">sharableTarget.share</a>方法来分享数据。</li><li><strong>文件接收策略与对端跳转处理</strong>：<ol><li><strong>文件分享</strong>：隔空传送文件分享的接收由对端系统自行接收，见<a href="/consumer/cn/doc/best-practices/bpta-application-gesture-share#section177815256291">文件接收策略</a>。</li><li><strong>链接分享</strong>：隔空传送链接分享需<a href="/consumer/cn/doc/best-practices/bpta-application-gesture-share#section1685558173015">配置App Linking</a>并在接收端进行数据处理参考<a href="/consumer/cn/doc/best-practices/bpta-application-gesture-share#section20788652163113">对端跳转处理</a>。</li></ol> </li></ol> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ul><li><strong>超时控制</strong>：从触发事件到调用sharableTarget.share需在3秒内完成，否则可能导致失败。</li><li><strong>页面生命周期管理</strong>：确保页面隐藏或退至后台时取消监听。</li><li><strong>数据分享</strong>：可分享链接或文件（图片、视频、文档等），但每次分享内容只能是链接或文件中的一种，不支持混合分享。</li></ul> </div></div></div> </div> <div class="tiledSection"><h2 id="section8652105522112">分享文件<i class="anchor-icon anchor-icon-link" anchorid="section8652105522112" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section18279162912273" class="firsth2">分享注册监听与取消监听<i class="anchor-icon anchor-icon-link" anchorid="section18279162912273" tips="复制节点链接"></i></h3><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/share-harmony-share" target="_blank">harmonyShare（华为分享）</a>模块提供了隔空传送分享事件的监听方法<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/share-harmony-share#section199317814132" target="_blank">on('gesturesShare')</a>及取消监听的方法<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/share-harmony-share#section1699538101317" target="_blank">off('gesturesShare')</a>。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>隔空传送监听方法：</p> <p>on(event: 'gesturesShare', capability: SendCapabilityRegistry, callback: Callback&lt;SharableTarget&gt;): void</p> <p>该方法需传入capability参数，类型为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/share-harmony-share#section7361949172719" target="_blank">SendCapabilityRegistry</a>，继承自<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/share-harmony-share#section7252115555417" target="_blank">BaseCapabilityRegistry</a>。其包含windowId属性，需要传入当前应用的窗口ID。在PC/2in1或平板自由窗口模式中，系统会根据窗口ID判断当前应用是否获取了窗口焦点。只有在获取焦点后，当用户触发隔空传送事件时，才会触发应用注册的隔空传送方法。</p> <p>该方法支持phone、tablet和PC/2in1设备类型，在多设备开发时建议使用该接口。</p> </div></div></div> <p>定义ShareModel类，用于封装分享相关方法，也便于分享页面调用相关方法，首先需要导入相关模块，其中harmonyShare、systemShare为分享服务相关模块。</p> <div class="screenLinkPre"><div _ngcontent-bta-c106="" class="highlight-div"><div _ngcontent-bta-c106="" class="highlight-div-header"><div _ngcontent-bta-c106="" class="highlight-div-header-left"><div _ngcontent-bta-c106="" class="handle-button expand-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bta-c106="" class="highlight-div-header-right"><div _ngcontent-bta-c106="" class="handle-button ai-button"></div><div _ngcontent-bta-c106="" class="handle-button line-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bta-c106="" class="handle-button theme-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bta-c106="" class="handle-button copy-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bta-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/GesturesShare/blob/master/feature/share/src/main/ets/model/ShareModel.ets#L17-L24" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { harmonyShare, systemShare } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ShareKit'</span>;</li><li><span class="hljs-keyword">import</span> { uniformTypeDescriptor } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li><span class="hljs-keyword">import</span> { fileUri } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">FileData</span>, <span class="hljs-title class_">ShareType</span>, <span class="hljs-variable constant_">VIDEO_SOURCES</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./FileData'</span>;</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GesturesShare/blob/master/feature/share/src/main/ets/model/ShareModel.ets#L17-L24" target="_blank">ShareModel.ets</a></div></div></div></div> <p>将隔空传送监听方法<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/share-harmony-share#section199317814132" target="_blank">on('gesturesShare')</a>及取消监听的方法<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/share-harmony-share#section1699538101317" target="_blank">off('gesturesShare')</a>进行封装。定义immersiveListening()方法为监听方法，immersiveDisableListening()方法为取消监听方法。在分享页面可通过初始化ShareModel类并调用immersiveListening()方法来启动监听，调用immersiveDisableListening()方法取消监听。</p> <div class="screenLinkPre"><div _ngcontent-bta-c106="" class="highlight-div"><div _ngcontent-bta-c106="" class="highlight-div-header"><div _ngcontent-bta-c106="" class="highlight-div-header-left"><div _ngcontent-bta-c106="" class="handle-button expand-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bta-c106="" class="highlight-div-header-right"><div _ngcontent-bta-c106="" class="handle-button ai-button"></div><div _ngcontent-bta-c106="" class="handle-button line-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bta-c106="" class="handle-button theme-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bta-c106="" class="handle-button copy-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bta-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/GesturesShare/blob/master/feature/share/src/main/ets/model/ShareModel.ets#L55-L93" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> *  Add gesturesShare listening.</span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-keyword">public</span> <span class="hljs-title function_">immersiveListening</span>(<span class="hljs-params">shareType: ShareType</span>) {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">canIUse</span>(<span class="hljs-string">'SystemCapability.Collaboration.HarmonyShare'</span>)) {</li><li>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getLastWindow</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">try</span> {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">mainWindowID</span>: <span class="hljs-built_in">number</span> = data.<span class="hljs-title function_">getWindowProperties</span>().<span class="hljs-property">id</span>;</li><li>        harmonyShare.<span class="hljs-title function_">on</span>(<span class="hljs-string">'gesturesShare'</span>, { <span class="hljs-attr">windowId</span>: mainWindowID }, <span class="hljs-function">(<span class="hljs-params">target: harmonyShare.SharableTarget</span>) =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">immersiveCallback</span>(target, shareType);</li><li>        });</li><li>      } <span class="hljs-keyword">catch</span> (err) {</li><li>        <span class="hljs-keyword">let</span> error = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'GesturesShare'</span>, <span class="hljs-string">`getWindowProperties error <span class="hljs-subst">${error.code}</span> <span class="hljs-subst">${error.message}</span>`</span>);</li><li>      }</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'GesturesShare'</span>, <span class="hljs-string">`immersiveListening error <span class="hljs-subst">${error.code}</span> <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> *  Remove gesturesShare listening.</span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-keyword">public</span> <span class="hljs-title function_">immersiveDisableListening</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">canIUse</span>(<span class="hljs-string">'SystemCapability.Collaboration.HarmonyShare'</span>)) {</li><li>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getLastWindow</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">try</span> {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">mainWindowID</span>: <span class="hljs-built_in">number</span> = data.<span class="hljs-title function_">getWindowProperties</span>().<span class="hljs-property">id</span>;</li><li>        harmonyShare.<span class="hljs-title function_">off</span>(<span class="hljs-string">'gesturesShare'</span>, { <span class="hljs-attr">windowId</span>: mainWindowID });</li><li>      } <span class="hljs-keyword">catch</span> (error) {</li><li>        <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'GesturesShare'</span>, <span class="hljs-string">`getWindowProperties error <span class="hljs-subst">${err.code}</span> <span class="hljs-subst">${err.message}</span>`</span>);</li><li>      }</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'GesturesShare'</span>, <span class="hljs-string">`immersiveDisableListening error <span class="hljs-subst">${error.code}</span> <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    })</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GesturesShare/blob/master/feature/share/src/main/ets/model/ShareModel.ets#L55-L93" target="_blank">ShareModel.ets</a></div></div></div></div> <p>开发者应在用户进入隔空传送分享页面时调用隔空传送分享接口。当应用不再需要隔空传送分享文件或离开页面（包括退至后台等情况）时，应及时调用取消监听的方法。ShareModel模块自定义封装了分享相关方法，可以通过调用this.shareModel.immersiveListening()方法并传入ShareType.FILE_SHARE来注册文件分享事件监听，调用this.shareModel.immersiveDisableListening()来取消监听。</p> <p>当用户在文件分享页面勾选或取消勾选文件时，会触发onChange()方法，在该方法中，调用setFileShare()方法将要分享的文件索引数据存储到shareModel实例中，以便在生成分享数据时使用。</p> <div class="screenLinkPre"><div _ngcontent-bta-c106="" class="highlight-div"><div _ngcontent-bta-c106="" class="highlight-div-header"><div _ngcontent-bta-c106="" class="highlight-div-header-left"><div _ngcontent-bta-c106="" class="handle-button expand-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bta-c106="" class="highlight-div-header-right"><div _ngcontent-bta-c106="" class="handle-button ai-button"></div><div _ngcontent-bta-c106="" class="handle-button line-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bta-c106="" class="handle-button theme-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bta-c106="" class="handle-button copy-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bta-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/GesturesShare/blob/master/feature/share/src/main/ets/view/FileSharePageComponent.ets#L17-L153" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common } from <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { filePreview } from <span class="hljs-string">'@kit.PreviewKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } from <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { FileData, FILE_SOURCES, ShareType } from <span class="hljs-string">'../model/FileData'</span>;</li><li><span class="hljs-keyword">import</span> { ShareModel } from <span class="hljs-string">'../model/ShareModel'</span>;</li><li><span class="hljs-keyword">import</span> { FileUtil, BreakpointConstants, BreakpointType } from <span class="hljs-string">'@ohos/common'</span>;</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>export struct FileSharePageComponent {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-comment">// Pending shared data index.</span></li><li>  <span class="hljs-meta">@State</span> fileShare: number[] = [];</li><li>  <span class="hljs-comment">// All file data collection.</span></li><li>  <span class="hljs-meta">@State</span> dataList: FileData[] = FILE_SOURCES;</li><li>
</li><li>  build() {</li><li>    NavDestination() {</li><li>      List({ space: <span class="hljs-number">16</span> }) {</li><li>        ForEach(<span class="hljs-keyword">this</span>.dataList, (item: FileData, index: number) =&gt; {</li><li>          ListItem() {</li><li>            Stack() {</li><li>              <span class="hljs-comment">// ...</span></li><li>              Column() {</li><li>                Checkbox({ name: index + <span class="hljs-string">''</span>, group: <span class="hljs-string">'checkboxGroup'</span>})</li><li>                  <span class="hljs-comment">// ...</span></li><li>                  .onChange((value: boolean) =&gt; {</li><li>                    <span class="hljs-keyword">if</span> (value) {</li><li>                      <span class="hljs-keyword">this</span>.fileShare.push(index);</li><li>                    } <span class="hljs-keyword">else</span> {</li><li>                      <span class="hljs-keyword">this</span>.fileShare.splice(<span class="hljs-keyword">this</span>.fileShare.indexOf(index), <span class="hljs-number">1</span>);</li><li>                    }</li><li>                    <span class="hljs-keyword">this</span>.shareModel = ShareModel.getInstance(<span class="hljs-keyword">this</span>.context);</li><li>                    <span class="hljs-keyword">this</span>.shareModel.setFileShare(<span class="hljs-keyword">this</span>.fileShare);</li><li>                    <span class="hljs-keyword">this</span>.shareModel.setVideoDataList(<span class="hljs-keyword">this</span>.dataList);</li><li>                  })</li><li>                <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>    .onShown(() =&gt; {</li><li>      <span class="hljs-comment">// ...</span></li><li>      <span class="hljs-keyword">this</span>.shareModel = ShareModel.getInstance(<span class="hljs-keyword">this</span>.context);</li><li>      <span class="hljs-keyword">this</span>.shareModel.immersiveListening(ShareType.FILE_SHARE);</li><li>    })</li><li>    .onHidden(() =&gt; {</li><li>      <span class="hljs-keyword">this</span>.shareModel = ShareModel.getInstance(<span class="hljs-keyword">this</span>.context);</li><li>      <span class="hljs-keyword">this</span>.shareModel.immersiveDisableListening();</li><li>    })</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GesturesShare/blob/master/feature/share/src/main/ets/view/FileSharePageComponent.ets#L17-L153" target="_blank">FileSharePageComponent.ets</a></div></div></div></div> </div> <div class="tiledSection"><h3 id="section97551607281">构建分享数据<i class="anchor-icon anchor-icon-link" anchorid="section97551607281" tips="复制节点链接"></i></h3><p>在分享数据时，分享发起方需要构建<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/share-system-share#section20696483813" target="_blank">SharedRecord</a>对象。在文件分享场景中，发起方在构造此参数时，必须传入uri和utd这两个属性。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ul><li>uri是指要分享的文件URI，而非文件路径，例如沙箱路径content.fileDir，应通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-file-fileuri#fileurigeturifrompath" target="_blank">fileUri.getUriFromPath</a>获取其URI。</li><li>utd则是当前文件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/uniform-data-type-list" target="_blank">标准化数据类型</a>，需要传入与分享的数据匹配的类型，以便系统匹配精确的目标应用，推荐使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-data-uniformtypedescriptor#uniformtypedescriptorgetuniformdatatypebyfilenameextension11" target="_blank">uniformTypeDescriptor.getUniformDataTypeByFilenameExtension</a>方法，通过给定的文件后缀名查询标准化数据类型的ID。</li></ul> </div></div></div> <p>在ShareModel模块中定义getShareRecord()方法，用于根据当前的文件类型构建分享数据。定义getFileShareData()方法当需要分享多个文件时，该方法会通过循环处理来获取分享数据。</p> <div class="screenLinkPre"><div _ngcontent-bta-c106="" class="highlight-div"><div _ngcontent-bta-c106="" class="highlight-div-header"><div _ngcontent-bta-c106="" class="highlight-div-header-left"><div _ngcontent-bta-c106="" class="handle-button expand-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bta-c106="" class="highlight-div-header-right"><div _ngcontent-bta-c106="" class="handle-button ai-button"></div><div _ngcontent-bta-c106="" class="handle-button line-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bta-c106="" class="handle-button theme-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bta-c106="" class="handle-button copy-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bta-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/GesturesShare/blob/master/feature/share/src/main/ets/model/ShareModel.ets#L118-L154" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * Get file Share data.</span></li><li><span class="hljs-comment"> * @returns systemShare.SharedData.</span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-keyword">private</span> <span class="hljs-title function_">getFileShareData</span>(): <span class="hljs-title class_">systemShare</span>.<span class="hljs-title class_">SharedData</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">shareData</span>: <span class="hljs-title class_">systemShare</span>.<span class="hljs-title class_">SharedData</span> =</li><li>    <span class="hljs-variable">new</span> <span class="hljs-variable">systemShare</span>.<span class="hljs-title function_">SharedData</span>(<span class="hljs-keyword">this</span>.<span class="hljs-title function_">getShareRecord</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">videoDataList</span>[<span class="hljs-keyword">this</span>.<span class="hljs-variable">fileShare</span>[<span class="hljs-number">0</span>]]));</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> <span class="hljs-variable">i</span> = <span class="hljs-number">1</span>; <span class="hljs-variable">i</span> &lt; <span class="hljs-keyword">this</span>.<span class="hljs-title class_">fileShare</span>.<span class="hljs-title class_">length</span>; <span class="hljs-title class_">i</span>++) {</li><li>      <span class="hljs-variable">shareData</span>.<span class="hljs-title function_">addRecord</span>(<span class="hljs-keyword">this</span>.<span class="hljs-title function_">getShareRecord</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">videoDataList</span>[<span class="hljs-keyword">this</span>.<span class="hljs-variable">fileShare</span>[<span class="hljs-variable">i</span>]]));</li><li>    }</li><li>  } <span class="hljs-keyword">catch</span> (<span class="hljs-variable">err</span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">error</span> = <span class="hljs-variable">err</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">BusinessError</span>;</li><li>    <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'GesturesShare'</span>, `<span class="hljs-variable">shareData</span>.<span class="hljs-variable">addRecord</span> <span class="hljs-variable">error</span> ${<span class="hljs-variable">error</span>.<span class="hljs-variable">code</span>} ${<span class="hljs-variable">error</span>.<span class="hljs-variable">message</span>}`);</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-variable">shareData</span>;</li><li>}</li><li>
</li><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * Get shared data.</span></li><li><span class="hljs-comment"> *</span></li><li><span class="hljs-comment"> * @param data File data to be shared.</span></li><li><span class="hljs-comment"> * @returns systemShare.SharedRecord.</span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-keyword">private</span> <span class="hljs-title function_">getShareRecord</span>(<span class="hljs-variable">data</span>: <span class="hljs-title class_">FileData</span>): <span class="hljs-title class_">systemShare</span>.<span class="hljs-title class_">SharedRecord</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">suffix</span> = <span class="hljs-string">'.'</span> + <span class="hljs-variable">data</span>.<span class="hljs-variable">url</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">'.'</span>).<span class="hljs-title function_">pop</span>();</li><li>  <span class="hljs-comment">// Obtain the UTD through the file extension.</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">utd</span> = <span class="hljs-variable">uniformTypeDescriptor</span>.<span class="hljs-title function_">getUniformDataTypeByFilenameExtension</span>(<span class="hljs-variable">suffix</span>);</li><li>  <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'GesturesShare'</span>, `<span class="hljs-variable">getShareRecord</span> <span class="hljs-variable">utd</span> ${<span class="hljs-variable">utd</span>}`);</li><li>  <span class="hljs-keyword">return</span> {</li><li>    <span class="hljs-variable">utd</span>: <span class="hljs-title class_">utd</span>,</li><li>    <span class="hljs-variable">uri</span>: <span class="hljs-title class_">data</span>.<span class="hljs-title class_">url</span>,</li><li>    <span class="hljs-variable">thumbnailUri</span>: <span class="hljs-title class_">data</span>.<span class="hljs-title class_">thumbnail</span>,</li><li>    <span class="hljs-variable">title</span>: <span class="hljs-title class_">data</span>.<span class="hljs-title class_">name</span>,</li><li>    <span class="hljs-variable">description</span>: <span class="hljs-title class_">data</span>.<span class="hljs-title class_">description</span></li><li>  };</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GesturesShare/blob/master/feature/share/src/main/ets/model/ShareModel.ets#L118-L154" target="_blank">ShareModel.ets</a></div></div></div></div> </div> <div class="tiledSection"><h3 id="section0145100252">分享数据<i class="anchor-icon anchor-icon-link" anchorid="section0145100252" tips="复制节点链接"></i></h3><p>在隔空传送事件回调中，调用this.immersiveCallback()方法，通过传入的ShareType类型来判断当前是文件分享还是链接分享，文件分享调用getFileShareData()方法构造分享数据，并通过sharableTarget.share()方法分享数据，完成隔空传送文件分享流程。</p> <div class="screenLinkPre"><div _ngcontent-bta-c106="" class="highlight-div"><div _ngcontent-bta-c106="" class="highlight-div-header"><div _ngcontent-bta-c106="" class="highlight-div-header-left"><div _ngcontent-bta-c106="" class="handle-button expand-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bta-c106="" class="highlight-div-header-right"><div _ngcontent-bta-c106="" class="handle-button ai-button"></div><div _ngcontent-bta-c106="" class="handle-button line-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bta-c106="" class="handle-button theme-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bta-c106="" class="handle-button copy-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bta-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/GesturesShare/blob/master/feature/share/src/main/ets/model/ShareModel.ets#L103-L114" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">public</span> <span class="hljs-title function_">immersiveCallback</span>(<span class="hljs-variable">target</span>: <span class="hljs-title class_">harmonyShare</span>.<span class="hljs-title class_">SharableTarget</span>, <span class="hljs-variable">shareType</span>: <span class="hljs-title class_">ShareType</span>) {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-variable">shareType</span> === <span class="hljs-variable">ShareType</span>.<span class="hljs-variable">FILE_SHARE</span>) {</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.<span class="hljs-variable">fileShare</span> || <span class="hljs-keyword">this</span>.<span class="hljs-variable">fileShare</span>.<span class="hljs-variable">length</span> === <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">shareData</span>: <span class="hljs-title class_">systemShare</span>.<span class="hljs-title class_">SharedData</span> = <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getFileShareData</span>();</li><li>    <span class="hljs-variable">target</span>.<span class="hljs-title function_">share</span>(<span class="hljs-variable">shareData</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">shareData</span>: <span class="hljs-title class_">systemShare</span>.<span class="hljs-title class_">SharedData</span> = <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getLinkShareData</span>();</li><li>    <span class="hljs-variable">target</span>.<span class="hljs-title function_">share</span>(<span class="hljs-variable">shareData</span>);</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GesturesShare/blob/master/feature/share/src/main/ets/model/ShareModel.ets#L103-L114" target="_blank">ShareModel.ets</a></div></div></div></div> </div> <div class="tiledSection"><h3 id="section177815256291">文件接收策略<i class="anchor-icon anchor-icon-link" anchorid="section177815256291" tips="复制节点链接"></i></h3><p>分享接收端接收数据时遵循统一规则，详情请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/share-access-one-step" target="_blank">目标设备接收分享数据一步直达体验</a>。当传入的分享参数utd为uniformTypeDescriptor.UniformDataType.IMAGE且文件确认为图片文件时，接收端为phone、tablet设备时默认将其存储在图库中。当传入的utd为uniformTypeDescriptor.UniformDataType.FILE时，文件会默认存储到文件管理中，接收端为PC/2in1设备类型时则会将媒体以及非媒体文件存储至文件管理器。系统预置了常用类型，详情可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/uniform-data-type-list" target="_blank">UTD预置列表</a>。</p> </div> <div class="tiledSection"><h2 id="section1348315782219">分享链接<i class="anchor-icon anchor-icon-link" anchorid="section1348315782219" tips="复制节点链接"></i></h2><p>开发者可以通过分享 AppLinking 链接实现应用间的无缝跳转和内容精准直达。当用户通过隔空传送分享链接时，接收端接收链接后：</p> <ul><li>如果目标应用已安装，将直接启动目标应用。</li><li>如果目标应用未安装，将直接跳转到应用市场或启动浏览器打开网页查看内容。</li></ul> <p>详情请参考碰一碰视频分享<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-application-knock-video-share#section95975396464" target="_blank">典型场景</a>章节。</p> </div> <div class="tiledSection"><h3 id="section564210586302" class="firsth2">分享注册监听及取消监听<i class="anchor-icon anchor-icon-link" anchorid="section564210586302" tips="复制节点链接"></i></h3></div> <p>分享链接再注册监听以及取消监听与分享文件章节下的<a href="/consumer/cn/doc/best-practices/bpta-application-gesture-share#section18279162912273">分享注册监听与取消监听</a>处理过程一致，开发者可参考分享文件这一章节的内容，在调用immersiveListening()方法需传入ShareType.LINK_SHARE来注册链接分享事件监听，调用this.shareModel.immersiveDisableListening()来取消监听。</p> <p>在分享链接页面，当用户点击不同的视频集数时，会触发onClick()方法。在该方法中，调用setVideoIndex()方法将当前集数存储到shareModel实例中，以便在生成分享链接时使用。</p> <div class="screenLinkPre"><div _ngcontent-bta-c106="" class="highlight-div"><div _ngcontent-bta-c106="" class="highlight-div-header"><div _ngcontent-bta-c106="" class="highlight-div-header-left"><div _ngcontent-bta-c106="" class="handle-button expand-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bta-c106="" class="highlight-div-header-right"><div _ngcontent-bta-c106="" class="handle-button ai-button"></div><div _ngcontent-bta-c106="" class="handle-button line-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bta-c106="" class="handle-button theme-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bta-c106="" class="handle-button copy-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bta-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/GesturesShare/blob/master/feature/share/src/main/ets/view/LinkSharePageComponent.ets#L17-L159" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common } from <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { JSON } from <span class="hljs-string">'@kit.ArkTS'</span>;</li><li><span class="hljs-keyword">import</span> { FileData, ShareType, VIDEO_SOURCES } from <span class="hljs-string">'../model/FileData'</span>;</li><li><span class="hljs-keyword">import</span> { ShareModel } from <span class="hljs-string">'../model/ShareModel'</span>;</li><li><span class="hljs-keyword">import</span> { BreakpointConstants } from <span class="hljs-string">'@ohos/common'</span>;</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>export struct LinkSharePageComponent {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-comment">// Current playing video index.</span></li><li>  <span class="hljs-meta">@State</span> currentVideoIndex: number = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@State</span> url: ResourceStr = $rawfile(<span class="hljs-keyword">this</span>.dataList[<span class="hljs-keyword">this</span>.currentVideoIndex].url);</li><li>
</li><li>  build() {</li><li>    NavDestination() {</li><li>      Scroll() {</li><li>        Column() {</li><li>          <span class="hljs-comment">// ...</span></li><li>          Column() {</li><li>            <span class="hljs-comment">// ...</span></li><li>            Scroll() {</li><li>              Row({ space: <span class="hljs-number">10</span> }) {</li><li>                ForEach(<span class="hljs-keyword">this</span>.dataList, (item: FileData, index) =&gt; {</li><li>                  RelativeContainer() {</li><li>                    <span class="hljs-comment">// ...</span></li><li>                  }</li><li>                  <span class="hljs-comment">// ...</span></li><li>                  .onClick(() =&gt; {</li><li>                    <span class="hljs-keyword">this</span>.currentVideoIndex = index;</li><li>                    <span class="hljs-keyword">this</span>.shareModel = ShareModel.getInstance(<span class="hljs-keyword">this</span>.context);</li><li>                    <span class="hljs-keyword">this</span>.shareModel.setVideoIndex(<span class="hljs-keyword">this</span>.currentVideoIndex);</li><li>                    <span class="hljs-keyword">this</span>.videoController.reset();</li><li>                    <span class="hljs-keyword">this</span>.url = $rawfile(item.url);</li><li>                  })</li><li>                  <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>    .onShown(() =&gt; {</li><li>      <span class="hljs-comment">// ...</span></li><li>      <span class="hljs-keyword">this</span>.shareModel = ShareModel.getInstance(<span class="hljs-keyword">this</span>.context);</li><li>      <span class="hljs-keyword">this</span>.shareModel?.immersiveListening(ShareType.LINK_SHARE);</li><li>    })</li><li>    .onHidden(() =&gt; {</li><li>      <span class="hljs-keyword">this</span>.shareModel = ShareModel.getInstance(<span class="hljs-keyword">this</span>.context);</li><li>      <span class="hljs-keyword">this</span>.shareModel?.immersiveDisableListening();</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GesturesShare/blob/master/feature/share/src/main/ets/view/LinkSharePageComponent.ets#L17-L159" target="_blank">LinkSharePageComponent.ets</a></div></div></div></div> <div class="tiledSection"><h3 id="section1578365517255">构建分享数据并分享数据<i class="anchor-icon anchor-icon-link" anchorid="section1578365517255" tips="复制节点链接"></i></h3><p>在隔空传送事件回调中调用this.immersiveLinkCallback()方法，实现分享数据构建，在链接分享场景中，发起方在构造<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/share-system-share#section20696483813" target="_blank">SharedRecord</a>参数时，必须传入content和utd这两个属性，并通过sharableTarget.share()方法传输数据，完成隔空传送链接分享流程。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ul><li>utd需设置为utd.UniformDataType.HYPERLINK，表示分享内容为链接；content设置为<a href="/consumer/cn/doc/best-practices/bpta-application-gesture-share#section1685558173015">配置App Linking</a>章节中配置的链接，链接中拼接视频唯一标识符videoIndex。</li><li>为提升分享预览模板缩略图的清晰度和整体用户体验，建议开发者优先使用thumbnailUri参数设置缩略图。尽管thumbnailUri和thumbnail两个参数均可实现缩略图效果，但thumbnail参数因大小限制为32KB，实际应用中可能导致图片模糊，影响用户体验。因此，采用thumbnailUri指定高质量缩略图更为推荐。</li></ul> </div></div></div> <div class="screenLinkPre"><div _ngcontent-bta-c106="" class="highlight-div"><div _ngcontent-bta-c106="" class="highlight-div-header"><div _ngcontent-bta-c106="" class="highlight-div-header-left"><div _ngcontent-bta-c106="" class="handle-button expand-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bta-c106="" class="highlight-div-header-right"><div _ngcontent-bta-c106="" class="handle-button ai-button"></div><div _ngcontent-bta-c106="" class="handle-button line-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bta-c106="" class="handle-button theme-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bta-c106="" class="handle-button copy-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bta-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/GesturesShare/blob/master/feature/share/src/main/ets/model/ShareModel.ets#L162-L179" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">getLinkShareData</span>(): <span class="hljs-title class_">systemShare</span>.<span class="hljs-title class_">SharedData</span> {</li><li>  <span class="hljs-comment">// share app linking.</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">videoData</span>: <span class="hljs-title class_">FileData</span> = <span class="hljs-variable">VIDEO_SOURCES</span>[<span class="hljs-keyword">this</span>.<span class="hljs-variable">videoIndex</span>];</li><li>  <span class="hljs-comment">// Video thumbnail image sandbox path.</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">filePath</span>: <span class="hljs-title class_">string</span> = <span class="hljs-keyword">this</span>.<span class="hljs-variable">context</span>?.<span class="hljs-variable">filesDir</span> + `/${<span class="hljs-variable">videoData</span>.<span class="hljs-variable">thumbnail</span>}`;</li><li>  <span class="hljs-comment">// Get video thumbnail URI path.</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">coverUri</span>: <span class="hljs-title class_">string</span> = <span class="hljs-variable">fileUri</span>.<span class="hljs-title function_">getUriFromPath</span>(<span class="hljs-variable">filePath</span>);</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">shareData</span>: <span class="hljs-title class_">systemShare</span>.<span class="hljs-title class_">SharedData</span> = <span class="hljs-variable">new</span> <span class="hljs-variable">systemShare</span>.<span class="hljs-title function_">SharedData</span>({</li><li>    <span class="hljs-comment">// Set the shared data type to Link.</span></li><li>    <span class="hljs-variable">utd</span>: <span class="hljs-title class_">uniformTypeDescriptor</span>.<span class="hljs-title class_">UniformDataType</span>.<span class="hljs-title class_">HYPERLINK</span>,</li><li>    <span class="hljs-comment">// The shared App Linking link is replaced with the real address here.</span></li><li>    <span class="hljs-variable">content</span>: `<span class="hljs-title class_">https</span>:<span class="hljs-comment">//www.example.com?videoIndex=${this.videoIndex}`,</span></li><li>    <span class="hljs-variable">thumbnailUri</span>: <span class="hljs-title class_">coverUri</span>,</li><li>    <span class="hljs-variable">title</span>: <span class="hljs-title class_">videoData</span>.<span class="hljs-title class_">name</span>,</li><li>    <span class="hljs-variable">description</span>: <span class="hljs-title class_">videoData</span>.<span class="hljs-title class_">description</span></li><li>  });</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-variable">shareData</span>;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GesturesShare/blob/master/feature/share/src/main/ets/model/ShareModel.ets#L162-L179" target="_blank">ShareModel.ets</a></div></div></div></div> </div> <div class="tiledSection"><h3 id="section1685558173015">配置App Linking<i class="anchor-icon anchor-icon-link" anchorid="section1685558173015" tips="复制节点链接"></i></h3><p>开发者可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-linking-startup" target="_blank">使用App Linking实现应用间跳转</a>进行配置和使用。例如，此处配置的App Linking的链接为：www.example.com，开发者需在entry模块的module.json5中进行如下配置：</p> <div class="screenLinkPre"><div _ngcontent-bta-c106="" class="highlight-div"><div _ngcontent-bta-c106="" class="highlight-div-header"><div _ngcontent-bta-c106="" class="highlight-div-header-left"><div _ngcontent-bta-c106="" class="handle-button expand-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bta-c106="" class="highlight-div-header-right"><div _ngcontent-bta-c106="" class="handle-button ai-button"></div><div _ngcontent-bta-c106="" class="handle-button line-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bta-c106="" class="handle-button theme-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bta-c106="" class="handle-button copy-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bta-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/GesturesShare/blob/master/product/entry/src/main/module.json5#L2-L74" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"module"</span>: {</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-string">"abilities"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"name"</span>: <span class="hljs-string">"EntryAbility"</span>,</li><li>        <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-string">"exported"</span>: <span class="hljs-keyword">true</span>,</li><li>        <span class="hljs-string">"skills"</span>: [</li><li>          {</li><li>            <span class="hljs-string">"entities"</span>: [</li><li>              <span class="hljs-string">"entity.system.home"</span>,</li><li>              <span class="hljs-comment">// entities must contain "entity.system.browsable"</span></li><li>              <span class="hljs-string">"entity.system.browsable"</span></li><li>            ],</li><li>            <span class="hljs-string">"actions"</span>: [</li><li>              <span class="hljs-string">"ohos.want.action.home"</span>,</li><li>              <span class="hljs-comment">// Actions must contain "ohos.want.action.viewData"</span></li><li>              <span class="hljs-string">"ohos.want.action.viewData"</span></li><li>            ],</li><li>            <span class="hljs-string">"uris"</span>: [</li><li>              {</li><li>                <span class="hljs-comment">// The scheme must be configured as https</span></li><li>                <span class="hljs-string">"scheme"</span>: <span class="hljs-string">"https"</span>,</li><li>                <span class="hljs-comment">// The host must be configured as the associated domain name</span></li><li>                <span class="hljs-string">"host"</span>: <span class="hljs-string">"www.example.com"</span>,</li><li>                <span class="hljs-string">"path"</span>: <span class="hljs-string">""</span></li><li>              }</li><li>            ],</li><li>            <span class="hljs-comment">// domainVerify must be set to true</span></li><li>            <span class="hljs-string">"domainVerify"</span>: <span class="hljs-keyword">true</span></li><li>          }</li><li>        ]</li><li>      }</li><li>    ],</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GesturesShare/blob/master/product/entry/src/main/module.json5#L2-L74" target="_blank">module.json5</a></div></div></div></div> </div> <div class="tiledSection"><h3 id="section20788652163113">对端跳转处理<i class="anchor-icon anchor-icon-link" anchorid="section20788652163113" tips="复制节点链接"></i></h3><p>当对端设备已安装应用并收到分享的 App Linking 链接后，系统会拉起应用。根据应用是否处于后台，有以下两种情况需处理：</p> <p>应用未在后台运行：此时跳转应用，应在onCreate()方法中获取链接中的视频唯一标识符videoIndex并存储到AppStorage中，同时存储GesturesShare_isShareLink为true，表示当前应用通过分享系统启动，以便于跳转到隔空传送链接分享页面播放视频。</p> <div class="screenLinkPre"><div _ngcontent-bta-c106="" class="highlight-div"><div _ngcontent-bta-c106="" class="highlight-div-header"><div _ngcontent-bta-c106="" class="highlight-div-header-left"><div _ngcontent-bta-c106="" class="handle-button expand-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bta-c106="" class="highlight-div-header-right"><div _ngcontent-bta-c106="" class="handle-button ai-button"></div><div _ngcontent-bta-c106="" class="handle-button line-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bta-c106="" class="handle-button theme-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bta-c106="" class="handle-button copy-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bta-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/GesturesShare/blob/master/product/entry/src/main/ets/entryability/EntryAbility.ets#L28-L43" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">onCreate</span>(<span class="hljs-variable">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-variable">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-title class_">LaunchParam</span>): <span class="hljs-title class_">void</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">videoIndex</span> = <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getVideoIndex</span>(<span class="hljs-variable">want</span>);</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-variable">videoIndex</span> !== <span class="hljs-string">''</span>) {</li><li>    <span class="hljs-variable">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'GesturesShare_shareVideoIndex'</span>, <span class="hljs-variable">Number</span>.<span class="hljs-title function_">parseInt</span>(<span class="hljs-variable">videoIndex</span>));</li><li>    <span class="hljs-variable">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'GesturesShare_isShareLink'</span>, <span class="hljs-keyword">true</span>);</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GesturesShare/blob/master/product/entry/src/main/ets/entryability/EntryAbility.ets#L28-L43" target="_blank">EntryAbility.ets</a></div></div></div></div> <p>应用已在后台运行：此时跳转应用，需在onNewWant()方法中获取链接中的视频唯一标识符videoIndex并存储到AppStorage中，并存储GesturesShare_isShareLink为true，表示当前应用通过分享系统启动，以便于跳转到隔空传送链接分享页面播放视频。</p> <div class="screenLinkPre"><div _ngcontent-bta-c106="" class="highlight-div"><div _ngcontent-bta-c106="" class="highlight-div-header"><div _ngcontent-bta-c106="" class="highlight-div-header-left"><div _ngcontent-bta-c106="" class="handle-button expand-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bta-c106="" class="highlight-div-header-right"><div _ngcontent-bta-c106="" class="handle-button ai-button"></div><div _ngcontent-bta-c106="" class="handle-button line-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bta-c106="" class="handle-button theme-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bta-c106="" class="handle-button copy-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bta-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/GesturesShare/blob/master/product/entry/src/main/ets/entryability/EntryAbility.ets#L47-L53" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">onNewWant</span>(<span class="hljs-params">want: Want, launchParam: AbilityConstant.LaunchParam</span>) {</li><li>  <span class="hljs-keyword">let</span> videoIndex = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getVideoIndex</span>(want);</li><li>  <span class="hljs-keyword">if</span> (videoIndex !== <span class="hljs-string">''</span>) {</li><li>    <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'GesturesShare_shareVideoIndex'</span>, <span class="hljs-title class_">Number</span>.<span class="hljs-built_in">parseInt</span>(videoIndex));</li><li>    <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'GesturesShare_isShareLink'</span>, <span class="hljs-literal">true</span>);</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GesturesShare/blob/master/product/entry/src/main/ets/entryability/EntryAbility.ets#L47-L53" target="_blank">EntryAbility.ets</a></div></div></div></div> <p>getVideoIndex()通过want参数获取分享链接中的参数。</p> <div class="screenLinkPre"><div _ngcontent-bta-c106="" class="highlight-div"><div _ngcontent-bta-c106="" class="highlight-div-header"><div _ngcontent-bta-c106="" class="highlight-div-header-left"><div _ngcontent-bta-c106="" class="handle-button expand-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bta-c106="" class="highlight-div-header-right"><div _ngcontent-bta-c106="" class="handle-button ai-button"></div><div _ngcontent-bta-c106="" class="handle-button line-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bta-c106="" class="handle-button theme-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bta-c106="" class="handle-button copy-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bta-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/GesturesShare/blob/master/product/entry/src/main/ets/entryability/EntryAbility.ets#L57-L73" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">private</span> <span class="hljs-title function_">getVideoIndex</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>): <span class="hljs-built_in">string</span> {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> uri = want?.<span class="hljs-property">uri</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">videoIndex</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>    <span class="hljs-comment">// Parse the parameters to obtain the app linking</span></li><li>    <span class="hljs-keyword">if</span> (uri) {</li><li>      <span class="hljs-keyword">let</span> urlObject = url.<span class="hljs-property">URL</span>.<span class="hljs-title function_">parseURL</span>(want?.<span class="hljs-property">uri</span>);</li><li>      videoIndex = urlObject.<span class="hljs-property">params</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'videoIndex'</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'GesturesShare'</span>, <span class="hljs-string">`getAid aid:<span class="hljs-subst">${videoIndex}</span>`</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> videoIndex;</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-keyword">let</span> error = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'GesturesShare'</span>, <span class="hljs-string">`Failed to getVideoIndex, error: <span class="hljs-subst">${error.code}</span> <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GesturesShare/blob/master/product/entry/src/main/ets/entryability/EntryAbility.ets#L57-L73" target="_blank">EntryAbility.ets</a></div></div></div></div> <p>在应用首页判断GesturesShare_isShareLink是否为true，若为true则跳转至隔空传送链接分享页面。</p> <div class="screenLinkPre"><div _ngcontent-bta-c106="" class="highlight-div"><div _ngcontent-bta-c106="" class="highlight-div-header"><div _ngcontent-bta-c106="" class="highlight-div-header-left"><div _ngcontent-bta-c106="" class="handle-button expand-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bta-c106="" class="highlight-div-header-right"><div _ngcontent-bta-c106="" class="handle-button ai-button"></div><div _ngcontent-bta-c106="" class="handle-button line-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bta-c106="" class="handle-button theme-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bta-c106="" class="handle-button copy-button"><div _ngcontent-bta-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bta-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/GesturesShare/blob/master/product/entry/src/main/ets/pages/Index.ets#L37-L41" data-highlighted="yes"><ol class="linenums"><li>onPageShow(): void {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isShareLink) {</li><li>    <span class="hljs-keyword">this</span>.pageInfos.pushPathByName(<span class="hljs-string">'LinkSharePage'</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">true</span>);</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GesturesShare/blob/master/product/entry/src/main/ets/pages/Index.ets#L37-L41" target="_blank">Index.ets</a></div></div></div></div> </div> <div class="tiledSection"><h2 id="section18698134115114">常见问题<i class="anchor-icon anchor-icon-link" anchorid="section18698134115114" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section6406182494612" class="firsth2">数据在分享过程中被丢弃或者提示无效的数据类型<i class="anchor-icon anchor-icon-link" anchorid="section6406182494612" tips="复制节点链接"></i></h3><p>分享服务支持链接分享和文件分享两种场景，但不支持两者混合分享。在混合分享时，数据可能会在分享过程中丢失或提示无效的数据类型。详情可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/share-faq-2" target="_blank">分享数据类型不支持</a>。</p> </div> <div class="tiledSection"><h2 id="section2500053172119">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section2500053172119" tips="复制节点链接"></i></h2><ul><li><a href="https://gitee.com/harmonyos_samples/GesturesShare" target="_blank">基于Share Kit实现隔空传送分享文件和链接</a></li></ul> </div> </div> <div></div></div>