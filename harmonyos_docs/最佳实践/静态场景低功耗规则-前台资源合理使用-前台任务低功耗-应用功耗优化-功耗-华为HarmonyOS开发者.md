<h1 _ngcontent-tly-c119="" class="doc-title ng-star-inserted" title="静态场景低功耗规则"> 静态场景低功耗规则 </h1>

<div _ngcontent-tly-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section8872134218512">规则<i class="anchor-icon anchor-icon-link" anchorid="section8872134218512" tips="复制节点链接"></i></h2></div> <p>在界面完全静止且无音频输出、资源下载的场景下，三方应用应停止频繁请求显示和sensor等无关资源，不随vsync信号每帧周期性运行，不持续请求sensor等资源。三方应用进程的CPU负载率应低于10%（单核负载）。</p> <div class="tiledSection"><h2 id="section16293051466">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section16293051466" tips="复制节点链接"></i></h2><p>静置场景下，三方应用进程不会随着vsync信号每帧周期性运行。以下“案例分析”对此进行详细说明。</p> </div> <p>在静置场景下，未使用的资源应及时释放。以sensor为例：</p> <ol><li>按需使用sensor资源，并按需注册sensorId。<p>注册监听，通过on()接口实现对传感器的持续监听。设置传感器上报周期interval为200000000纳秒（最小采样周期为5000000纳秒，最大采样周期为200000000纳秒）。</p> <div class="screenLinkPre"><div _ngcontent-tly-c106="" class="highlight-div"><div _ngcontent-tly-c106="" class="highlight-div-header"><div _ngcontent-tly-c106="" class="highlight-div-header-left"><div _ngcontent-tly-c106="" class="handle-button expand-button"><div _ngcontent-tly-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tly-c106="" class="highlight-div-header-right"><div _ngcontent-tly-c106="" class="handle-button ai-button"></div><div _ngcontent-tly-c106="" class="handle-button line-button"><div _ngcontent-tly-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tly-c106="" class="handle-button theme-button"><div _ngcontent-tly-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tly-c106="" class="handle-button copy-button"><div _ngcontent-tly-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tly-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/RationalUseOfFrontEndResources/entry/src/main/ets/pages/StaticScenesRule.ets#L21-L26" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { sensor } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.SensorServiceKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li>sensor.<span class="hljs-title function_">on</span>(sensor.<span class="hljs-property">SensorId</span>.<span class="hljs-property">ACCELEROMETER</span>, <span class="hljs-function">(<span class="hljs-params">data: sensor.AccelerometerResponse</span>) =&gt;</span> {</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Sample'</span>, <span class="hljs-string">'Succeeded in obtaining data. x: '</span> + data.<span class="hljs-property">x</span> + <span class="hljs-string">' y: '</span> + data.<span class="hljs-property">y</span> + <span class="hljs-string">' z: '</span> + data.<span class="hljs-property">z</span>);</li><li>}, { <span class="hljs-attr">interval</span>: <span class="hljs-number">200000000</span> });</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/RationalUseOfFrontEndResources/entry/src/main/ets/pages/StaticScenesRule.ets#L21-L26" target="_blank">StaticScenesRule.ets</a></div></div></div></div> </li></ol><ol start="2"><li>在sensor频次需求较低的场景中，根据需要调整sensor.on()的interval属性，以改变上报频次。<div class="screenLinkPre"><div _ngcontent-tly-c106="" class="highlight-div"><div _ngcontent-tly-c106="" class="highlight-div-header"><div _ngcontent-tly-c106="" class="highlight-div-header-left"><div _ngcontent-tly-c106="" class="handle-button expand-button"><div _ngcontent-tly-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tly-c106="" class="highlight-div-header-right"><div _ngcontent-tly-c106="" class="handle-button ai-button"></div><div _ngcontent-tly-c106="" class="handle-button line-button"><div _ngcontent-tly-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tly-c106="" class="handle-button theme-button"><div _ngcontent-tly-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tly-c106="" class="handle-button copy-button"><div _ngcontent-tly-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tly-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/RationalUseOfFrontEndResources/entry/src/main/ets/pages/StaticScenesRule.ets#L30-L32" data-highlighted="yes"><ol class="linenums"><li>sensor.on(sensor.SensorId.ACCELEROMETER, (<span class="hljs-keyword">data</span>: sensor.AccelerometerResponse) =&gt; {</li><li>  hilog.info(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Sample'</span>, <span class="hljs-string">'Succeeded in obtaining data. x: '</span> + <span class="hljs-keyword">data</span>.x + <span class="hljs-string">' y: '</span> + <span class="hljs-keyword">data</span>.y + <span class="hljs-string">' z: '</span> + <span class="hljs-keyword">data</span>.z);</li><li>}, { interval: <span class="hljs-number">200000000</span> });</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/RationalUseOfFrontEndResources/entry/src/main/ets/pages/StaticScenesRule.ets#L30-L32" target="_blank">StaticScenesRule.ets</a></div></div></div></div> </li><li class="continue">不使用sensor资源时，使用以下接口进行解注册。<div class="screenLinkPre"><div _ngcontent-tly-c106="" class="highlight-div"><div _ngcontent-tly-c106="" class="highlight-div-header"><div _ngcontent-tly-c106="" class="highlight-div-header-left"><div _ngcontent-tly-c106="" class="handle-button expand-button"><div _ngcontent-tly-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tly-c106="" class="highlight-div-header-right"><div _ngcontent-tly-c106="" class="handle-button ai-button"></div><div _ngcontent-tly-c106="" class="handle-button line-button"><div _ngcontent-tly-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tly-c106="" class="handle-button theme-button"><div _ngcontent-tly-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tly-c106="" class="handle-button copy-button"><div _ngcontent-tly-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tly-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/RationalUseOfFrontEndResources/entry/src/main/ets/pages/StaticScenesRule.ets#L36-L36" data-highlighted="yes"><ol class="linenums"><li>sensor<span class="hljs-selector-class">.off</span>(sensor.SensorId.ACCELEROMETER);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/RationalUseOfFrontEndResources/entry/src/main/ets/pages/StaticScenesRule.ets#L36-L36" target="_blank">StaticScenesRule.ets</a></div></div></div></div> </li></ol> <div class="tiledSection"><h2 id="section18612192513142">案例分析<i class="anchor-icon anchor-icon-link" anchorid="section18612192513142" tips="复制节点链接"></i></h2></div> <ul><li>开机后，桌面静置。连接Wi-Fi后，lottie动效异常，导致UI和RS空跑。<p><span><img height="271.54636600000003" originheight="422" originwidth="865" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163444.36953287531691772129501159074753:50001231000000:2800:3C7471594336BE81A4A96797154E825FB5A7EA3E1387D94DC08DC1A96470D00C.png" title="点击放大" width="556.605"></span></p> </li><li>应用静置界面时，应用以120 fps响应vsync事件但无实际显示，导致应用进程和RS负载较高。<p class="msonormal"><span><img height="254.03" originheight="867" originwidth="1888" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163444.27158919803919917863583613400879:50001231000000:2800:987A3C6DC397F7B642D372CDBC89C652313B16E4D5AA96F17D66B1F7B4044818.png" title="点击放大" width="551.95"></span></p> </li></ul> <div class="tiledSection"><h2 id="section545571014186">调测验证<i class="anchor-icon anchor-icon-link" anchorid="section545571014186" tips="复制节点链接"></i></h2><ul><li>查看日志：在控制台输入top指令，可直接获取进程负载。<p class="msonormal"><span><img height="299.25" originheight="724" originwidth="1000" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163444.63831518423023287911150734212552:50001231000000:2800:342305E21B87DD65C2A0566DFE63872E991826414DD383B595488675C42A173B.png" title="点击放大" width="412.3"></span></p> </li><li class="continue">抓取trace：通过trace中的进程耗时和绝对耗时，计算进程负载。<p class="msonormal"><span><img height="260.68" originheight="895" originwidth="1894" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163445.40548450648495186299217410353519:50001231000000:2800:ECE8E72F5146AF9B08B68A6AF2D29565D98BA0821E2D4BAF1833E979B3D26DDC.png" title="点击放大" width="551.95"></span></p> </li></ul> </div> </div> <div></div></div>