<h1 _ngcontent-jtx-c119="" class="doc-title ng-star-inserted" title="音频焦点管理"> 音频焦点管理 </h1>

<div _ngcontent-jtx-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section138096151117">概述<i class="anchor-icon anchor-icon-link" anchorid="section138096151117" tips="复制节点链接"></i></h2><p>在后台音频应用已经正确监听音频焦点事件并作相应处理后，目前仍存在前台应用与后台音频抢占音频焦点导致的用户体验问题。比如：</p> <ol><li>前台静音播放中断后台音乐播放。</li><li>前台公众号文章中内嵌的短视频播放中断后台音乐播放，短视频播放结束后，后台音乐播放不恢复。</li><li>前台视频播放过程中，音频被后台闹铃播放中断后，无声播放。</li></ol> <p>为解决上述场景中多音频流播放冲突问题，系统采用了音频焦点机制，即只有获得音频焦点的音频流可以正常播放，失去音频焦点的音频流则不能播放。为了尽可能满足用户的各类播放体验，系统构建了一套音频焦点管理机制，会根据应用播放的音频流类型不同，采取不同的中断策略以满足用户的体验诉求。</p> <p>本文将从以下几个方面，通过手机场景举例详细介绍系统音频焦点管理机制原理和典型问题场景的解决思路，其他设备场景下管理机制是相通的，主要区别在于系统默认策略不一样：</p> <ul><li><a href="/consumer/cn/doc/best-practices/bpta-audio-focus-management#section16381186101113">音频流类型正确配置</a>：正确配置音频流类型，可以获取合理的系统默认焦点策略。同时，在音量管理、音效管理以及输入/输出设备选择上，避免出现不可预期的故障现象。</li><li><a href="/consumer/cn/doc/best-practices/bpta-audio-focus-management#section14383666111">自定义焦点策略设置</a>：使用AudioSession进行自定义焦点策略，可以定制化地满足用户预期播放体验。</li><li><a href="/consumer/cn/doc/best-practices/bpta-audio-focus-management#section1338416621118">焦点中断事件正确处理</a>：正确处理焦点中断事件，可以避免出现中断不恢复或者播放UI状态错误的现象。</li><li><a href="/consumer/cn/doc/best-practices/bpta-audio-focus-management#section18385136161118">常见焦点场景的问题分析</a>：通过对典型问题场景的分析，有利于帮助开发者获取解决方案，以提升开发效率。</li></ul> </div> <div class="tiledSection"><h2 id="section1138116619118">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section1138116619118" tips="复制节点链接"></i></h2><p>面对多样化的业务场景，为了给用户更好的音频播放体验，系统音频焦点管理机制提供了四类音频中断策略：</p> <p><strong>终止策略（Stop）：</strong>停止先播音频流，使其永久失焦，待后播音频流结束后，先播音频流不恢复播放。</p> <p><strong>暂停策略（Pause）：</strong>暂停先播音频流，使其暂时失焦，待后播音频流结束后，先播音频流恢复播放。</p> <p><strong>降音策略（Duck）：</strong>与先播音频流并发播放，并且降低先播音频流的音量，待后播音频流结束后，先播音频流恢复音量。</p> <p><strong>并发策略（Mix）：</strong>与先播音频流并发播放。</p> <p>为了确保业务符合用户的中断策略，系统构建了音频焦点管理机制。该机制以音频流类型为输入，自动决策并执行相应的中断策略。同时，若系统默认策略无法满足用户的音频播放体验需求，系统提供了音频会话（AudioSession），以便开发者精细化管理和自定义调整中断策略。</p> </div> <div class="tiledSection"><h3 id="section538110641114" class="firsth2">音频焦点抢占流程<i class="anchor-icon anchor-icon-link" anchorid="section538110641114" tips="复制节点链接"></i></h3><p>在详细了解音频焦点管理机制之前，开发者先了解多音频流抢占焦点的时序流程是怎样的。流程图如下：</p> <p></p> <p><span><img height="585.8833242631343" originheight="1014" originwidth="1606" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163037.33317649361058741010120971982685:50001231000000:2800:702099EB692BE3F611295772B9756C5F5028EE6BBEDC5503B3618663431F4E22.png" title="点击放大" width="920"></span></p> <p>从上图可以看出系统音频焦点管理机制，开发者在开发音频相关功能时需要关注以下3点：</p> <ol><li>配置正确的音频流，其中音频焦点的创建、释放以及中断策略等动作由系统统一调控。</li><li>在音频流配置正确后，仍无法满足音频播放体验时，开发者可通过AudioSession采用自定义焦点模式。</li><li>监听系统发出的中断事件，通过中断事件信息作出相应业务处理。</li></ol> </div> <div class="tiledSection"><h3 id="section16381186101113">音频流类型正确配置<i class="anchor-icon anchor-icon-link" anchorid="section16381186101113" tips="复制节点链接"></i></h3><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/audio-kit-intro#音频流介绍" target="_blank">音频流</a>类型是定义音频数据播放和录制方式的关键属性。</p> <ul><li><strong>播放场景</strong><ul><li>音频播放场景的信息，可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-e#streamusage" target="_blank">StreamUsage</a>进行描述。</li><li>StreamUsage指音频流本身的用途类型，包括媒体、语音通信、语音播报、通知、铃声等。</li></ul> </li><li><strong>录制场景</strong><ul><li>音频流录制场景的信息，可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-e#sourcetype8" target="_blank">SourceType</a>进行描述。</li><li>SourceType指音频流中录音源的类型，包括麦克风音频源、语音识别音频源、语音通话音频源等。</li></ul> </li></ul> <p>在系统机制中，音频流类型对业务的影响有：<strong>音频焦点策略调整</strong>、<strong>音频音量控制</strong>、<strong>音频输入/输出设备选择</strong>以及<strong>音频音效管理</strong>等。</p> <p>上文提到，为确保音频播放效果符合预期，开发者需要在创建音频流时配置正确的音频流类型。系统会根据音频流类型默认执行相应中断策略，如果配置错了类型，可能会导致音频播放体验与用户预期不符，进而产生音频播放体验不佳的感受。</p> <p>以前台导航音频和后台音乐音频冲突场景举例，用户的预期体验是，导航语音播放时会压低后台音乐音量，在导航语音播放完毕后恢复后台音乐音量。如果开发者将导航类应用的音频流类型错误设置为STREAM_USAGE_MUSIC（音乐类型），那在播放导航语音时，会停止后台音乐的播放，使其释放焦点。并且在语音播放完毕后不会恢复音乐播放，导致用户后台音乐播放体验中断。</p> <p><strong>音频流类型对音频焦点策略的影响原理</strong></p> <p>系统根据先播和后播音频流类型，查询<a href="/consumer/cn/doc/best-practices/bpta-audio-focus-management#section123975612118">默认策略表</a>。不同策略对应着不同的焦点处理方式，具体如下流程图：</p> <p></p> <p><span><img height="497.814345" originheight="686" originwidth="1248" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163037.92080164021580791307977780198742:50001231000000:2800:87161849AA417E8EA94F058ED4DDD674E9B245182DBD0AEAF7C1887BD8090C33.png" title="点击放大" width="888.96003"></span></p> <p><strong>音频流类型设置方法</strong></p> <p>应用可采用多种方法实现音频播放或录音功能，比如<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/using-audiorenderer-for-playback" target="_blank">AudioRenderer</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/using-ohaudio-for-playback" target="_blank">OHAudio</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/using-avplayer-for-playback" target="_blank">AVPlayer</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/using-soundpool-for-playback" target="_blank">SoundPool</a>等。因此，设置音频流类型的方式也各不相同。比如，当开发者<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/using-audiorenderer-for-playback" target="_blank">使用AudioRenderer开发音频播放功能</a>时，可以在调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-f#audiocreateaudiorenderer8" target="_blank">createAudioRenderer</a>时，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-e#streamusage" target="_blank">StreamUsage</a>来设置音频流类型。具体代码细节可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/using-audiorenderer-for-playback#完整示例" target="_blank">使用AudioRenderer开发音频播放功能</a>。另外，更多正确设置音频流类型的方法和详细细节，可以参考指南<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/using-right-streamusage-and-sourcetype#设置音频流类型" target="_blank">使用合适的音频流类型</a>。</p> <p><strong>音频流类型与典型业务场景映射表</strong></p> <p>为了开发者能够更好地选择正确的音频流类型，本文提供了常见音频流以及对应业务场景映射表以供参考。开发者也可以根据音频流类型，查询对应的<a href="/consumer/cn/doc/best-practices/bpta-audio-focus-management#section123975612118">系统默认策略</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table id="table838220651115" class="layoutFixed idpTab"><tbody><tr><td class="cellrowborder" valign="top" width="50%"><p><strong>音频流类型</strong></p> </td> <td class="cellrowborder" valign="top" width="50%"><p><strong>典型业务场景</strong></p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>STREAM_USAGE_MUSIC</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>音乐播放、游戏音效</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>STREAM_USAGE_MOVIE</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>电视、电影、短视频、广告、直播、Web页面（比如商品详情介绍视频）</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>STREAM_USAGE_AUDIOBOOK</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>有声读物（听书、相声、评书等）、听新闻、播客</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>STREAM_USAGE_GAME</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>适用于游戏内配乐、配音，后台音乐不会被中断；游戏内语音，建议使用STREAM_USAGE_VOICE_COMMUNICATION</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>STREAM_USAGE_NAVIGATION</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>导航语音</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>STREAM_USAGE_VOICE_MESSAGE</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>语音消息（即时通讯软件、论坛等），比如语音消息</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>STREAM_USAGE_VOICE_ASSISTANT</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>语音播报，比如滴滴打车</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>STREAM_USAGE_ACCESSIBILITY</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>无障碍（听障辅助等）</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>STREAM_USAGE_VOICE_COMMUNICATION</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>VoIP语音通话，比如游戏内语音交流、微信语音通话</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>STREAM_USAGE_VIDEO_COMMUNICATION</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>VoIP视频通话，比如微信视频通话</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>STREAM_USAGE_ALARM</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>闹钟播放</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>STREAM_USAGE_RINGTONE</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>VoIP来电铃声，比如微信电话来电响铃</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>STREAM_USAGE_NOTIFICATION</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>应用消息通知音/提示音播放</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h3 id="section14383666111">自定义焦点策略设置<i class="anchor-icon anchor-icon-link" anchorid="section14383666111" tips="复制节点链接"></i></h3><p>对于多音频流并发冲突的场景，系统虽然提供了统一的音频焦点管理机制进行协调，但是默认策略不一定能满足所有业务场景。</p> <p>如：以新闻或者公众号文章中的内嵌短视频播放中断后台音乐场景为例，短视频音频流类型正确配置为STREAM_USAGE_MOVIE，按照系统默认策略为停止后台音乐播放，且短视频播放结束后后台音乐不恢复播放。但事实上该场景用户更好的音频播放体验应为短视频播放结束后后台音乐恢复播放，从这个例子可以发现开发者有精细化管理音频焦点策略的场景。</p> <p>针对上述场景中系统默认策略与用户预期策略不一致的情况，系统提供了音频会话（AudioSession）机制，以便开发者自定义焦点策略。AudioSession将在系统默认策略的基础上，进行适当的策略调整。例如，将“音频A stop 音频B”调整为“音频A pause 音频B”。</p> <p>AudioSession提供的四种会话策略（即自定义焦点策略），具体如下：</p> <ol><li><strong>默认模式（CONCURRENCY_DEFAULT）：</strong>即系统默认的音频焦点策略。</li><li><strong>并发模式（CONCURRENCY_MIX_WITH_OTHERS）：</strong>和其他音频流并发。</li><li><strong>降低音量模式（CONCURRENCY_DUCK_OTHERS）：</strong>和其他音频流并发，并且降低其他音频流的音量。</li><li><strong>暂停模式（CONCURRENCY_PAUSE_OTHERS）：</strong>暂停其他音频流，待释放焦点后通知其他音频流恢复。</li></ol> <p><strong>自定义策略原理</strong></p> <p>AudioSession的自定义焦点策略原理主要通过降低音频流优先级在<a href="/consumer/cn/doc/best-practices/bpta-audio-focus-management#section123975612118">系统默认策略</a>上进行调整的。比如音频A stop 音频B，说明音频A优先级大于音频B优先级，此时开发者可以降低音频A优先级，自定义焦点策略为并发模式，使其能够与音频B进行并发播放。其原理流程图如下：</p> <p></p> <p><span><img height="633.474345" originheight="702" originwidth="1016" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163037.94950271231671511016207172394061:50001231000000:2800:8584310AEC1F4559C186DD75DAE868BBF3751BFB26E8C3909F3E2ABC0927E39D.png" title="点击放大" width="911.8566450000001"></span></p> <p>以上文的内嵌短视频播放中断后台音乐场景为例，短视频音频流类型为STREAM_USAGE_MOVIE，后台音乐音频流类型为STREAM_USAGE_MUSIC，系统默认策略为Stop模式，用户预期策略为Pause模式</p> <ol><li>第一步，判断后台音乐的焦点策略是否为mix（mix具有双向策略特点）。若为mix，则系统直接采取mix策略；</li><li>第二步，根据内嵌短视频和后台音乐音频流类型，查询默认策略为内嵌短视频Stop后台音乐。因此，内嵌短视频优先级高于后台音乐；</li><li>第三步，内嵌短视频的AudioSession会话策略为Pause模式，其优先级低于默认策略Stop模式，满足AudioSession调整原则；</li><li>最终，系统按照内嵌短视频Pause后台音乐的策略执行中断操作。</li></ol> <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content"><p><span style="color: rgb(73,73,73);">AudioSession自定义焦点策略的原则主要为以下2点：</span></p> <ol><li><span style="color: rgb(73,73,73);">无论先播还是后播，存在mix策略，则调整双向策略为mix；</span></li><li><span style="color: rgb(73,73,73);">不可通过提高优先级来调整策略。</span></li></ol> <p>因此，当应用通过AudioSession使用上述各种模式时，系统将尽量满足其焦点策略，并非所有场景能够保证完全满足。比如，使用CONCURRENCY_PAUSE_OTHERS模式时，STREAM_USAGE_MOVIE流申请音频焦点，如果STREAM_USAGE_MUSIC流正在播放，则STREAM_USAGE_MUSIC流会被暂停。此时，如果STREAM_USAGE_VOICE_COMMUNICATION流正在播放，则STREAM_USAGE_VOICE_COMMUNICATION流不会被暂停。</p> </div></div></div> <p>关于AudioSession的具体使用方法，可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/audio-session-management" target="_blank">AudioSession使用示例</a>，完成音频会话从创建到激活并监听的过程。</p> </div> <div class="tiledSection"><h3 id="section1338416621118">焦点中断事件正确处理<i class="anchor-icon anchor-icon-link" anchorid="section1338416621118" tips="复制节点链接"></i></h3><p>上文提到，为了达成用户预期播放体验，除了配置正确的音频流类型，开发者往往还需要监听并正确处理焦点中断事件。比如：</p> <ul><li>对于音视频类应用，当音频播放被中断后，需要在页面状态上有所调整，如播放按钮切换为暂停按钮、显示相应的提示消息等。</li><li>对于音频流恢复播放，如被暂停播放的后台音乐应用，需要应用自行监听系统传递的中断事件，在合适的时机恢复播放。</li></ul> <p>然而，处理焦点中断事件不是必选的，比如瞬时的按键音、提示音等等，一般只需配置正确的音频流类型即可。</p> <p>根据系统对于音频流播放冲突的处理方案，应用的音频流播放场景可以概括为四类：<em><strong>先暂停后恢复播放、先降低音量后恢复音量、停止后不恢复播放以及并发混音播放</strong></em>。</p> <p><strong>先暂停后恢复播放</strong></p> <ul><li><strong>场景描述</strong><ul><li>先播音频正常播放中，当后播音频类型为闹钟/电话/铃声时，先播音频暂停播放，待后播音频结束后，先播音频恢复播放。</li></ul> </li><li><strong>处理方式</strong><ul><li>当后播应用播放音频时，系统会强制暂停先播音频播放，先播应用会监听到音频中断类型为InterruptForceType.INTERRUPT_FORCE（强制中断），中断提示为InterruptHint.INTERRUPT_HINT_PAUSE（音频暂停）事件，然后需要刷新播放状态。值得注意的是，如果使用AVPlayer播放的话，那么播放状态不会自动变为暂停，先播应用需要主动调用AVPlayer的暂停接口来保证状态一致。</li><li>当后播应用音频结束后，先播应用会监听到中断类型为InterruptForceType.INTERRUPT_SHARE（共享中断），中断提示为InterruptHint.INTERRUPT_HINT_RESUME（音频恢复）事件，此时系统不会自动恢复先播音频播放，先播应用需要在相应的事件中主动调用AVPlayer的播放接口完成恢复。</li></ul> </li></ul> <p><strong>先降低音量后恢复音量</strong></p> <ul><li><strong>场景描述</strong><ul><li>先播音频正常播放中，当后播音频类型为导航/TextReader控件朗读语音/语音助手类短语音时，先播音频会降低音量持续播放，待后播音频结束后，先播音频音量恢复。</li></ul> </li></ul> <ul><li><strong>处理方式</strong><ul><li>当后播应用播放音频时，系统会强制降低先播音频音量，先播应用会监听到音频打断类型为InterruptForceType.INTERRUPT_FORCE（强制打断），中断提示为InterruptHint.INTERRUPT_HINT_DUCK（降低音量）事件，应用无需处理，如果应用想实现其他业务逻辑，可在相应的事件类型下进行处理。</li><li>当后播应用音频结束后，先播应用会监听到打断类型为InterruptForceType.INTERRUPT_FORCE（强制打断），中断提示为InterruptHint.INTERRUPT_HINT_UNDUCK（恢复音量）事件，此时系统会自动恢复先播音频音量，应用无需处理，如果应用想实现其他业务逻辑，可在相应的事件类型下进行处理。</li></ul> </li></ul> <p><strong>停止后不恢复播放</strong></p> <ul><li><strong>场景描述</strong><ul><li>先播音频正常播放中，当后播音频类型为音乐/视频/VoIP时，先播音频停止播放，待后播音频结束后，先播音频不会恢复。</li></ul> </li></ul> <ul><li><strong>处理方式</strong><ul><li>当后播应用播放音频时，系统会强制停止先播音频播放，先播应用会监听到音频打断类型为InterruptForceType.INTERRUPT_FORCE（强制打断），中断提示为InterruptHint.INTERRUPT_HINT_STOP（音频结束）事件，然后需要刷新播放状态。值得注意的是，如果使用AVPlayer播放的话，那么播放状态不会自动变为暂停，先播应用需要主动调用AVPlayer的暂停接口来保证状态一致。</li></ul> </li></ul> <p><strong>并发混音播放</strong></p> <ul><li><strong>场景描述</strong><ul><li>先播音频正常播放中，当后播音频类型为游戏/系统音效(锁屏/按键)时，先播应用会与后播应用并发播放。</li></ul> </li></ul> <ul><li><strong>处理方式</strong><ul><li>此场景为系统默认行为，应用无需适配。</li></ul> </li></ul> <p>不同的音频开发方式，对应的中断事件处理接口亦不相同。比如，以AudioRender播放音频为例，参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/audio-playback-concurrency#处理音频焦点变化" target="_blank">代码示例</a>来说明焦点中断事件处理方法。</p> </div> <div class="tiledSection"><h2 id="section18385136161118">问题分析<i class="anchor-icon anchor-icon-link" anchorid="section18385136161118" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section93850651112" class="firsth2">直播/广告被中断后不恢复问题<i class="anchor-icon anchor-icon-link" anchorid="section93850651112" tips="复制节点链接"></i></h3><p><strong>问题现象</strong></p> <p>直播/广告在播放过程中，被后播音乐中断，待后播音乐结束后，广告/直播将会停止不恢复或者无声播放。</p> <p><strong>分析思路</strong></p> <p>直播/广告的音频流类型一般为STREAM_USAGE_MOVIE。该音频流类型对应的系统默认焦点策略如下：</p> <ul><li>若后播音频为闹钟/运营商通话/VoIP通话/铃声/语音消息时，则直播/广告会被暂停，待后播音频流播放结束后，直播/广告恢复播放。</li><li>若后播音频为导航/语音播报/通知消息时，则直播/广告会被降低音量持续播放，待后播音频流播放结束后，直播/广告恢复音量持续播放。</li><li>若后播音频为音乐/视频/电子书时，则直播/广告会被停止，永久失焦。</li><li>若后播音频为游戏/系统音效（锁屏、按键音）时，则并发混音播放。</li></ul> <p>因此，根据系统默认的焦点策略，当后台播放的音频为STREAM_USAGE_MOVIE时，直播或广告将永久失焦。由于直播或广告视频页面中没有交互按钮，用户无法通过点击播放按钮来重新播放视频，因此，音频也无法重新获取焦点并恢复播放。</p> <p><strong>解决方案</strong></p> <p>针对上述场景，常见解决方案如下：</p> <ul><li>如果先播应用从后台切换到前台，开发者需要在生命周期方法onPageShow()中主动调用播放接口以恢复播放。具体参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-faqs/faqs-media-4" target="_blank">应用从后台切换到前台继续播放音频</a>。</li><li>如果先播应用在前台被stop，那么需要应用适配交互行为，让用户主动触发以恢复播放。<div class="screenLinkPre"><div _ngcontent-jtx-c106="" class="highlight-div"><div _ngcontent-jtx-c106="" class="highlight-div-header"><div _ngcontent-jtx-c106="" class="highlight-div-header-left"><div _ngcontent-jtx-c106="" class="handle-button expand-button"><div _ngcontent-jtx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jtx-c106="" class="highlight-div-header-right"><div _ngcontent-jtx-c106="" class="handle-button ai-button"></div><div _ngcontent-jtx-c106="" class="handle-button line-button"><div _ngcontent-jtx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jtx-c106="" class="handle-button theme-button"><div _ngcontent-jtx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jtx-c106="" class="handle-button copy-button"><div _ngcontent-jtx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jtx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/audio-focus/blob/master/entry/src/main/ets/videoscene/VideoScene.ets#L109-L118" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">XComponent</span>({</li><li>  <span class="hljs-variable">id</span>: <span class="hljs-string">'VideoPlayer'</span>,</li><li>  <span class="hljs-keyword">type</span>: <span class="hljs-title class_">XComponentType</span>.<span class="hljs-title class_">SURFACE</span>,</li><li>  <span class="hljs-variable">controller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">xComponentController</span></li><li>})</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  .<span class="hljs-title function_">onClick</span>(() =&gt; {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">avPlayerController</span>?.<span class="hljs-title function_">MediaPlay</span>();</li><li>  })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/audio-focus/blob/master/entry/src/main/ets/videoscene/VideoScene.ets#L109-L118" target="_blank">VideoScene.ets</a></div></div></div></div> </li></ul> </div> <div class="tiledSection"><h3 id="section938616611116">VoIP通话被中断后不恢复问题<i class="anchor-icon anchor-icon-link" anchorid="section938616611116" tips="复制节点链接"></i></h3><p><strong>问题现象</strong></p> <p>VoIP通话过程中，被后播音频中断，待后播音频结束后，VoIP音频不会恢复，即无声。</p> <p><strong>分析思路</strong></p> <p>VoIP通话场景中，播放对端通话声音的音频流类型应当设置为STREAM_USAGE_VOICE_COMMUNICATION。该音频流类型对应的系统默认焦点策略如下：</p> <ul><li>若后播音频为运营商通话/VoIP通话时，则先暂停VoIP通话，待后播音频结束后，VoIP通话恢复。</li><li>若后播音频为语言播报时，则后播音频申请焦点失败，不允许播放。</li><li>若后播音频为蜂窝铃声/VoIP铃声/导航播报/通知消息/运营商拨号声时，则并发混音播放。</li><li>若后播音频为语音消息/锁屏按键声/音频/视频/游戏声效/电子书播报/闹钟时，则降低后播音频音量，并发播放。</li></ul> <p>因此，从系统默认焦点策略来看，出现VoIP被中断不恢复的原因，主要有以下两个可能原因：</p> <ol><li><strong>音频流类型设置错误，导致系统默认策略错误。</strong>比如：<ul><li>当先播音频为VoIP通话，后播音频为运营商通话时，则：</li><li>若先播音频流类型为STREAM_USAGE_VOICE_COMMUNICATION，则系统默认策略为pause inprocessing，即先暂停先播音频，待后播音频结束后，先播音频恢复播放。</li><li>若先播音频流类型为STREAM_USAGE_VOICE_MESSAGE，则系统默认策略为stop inprocessing，即直接停止先播音频，使其永久失焦，待后播音频结束后，先播音频不恢复播放。</li></ul> </li><li><strong>应用未正确处理中断事件，导致音频中断不恢复。</strong><ul><li>恢复中断事件类型为InterruptForceType.INTERRUPT_SHARE（共享中断），该事件非强制性执行，系统不会自动恢复先播音频播放。当先播应用收到中断提示为InterruptHint.INTERRUPT_HINT_RESUME（音频恢复）时，需要主动在相应的事件中调用播放接口完成恢复。</li></ul> </li></ol> <p><strong>解决方案</strong></p> <p>针对上述可能导致音频中断不恢复的原因，相应提出以下解决方案：</p> <ol><li><strong>音频流类型设置解决方案</strong><ul><li>了解音频流类型与系统默认策略关联原理。</li><li>参考<a href="/consumer/cn/doc/best-practices/bpta-audio-focus-management#table838220651115">音频流类型与典型业务场景映射关系</a>，选择正确的音频流类型。</li><li>根据所用的音频开发方法，正确<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/using-right-streamusage-and-sourcetype#设置音频流类型" target="_blank">设置音频流类型</a>。<div class="screenLinkPre"><div _ngcontent-jtx-c106="" class="highlight-div"><div _ngcontent-jtx-c106="" class="highlight-div-header"><div _ngcontent-jtx-c106="" class="highlight-div-header-left"><div _ngcontent-jtx-c106="" class="handle-button expand-button"><div _ngcontent-jtx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jtx-c106="" class="highlight-div-header-right"><div _ngcontent-jtx-c106="" class="handle-button ai-button"></div><div _ngcontent-jtx-c106="" class="handle-button line-button"><div _ngcontent-jtx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jtx-c106="" class="handle-button theme-button"><div _ngcontent-jtx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jtx-c106="" class="handle-button copy-button"><div _ngcontent-jtx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jtx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/audio-focus/blob/master/entry/src/main/ets/voipscene/VoIPScene.ets#L70-L79" data-highlighted="yes"><ol class="linenums"><li>async initAVResource() {</li><li>  <span class="hljs-comment">// Create an instance of AudioRenderer and set the audio stream type to STREAM_USAGE_VOICE_COMMUNICATION</span></li><li>  <span class="hljs-keyword">this</span>.audioRenderController.createAndInitAudioRender(<span class="hljs-keyword">this</span>.avSessionController, <span class="hljs-keyword">this</span>.renderFileName,</li><li>    audio.StreamUsage.STREAM_USAGE_VOICE_COMMUNICATION);</li><li>  <span class="hljs-comment">// Create an AudioRCapturer instance and set the audio stream type to SOURCE_TYPE_VOICE_COMMUNICATION</span></li><li>  <span class="hljs-keyword">this</span>.audioCapturerController.createAndInitAudioCapturer(<span class="hljs-keyword">this</span>.avSessionController, <span class="hljs-keyword">this</span>.captureFileName,</li><li>    audio.SourceType.SOURCE_TYPE_VOICE_COMMUNICATION);</li><li>  Logger.info(<span class="hljs-string">'initAVResource SUCCESS'</span>);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/audio-focus/blob/master/entry/src/main/ets/voipscene/VoIPScene.ets#L70-L79" target="_blank">VoIPScene.ets</a></div></div></div></div> <div class="screenLinkPre"><div _ngcontent-jtx-c106="" class="highlight-div"><div _ngcontent-jtx-c106="" class="highlight-div-header"><div _ngcontent-jtx-c106="" class="highlight-div-header-left"><div _ngcontent-jtx-c106="" class="handle-button expand-button"><div _ngcontent-jtx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jtx-c106="" class="highlight-div-header-right"><div _ngcontent-jtx-c106="" class="handle-button ai-button"></div><div _ngcontent-jtx-c106="" class="handle-button line-button"><div _ngcontent-jtx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jtx-c106="" class="handle-button theme-button"><div _ngcontent-jtx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jtx-c106="" class="handle-button copy-button"><div _ngcontent-jtx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jtx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/audio-focus/blob/master/entry/src/main/ets/commonutils/AudioRenderController.ets#L35-L72" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">async</span> <span class="hljs-title function_">createAndInitAudioRender</span>(</li><li>  <span class="hljs-variable">avSessionController</span>: <span class="hljs-title class_">AVSessionController</span>, <span class="hljs-variable">audioUrl</span>: <span class="hljs-title class_">string</span>, <span class="hljs-variable">mediaUsage</span>: <span class="hljs-title class_">audio</span>.<span class="hljs-title class_">StreamUsage</span>) {</li><li>  <span class="hljs-comment">// Set up AVSession</span></li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-variable">avSessionController</span> = <span class="hljs-variable">avSessionController</span>;</li><li>  <span class="hljs-comment">// Set the audio encoding information</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">audioStreamInfo</span>: <span class="hljs-title class_">audio</span>.<span class="hljs-title class_">AudioStreamInfo</span> = {</li><li>    <span class="hljs-variable">samplingRate</span>: <span class="hljs-title class_">audio</span>.<span class="hljs-title class_">AudioSamplingRate</span>.<span class="hljs-title class_">SAMPLE_RATE_48000</span>,</li><li>    <span class="hljs-variable">channels</span>: <span class="hljs-title class_">audio</span>.<span class="hljs-title class_">AudioChannel</span>.<span class="hljs-title class_">CHANNEL_2</span>,</li><li>    <span class="hljs-variable">sampleFormat</span>: <span class="hljs-title class_">audio</span>.<span class="hljs-title class_">AudioSampleFormat</span>.<span class="hljs-title class_">SAMPLE_FORMAT_S16LE</span>,</li><li>    <span class="hljs-variable">encodingType</span>: <span class="hljs-title class_">audio</span>.<span class="hljs-title class_">AudioEncodingType</span>.<span class="hljs-title class_">ENCODING_TYPE_RAW</span></li><li>  };</li><li>  <span class="hljs-comment">// Set the audio stream type</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">audioRendererInfo</span>: <span class="hljs-title class_">audio</span>.<span class="hljs-title class_">AudioRendererInfo</span> = {</li><li>    <span class="hljs-variable">usage</span>: <span class="hljs-title class_">mediaUsage</span>,</li><li>    <span class="hljs-variable">rendererFlags</span>: <span class="hljs-number">0</span></li><li>  };</li><li>
</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">audioRendererOptions</span>: <span class="hljs-title class_">audio</span>.<span class="hljs-title class_">AudioRendererOptions</span> = {</li><li>    <span class="hljs-variable">streamInfo</span>: <span class="hljs-title class_">audioStreamInfo</span>,</li><li>    <span class="hljs-variable">rendererInfo</span>: <span class="hljs-title class_">audioRendererInfo</span></li><li>  };</li><li>  <span class="hljs-comment">// Create an AudioRender instance</span></li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-variable">audioRenderer</span> = <span class="hljs-variable">await</span> <span class="hljs-variable">audio</span>.<span class="hljs-title function_">createAudioRenderer</span>(<span class="hljs-variable">audioRendererOptions</span>);</li><li>  <span class="hljs-variable">await</span> <span class="hljs-keyword">this</span>.<span class="hljs-title function_">setAudioFdSrcByName</span>(<span class="hljs-variable">audioUrl</span>);</li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-title function_">setWriteDataCallback</span>();</li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-title function_">setAudioStateChangeCallBack</span>();</li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-title function_">setAudioInterruptCallBack</span>();</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">playbackState</span>: <span class="hljs-title class_">avSession</span>.<span class="hljs-title class_">AVPlaybackState</span> = {</li><li>    <span class="hljs-variable">state</span>: <span class="hljs-title class_">avSession</span>.<span class="hljs-title class_">PlaybackState</span>.<span class="hljs-title class_">PLAYBACK_STATE_PAUSE</span>,</li><li>    <span class="hljs-variable">loopMode</span>: <span class="hljs-title class_">avSession</span>.<span class="hljs-title class_">LoopMode</span>.<span class="hljs-title class_">LOOP_MODE_SINGLE</span></li><li>  };</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-variable">await</span> <span class="hljs-keyword">this</span>.<span class="hljs-variable">avSessionController</span>?.<span class="hljs-variable">session</span>?.<span class="hljs-title function_">setAVPlaybackState</span>(<span class="hljs-variable">playbackState</span>);</li><li>  } <span class="hljs-keyword">catch</span> (<span class="hljs-variable">error</span>) {</li><li>    <span class="hljs-variable">Logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable">TAG</span>, `<span class="hljs-variable">setAVPlaybackState</span> <span class="hljs-variable">fail</span>. <span class="hljs-variable">code</span> <span class="hljs-keyword">is</span> ${<span class="hljs-variable">error</span>.<span class="hljs-variable">code</span>}, <span class="hljs-variable">error</span> <span class="hljs-variable">message</span> <span class="hljs-keyword">is</span> ${<span class="hljs-variable">error</span>.<span class="hljs-variable">message</span>}`);</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/audio-focus/blob/master/entry/src/main/ets/commonutils/AudioRenderController.ets#L35-L72" target="_blank">AudioRenderController.ets</a></div></div></div></div> <div class="screenLinkPre"><div _ngcontent-jtx-c106="" class="highlight-div"><div _ngcontent-jtx-c106="" class="highlight-div-header"><div _ngcontent-jtx-c106="" class="highlight-div-header-left"><div _ngcontent-jtx-c106="" class="handle-button expand-button"><div _ngcontent-jtx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jtx-c106="" class="highlight-div-header-right"><div _ngcontent-jtx-c106="" class="handle-button ai-button"></div><div _ngcontent-jtx-c106="" class="handle-button line-button"><div _ngcontent-jtx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jtx-c106="" class="handle-button theme-button"><div _ngcontent-jtx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jtx-c106="" class="handle-button copy-button"><div _ngcontent-jtx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jtx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/audio-focus/blob/master/entry/src/main/ets/commonutils/AudioCapturerController.ets#L35-L72" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">async</span> <span class="hljs-title function_">createAndInitAudioCapturer</span>(</li><li>  <span class="hljs-variable">avSessionController</span>: <span class="hljs-title class_">AVSessionController</span>, <span class="hljs-variable">audioName</span>: <span class="hljs-title class_">string</span>, <span class="hljs-variable">sourceType</span>: <span class="hljs-title class_">audio</span>.<span class="hljs-title class_">SourceType</span>) {</li><li>  <span class="hljs-comment">// Set up AVSession</span></li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-variable">avSessionController</span> = <span class="hljs-variable">avSessionController</span>;</li><li>  <span class="hljs-comment">// Set the audio encoding information</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">audioStreamInfo</span>: <span class="hljs-title class_">audio</span>.<span class="hljs-title class_">AudioStreamInfo</span> = {</li><li>    <span class="hljs-variable">samplingRate</span>: <span class="hljs-title class_">audio</span>.<span class="hljs-title class_">AudioSamplingRate</span>.<span class="hljs-title class_">SAMPLE_RATE_48000</span>,</li><li>    <span class="hljs-variable">channels</span>: <span class="hljs-title class_">audio</span>.<span class="hljs-title class_">AudioChannel</span>.<span class="hljs-title class_">CHANNEL_2</span>,</li><li>    <span class="hljs-variable">sampleFormat</span>: <span class="hljs-title class_">audio</span>.<span class="hljs-title class_">AudioSampleFormat</span>.<span class="hljs-title class_">SAMPLE_FORMAT_S16LE</span>,</li><li>    <span class="hljs-variable">encodingType</span>: <span class="hljs-title class_">audio</span>.<span class="hljs-title class_">AudioEncodingType</span>.<span class="hljs-title class_">ENCODING_TYPE_RAW</span></li><li>  };</li><li>  <span class="hljs-comment">// Set the audio stream type</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">audioCapturerInfo</span>: <span class="hljs-title class_">audio</span>.<span class="hljs-title class_">AudioCapturerInfo</span> = {</li><li>    <span class="hljs-variable">source</span>: <span class="hljs-title class_">sourceType</span>,</li><li>    <span class="hljs-variable">capturerFlags</span>: <span class="hljs-number">0</span></li><li>  };</li><li>
</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">audioCapturerOptions</span>: <span class="hljs-title class_">audio</span>.<span class="hljs-title class_">AudioCapturerOptions</span> = {</li><li>    <span class="hljs-variable">streamInfo</span>: <span class="hljs-title class_">audioStreamInfo</span>,</li><li>    <span class="hljs-variable">capturerInfo</span>: <span class="hljs-title class_">audioCapturerInfo</span></li><li>  };</li><li>  <span class="hljs-comment">// Create an AudioCapturer instance</span></li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-variable">audioCapturer</span> = <span class="hljs-variable">await</span> <span class="hljs-variable">audio</span>.<span class="hljs-title function_">createAudioCapturer</span>(<span class="hljs-variable">audioCapturerOptions</span>);</li><li>  <span class="hljs-variable">await</span> <span class="hljs-keyword">this</span>.<span class="hljs-title function_">setAudioFdSrcByName</span>(<span class="hljs-variable">audioName</span>);</li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-title function_">setReadDataCallback</span>();</li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-title function_">setAudioStateChangeCallBack</span>();</li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-title function_">setAudioInterruptCallBack</span>();</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">playbackState</span>: <span class="hljs-title class_">avSession</span>.<span class="hljs-title class_">AVPlaybackState</span> = {</li><li>    <span class="hljs-variable">state</span>: <span class="hljs-title class_">avSession</span>.<span class="hljs-title class_">PlaybackState</span>.<span class="hljs-title class_">PLAYBACK_STATE_PAUSE</span>,</li><li>    <span class="hljs-variable">loopMode</span>: <span class="hljs-title class_">avSession</span>.<span class="hljs-title class_">LoopMode</span>.<span class="hljs-title class_">LOOP_MODE_SINGLE</span></li><li>  };</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-variable">await</span> <span class="hljs-keyword">this</span>.<span class="hljs-variable">avSessionController</span>?.<span class="hljs-variable">session</span>?.<span class="hljs-title function_">setAVPlaybackState</span>(<span class="hljs-variable">playbackState</span>);</li><li>  } <span class="hljs-keyword">catch</span> (<span class="hljs-variable">error</span>) {</li><li>    <span class="hljs-variable">Logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable">TAG</span>, `<span class="hljs-variable">setAVPlaybackState</span> <span class="hljs-variable">failed</span>, <span class="hljs-variable">code</span> <span class="hljs-keyword">is</span> ${<span class="hljs-variable">error</span>.<span class="hljs-variable">code</span>}, <span class="hljs-variable">message</span> <span class="hljs-keyword">is</span> ${<span class="hljs-variable">error</span>.<span class="hljs-variable">message</span>}}`);</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/audio-focus/blob/master/entry/src/main/ets/commonutils/AudioCapturerController.ets#L35-L72" target="_blank">AudioCapturerController.ets</a></div></div></div></div> </li></ul> </li><li><strong>焦点中断事件处理解决方案</strong><ul><li>由于恢复事件属于非强制类型，系统不会自动恢复先播音频播放。先播应用收到中断提示为InterruptHint.INTERRUPT_HINT_RESUME（音频恢复）后，需要主动在相应的事件中调用播放接口完成恢复。具体操作参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/audio-playback-concurrency#处理音频焦点变化" target="_blank">焦点中断事件处理示例</a>。<div class="screenLinkPre"><div _ngcontent-jtx-c106="" class="highlight-div"><div _ngcontent-jtx-c106="" class="highlight-div-header"><div _ngcontent-jtx-c106="" class="highlight-div-header-left"><div _ngcontent-jtx-c106="" class="handle-button expand-button"><div _ngcontent-jtx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jtx-c106="" class="highlight-div-header-right"><div _ngcontent-jtx-c106="" class="handle-button ai-button"></div><div _ngcontent-jtx-c106="" class="handle-button line-button"><div _ngcontent-jtx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jtx-c106="" class="handle-button theme-button"><div _ngcontent-jtx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jtx-c106="" class="handle-button copy-button"><div _ngcontent-jtx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jtx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/audio-focus/blob/master/entry/src/main/ets/commonutils/AudioRenderController.ets#L145-L174" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">setAudioInterruptCallBack</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">audioRenderer</span>) {</li><li>    <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'set interrupt callback failed, audioRenderer is null.'</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'setAudioInterruptCallBack.'</span>);</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">audioRenderer</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'audioInterrupt'</span>, <span class="hljs-keyword">async</span> (<span class="hljs-attr">interruptInfo</span>: audio.<span class="hljs-property">InterruptEvent</span>) =&gt; {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">playbackState</span>: avSession.<span class="hljs-property">AVPlaybackState</span> = {</li><li>        <span class="hljs-attr">state</span>: avSession.<span class="hljs-property">PlaybackState</span>.<span class="hljs-property">PLAYBACK_STATE_PLAY</span>,</li><li>        <span class="hljs-attr">loopMode</span>: avSession.<span class="hljs-property">LoopMode</span>.<span class="hljs-property">LOOP_MODE_SINGLE</span></li><li>      };</li><li>      <span class="hljs-keyword">if</span> (interruptInfo.<span class="hljs-property">forceType</span> === audio.<span class="hljs-property">InterruptForceType</span>.<span class="hljs-property">INTERRUPT_SHARE</span> &amp;&amp;</li><li>        interruptInfo.<span class="hljs-property">hintType</span> === audio.<span class="hljs-property">InterruptHint</span>.<span class="hljs-property">INTERRUPT_HINT_RESUME</span>) {</li><li>        <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'audio resume play.'</span>);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">audioRenderer</span>?.<span class="hljs-title function_">start</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`audio resume failed,code is <span class="hljs-subst">${err.code}</span>,message is <span class="hljs-subst">${err.message}</span>}`</span>);</li><li>        })</li><li>      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (interruptInfo.<span class="hljs-property">forceType</span> === audio.<span class="hljs-property">InterruptForceType</span>.<span class="hljs-property">INTERRUPT_FORCE</span> &amp;&amp;</li><li>        (interruptInfo.<span class="hljs-property">hintType</span> === audio.<span class="hljs-property">InterruptHint</span>.<span class="hljs-property">INTERRUPT_HINT_PAUSE</span> ||</li><li>          interruptInfo.<span class="hljs-property">hintType</span> === audio.<span class="hljs-property">InterruptHint</span>.<span class="hljs-property">INTERRUPT_HINT_STOP</span>)) {</li><li>        playbackState.<span class="hljs-property">state</span> = avSession.<span class="hljs-property">PlaybackState</span>.<span class="hljs-property">PLAYBACK_STATE_PAUSE</span>;</li><li>      }</li><li>      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">avSessionController</span>?.<span class="hljs-property">session</span>?.<span class="hljs-title function_">setAVPlaybackState</span>(playbackState);</li><li>    })</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`setAudioInterruptCallBack fail. code is <span class="hljs-subst">${error.code}</span>, error message is <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/audio-focus/blob/master/entry/src/main/ets/commonutils/AudioRenderController.ets#L145-L174" target="_blank">AudioRenderController.ets</a></div></div></div></div> </li></ul> </li></ol> </div> <div class="tiledSection"><h3 id="section1738816631110">信息流内嵌短视频中断先播音频不恢复问题<i class="anchor-icon anchor-icon-link" anchorid="section1738816631110" tips="复制节点链接"></i></h3><p><strong>问题现象</strong></p> <p>信息流内嵌短视频是指新闻、公众号文章等内部的短视频。若后播音频为信息流内嵌短视频，中断先播音频后，不使其恢复播放。</p> <p><strong>分析思路</strong></p> <p>信息流内嵌短视频的音频流类型一般为STREAM_USAGE_MOVIE。该音频流类型对应的系统默认焦点策略如下：</p> <ul><li>若先播音频为短视频，后播音频为闹钟/运营商通话/VoIP通话/铃声时，则短视频会被暂停，待后播音频流播放结束后，视频恢复播放。</li><li>若先播音频为短视频，后播音频为导航/语音播报/通知消息时，则短视频会被降低音量持续播放，待后播音频流播放结束后，视频恢复音量持续播放。</li><li>若先播音频为短视频，后播音频为音乐/视频/电子书时，则短视频会被停止，永久失焦。</li><li>若先播音频为短视频，后播音频为游戏/系统音效（锁屏、按键音）时，则并发混音播放。</li><li>若后播音频为短视频时，则会中断STREAM_USAGE_MUSIC、STREAM_USAGE_MOVIE、STREAM_USAGE_AUDIOBOOK等类型的先播音频，且不会使其恢复播放。</li></ul> <p>因此，从系统默认焦点策略来看，当其中断先播音频后，待其结束时，是不会恢复先播音频播放的。在该问题中，系统默认策略不符合用户播放预期。比如，先播音频为音乐，其音频流类型设置为STREAM_USAGE_MUSIC。后播音频为新闻内嵌短视频，其音频流类型设置为STREAM_USAGE_MOVIE。</p> <ul><li>系统默认策略为stop inprocessing，即直接停止先播音频，使其永久失焦，待后播音频结束后，先播音频不恢复播放。</li><li>用户预期策略为pause inprocessing，即先暂停先播音频，待后播音频结束后，先播音频恢复播放。</li></ul> <p><strong>解决方案</strong></p> <p>短视频应该配置的音频流类型是STREAM_USAGE_MOVIE，根据所用的音频开发方法，正确<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/using-right-streamusage-and-sourcetype#设置音频流类型" target="_blank">设置音频流类型</a>。</p> <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content"><ul><li>如果使用AVPlayer进行短视频应用开发，可以通过设置AVPlayer的属性audioRenderInfo来设置音频流类型。</li><li>如果未主动设置该属性，AVPlayer将默认使用STREAM_USAGE_MUSIC类型。但是，当媒体源包含视频时，默认值为STREAM_USAGE_MOVIE。</li></ul> </div></div></div> <p>后播音频流是内嵌在信息流中的短视频，比如新闻、公众号文章中插入的短视频。当先播音频流类型为STREAM_USAGE_MUSIC、STREAM_USAGE_MOVIE、STREAM_USAGE_AUDIOBOOK时，用户一般期望在短视频播放完毕后，先播音频能恢复播放。此时系统的默认音频焦点策略不能解决这个问题，需要使用AudioSession进行自定义焦点策略。</p> <ul><li>根据业务需求，选择适当的<a href="/consumer/cn/doc/best-practices/bpta-audio-focus-management#section14383666111">音频会话（AudioSession）策略</a>以满足用户播放预期。对于该场景，应选择暂停其他任务（CONCURRENCY_PAUSE_OTHERS）策略。</li><li>参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/audio-session-management" target="_blank">AudioSession开发音频播放</a>进行业务实现。<div class="screenLinkPre"><div _ngcontent-jtx-c106="" class="highlight-div"><div _ngcontent-jtx-c106="" class="highlight-div-header"><div _ngcontent-jtx-c106="" class="highlight-div-header-left"><div _ngcontent-jtx-c106="" class="handle-button expand-button"><div _ngcontent-jtx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jtx-c106="" class="highlight-div-header-right"><div _ngcontent-jtx-c106="" class="handle-button ai-button"></div><div _ngcontent-jtx-c106="" class="handle-button line-button"><div _ngcontent-jtx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jtx-c106="" class="handle-button theme-button"><div _ngcontent-jtx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jtx-c106="" class="handle-button copy-button"><div _ngcontent-jtx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jtx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/audio-focus/blob/master/entry/src/main/ets/videoscene/VideoScene.ets#L60-L84" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-title function_">initAVResource</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-comment">// Set audio concurrency mode</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">strategy</span>: audio.<span class="hljs-property">AudioSessionStrategy</span> = {</li><li>    <span class="hljs-attr">concurrencyMode</span>: <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'audioConcurrencyMode'</span>) <span class="hljs-keyword">as</span> audio.<span class="hljs-property">AudioConcurrencyMode</span></li><li>  };</li><li>  <span class="hljs-comment">// Activate audio session</span></li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">audioSessionManager</span>.<span class="hljs-title function_">activateAudioSession</span>(strategy).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'activateAudioSession SUCCESS'</span>);</li><li>    });</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`activateAudioSession failed,code is <span class="hljs-subst">${error.code}</span>,message is <span class="hljs-subst">${error.message}</span>}`</span>);</li><li>  }</li><li>  <span class="hljs-comment">// Create an AVSession instance</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">videoMetadata</span>: avSession.<span class="hljs-property">AVMetadata</span> = { <span class="hljs-attr">assetId</span>: <span class="hljs-string">'0'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'video'</span>, <span class="hljs-attr">artist</span>: <span class="hljs-string">'none'</span> }</li><li>  <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">avSessionController</span>.<span class="hljs-title function_">createAndActiveSession</span>(videoMetadata, <span class="hljs-string">'EntryAbility'</span>, <span class="hljs-string">'video'</span>);</li><li>  <span class="hljs-comment">// Create AVPlayer instance</span></li><li>  <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">avPlayerController</span>.<span class="hljs-title function_">createAndActiveAVPlayer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">avSessionController</span>,</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">xComponentController</span>.<span class="hljs-title function_">getXComponentSurfaceId</span>(),</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">videoUrl</span>);</li><li>  <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">avSessionController</span>.<span class="hljs-title function_">registerSessionListener</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">avPlayerController</span>);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/audio-focus/blob/master/entry/src/main/ets/videoscene/VideoScene.ets#L60-L84" target="_blank">VideoScene.ets</a></div></div></div></div> </li></ul> </div> <div class="tiledSection"><h3 id="section1039066181117">短视频上下滑动间隙漏音问题<i class="anchor-icon anchor-icon-link" anchorid="section1039066181117" tips="复制节点链接"></i></h3><p><strong>问题现象</strong></p> <p>在短视频上下滑动过程中，会出现以下两种漏音场景：</p> <ol><li>后播音频为短视频，在滑动一半停止固定页面，出现漏音（先播音频声音）现象。</li><li>后播音频为短视频，在上下滑动间隙出现漏音（先播音频声音）现象。</li></ol> <p><strong>分析思路</strong></p> <p>该问题主要是因为上下两个短视频保持焦点不连贯，导致在滑动间隙后台音频重新获取焦点恢复播放。上文提到的音频会话（AudioSession）机制除了能够自定义焦点策略以外，还具有延迟焦点释放的功能。原理流程如下：</p> <p></p> <p><span><img height="833.9718450000001" originheight="898" originwidth="872" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163037.74286545203143753534940886986819:50001231000000:2800:5745E0764656852694E36808B794B44F998807E0920F2058EDD3145CD92F5317.png" title="点击放大" width="809.98596"></span></p> <ol><li>若AudioSession处于激活状态，应用的音频流全部停止时，不会立刻释放音频焦点，系统会保持音频焦点进入静默等待状态，直到音频会话停用或者该应用有新的音频流申请焦点。</li><li>若应用存在音频流处于运行状态，AudioSession停用后，不会立刻释放音频焦点，系统会保持音频焦点，直到应用所有音频流均停止。</li></ol> <p>因此，导致该问题的可能原因有以下两个：</p> <ol><li>未使用AudioSession机制来管控焦点，导致焦点不能延时释放，从而让后台音频有机会重获焦点恢复播放。</li><li>AudioSession使用时机不对。若保证焦点在短视频页面继续持有，应当基于页面级创建AudioSession会话，而非视频级AudioSession。若基于视频级创建AudioSession，则上下两个视频各自拥有独立的AudioSession实例。在上个视频滑过之后，该视频对应的AudioSession实例被停用，从而短视频应用失去焦点。</li></ol> <p><strong>解决方案</strong></p> <p>为了保持应用焦点的连贯性，系统提供了音频会话（AudioSession）机制来实现这个功能。基于AudioSession焦点释放机制原理，AudioSession激活状态下，音频焦点不会立刻释放，会有静默等待周期。具体操作如下：</p> <ul><li>根据业务需要，选择合适的<a href="/consumer/cn/doc/best-practices/bpta-audio-focus-management#section14383666111">音频会话（AudioSession）策略</a>以满足用户播放预期。针对该场景应当选择暂停模式（CONCURRENCY_PAUSE_OTHERS）策略。</li><li>参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/audio-session-management" target="_blank">AudioSession开发音频播放</a>进行页面级AudioSession业务实现。<div class="screenLinkPre"><div _ngcontent-jtx-c106="" class="highlight-div"><div _ngcontent-jtx-c106="" class="highlight-div-header"><div _ngcontent-jtx-c106="" class="highlight-div-header-left"><div _ngcontent-jtx-c106="" class="handle-button expand-button"><div _ngcontent-jtx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jtx-c106="" class="highlight-div-header-right"><div _ngcontent-jtx-c106="" class="handle-button ai-button"></div><div _ngcontent-jtx-c106="" class="handle-button line-button"><div _ngcontent-jtx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jtx-c106="" class="handle-button theme-button"><div _ngcontent-jtx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jtx-c106="" class="handle-button copy-button"><div _ngcontent-jtx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jtx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/audio-focus/blob/master/entry/src/main/ets/videoscene/VideoScene.ets#L38-L85" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">onDidBuild</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-comment">// Since the SurfaceID needs to be configured when the AVPlayer is initialized, the AVPlayer is initialized after the build is executed</span></li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initAVResource</span>();</li><li>}</li><li>
</li><li><span class="hljs-comment">// ...</span></li><li><span class="hljs-keyword">async</span> <span class="hljs-title function_">initAVResource</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-comment">// Set audio concurrency mode</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">strategy</span>: audio.<span class="hljs-property">AudioSessionStrategy</span> = {</li><li>    <span class="hljs-attr">concurrencyMode</span>: <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'audioConcurrencyMode'</span>) <span class="hljs-keyword">as</span> audio.<span class="hljs-property">AudioConcurrencyMode</span></li><li>  };</li><li>  <span class="hljs-comment">// Activate audio session</span></li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">audioSessionManager</span>.<span class="hljs-title function_">activateAudioSession</span>(strategy).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'activateAudioSession SUCCESS'</span>);</li><li>    });</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`activateAudioSession failed,code is <span class="hljs-subst">${error.code}</span>,message is <span class="hljs-subst">${error.message}</span>}`</span>);</li><li>  }</li><li>  <span class="hljs-comment">// Create an AVSession instance</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">videoMetadata</span>: avSession.<span class="hljs-property">AVMetadata</span> = { <span class="hljs-attr">assetId</span>: <span class="hljs-string">'0'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'video'</span>, <span class="hljs-attr">artist</span>: <span class="hljs-string">'none'</span> }</li><li>  <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">avSessionController</span>.<span class="hljs-title function_">createAndActiveSession</span>(videoMetadata, <span class="hljs-string">'EntryAbility'</span>, <span class="hljs-string">'video'</span>);</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/audio-focus/blob/master/entry/src/main/ets/videoscene/VideoScene.ets#L38-L85" target="_blank">VideoScene.ets</a></div></div></div></div> </li></ul> </div> <div class="tiledSection"><h3 id="section173914651114">短音中断先播音频不恢复问题<i class="anchor-icon anchor-icon-link" anchorid="section173914651114" tips="复制节点链接"></i></h3><p><strong>问题现象</strong></p> <p>先播音频类型为STREAM_USAGE_MUSIC，后播音频为短音，当后播音频抢占焦点后，先播音频停止播放，待后播音频结束后，先播音频不会恢复。</p> <p><strong>分析思路</strong></p> <p>短音类型一般包括闹钟、语音消息、通知消息等。短音类型不同，对应的音频流类型亦不同。建议闹钟对应STREAM_USAGE_ALARM、语音消息对应STREAM_USAGE_VOICE_MESSAGE、通知音对应STREAM_USAGE_NAVIGATION、动效音对应STREAM_USAGE_MUSIC。</p> <p>当先播音频流类型为STREAM_USAGE_MUSIC/STREAM_USAGE_MOVIE/STREAM_USAGE_GAME/STREAM_USAGE_AUDIOBOOK时，后播短音音频根据类型不同，系统默认焦点策略有所不同：</p> <ul><li>若短音类型为闹钟和语音消息时，则会先暂停先播音频。在短音播放结束后，先播音频会收到RESUME类型的焦点事件，并恢复播放。</li><li>若短音类型为通知音时，则会先暂时降低先播音频的音量，在通知音播放完毕后，恢复先播音频音量。</li><li>若短音类型为动效音时，若先播音频为STREAM_USAGE_MUSIC/STREAM_USAGE_MOVIE/STREAM_USAGE_AUDIOBOOK，则会先停止先播音频，使其永久失焦。在短音播放结束后，先播音频不能恢复播放。若先播音频为STREAM_USAGE_GAME时，则会并发混音播放。</li></ul> <p>根据系统默认策略来看，短音音频流优先级较低。一般当先播音频也为短音类型时，后播音频策略才为stop。</p> <p>因此，后播短音中断先播音频，使其不恢复的原因主要是以下两种：</p> <ol><li><strong>音频流类型设置错误，导致系统默认策略错误。</strong>比如，先播音频为音乐，其音频流类型设置为STREAM_USAGE_MUSIC。后播音频为闹钟。<ul><li>若后播音频流类型为STREAM_USAGE_ALARM，则系统默认策略为pause inprocessing，即先暂停先播音频，待后播音频结束后，先播音频恢复播放。</li><li>若后播音频流类型为STREAM_USAGE_MUSIC，则系统默认策略为stop inprocessing，即直接停止先播音频，使其永久失焦，待后播音频结束后，先播音频不恢复播放。</li></ul> </li><li><strong>系统默认策略不符合用户播放预期。</strong>比如，先播音频为音乐，其音频流类型设置为STREAM_USAGE_MUSIC。后播音频为动效音，其音频流类型设置为STREAM_USAGE_MUSIC。<ul><li>系统默认策略为stop inprocessing，即直接停止先播音频，使其永久失焦，待后播音频结束后，先播音频不恢复播放。</li><li>用户预期策略为pause inprocessing，即先暂停先播音频，待后播音频结束后，先播音频恢复播放。</li></ul> </li></ol> <p><strong>解决方案</strong></p> <ol><li><strong>音频流类型设置解决方案</strong><ul><li>了解音频流类型与系统默认策略关联原理。</li><li>参考<a href="/consumer/cn/doc/best-practices/bpta-audio-focus-management#table838220651115">音频流类型与典型业务场景映射关系</a>，选择正确的音频流类型。</li><li>根据所用的音频开发方法，正确<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/using-right-streamusage-and-sourcetype#设置音频流类型" target="_blank">设置音频流类型</a>。</li></ul> </li><li><strong>系统默认焦点策略不满足业务预期策略解决方案</strong><ul><li>使用AudioSession自定义焦点策略，根据业务需要，选择合适的<a href="/consumer/cn/doc/best-practices/bpta-audio-focus-management#section14383666111">音频会话（AudioSession）策略</a>以满足用户播放预期。</li><li>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/using-soundpool-for-playback" target="_blank">SoundPool开发音频播放功能</a>，且<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-e#streamusage" target="_blank">StreamUsage</a>指定为STREAM_USAGE_MUSIC、STREAM_USAGE_MOVIE、STREAM_USAGE_AUDIOBOOK等类型播放短音，则其申请焦点时默认为并发模式，不会影响其他音频。</li></ul> </li></ol> </div> <div class="tiledSection"><h3 id="section1239312661119">静音播放中断其他音频问题<i class="anchor-icon anchor-icon-link" anchorid="section1239312661119" tips="复制节点链接"></i></h3><p><strong>问题现象</strong></p> <p>音频静音播放，中断其他非静音播放的音频。</p> <p><strong>分析思路</strong></p> <p>音频静音播放应当满足以下两种场景：</p> <ol><li>当先播音频为静音播放时，不能影响后播音频申请焦点并正常播放。</li><li>当后播音频为静音播放时，不能中断先播音频。</li></ol> <p>若出现音频静音播放中断其他音频的现象，则主要是以下两种可能原因：</p> <ol><li>系统静音接口使用不当，导致静音音频不是并发策略。</li><li>若未使用系统静音接口，则音频焦点策略不对和音量控制不当，导致静音音频不是并发策略。</li></ol> <p><strong>解决方案</strong></p> <p>综上问题原因，针对音频静音播放中断其他音频的现象，有以下两种解决方案：</p> <ol><li>当使用系统静音并发接口开发时，该接口让应用以静音状态开始播放音频（或视频），并且静音阶段不影响其他音频，当后续解除静音的时候，再以正常策略申请音频焦点。各类音频开发方法中的静音接口如下：<ul><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/using-avplayer-for-playback" target="_blank">使用AVPlayer开发音频播放功能</a>，可以调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avplayer#setmediamuted12" target="_blank">setMediaMuted</a>函数。</li><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/using-audiorenderer-for-playback" target="_blank">使用AudioRenderer开发音频播放功能</a>，可调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiorenderer#setsilentmodeandmixwithothers12" target="_blank">setSilentModeAndMixWithOthers</a>函数。</li><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/using-ohaudio-for-playback" target="_blank">使用OHAudio开发音频播放功能</a>，可调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-audiorenderer-h#oh_audiorenderer_setsilentmodeandmixwithothers" target="_blank">OH_AudioRenderer_SetSilentModeAndMixWithOthers</a>函数。</li></ul> </li><li>当不使用系统静音接口开发时，则可以使用AudioSession自定义焦点策略为CONCURRENCY_MIX_WITH_OTHERS（并发模式），并手动设置自身应用音量为0即可。具体参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/audio-session-management" target="_blank">AudioSession开发音频播放</a>进行业务实现。</li></ol> </div> <div class="tiledSection"><h3 id="section16394136171112">游戏音效与其他音频冲突问题<i class="anchor-icon anchor-icon-link" anchorid="section16394136171112" tips="复制节点链接"></i></h3><p><strong>问题现象</strong></p> <p>游戏音频场景中，经常会出现如下问题：</p> <ul><li>游戏配乐、配音、动效声音中断后台音乐，预期是并发播放。</li><li>游戏语音中断后台音乐不恢复。</li></ul> <p><strong>分析思路</strong></p> <p>游戏场景的音频流类型选择需要取决于具体音效类型。比如游戏中的配乐、配音建议使用STREAM_USAGE_GAME类型，类似射击动效音建议使用STREAM_USAGE_MUSIC类型，游戏语音建议使用STREAM_USAGE_VOICE_COMMUNICATION。问题场景中，后台音乐类型为STREAM_USAGE_MUSIC，则系统默认焦点策略如下：</p> <ul><li>若游戏音频流类型为STREAM_USAGE_GAME时，则并发混音播放。</li><li>若游戏音频流类型为STREAM_USAGE_MUSIC时，则终止后台音乐，使其永久失焦，待游戏动效声音结束后，音乐不恢复播放。</li><li>若游戏音频流类型为STREAM_USAGE_VOICE_COMMUNICATION时，则暂时中断后台音乐，待游戏语音结束后，音乐恢复播放。</li></ul> <p>因此，从系统默认焦点策略来看，可能原因如下：</p> <ul><li><strong>游戏配乐、配音中断后台音乐，预期是并发播放，</strong>可参考上文<a href="/consumer/cn/doc/best-practices/bpta-audio-focus-management#section173914651114">短音中断场景分析思路</a><ul><li>音频流类型设置错误，导致系统默认策略错误。</li><li>系统默认策略不符合用户播放预期。</li></ul> </li><li><strong>游戏语音中断后台音乐不恢复</strong>，可参考上文<a href="/consumer/cn/doc/best-practices/bpta-audio-focus-management#section938616611116">VoIP通话场景分析思路</a><ul><li>音频流类型设置错误，导致系统默认策略错误。</li><li>应用未正确处理中断事件，导致音频中断不恢复。</li></ul> </li></ul> <p><strong>解决方案</strong></p> <p>综上问题原因，有以下解决方案：</p> <ol><li><strong>音频流类型设置解决方案</strong><ul><li>了解音频流类型与系统默认策略关联原理。</li><li>参考<a href="/consumer/cn/doc/best-practices/bpta-audio-focus-management#table838220651115">音频流类型与典型业务场景映射关系</a>，选择正确的音频流类型。</li><li>根据所用的音频开发方法，正确<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/using-right-streamusage-and-sourcetype#设置音频流类型" target="_blank">设置音频流类型</a>。</li></ul> </li><li><strong>游戏动效声音使用了STREAM_USAGE_MUSIC类型调整焦点策略方案</strong><ul><li>使用AudioSession自定义焦点策略，根据业务需要，选择合适的<a href="/consumer/cn/doc/best-practices/bpta-audio-focus-management#section14383666111">音频会话（AudioSession）策略</a>以满足用户播放预期。</li><li>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/using-soundpool-for-playback" target="_blank">SoundPool开发音频播放功能</a>，且<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-e#streamusage" target="_blank">StreamUsage</a>指定为STREAM_USAGE_MUSIC、STREAM_USAGE_MOVIE、STREAM_USAGE_AUDIOBOOK等类型播放短音，则其申请焦点时默认为并发模式，不会影响其他音频。</li></ul> </li><li><strong>焦点中断事件处理解决方案</strong><ul><li>由于恢复事件属于非强制类型，系统不会自动恢复先播音频播放。先播应用收到中断提示为InterruptHint.INTERRUPT_HINT_RESUME（音频恢复）后，需要主动在相应的事件中调用播放接口完成恢复。具体操作参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/audio-playback-concurrency#处理音频焦点变化" target="_blank">焦点中断事件处理示例</a>。</li></ul> </li></ol> </div> <div class="tiledSection"><h3 id="section9396963110">后台长时任务与音频焦点管理的问题<i class="anchor-icon anchor-icon-link" anchorid="section9396963110" tips="复制节点链接"></i></h3><p><strong>问题现象</strong></p> <p>（1）后台播放音频，自动停止播放，并偶现闪退。</p> <p>（2）后台播放过程中用户主动暂停，没有释放长时任务，应用进程被挂起。</p> <p><strong>分析思路</strong></p> <p>后台长时任务的申请和取消具有一定的运行限制。应用若不遵守规范接入，则将会被系统管控，比如静音冻结、进程挂起等。长时任务具体使用场景和运行限制，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/continuous-task#使用场景" target="_blank">后台长时任务使用场景和运行限制</a>。</p> <p><strong>解决方案</strong></p> <p>根据后台长时任务的使用场景和运行限制，开发者在进行后台播放时，建议如下：</p> <ol><li>应用执行的业务类型与长时任务的申请类型需要保持一致，否则系统会对应用进行管控，即应用退至后台会被挂起。如系统检测到应用只申请了AUDIO_PLAYBACK（音视频播放），但实际上除了播放音乐（对应AUDIO_PLAYBACK类型），还在进行录制（对应AUDIO_RECORDING类型）。</li><li>应用申请长时任务后，需要执行相应的业务，否则系统会对应用进行管控，即应用退至后台会被挂起。如系统检测到应用申请了AUDIO_PLAYBACK（音视频播放），但实际未播放音乐。</li><li>媒体播放类（流类型为STREAM_USAGE_MUSIC、STREAM_USAGE_MOVIE和STREAM_USAGE_AUDIOBOOK）和游戏类（流类型为STREAM_USAGE_GAME）应用申请后台长时任务播放时，必须接入媒体会话服务（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/avsession-overview" target="_blank">AVSession</a>），且长时任务类型应当为AUDIO_PLAYBACK。否则应用退至后台播放时会被系统静音并冻结，无法在后台正常播放，直到应用重新切回前台时，才会解除静音并恢复播放。</li><li>用户主动点击音乐暂停播放时，应用需及时取消对应的长时任务；用户再次点击音乐播放时，需重新申请长时任务。</li><li>若音频在后台播放时被<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/audio-playback-concurrency" target="_blank">打断</a>，系统会自行检测和停止长时任务，音频重启播放时，需要再次申请长时任务。</li><li>后台播放音频的应用，在停止长时任务的同时，需要暂停或停止音频流，否则应用会被系统强制终止。</li><li>若应用退至后台，需要暂停音频播放时，则建议不申请长时任务。</li></ol> </div> <div class="tiledSection"><h2 id="section123975612118">系统默认焦点策略表<i class="anchor-icon anchor-icon-link" anchorid="section123975612118" tips="复制节点链接"></i></h2><p>上文提供了<a href="/consumer/cn/doc/best-practices/bpta-audio-focus-management#table838220651115">音频流类型与典型业务场景映射关系</a>，用以帮助开发者根据业务场景选择正确的音频流类型。下文将提供手机场景下常见音频流类型与系统默认焦点策略之间的关联矩阵表，用以帮助开发者选择合适的音频会话（AudioSession）策略，从而满足用户预期播放行为。为方便阅读，去掉了播放音频流类型的“STREAM_USAGE_”前缀。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><tbody><tr><td align="center" class="cellrowborder" valign="top">&nbsp;&nbsp;</td> <td align="center" class="cellrowborder" colspan="11" valign="top"><p>后 播 音 频 流</p> </td> </tr> <tr><td align="center" class="cellrowborder" rowspan="15" valign="top" width="8.333333333333332%"><p>先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top" width="8.333333333333332%"><p>音频类型</p> </td> <td align="center" class="cellrowborder" valign="top" width="8.333333333333332%"><p>MUSIC</p> <p>（音乐）</p> </td> <td align="center" class="cellrowborder" valign="top" width="8.333333333333332%"><p>COMMUNICATION</p> <p>（VoIP通话）</p> </td> <td align="center" class="cellrowborder" valign="top" width="8.333333333333332%"><p>VOICE_ASSISTANT</p> <p>（语音播报）</p> </td> <td align="center" class="cellrowborder" valign="top" width="8.333333333333332%"><p>ALARM</p> <p>（闹钟）</p> </td> <td align="center" class="cellrowborder" valign="top" width="8.333333333333332%"><p>VOICE_MESSAGE</p> <p>（语音消息）</p> </td> <td align="center" class="cellrowborder" valign="top" width="8.333333333333332%"><p>NOTIFICATION</p> <p>（通知消息）</p> </td> <td align="center" class="cellrowborder" valign="top" width="8.333333333333332%"><p>MOVIE</p> <p>（视频）</p> </td> <td align="center" class="cellrowborder" valign="top" width="8.333333333333332%"><p>GAME</p> <p>（游戏）</p> </td> <td align="center" class="cellrowborder" valign="top" width="8.333333333333332%"><p>AUDIOBOOK</p> <p>（电子书）</p> </td> <td align="center" class="cellrowborder" valign="top" width="8.333333333333332%"><p>NAVIGATION</p> <p>（导航）</p> </td> </tr> <tr><td align="center" class="cellrowborder" valign="top"><p>MUSIC（音乐）</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>暂停先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低先播音频流音量</p> </td> <td align="center" class="cellrowborder" valign="top"><p>暂停先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>暂停先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低先播音频流音量</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>同时播放</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低先播音频流音量</p> </td> </tr> <tr><td align="center" class="cellrowborder" valign="top"><p>VOICE_COMMUNICATION（VoIP通话）</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低后播音频流音量</p> </td> <td align="center" class="cellrowborder" valign="top"><p>暂停先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>拒绝后播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低后播音频流音量</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低后播音频流音量</p> </td> <td align="center" class="cellrowborder" valign="top"><p>同时播放</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低后播音频流音量</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低后播音频流音量</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低后播音频流音量</p> </td> <td align="center" class="cellrowborder" valign="top"><p>同时播放</p> </td> </tr> <tr><td align="center" class="cellrowborder" valign="top"><p>VOICE_ASSISTANT</p> <p>（语音播报）</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低后播音频流音量</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低后播音频流音量</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低后播音频流音量</p> </td> <td align="center" class="cellrowborder" valign="top"><p>同时播放</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低后播音频流音量</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低后播音频流音量</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> </tr> <tr><td align="center" class="cellrowborder" valign="top"><p>ALARM</p> <p>（闹钟）</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低先播音频流音量</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>同时播放</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>同时播放</p> </td> </tr> <tr><td align="center" class="cellrowborder" valign="top"><p>VOICE_MESSAGE</p> <p>（语音消息）</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低先播音频流音量</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低先播音频流音量</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>同时播放</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低后播音频流音量</p> </td> </tr> <tr><td align="center" class="cellrowborder" valign="top"><p>NOTIFICATION</p> <p>（通知消息）</p> </td> <td align="center" class="cellrowborder" valign="top"><p>同时播放</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>同时播放</p> </td> <td align="center" class="cellrowborder" valign="top"><p>同时播放</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>同时播放</p> </td> <td align="center" class="cellrowborder" valign="top"><p>同时播放</p> </td> <td align="center" class="cellrowborder" valign="top"><p>同时播放</p> </td> <td align="center" class="cellrowborder" valign="top"><p>同时播放</p> </td> </tr> <tr><td align="center" class="cellrowborder" valign="top"><p>MOVIE</p> <p>（视频）</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>暂停先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低先播音频流音量</p> </td> <td align="center" class="cellrowborder" valign="top"><p>暂停先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>暂停先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低先播音频流音量</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>同时播放</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低先播音频流音量</p> </td> </tr> <tr><td align="center" class="cellrowborder" valign="top"><p>GAME</p> <p>（游戏）</p> </td> <td align="center" class="cellrowborder" valign="top"><p>同时播放</p> </td> <td align="center" class="cellrowborder" valign="top"><p>暂停先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低先播音频流音量</p> </td> <td align="center" class="cellrowborder" valign="top"><p>暂停先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>暂停先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低先播音频流音量</p> </td> <td align="center" class="cellrowborder" valign="top"><p>同时播放</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>同时播放</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低先播音频流音量</p> </td> </tr> <tr><td align="center" class="cellrowborder" valign="top"><p>AUDIOBOOK</p> <p>（电子书）</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>暂停先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低先播音频流音量</p> </td> <td align="center" class="cellrowborder" valign="top"><p>暂停先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>暂停先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低先播音频流音量</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>同时播放</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低先播音频流音量</p> </td> </tr> <tr><td align="center" class="cellrowborder" valign="top"><p>NAVIGATION</p> <p>（导航）</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低后播音频流音量</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> <td align="center" class="cellrowborder" valign="top"><p>同时播放</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低先播音频流音量</p> </td> <td align="center" class="cellrowborder" valign="top"><p>同时播放</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低后播音频流音量</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低后播音频流音量</p> </td> <td align="center" class="cellrowborder" valign="top"><p>降低后播音频流音量</p> </td> <td align="center" class="cellrowborder" valign="top"><p>停止先播音频流</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>SOURCE_TYPE_MIC</p> <p>（普通录音）</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>拒绝后播音频流</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>SOURCE_TYPE_VOICE_RECOGNITION</p> <p>（VOIP通话）</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>SOURCE_TYPE_PLAYBACK_CAPTURE</p> <p>（屏幕录音）</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>SOURCE_TYPE_VOICE_MESSAGE</p> <p>（语音消息）</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> <td class="cellrowborder" valign="top"><p>同时播放</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section1341206161110">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section1341206161110" tips="复制节点链接"></i></h2><ul><li><a href="https://gitee.com/harmonyos_samples/audio-focus" target="_blank">实现音频焦点管理功能</a></li></ul> </div> </div> <div></div></div>