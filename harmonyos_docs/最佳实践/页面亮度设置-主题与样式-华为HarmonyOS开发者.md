<h1 _ngcontent-ali-c119="" class="doc-title ng-star-inserted" title="页面亮度设置"> 页面亮度设置 </h1>

<div _ngcontent-ali-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section1056134019215">概述<i class="anchor-icon anchor-icon-link" anchorid="section1056134019215" tips="复制节点链接"></i></h2><p>在“视频播放”和“付款码展示”这两种典型场景下，应用需要在不同的页面分别设置不同的屏幕亮度，用户也可以自定义调节屏幕亮度，并且随着页面跳转而自动恢复系统亮度设置。</p> </div> <p>本文将这两种典型场景拆分为三个功能，帮助开发者掌握页面亮度设置的开发流程与细节。</p> <ul><li><a href="/consumer/cn/doc/best-practices/bpta-page-brightness-settings#section02121449165218">视频播放页面亮度调节</a></li><li><a href="/consumer/cn/doc/best-practices/bpta-page-brightness-settings#section13735111620212">视频播放时页面常亮设置</a></li><li><a href="/consumer/cn/doc/best-practices/bpta-page-brightness-settings#section689872941418">付款码页面高亮设置</a></li></ul> <div class="tiledSection"><h2 id="section1627912244813">原理<i class="anchor-icon anchor-icon-link" anchorid="section1627912244813" tips="复制节点链接"></i></h2><p>当前亮度设置的能力由窗口提供，设置亮度后，如果没有再次修改，亮度将不会发生变化（仅在应用内生效，退出应用恢复系统默认亮度）。</p> </div> <p>窗口作为亮度设置的媒介，窗口的改变会使得该窗口下所有页面的亮度都跟随改变，所以需要一套记录页面和监听页面变化的机制，动态设置不同页面下的亮度。</p> <ul><li>监听机制：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-observer#uiobserveronnavdestinationupdate" target="_blank">uiObserver.on('navDestinationUpdate')</a></li><li>亮度设置：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setwindowbrightness9" target="_blank">setWindowBrightness</a></li><li>屏幕常亮：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setwindowkeepscreenon9" target="_blank">setWindowKeepScreenOn</a></li></ul> <div class="tiledSection"><h2 id="section02121449165218">视频播放页面亮度调节<i class="anchor-icon anchor-icon-link" anchorid="section02121449165218" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section16813153613532" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section16813153613532" tips="复制节点链接"></i></h3><p>视频播放场景，支持用户在视频页调节屏幕亮度，调整完亮度退出页面后其他页面仍为系统亮度，再次进入视频页，屏幕亮度会自动恢复成页面之前保存的亮度。</p> </div> <div class="tiledSection"><h3 id="section296614376174">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section296614376174" tips="复制节点链接"></i></h3><p>调节屏幕亮度：</p> <p>1.维护页面与亮度的映射关系</p> <div class="screenLinkPre"><div _ngcontent-ali-c106="" class="highlight-div"><div _ngcontent-ali-c106="" class="highlight-div-header"><div _ngcontent-ali-c106="" class="highlight-div-header-left"><div _ngcontent-ali-c106="" class="handle-button expand-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ali-c106="" class="highlight-div-header-right"><div _ngcontent-ali-c106="" class="handle-button ai-button"></div><div _ngcontent-ali-c106="" class="handle-button line-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ali-c106="" class="handle-button theme-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ali-c106="" class="handle-button copy-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ali-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/AdjustBrightness/blob/e708f559086adb44a288ebe485ca1c96c1f7a92f/entry/src/main/ets/util/BrightnessUtil.ets#L28-L30" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-attr">brightnessMap</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">number</span>&gt; =</li><li>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([[<span class="hljs-title class_">Constants</span>.<span class="hljs-property">NAV_DESTINATION_DEFAULT</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">DEFAULT_BRIGHTNESS</span>],</li><li>    [<span class="hljs-title class_">Constants</span>.<span class="hljs-property">NAV_DESTINATION_ITEM_PAY_CODE</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">MAX_BRIGHTNESS</span>]]);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/AdjustBrightness/blob/e708f559086adb44a288ebe485ca1c96c1f7a92f/entry/src/main/ets/util/BrightnessUtil.ets#L28-L30" target="_blank">BrightnessUtil.ets</a></div></div></div></div> <p>2.在视频播放器组件上添加滑动组件Slider</p> <div class="screenLinkPre"><div _ngcontent-ali-c106="" class="highlight-div"><div _ngcontent-ali-c106="" class="highlight-div-header"><div _ngcontent-ali-c106="" class="highlight-div-header-left"><div _ngcontent-ali-c106="" class="handle-button expand-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ali-c106="" class="highlight-div-header-right"><div _ngcontent-ali-c106="" class="handle-button ai-button"></div><div _ngcontent-ali-c106="" class="handle-button line-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ali-c106="" class="handle-button theme-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ali-c106="" class="handle-button copy-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ali-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/AdjustBrightness/blob/e708f559086adb44a288ebe485ca1c96c1f7a92f/entry/src/main/ets/view/VideoView.ets#L25-L71" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">build</span>() {</li><li>  <span class="hljs-title function_">Stack</span>({ <span class="hljs-variable">alignContent</span>: <span class="hljs-title class_">Alignment</span>.<span class="hljs-title class_">Start</span> }) {</li><li>    <span class="hljs-title function_">Video</span>({</li><li>      <span class="hljs-variable">src</span>: $<span class="hljs-title class_">rawfile</span>('<span class="hljs-title class_">video1</span>.<span class="hljs-title class_">mp4</span>'),</li><li>      <span class="hljs-variable">previewUri</span>: $<span class="hljs-title class_">r</span>('<span class="hljs-title class_">app</span>.<span class="hljs-title class_">media</span>.<span class="hljs-title class_">img_preview</span>'),</li><li>    })</li><li>      .<span class="hljs-title function_">loop</span>(<span class="hljs-keyword">true</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-variable">Constants</span>.<span class="hljs-variable">FULL_PERCENT</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-variable">Constants</span>.<span class="hljs-variable">FULL_PERCENT</span>)</li><li>      .<span class="hljs-title function_">onStart</span>(() =&gt; {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">brightnessViewModel</span>.<span class="hljs-title function_">setWindowKeepScreenState</span>(<span class="hljs-keyword">true</span>);</li><li>      })</li><li>      .<span class="hljs-title function_">onPause</span>(() =&gt; {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">brightnessViewModel</span>.<span class="hljs-title function_">setWindowKeepScreenState</span>(<span class="hljs-keyword">false</span>);</li><li>      })</li><li>    <span class="hljs-title function_">Slider</span>({</li><li>      <span class="hljs-variable">value</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">currentBrightness</span>,</li><li>      <span class="hljs-variable">min</span>: <span class="hljs-number">0</span>,</li><li>      <span class="hljs-variable">max</span>: <span class="hljs-number">1</span>,</li><li>      <span class="hljs-variable">step</span>: <span class="hljs-number">0.01</span>,</li><li>      <span class="hljs-variable">style</span>: <span class="hljs-title class_">SliderStyle</span>.<span class="hljs-title class_">InSet</span>,</li><li>      <span class="hljs-variable">direction</span>: <span class="hljs-title class_">Axis</span>.<span class="hljs-title class_">Vertical</span>,</li><li>      <span class="hljs-variable">reverse</span>: <span class="hljs-keyword">true</span></li><li>    })</li><li>      .<span class="hljs-title function_">trackColor</span>(<span class="hljs-string">'#66A0A0A4'</span>)</li><li>      .<span class="hljs-title function_">blockColor</span>(<span class="hljs-variable">Color</span>.<span class="hljs-variable">Transparent</span>)</li><li>      .<span class="hljs-title function_">selectedColor</span>(<span class="hljs-variable">Color</span>.<span class="hljs-variable">White</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'80%'</span>)</li><li>      .<span class="hljs-title function_">margin</span>({ <span class="hljs-variable">left</span>: <span class="hljs-number">24</span>, <span class="hljs-variable">bottom</span>: <span class="hljs-number">24</span> })</li><li>      .<span class="hljs-title function_">onChange</span>((<span class="hljs-variable">value</span>: <span class="hljs-title class_">number</span>, <span class="hljs-variable">mode</span>: <span class="hljs-title class_">SliderChangeMode</span>) =&gt; { <span class="hljs-comment">// Slider onChange callback</span></li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">mode</span> === <span class="hljs-variable">SliderChangeMode</span>.<span class="hljs-variable">Moving</span>) {</li><li>          <span class="hljs-keyword">this</span>.<span class="hljs-variable">sliderOpacity</span> = <span class="hljs-number">1</span>;</li><li>          <span class="hljs-keyword">this</span>.<span class="hljs-variable">brightnessViewModel</span>.<span class="hljs-title function_">updateVideoBrightness</span>(<span class="hljs-variable">value</span>);</li><li>        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">mode</span> === <span class="hljs-variable">SliderChangeMode</span>.<span class="hljs-variable">End</span>) {</li><li>          <span class="hljs-keyword">this</span>.<span class="hljs-variable">sliderOpacity</span> = <span class="hljs-number">0</span>;</li><li>        }</li><li>      })</li><li>      .<span class="hljs-title function_">opacity</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">sliderOpacity</span>)</li><li>      .<span class="hljs-title function_">animation</span>({</li><li>        <span class="hljs-variable">duration</span>: <span class="hljs-number">300</span></li><li>      })</li><li>  }</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-variable">Constants</span>.<span class="hljs-variable">FULL_PERCENT</span>)</li><li>  .<span class="hljs-title function_">height</span>(<span class="hljs-number">184</span>)</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/AdjustBrightness/blob/e708f559086adb44a288ebe485ca1c96c1f7a92f/entry/src/main/ets/view/VideoView.ets#L25-L71" target="_blank">VideoView.ets</a></div></div></div></div> </div> <p>3.通过滑动组件调节屏幕亮度，并将调节的亮度值缓存</p> <div class="screenLinkPre"><div _ngcontent-ali-c106="" class="highlight-div"><div _ngcontent-ali-c106="" class="highlight-div-header"><div _ngcontent-ali-c106="" class="highlight-div-header-left"><div _ngcontent-ali-c106="" class="handle-button expand-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ali-c106="" class="highlight-div-header-right"><div _ngcontent-ali-c106="" class="handle-button ai-button"></div><div _ngcontent-ali-c106="" class="handle-button line-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ali-c106="" class="handle-button theme-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ali-c106="" class="handle-button copy-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ali-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" codehub="https://gitee.com/harmonyos_samples/AdjustBrightness/blob/e708f559086adb44a288ebe485ca1c96c1f7a92f/entry/src/main/ets/util/BrightnessUtil.ets#L43-L51" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * Video playback page brightness adjustment execution function</span></li><li><span class="hljs-comment"> *</span></li><li><span class="hljs-comment"> * @param brightness Brightness value</span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title">updateVideoBrightness</span>(<span class="hljs-params">brightness: number</span>): <span class="hljs-keyword">void</span></span> {</li><li>  BrightnessUtil.setBrightness(brightness, Constants.SET_BRIGHTNESS_SLIDE);</li><li>  BrightnessUtil.brightnessMap.<span class="hljs-keyword">set</span>(Constants.NAV_DESTINATION_ITEM_VIDEO, brightness);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/AdjustBrightness/blob/e708f559086adb44a288ebe485ca1c96c1f7a92f/entry/src/main/ets/util/BrightnessUtil.ets#L43-L51" target="_blank">BrightnessUtil.ets</a></div></div></div></div> <p>4. 返回首页，恢复屏幕默认亮度，重新进入视频播放页，恢复最后一次在视频播放页设置的亮度</p> <div class="screenLinkPre"><div _ngcontent-ali-c106="" class="highlight-div"><div _ngcontent-ali-c106="" class="highlight-div-header"><div _ngcontent-ali-c106="" class="highlight-div-header-left"><div _ngcontent-ali-c106="" class="handle-button expand-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ali-c106="" class="highlight-div-header-right"><div _ngcontent-ali-c106="" class="handle-button ai-button"></div><div _ngcontent-ali-c106="" class="handle-button line-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ali-c106="" class="handle-button theme-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ali-c106="" class="handle-button copy-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ali-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" codehub="https://gitee.com/harmonyos_samples/AdjustBrightness/blob/e708f559086adb44a288ebe485ca1c96c1f7a92f/entry/src/main/ets/viewmodel/BrightnessViewModel.ets#L23-L46" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Switch and listen to the routing page, and set the brightness of the cached page.</span></li><li><span class="hljs-keyword">private</span> navDestinationUpdateCallBack: Callback&lt;NavDestinationInfo&gt; = (info: NavDestinationInfo): <span class="hljs-keyword">void</span> =&gt; {</li><li>  <span class="hljs-keyword">switch</span> (info.state) {</li><li>    <span class="hljs-keyword">case</span> uiObserver.NavDestinationState.ON_SHOWN:</li><li>      BrightnessUtil.setBrightness(info.name <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>, Constants.SET_BRIGHTNESS_CLICK);</li><li>      BrightnessUtil.setStateBarContentColor(info.name <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>, <span class="hljs-string">'#FFFFFF'</span>);</li><li>      <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">case</span> uiObserver.NavDestinationState.ON_HIDDEN:</li><li>    <span class="hljs-keyword">case</span> uiObserver.NavDestinationState.ON_BACKPRESS:</li><li>      BrightnessUtil.setBrightness(Constants.NAV_DESTINATION_DEFAULT, Constants.SET_BRIGHTNESS_CLICK);</li><li>      BrightnessUtil.setStateBarContentColor(info.name <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>, <span class="hljs-string">'#000000'</span>);</li><li>      <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-literal">default</span>:</li><li>      <span class="hljs-keyword">break</span>;</li><li>  }</li><li>};</li><li>
</li><li><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">registerNavigationListener</span>(): <span class="hljs-keyword">void</span></span> {</li><li>  uiObserver.<span class="hljs-keyword">on</span>(<span class="hljs-string">'navDestinationUpdate'</span>, <span class="hljs-keyword">this</span>.navDestinationUpdateCallBack);</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">unRegisterNavigationListener</span>(): <span class="hljs-keyword">void</span></span> {</li><li>  uiObserver.off(<span class="hljs-string">'navDestinationUpdate'</span>, <span class="hljs-keyword">this</span>.navDestinationUpdateCallBack);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/AdjustBrightness/blob/e708f559086adb44a288ebe485ca1c96c1f7a92f/entry/src/main/ets/viewmodel/BrightnessViewModel.ets#L23-L46" target="_blank">BrightnessViewModel.ets</a></div></div></div></div> <div class="tiledSection"><h3 id="section1740011461501">实现效果<i class="anchor-icon anchor-icon-link" anchorid="section1740011461501" tips="复制节点链接"></i></h3><div class="fignone"><span class="figcap"><b>图1 </b>视频播放页面</span></div> <p><span><img height="637.6951" originheight="720" originwidth="337" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162952.82031103063699302532080984708289:50001231000000:2800:9F8027732F8DBA98FCAF8BEC0760ED0C6785EF45A8E3C9139358C5DAAF5F5F14.gif" title="点击放大" width="308.2275"></span></p> <p>注：录屏无法录制亮度变化，以真机为准</p> </div> <div class="tiledSection"><h2 id="section13735111620212">视频播放时页面常亮设置<i class="anchor-icon anchor-icon-link" anchorid="section13735111620212" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section18452352215" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section18452352215" tips="复制节点链接"></i></h3><p>视频播放场景，在视频播放期间，即使用户没有屏幕交互操作，也希望保持屏幕常亮，直至视频播放完成或退出视频播放页。</p> </div> <div class="tiledSection"><h3 id="section1389752815227">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section1389752815227" tips="复制节点链接"></i></h3><p>1.视频播放时保持屏幕常亮，暂停或退出页面，取消屏幕常亮</p> <div class="screenLinkPre"><div _ngcontent-ali-c106="" class="highlight-div"><div _ngcontent-ali-c106="" class="highlight-div-header"><div _ngcontent-ali-c106="" class="highlight-div-header-left"><div _ngcontent-ali-c106="" class="handle-button expand-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ali-c106="" class="highlight-div-header-right"><div _ngcontent-ali-c106="" class="handle-button ai-button"></div><div _ngcontent-ali-c106="" class="handle-button line-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ali-c106="" class="handle-button theme-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ali-c106="" class="handle-button copy-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ali-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/AdjustBrightness/blob/e708f559086adb44a288ebe485ca1c96c1f7a92f/entry/src/main/ets/view/VideoView.ets#L28-L40" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Video</span>({</li><li>  <span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">'video1.mp4'</span>),</li><li>  <span class="hljs-attr">previewUri</span>: $r(<span class="hljs-string">'app.media.img_preview'</span>),</li><li>})</li><li>  .<span class="hljs-title function_">loop</span>(<span class="hljs-literal">true</span>)</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-title class_">Constants</span>.<span class="hljs-property">FULL_PERCENT</span>)</li><li>  .<span class="hljs-title function_">height</span>(<span class="hljs-title class_">Constants</span>.<span class="hljs-property">FULL_PERCENT</span>)</li><li>  .<span class="hljs-title function_">onStart</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">brightnessViewModel</span>.<span class="hljs-title function_">setWindowKeepScreenState</span>(<span class="hljs-literal">true</span>);</li><li>  })</li><li>  .<span class="hljs-title function_">onPause</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">brightnessViewModel</span>.<span class="hljs-title function_">setWindowKeepScreenState</span>(<span class="hljs-literal">false</span>);</li><li>  })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/AdjustBrightness/blob/e708f559086adb44a288ebe485ca1c96c1f7a92f/entry/src/main/ets/view/VideoView.ets#L28-L40" target="_blank">VideoView.ets</a></div></div></div></div> </div> <p>2.设置屏幕常亮接口</p> <div class="screenLinkPre"><div _ngcontent-ali-c106="" class="highlight-div"><div _ngcontent-ali-c106="" class="highlight-div-header"><div _ngcontent-ali-c106="" class="highlight-div-header-left"><div _ngcontent-ali-c106="" class="handle-button expand-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ali-c106="" class="highlight-div-header-right"><div _ngcontent-ali-c106="" class="handle-button ai-button"></div><div _ngcontent-ali-c106="" class="handle-button line-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ali-c106="" class="handle-button theme-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ali-c106="" class="handle-button copy-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ali-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/AdjustBrightness/blob/e708f559086adb44a288ebe485ca1c96c1f7a92f/entry/src/main/ets/util/BrightnessUtil.ets#L75-L93" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * Keep screen brightness</span></li><li><span class="hljs-comment"> *</span></li><li><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> isKeepOn true：keep；false:cancel keep</span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">setWindowKeepScreenState</span>(<span class="hljs-attr">isKeepOn</span>: <span class="hljs-built_in">boolean</span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-title class_">BrightnessUtil</span>.<span class="hljs-property">windowClass</span>?.<span class="hljs-title function_">setWindowKeepScreenOn</span>(isKeepOn, <span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">const</span> <span class="hljs-attr">errCode</span>: <span class="hljs-built_in">number</span> = err.<span class="hljs-property">code</span>;</li><li>      <span class="hljs-keyword">if</span> (errCode) {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`Failed set window keep screen state, errorCode: <span class="hljs-subst">${err.code}</span>`</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`Success set window keep screen state`</span>);</li><li>    });</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`Failed set window keep screen state, errorCode: <span class="hljs-subst">${err.code}</span>`</span>);</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/AdjustBrightness/blob/e708f559086adb44a288ebe485ca1c96c1f7a92f/entry/src/main/ets/util/BrightnessUtil.ets#L75-L93" target="_blank">BrightnessUtil.ets</a></div></div></div></div> <div class="tiledSection"><h3 id="section18761130192615">实现效果<i class="anchor-icon anchor-icon-link" anchorid="section18761130192615" tips="复制节点链接"></i></h3><p>见图1 视频播放</p> <p>注：录屏无法录制亮度变化，以真机为准</p> </div> <div class="tiledSection"><h2 id="section689872941418">付款码页面高亮设置<i class="anchor-icon anchor-icon-link" anchorid="section689872941418" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section17127151317153" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section17127151317153" tips="复制节点链接"></i></h3><p>一些包含支付功能的应用，用户进入付款码页面，应用自动设置屏幕最高亮度，退出付款码页面，恢复屏幕默认亮度。</p> </div> <div class="tiledSection"><h3 id="section16391045102011">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section16391045102011" tips="复制节点链接"></i></h3><p>1.内存中维护一个页面与亮度的映射关系</p> <div class="screenLinkPre"><div _ngcontent-ali-c106="" class="highlight-div"><div _ngcontent-ali-c106="" class="highlight-div-header"><div _ngcontent-ali-c106="" class="highlight-div-header-left"><div _ngcontent-ali-c106="" class="handle-button expand-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ali-c106="" class="highlight-div-header-right"><div _ngcontent-ali-c106="" class="handle-button ai-button"></div><div _ngcontent-ali-c106="" class="handle-button line-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ali-c106="" class="handle-button theme-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ali-c106="" class="handle-button copy-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ali-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/AdjustBrightness/blob/e708f559086adb44a288ebe485ca1c96c1f7a92f/entry/src/main/ets/util/BrightnessUtil.ets#L28-L30" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-attr">brightnessMap</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">number</span>&gt; =</li><li>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([[<span class="hljs-title class_">Constants</span>.<span class="hljs-property">NAV_DESTINATION_DEFAULT</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">DEFAULT_BRIGHTNESS</span>],</li><li>    [<span class="hljs-title class_">Constants</span>.<span class="hljs-property">NAV_DESTINATION_ITEM_PAY_CODE</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">MAX_BRIGHTNESS</span>]]);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/AdjustBrightness/blob/e708f559086adb44a288ebe485ca1c96c1f7a92f/entry/src/main/ets/util/BrightnessUtil.ets#L28-L30" target="_blank">BrightnessUtil.ets</a></div></div></div></div> <p>2.监听页面切换事件，进入付款码页面，设置高亮，返回首页，恢复屏幕默认亮度</p> <div class="screenLinkPre"><div _ngcontent-ali-c106="" class="highlight-div"><div _ngcontent-ali-c106="" class="highlight-div-header"><div _ngcontent-ali-c106="" class="highlight-div-header-left"><div _ngcontent-ali-c106="" class="handle-button expand-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ali-c106="" class="highlight-div-header-right"><div _ngcontent-ali-c106="" class="handle-button ai-button"></div><div _ngcontent-ali-c106="" class="handle-button line-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ali-c106="" class="handle-button theme-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ali-c106="" class="handle-button copy-button"><div _ngcontent-ali-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ali-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" codehub="https://gitee.com/harmonyos_samples/AdjustBrightness/blob/e708f559086adb44a288ebe485ca1c96c1f7a92f/entry/src/main/ets/viewmodel/BrightnessViewModel.ets#L23-L46" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Switch and listen to the routing page, and set the brightness of the cached page.</span></li><li><span class="hljs-keyword">private</span> navDestinationUpdateCallBack: Callback&lt;NavDestinationInfo&gt; = (info: NavDestinationInfo): <span class="hljs-keyword">void</span> =&gt; {</li><li>  <span class="hljs-keyword">switch</span> (info.state) {</li><li>    <span class="hljs-keyword">case</span> uiObserver.NavDestinationState.ON_SHOWN:</li><li>      BrightnessUtil.setBrightness(info.name <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>, Constants.SET_BRIGHTNESS_CLICK);</li><li>      BrightnessUtil.setStateBarContentColor(info.name <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>, <span class="hljs-string">'#FFFFFF'</span>);</li><li>      <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">case</span> uiObserver.NavDestinationState.ON_HIDDEN:</li><li>    <span class="hljs-keyword">case</span> uiObserver.NavDestinationState.ON_BACKPRESS:</li><li>      BrightnessUtil.setBrightness(Constants.NAV_DESTINATION_DEFAULT, Constants.SET_BRIGHTNESS_CLICK);</li><li>      BrightnessUtil.setStateBarContentColor(info.name <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>, <span class="hljs-string">'#000000'</span>);</li><li>      <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-literal">default</span>:</li><li>      <span class="hljs-keyword">break</span>;</li><li>  }</li><li>};</li><li>
</li><li><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">registerNavigationListener</span>(): <span class="hljs-keyword">void</span></span> {</li><li>  uiObserver.<span class="hljs-keyword">on</span>(<span class="hljs-string">'navDestinationUpdate'</span>, <span class="hljs-keyword">this</span>.navDestinationUpdateCallBack);</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">unRegisterNavigationListener</span>(): <span class="hljs-keyword">void</span></span> {</li><li>  uiObserver.off(<span class="hljs-string">'navDestinationUpdate'</span>, <span class="hljs-keyword">this</span>.navDestinationUpdateCallBack);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/AdjustBrightness/blob/e708f559086adb44a288ebe485ca1c96c1f7a92f/entry/src/main/ets/viewmodel/BrightnessViewModel.ets#L23-L46" target="_blank">BrightnessViewModel.ets</a></div></div></div></div> </div> <div class="tiledSection"><h3 id="section27195244296">实现效果<i class="anchor-icon anchor-icon-link" anchorid="section27195244296" tips="复制节点链接"></i></h3><div class="fignone"><span class="figcap"><b>图2 </b>付款码页面</span></div> <p><span><img height="639.3975" originheight="720" originwidth="337" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162952.87276538584187279907149981646962:50001231000000:2800:A60AF743437B19F5B754A717BF07954DFE5032DA249F950CD935F63E3AC70C29.gif" title="点击放大" width="309.6107"></span></p> <p>注：录屏无法录制亮度变化，以真机为准</p> </div> <div class="tiledSection"><h2 id="section3457134016343">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section3457134016343" tips="复制节点链接"></i></h2><ul><li><a href="https://gitee.com/harmonyos_samples/AdjustBrightness" target="_blank">实现页面亮度调节的功能</a></li></ul> </div> </div> <div></div></div>