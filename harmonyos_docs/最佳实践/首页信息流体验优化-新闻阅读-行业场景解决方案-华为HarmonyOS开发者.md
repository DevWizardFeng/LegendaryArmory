<h1 _ngcontent-ege-c119="" class="doc-title ng-star-inserted" title="首页信息流体验优化"> 首页信息流体验优化 </h1>

<div _ngcontent-ege-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section1464021606">概述<i class="anchor-icon anchor-icon-link" anchorid="section1464021606" tips="复制节点链接"></i></h2><p>本场景解决方案面向新闻类页面开发人员，指导开发者从零开始构建新闻类首页面。包含地址选择、tabs和tabContent切换的动态图标和流畅动效、下拉刷新、上拉加载、首页feed流等常见功能的实现及流畅体验。</p> </div> <div class="tiledSection"><h3 id="section15349157239" class="firsth2">整体场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section15349157239" tips="复制节点链接"></i></h3><p>介绍了用户操作应用的主要流程，包括进入首页后通过页签切换页面内容、上拉加载和下拉刷新页面，以及从首页地址进入地址选择页更换地址等功能。</p> </div> <ul><li>应用的主要流程图：<p><span><img originheight="746" originwidth="662" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163340.70296567107920897520435242132883:50001231000000:2800:8080B9D984F0BED44F2AB1B0D1328671431AA19330765FC8553B73E1C0DE4EC1.png" width="662" height="746"></span></p> </li></ul> <ul><li>应用的运行效果图：<p><span><img height="546.3906000000001" originheight="662" originwidth="320" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163340.89984166646153681241851947127359:50001231000000:2800:C2638A5B3592593856F5A3F2A1DE1575DA6519852E21094DFE246B487474616D.gif" title="点击放大" width="266"></span></p> </li></ul> <ul><li>操作流程如下：<p>1. 获取地理位置的权限；</p> <p>2. 点击位置信息，跳转地址选择页，可修改当前位置信息；</p> <p>3. 点击顶部页签或者滑动切换页面，页签同步切换；</p> <p>4. 点击底部页签切换页面，同步切换页签，触发页签切换的动画效果；</p> <p>5. 下拉刷新页面信息；</p> <p>6. 上拉加载页面信息；</p> <p>7. 点击右下角按钮回弹至顶部。</p> </li></ul> <div class="tiledSection"><h2 id="section181613418310">场景说明<i class="anchor-icon anchor-icon-link" anchorid="section181613418310" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section1812017554315" class="firsth2">适用范围<i class="anchor-icon anchor-icon-link" anchorid="section1812017554315" tips="复制节点链接"></i></h3><p>本场景适用于新闻类应用的首页，采用原生组件和三方库组件来实现新闻首页及其功能。</p> </div> <div class="tiledSection"><h3 id="section13747115414">场景优势<i class="anchor-icon anchor-icon-link" anchorid="section13747115414" tips="复制节点链接"></i></h3><p>本场景可提升用户的首页体验，使其更加流畅和便捷。具体优势包括：</p> <ol><li>导航栏点击切换动效流畅，响应时延51ms。</li><li>左右滑动切换动效流畅，响应时延67ms。</li><li>地址选择页定位精确，选择目标城市便捷。</li><li>底部页签跳转流畅，时延349ms。</li><li>页面支持上拉加载和下拉刷新功能，动效回弹流畅，无丢帧现象。下拉刷新响应时延为153毫秒，上拉加载响应时延为150毫秒。</li></ol> </div> <div class="tiledSection"><h2 id="section1663154417412">场景分析<i class="anchor-icon anchor-icon-link" anchorid="section1663154417412" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section262310527410" class="firsth2">典型场景与实现方案<i class="anchor-icon anchor-icon-link" anchorid="section262310527410" tips="复制节点链接"></i></h3><ul><li>实现方案如下表： <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.10.2.1.1.1.4.1.1" valign="top" width="12.989999999999998%"><p>场景名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.10.2.1.1.1.4.1.2" valign="top" width="34.03%"><p>描述</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.10.2.1.1.1.4.1.3" valign="top" width="52.980000000000004%"><p>实现方案</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="12.989999999999998%"><p>导航栏切换动效流畅</p> </td> <td class="cellrowborder" valign="top" width="34.03%"><p>点击页签或滑动切换页面时，页签同步切换</p> </td> <td class="cellrowborder" valign="top" width="52.980000000000004%"><p>tab组件添加动画开始时触发事件</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="12.989999999999998%"><p>底部页签跳转精致流畅</p> </td> <td class="cellrowborder" valign="top" width="34.03%"><p>底部页签切换时具有动画效果</p> </td> <td class="cellrowborder" valign="top" width="52.980000000000004%"><p>添加lottie动画</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="12.989999999999998%"><p>上拉加载下拉刷新</p> </td> <td class="cellrowborder" valign="top" width="34.03%"><p>上拉加载更多新闻内容，下拉刷新整个页面，均具有加载动效</p> </td> <td class="cellrowborder" valign="top" width="52.980000000000004%"><p>pullToRefresh组件</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="12.989999999999998%"><p>首页feed流</p> </td> <td class="cellrowborder" valign="top" width="34.03%"><p>首页展示流畅的图文列表</p> </td> <td class="cellrowborder" valign="top" width="52.980000000000004%"><p>使用LazyForEach对子组件进行渲染，实现懒加载功能</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="12.989999999999998%"><p>地址选择页</p> </td> <td class="cellrowborder" valign="top" width="34.03%"><p>提供地址选择、定位、地址首字母定位及模糊查询功能</p> </td> <td class="cellrowborder" valign="top" width="52.980000000000004%"><p>位置服务与AlphabetIndexer组件</p> </td> </tr>  </tbody></table></div> </div> </li></ul> </div> <div class="tiledSection"><h2 id="section14765310156">场景实现<i class="anchor-icon anchor-icon-link" anchorid="section14765310156" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section1910311181852" class="firsth2">导航栏切换动效流畅<i class="anchor-icon anchor-icon-link" anchorid="section1910311181852" tips="复制节点链接"></i></h3><p>通过添加Tab组件的动效触发事件，实现页面内容切换与页签样式切换的同步效果。具体效果如图所示：</p> <p><span><img height="546.3906000000001" originheight="662" originwidth="320" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163341.29405853613787122253984419466100:50001231000000:2800:20D401CECC40F85117FB26A6E7BCE87131B20D39047EE3993D4F8BA9F3766176.gif" title="点击放大" width="266"></span></p> <ul><li>动效触发事件节点<p>推荐使用onAnimationStart事件设置切换标签动效。使用onChange事件会导致页面切换后再触发动效，造成效果延迟。使用onClick事件会与页面切换冲突。</p> <div class="screenLinkPre"><div _ngcontent-ege-c106="" class="highlight-div"><div _ngcontent-ege-c106="" class="highlight-div-header"><div _ngcontent-ege-c106="" class="highlight-div-header-left"><div _ngcontent-ege-c106="" class="handle-button expand-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ege-c106="" class="highlight-div-header-right"><div _ngcontent-ege-c106="" class="handle-button ai-button"></div><div _ngcontent-ege-c106="" class="handle-button line-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ege-c106="" class="handle-button theme-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ege-c106="" class="handle-button copy-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ege-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/view/TabBar.ets#L30-L75" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// TabBar.ets</span></li><li>@<span class="hljs-title function_">Builder</span></li><li><span class="hljs-title function_">TabBuilder</span>(<span class="hljs-variable">id</span>: <span class="hljs-title class_">number</span>, <span class="hljs-variable">index</span>: <span class="hljs-title class_">number</span>) {</li><li>  <span class="hljs-title function_">Column</span>() {</li><li>    <span class="hljs-title function_">Text</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">tabBarArray</span>[<span class="hljs-variable">id</span>].<span class="hljs-variable">name</span>)</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>  .<span class="hljs-title function_">alignItems</span>(<span class="hljs-variable">HorizontalAlign</span>.<span class="hljs-variable">Start</span>)</li><li>}</li><li>
</li><li><span class="hljs-title function_">build</span>() {</li><li>  <span class="hljs-title function_">Tabs</span>({ <span class="hljs-variable">barPosition</span>: <span class="hljs-title class_">BarPosition</span>.<span class="hljs-title class_">Start</span> }) {</li><li>    <span class="hljs-title function_">ForEach</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">tabBarArray</span>, (<span class="hljs-variable">tabsItem</span>: <span class="hljs-title class_">NewsTypeModel</span>, <span class="hljs-variable">index</span>: <span class="hljs-title class_">number</span>) =&gt; {</li><li>      <span class="hljs-title function_">TabContent</span>() {</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>      <span class="hljs-comment">// ...</span></li><li>    }, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">NewsTypeModel</span>) =&gt; <span class="hljs-variable">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable">item</span>));</li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>  .<span class="hljs-title function_">onAnimationStart</span>((<span class="hljs-variable">_index</span>: <span class="hljs-title class_">number</span>, <span class="hljs-variable">targetIndex</span>: <span class="hljs-title class_">number</span>, <span class="hljs-variable">_event</span>: <span class="hljs-title class_">TabsAnimationEvent</span>) =&gt; {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">currentIndex</span> = <span class="hljs-variable">targetIndex</span>;</li><li>  })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/view/TabBar.ets#L30-L75" target="_blank">TabBar.ets</a></div></div></div></div> </li></ul> </div> <div class="tiledSection"><h3 id="section152186182613">底部页签跳转精致流畅<i class="anchor-icon anchor-icon-link" anchorid="section152186182613" tips="复制节点链接"></i></h3><p>底部页签样式添加Lottie动画，使跳转更加精致流畅。效果如图所示：</p> </div> <p><span><img height="546.3906000000001" originheight="662" originwidth="320" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163341.25434834685884975267852196871142:50001231000000:2800:FF64E87B9A439DD7FEB6A592D2ACB15AE407E1D6710EEE58E1F87FF563E78AE7.gif" title="点击放大" width="266"></span></p> <ul><li>底部页签跳转功能时序图<p><span><img height="474.81" originheight="506" originwidth="557" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163341.23112353496406521379223943658044:50001231000000:2800:755E5FACFCD9BFE4B687190FE0CDFF1FBC14748735251E7EE33BDD81FADB98E6.png" title="点击放大" width="523.6875"></span></p> </li></ul> <ul><li>TabBar集成lottie动画<p>lottie是适用于OpenHarmony的动画库，可解析AdobeAfterEffects通过Bodymovin插件导出的JSON格式动画，并在移动设备上本地渲染。支持动画交互，通过添加触摸事件与TabBar结合，实现动态图标效果。</p> <p>引入lottie三方库。</p> <div _ngcontent-ege-c106="" class="highlight-div"><div _ngcontent-ege-c106="" class="highlight-div-header"><div _ngcontent-ege-c106="" class="highlight-div-header-left"><div _ngcontent-ege-c106="" class="handle-button expand-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ege-c106="" class="highlight-div-header-right"><div _ngcontent-ege-c106="" class="handle-button ai-button"></div><div _ngcontent-ege-c106="" class="handle-button line-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ege-c106="" class="handle-button theme-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ege-c106="" class="handle-button copy-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ege-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li>ohpm install @ohos/lottie</li></ol></pre></div></div> <p>准备lottie动画资源，建议放置在Entry目录的common文件夹中。如果放置在本模块中，使用相对路径将无法读取。</p> <p>导入lottie模块。</p> <div class="screenLinkPre"><div _ngcontent-ege-c106="" class="highlight-div"><div _ngcontent-ege-c106="" class="highlight-div-header"><div _ngcontent-ege-c106="" class="highlight-div-header-left"><div _ngcontent-ege-c106="" class="handle-button expand-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ege-c106="" class="highlight-div-header-right"><div _ngcontent-ege-c106="" class="handle-button ai-button"></div><div _ngcontent-ege-c106="" class="handle-button line-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ege-c106="" class="handle-button theme-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ege-c106="" class="handle-button copy-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ege-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/view/Home.ets#L18-L19" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Home.ets</span></li><li><span class="hljs-keyword">import</span> lottie, { <span class="hljs-title class_">AnimationItem</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos/lottie'</span>;</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/view/Home.ets#L18-L19" target="_blank">Home.ets</a></div></div></div></div> <p>使用RenderingContext在Canvas组件上进行绘制，声明CanvasRenderingContext2D变量。使用RenderingContextSettings配置CanvasRenderingContext2D对象的参数，设置canvas是否开启抗锯齿。</p> <div class="screenLinkPre"><div _ngcontent-ege-c106="" class="highlight-div"><div _ngcontent-ege-c106="" class="highlight-div-header"><div _ngcontent-ege-c106="" class="highlight-div-header-left"><div _ngcontent-ege-c106="" class="handle-button expand-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ege-c106="" class="highlight-div-header-right"><div _ngcontent-ege-c106="" class="handle-button ai-button"></div><div _ngcontent-ege-c106="" class="handle-button line-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ege-c106="" class="handle-button theme-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ege-c106="" class="handle-button copy-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ege-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" codehub="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/view/Home.ets#L35-L37" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Home.ets</span></li><li><span class="hljs-keyword">private</span> renderingSettings1: RenderingContextSettings = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RenderingContextSettings</span>(<span class="hljs-literal">true</span>);</li><li><span class="hljs-keyword">private</span> canvasRenderingContext1: CanvasRenderingContext2D = <span class="hljs-keyword">new</span> <span class="hljs-built_in">CanvasRenderingContext2D</span>(<span class="hljs-keyword">this</span>.renderingSettings1);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/view/Home.ets#L35-L37" target="_blank">Home.ets</a></div></div></div></div> <p>定义所需数据类型的接口，初始化变量。接口中包含资源路径信息和CanvasRenderingContext2D。</p> <div class="screenLinkPre"><div _ngcontent-ege-c106="" class="highlight-div"><div _ngcontent-ege-c106="" class="highlight-div-header"><div _ngcontent-ege-c106="" class="highlight-div-header-left"><div _ngcontent-ege-c106="" class="handle-button expand-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ege-c106="" class="highlight-div-header-right"><div _ngcontent-ege-c106="" class="handle-button ai-button"></div><div _ngcontent-ege-c106="" class="handle-button line-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ege-c106="" class="handle-button theme-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ege-c106="" class="handle-button copy-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ege-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/view/Home.ets#L201-L209" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Home.ets</span></li><li><span class="hljs-keyword">interface</span> <span class="hljs-title class_">TabBarOption</span> {</li><li>  <span class="hljs-variable">index</span>: <span class="hljs-title class_">number</span>;</li><li>  <span class="hljs-variable">text</span>: <span class="hljs-title class_">ResourceStr</span>;</li><li>  <span class="hljs-variable">name</span>: <span class="hljs-title class_">string</span>;</li><li>  <span class="hljs-variable">path</span>: <span class="hljs-title class_">string</span>;</li><li>  <span class="hljs-variable">canvasRenderingContext</span>: <span class="hljs-title class_">CanvasRenderingContext2D</span>;</li><li>  <span class="hljs-variable">lottieItem</span>?: <span class="hljs-title class_">AnimationItem</span>;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/view/Home.ets#L201-L209" target="_blank">Home.ets</a></div></div></div></div> <p>实现动画播放的方法。</p> <div class="screenLinkPre"><div _ngcontent-ege-c106="" class="highlight-div"><div _ngcontent-ege-c106="" class="highlight-div-header"><div _ngcontent-ege-c106="" class="highlight-div-header-left"><div _ngcontent-ege-c106="" class="handle-button expand-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ege-c106="" class="highlight-div-header-right"><div _ngcontent-ege-c106="" class="handle-button ai-button"></div><div _ngcontent-ege-c106="" class="handle-button line-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ege-c106="" class="handle-button theme-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ege-c106="" class="handle-button copy-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ege-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/view/Home.ets#L126-L141" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Home.ets</span></li><li>lottieController(): void {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.currentBottomIndex === <span class="hljs-number">0</span>) {</li><li>    lottie.stop();</li><li>    lottie.play(<span class="hljs-keyword">this</span>.tabBarOption1.name);</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.currentBottomIndex === <span class="hljs-number">1</span>) {</li><li>    lottie.stop();</li><li>    lottie.play(<span class="hljs-keyword">this</span>.tabBarOption2.name);</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.currentBottomIndex === <span class="hljs-number">2</span>) {</li><li>    lottie.stop();</li><li>    lottie.play(<span class="hljs-keyword">this</span>.tabBarOption3.name);</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/view/Home.ets#L126-L141" target="_blank">Home.ets</a></div></div></div></div> <p>在TabBar样式中实现Canvas子组件。</p> <div class="screenLinkPre"><div _ngcontent-ege-c106="" class="highlight-div"><div _ngcontent-ege-c106="" class="highlight-div-header"><div _ngcontent-ege-c106="" class="highlight-div-header-left"><div _ngcontent-ege-c106="" class="handle-button expand-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ege-c106="" class="highlight-div-header-right"><div _ngcontent-ege-c106="" class="handle-button ai-button"></div><div _ngcontent-ege-c106="" class="handle-button line-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ege-c106="" class="handle-button theme-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ege-c106="" class="handle-button copy-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ege-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/view/Home.ets#L179-L202" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Home.ets</span></li><li><span class="hljs-title function_">Canvas</span>(<span class="hljs-variable">tabBarOption</span>.<span class="hljs-variable">canvasRenderingContext</span>)</li><li>  .<span class="hljs-title function_">width</span>($<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.float.canvas_size'</span>))</li><li>  .<span class="hljs-title function_">height</span>($<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.float.canvas_size'</span>))</li><li>  .<span class="hljs-title function_">onReady</span>(() =&gt; {</li><li>    <span class="hljs-variable">tabBarOption</span>.<span class="hljs-variable">canvasRenderingContext</span>.<span class="hljs-variable">imageSmoothingEnabled</span> = <span class="hljs-keyword">true</span>;</li><li>    <span class="hljs-variable">tabBarOption</span>.<span class="hljs-variable">canvasRenderingContext</span>.<span class="hljs-variable">imageSmoothingQuality</span> = <span class="hljs-string">'medium'</span>;</li><li>    <span class="hljs-variable">lottie</span>.<span class="hljs-title function_">destroy</span>(<span class="hljs-variable">tabBarOption</span>.<span class="hljs-variable">name</span>);</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-variable">item</span> = <span class="hljs-variable">lottie</span>.<span class="hljs-title function_">loadAnimation</span>({</li><li>      <span class="hljs-variable">container</span>: <span class="hljs-title class_">tabBarOption</span>.<span class="hljs-title class_">canvasRenderingContext</span>,</li><li>      <span class="hljs-variable">renderer</span>: <span class="hljs-string">'canvas'</span>,</li><li>      <span class="hljs-variable">loop</span>: <span class="hljs-keyword">false</span>,</li><li>      <span class="hljs-variable">autoplay</span>: <span class="hljs-keyword">false</span>,</li><li>      <span class="hljs-variable">autoSkip</span>: <span class="hljs-keyword">false</span>,</li><li>      <span class="hljs-variable">name</span>: <span class="hljs-title class_">tabBarOption</span>.<span class="hljs-title class_">name</span>,</li><li>      <span class="hljs-variable">path</span>: <span class="hljs-title class_">tabBarOption</span>.<span class="hljs-title class_">path</span>,</li><li>    });</li><li>    <span class="hljs-variable">tabBarOption</span>.<span class="hljs-variable">lottieItem</span> = <span class="hljs-variable">item</span>;</li><li>    <span class="hljs-variable">item</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'DOMLoaded'</span>, (<span class="hljs-variable">args</span>: <span class="hljs-title class_">Object</span>): <span class="hljs-title class_">void</span> =&gt; {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable">tabBarOption</span>.<span class="hljs-variable">index</span> === <span class="hljs-variable">tabBarOption</span>.<span class="hljs-variable">currentBottomIndex</span>) {</li><li>        <span class="hljs-variable">item</span>.<span class="hljs-title function_">play</span>();</li><li>      }</li><li>    })</li><li>  })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/view/Home.ets#L179-L202" target="_blank">Home.ets</a></div></div></div></div> <p>在tab组件的onAnimationStart事件中调用播放方法。</p> <div class="screenLinkPre"><div _ngcontent-ege-c106="" class="highlight-div"><div _ngcontent-ege-c106="" class="highlight-div-header"><div _ngcontent-ege-c106="" class="highlight-div-header-left"><div _ngcontent-ege-c106="" class="handle-button expand-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ege-c106="" class="highlight-div-header-right"><div _ngcontent-ege-c106="" class="handle-button ai-button"></div><div _ngcontent-ege-c106="" class="handle-button line-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ege-c106="" class="handle-button theme-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ege-c106="" class="handle-button copy-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ege-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/view/Home.ets#L115-L119" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Home.ets</span></li><li>.<span class="hljs-title function_">onAnimationStart</span>(<span class="hljs-function">(<span class="hljs-params">index: <span class="hljs-built_in">number</span>, targetIndex: <span class="hljs-built_in">number</span>, event: TabsAnimationEvent</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentBottomIndex</span> = targetIndex;</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">lottieController</span>();</li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/view/Home.ets#L115-L119" target="_blank">Home.ets</a></div></div></div></div> </li></ul> <div class="tiledSection"><h3 id="section18669174519718">上拉加载下拉刷新<i class="anchor-icon anchor-icon-link" anchorid="section18669174519718" tips="复制节点链接"></i></h3><p>通过三方库组件pullToRefresh实现下拉刷新页面和上拉加载更多数据的效果。具体效果如图所示：</p> </div> <p><span><img height="546.3906000000001" originheight="662" originwidth="320" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163341.35905602301992740538686790408210:50001231000000:2800:A783D2E8D8A05BC173DB1DA7D5038EC5255AED75C6AFB67D1C80F891E1158909.gif" title="点击放大" width="266"></span></p> <ul><li>上拉加载和下拉刷新时序图：<p><span><img height="503.7375" originheight="521" originwidth="541" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163341.89242124150288459458022054996383:50001231000000:2800:38DCFFBC55FC8275FBA7D0E96E27C036F9130E36250ACBEFDB0B0470BF7D308C.png" title="点击放大" width="523.6875"></span></p> </li></ul> <ul><li>pullToRefresh组件<p>使用第三方库的pullToRefresh组件，将列表组件、绑定的数据对象和scroller对象包含在内，并添加上滑和下拉方法。支持lazyForEach数据作为数据源。设置List组件的edgeEffect属性为EdgeEffect.None。</p> <p>引入三方库pullToRefresh。</p> <div _ngcontent-ege-c106="" class="highlight-div"><div _ngcontent-ege-c106="" class="highlight-div-header"><div _ngcontent-ege-c106="" class="highlight-div-header-left"><div _ngcontent-ege-c106="" class="handle-button expand-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ege-c106="" class="highlight-div-header-right"><div _ngcontent-ege-c106="" class="handle-button ai-button"></div><div _ngcontent-ege-c106="" class="handle-button line-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ege-c106="" class="handle-button theme-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ege-c106="" class="handle-button copy-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ege-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li>ohpm install @ohos/pulltorefresh</li></ol></pre></div></div> <div class="screenLinkPre"><div _ngcontent-ege-c106="" class="highlight-div"><div _ngcontent-ege-c106="" class="highlight-div-header"><div _ngcontent-ege-c106="" class="highlight-div-header-left"><div _ngcontent-ege-c106="" class="handle-button expand-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ege-c106="" class="highlight-div-header-right"><div _ngcontent-ege-c106="" class="handle-button ai-button"></div><div _ngcontent-ege-c106="" class="handle-button line-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ege-c106="" class="handle-button theme-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ege-c106="" class="handle-button copy-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ege-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/view/PullToRefreshNews.ets#L18-L19" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// PullToRefreshNews.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">PullToRefresh</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos/pulltorefresh/index'</span>;</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/view/PullToRefreshNews.ets#L18-L19" target="_blank">PullToRefreshNews.ets</a></div></div></div></div> <p>准备数据源，本场景使用本地资源模拟效果，资源文件在resources/rawfile目录下，实际情况可替换为从网络获取。</p> <div class="screenLinkPre"><div _ngcontent-ege-c106="" class="highlight-div"><div _ngcontent-ege-c106="" class="highlight-div-header"><div _ngcontent-ege-c106="" class="highlight-div-header-left"><div _ngcontent-ege-c106="" class="handle-button expand-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ege-c106="" class="highlight-div-header-right"><div _ngcontent-ege-c106="" class="handle-button ai-button"></div><div _ngcontent-ege-c106="" class="handle-button line-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ege-c106="" class="handle-button theme-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ege-c106="" class="handle-button copy-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ege-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-css" codehub="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/view/PullToRefreshNews.ets#L36-L40" data-highlighted="yes"><ol class="linenums"><li>// PullToRefreshNews<span class="hljs-selector-class">.ets</span></li><li>const MOCK_DATA_FILE_ONE_DIR: string =</li><li>  uiContext!.<span class="hljs-built_in">getHostContext</span>()!.resourceManager.<span class="hljs-built_in">getStringSync</span>($<span class="hljs-built_in">r</span>(<span class="hljs-string">'app.string.mock1'</span>).id);</li><li>const MOCK_DATA_FILE_TWO_DIR: string =</li><li>  uiContext!.<span class="hljs-built_in">getHostContext</span>()!.resourceManager.<span class="hljs-built_in">getStringSync</span>($<span class="hljs-built_in">r</span>(<span class="hljs-string">'app.string.mock2'</span>).id);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/view/PullToRefreshNews.ets#L36-L40" target="_blank">PullToRefreshNews.ets</a></div></div></div></div> <p>包含列表组件、数据对象和scroller对象，并添加上滑和下拉方法。</p> <div class="screenLinkPre"><div _ngcontent-ege-c106="" class="highlight-div"><div _ngcontent-ege-c106="" class="highlight-div-header"><div _ngcontent-ege-c106="" class="highlight-div-header-left"><div _ngcontent-ege-c106="" class="handle-button expand-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ege-c106="" class="highlight-div-header-right"><div _ngcontent-ege-c106="" class="handle-button ai-button"></div><div _ngcontent-ege-c106="" class="handle-button line-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ege-c106="" class="handle-button theme-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ege-c106="" class="handle-button copy-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ege-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/view/PullToRefreshNews.ets#L68-L110" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// PullToRefreshNews.ets</span></li><li><span class="hljs-title class_">PullToRefresh</span>({</li><li>  <span class="hljs-attr">data</span>: $newsData,</li><li>  <span class="hljs-attr">scroller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>,</li><li>  <span class="hljs-attr">customList</span>: <span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getListView</span>();</li><li>  },</li><li>  <span class="hljs-attr">onRefresh</span>: <span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {</li><li>      <span class="hljs-comment">// ...</span></li><li>      }, <span class="hljs-variable constant_">NEWS_REFRESH_TIME</span>);</li><li>    });</li><li>  },</li><li>  <span class="hljs-attr">onLoadMore</span>: <span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {</li><li>      <span class="hljs-comment">// ...</span></li><li>    });</li><li>  },</li><li>  <span class="hljs-attr">customLoad</span>: <span class="hljs-literal">null</span>,</li><li>  <span class="hljs-attr">customRefresh</span>: <span class="hljs-literal">null</span>,</li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/view/PullToRefreshNews.ets#L68-L110" target="_blank">PullToRefreshNews.ets</a></div></div></div></div> </li></ul> <div class="tiledSection"><h3 id="section142048404918">首页feed流<i class="anchor-icon anchor-icon-link" anchorid="section142048404918" tips="复制节点链接"></i></h3><p>使用懒加载实现首页 feed 流的快速渲染和流畅滑动。效果如图所示：</p> </div> <p><span><img height="546.3906000000001" originheight="662" originwidth="320" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163341.29566401372182308569627349857639:50001231000000:2800:EB8C5C3B329BF982025D96ED9D9835376DBAA35D415CFBE98AF1359CD4E54A10.gif" title="点击放大" width="266"></span></p> <ul><li>懒加载<p>新闻应用列表数据可能达到数万条。针对这类数据加载的长列表应用，使用懒加载可以解决一次性加载数据耗时长、占用资源多的问题，从而提升页面响应速度。</p> <p>准备需要加载的数据源：</p> <div class="screenLinkPre"><div _ngcontent-ege-c106="" class="highlight-div"><div _ngcontent-ege-c106="" class="highlight-div-header"><div _ngcontent-ege-c106="" class="highlight-div-header-left"><div _ngcontent-ege-c106="" class="handle-button expand-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ege-c106="" class="highlight-div-header-right"><div _ngcontent-ege-c106="" class="handle-button ai-button"></div><div _ngcontent-ege-c106="" class="handle-button line-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ege-c106="" class="handle-button theme-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ege-c106="" class="handle-button copy-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ege-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" codehub="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/view/PullToRefreshNews.ets#L47-L48" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// PullToRefreshNews.ets</span></li><li><span class="hljs-variable">@State</span> <span class="hljs-attribute">newsData</span>: NewsDataSource = new <span class="hljs-built_in">NewsDataSource</span>();</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/view/PullToRefreshNews.ets#L47-L48" target="_blank">PullToRefreshNews.ets</a></div></div></div></div> <p>创建子组件：</p> <div class="screenLinkPre"><div _ngcontent-ege-c106="" class="highlight-div"><div _ngcontent-ege-c106="" class="highlight-div-header"><div _ngcontent-ege-c106="" class="highlight-div-header-left"><div _ngcontent-ege-c106="" class="handle-button expand-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ege-c106="" class="highlight-div-header-right"><div _ngcontent-ege-c106="" class="handle-button ai-button"></div><div _ngcontent-ege-c106="" class="handle-button line-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ege-c106="" class="handle-button theme-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ege-c106="" class="handle-button copy-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ege-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" codehub="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/view/PullToRefreshNews.ets#L187-L265" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// PullToRefreshNews.ets</span></li><li><span class="hljs-variable">@Component</span></li><li>struct newsItem {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/view/PullToRefreshNews.ets#L187-L265" target="_blank">PullToRefreshNews.ets</a></div></div></div></div> <p>使用LazyForEach对子组件进行渲染：</p> <div class="screenLinkPre"><div _ngcontent-ege-c106="" class="highlight-div"><div _ngcontent-ege-c106="" class="highlight-div-header"><div _ngcontent-ege-c106="" class="highlight-div-header-left"><div _ngcontent-ege-c106="" class="handle-button expand-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ege-c106="" class="highlight-div-header-right"><div _ngcontent-ege-c106="" class="handle-button ai-button"></div><div _ngcontent-ege-c106="" class="handle-button line-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ege-c106="" class="handle-button theme-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ege-c106="" class="handle-button copy-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ege-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/view/PullToRefreshNews.ets#L122-L148" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// PullToRefreshNews.ets</span></li><li><span class="hljs-title function_">List</span>({ <span class="hljs-variable">space</span>: <span class="hljs-title class_">CommonConstants</span>.<span class="hljs-title class_">LIST_SPACE</span>, <span class="hljs-variable">scroller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">scroller</span> }) {</li><li>  <span class="hljs-title function_">LazyForEach</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">newsData</span>, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">NewsData</span>) =&gt; {</li><li>    <span class="hljs-title function_">ListItem</span>() {</li><li>      <span class="hljs-title function_">newsItem</span>({</li><li>        <span class="hljs-comment">// ...</span></li><li>      })</li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>  }, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">NewsData</span>, <span class="hljs-variable">index</span>?: <span class="hljs-title class_">number</span>) =&gt; <span class="hljs-variable">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable">item</span>) + <span class="hljs-variable">index</span>);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/view/PullToRefreshNews.ets#L122-L148" target="_blank">PullToRefreshNews.ets</a></div></div></div></div> </li></ul> <div class="tiledSection"><h3 id="section15993171910103">地址选择页<i class="anchor-icon anchor-icon-link" anchorid="section15993171910103" tips="复制节点链接"></i></h3><p>使用位置服务实现定位功能，AlphabetIndexer组件实现地址首字母定位导航条。效果如图所示：</p> </div> <p><span><img height="546.3906000000001" originheight="662" originwidth="320" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163341.61076158232652466728621211044256:50001231000000:2800:7734D1A58FECA709DF8540CE3C88CFB8878E8BD59DECF0455F57C6210A67540C.gif" title="点击放大" width="266"></span></p> <ul><li>地址选择页效果功能时序图<p><span><img height="464.83500000000004" originheight="515" originwidth="579" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163341.93518784246417289666336497006247:50001231000000:2800:2FA0FC0910412C411226301C672B9C15B20D48BABE623790D65EB9DCE4FF0B81.png" title="点击放大" width="523.6875"></span></p> </li></ul> <ul><li>位置服务与索引条导航<p>开启手机位置服务功能，使用位置服务获取当前地理位置信息，通过AlphabetIndexer组件实现首字母快速定位城市的索引条导航。</p> <p>申请权限时，API9及之后的版本，需要申请ohos.permission.APPROXIMATELY_LOCATION，或同时申请ohos.permission.APPROXIMATELY_LOCATION和ohos.permission.LOCATION；无法单独申请ohos.permission.LOCATION。</p> <div class="screenLinkPre"><div _ngcontent-ege-c106="" class="highlight-div"><div _ngcontent-ege-c106="" class="highlight-div-header"><div _ngcontent-ege-c106="" class="highlight-div-header-left"><div _ngcontent-ege-c106="" class="handle-button expand-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ege-c106="" class="highlight-div-header-right"><div _ngcontent-ege-c106="" class="handle-button ai-button"></div><div _ngcontent-ege-c106="" class="handle-button line-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ege-c106="" class="handle-button theme-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ege-c106="" class="handle-button copy-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ege-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/module.json5#L13-L34" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"requestPermissions"</span>: [</li><li>  {</li><li>    <span class="hljs-string">"name"</span>: <span class="hljs-string">"ohos.permission.APPROXIMATELY_LOCATION"</span>,</li><li>    <span class="hljs-string">"reason"</span>: <span class="hljs-string">"$string:approximately_location_desc"</span>,</li><li>    <span class="hljs-string">"usedScene"</span>: {</li><li>      <span class="hljs-string">"abilities"</span>: [</li><li>        <span class="hljs-string">"EntryAbility"</span></li><li>      ],</li><li>      <span class="hljs-string">"when"</span>: <span class="hljs-string">"always"</span></li><li>    }</li><li>  },</li><li>  {</li><li>    <span class="hljs-string">"name"</span>: <span class="hljs-string">"ohos.permission.LOCATION"</span>,</li><li>    <span class="hljs-string">"reason"</span>: <span class="hljs-string">"$string:location_desc"</span>,</li><li>    <span class="hljs-string">"usedScene"</span>: {</li><li>      <span class="hljs-string">"abilities"</span>: [</li><li>        <span class="hljs-string">"EntryAbility"</span></li><li>      ],</li><li>      <span class="hljs-string">"when"</span>: <span class="hljs-string">"always"</span></li><li>    }</li><li>  }</li><li>],</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/module.json5#L13-L34" target="_blank">module.json5</a></div></div></div></div> <p>申请用户安全权限：</p> <div class="screenLinkPre"><div _ngcontent-ege-c106="" class="highlight-div"><div _ngcontent-ege-c106="" class="highlight-div-header"><div _ngcontent-ege-c106="" class="highlight-div-header-left"><div _ngcontent-ege-c106="" class="handle-button expand-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ege-c106="" class="highlight-div-header-right"><div _ngcontent-ege-c106="" class="handle-button ai-button"></div><div _ngcontent-ege-c106="" class="handle-button line-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ege-c106="" class="handle-button theme-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ege-c106="" class="handle-button copy-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ege-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/pages/Index.ets#L66-L76" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li>onPageShow(): void {</li><li>  abilityAccessCtrl.createAtManager().requestPermissionsFromUser(<span class="hljs-keyword">this</span>.getUIContext().getHostContext(), [</li><li>    <span class="hljs-string">'ohos.permission.LOCATION'</span>, <span class="hljs-string">'ohos.permission.APPROXIMATELY_LOCATION'</span>]).then(() =&gt; {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.status) {</li><li>      geoLocationManager.getCurrentLocation(locationChange);</li><li>      <span class="hljs-keyword">this</span>.status = <span class="hljs-literal">false</span>;</li><li>    }</li><li>  });</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/pages/Index.ets#L66-L76" target="_blank">Index.ets</a></div></div></div></div> <p>导入位置服务：</p> <div class="screenLinkPre"><div _ngcontent-ege-c106="" class="highlight-div"><div _ngcontent-ege-c106="" class="highlight-div-header"><div _ngcontent-ege-c106="" class="highlight-div-header-left"><div _ngcontent-ege-c106="" class="handle-button expand-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ege-c106="" class="highlight-div-header-right"><div _ngcontent-ege-c106="" class="handle-button ai-button"></div><div _ngcontent-ege-c106="" class="handle-button line-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ege-c106="" class="handle-button theme-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ege-c106="" class="handle-button copy-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ege-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/pages/Index.ets#L17-L18" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { geoLocationManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocationKit'</span>;</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/pages/Index.ets#L17-L18" target="_blank">Index.ets</a></div></div></div></div> <p>获取地理位置信息，进行逆地理编码以确定当前位置：</p> <div class="screenLinkPre"><div _ngcontent-ege-c106="" class="highlight-div"><div _ngcontent-ege-c106="" class="highlight-div-header"><div _ngcontent-ege-c106="" class="highlight-div-header-left"><div _ngcontent-ege-c106="" class="handle-button expand-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ege-c106="" class="highlight-div-header-right"><div _ngcontent-ege-c106="" class="handle-button ai-button"></div><div _ngcontent-ege-c106="" class="handle-button line-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ege-c106="" class="handle-button theme-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ege-c106="" class="handle-button copy-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ege-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/pages/Index.ets#L29-L56" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">locationChange</span>: <span class="hljs-function">(<span class="hljs-params">err: BusinessError, location: geoLocationManager.Location</span>) =&gt;</span> <span class="hljs-keyword">void</span> = <span class="hljs-function">(<span class="hljs-params">err, location</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">if</span> (err) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x00000</span>, <span class="hljs-string">'locationChanger: err='</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (location) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">reverseGeocodeRequest</span>: geoLocationManager.<span class="hljs-property">ReverseGeoCodeRequest</span> = {</li><li>      <span class="hljs-string">'latitude'</span>: location.<span class="hljs-property">latitude</span>,</li><li>      <span class="hljs-string">'longitude'</span>: location.<span class="hljs-property">longitude</span>,</li><li>      <span class="hljs-string">'maxItems'</span>: <span class="hljs-title class_">CommonConstants</span>.<span class="hljs-property">MAX_ITEMS</span></li><li>    };</li><li>    geoLocationManager.<span class="hljs-title function_">getAddressesFromLocation</span>(reverseGeocodeRequest, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (data) {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x00000</span>, <span class="hljs-string">'getAddressesFromLocation: data='</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));</li><li>        <span class="hljs-keyword">if</span> (data[<span class="hljs-number">0</span>].<span class="hljs-property">locality</span> !== <span class="hljs-literal">undefined</span>) {</li><li>          <span class="hljs-keyword">if</span> (i18n.<span class="hljs-property">System</span>.<span class="hljs-title function_">getSystemLanguage</span>() === <span class="hljs-string">'zh-Hans'</span>) {</li><li>            <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'local'</span>, data[<span class="hljs-number">0</span>].<span class="hljs-property">locality</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/"/g</span>, <span class="hljs-string">''</span>).<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>));</li><li>            <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'currentLocal'</span>, data[<span class="hljs-number">0</span>].<span class="hljs-property">locality</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/"/g</span>, <span class="hljs-string">''</span>).<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>));</li><li>          } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'local'</span>, data[<span class="hljs-number">0</span>].<span class="hljs-property">locality</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/"/g</span>, <span class="hljs-string">''</span>));</li><li>            <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'currentLocal'</span>, data[<span class="hljs-number">0</span>].<span class="hljs-property">locality</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/"/g</span>, <span class="hljs-string">''</span>));</li><li>          }</li><li>        }</li><li>      }</li><li>    });</li><li>  }</li><li>};</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/pages/Index.ets#L29-L56" target="_blank">Index.ets</a></div></div></div></div> <p>使用AlphabetIndexer组件实现导航条。通过onSelect事件获取选中索引值，并使用Scroller的scrollToIndex方法滑动到指定索引位置：</p> <div class="screenLinkPre"><div _ngcontent-ege-c106="" class="highlight-div"><div _ngcontent-ege-c106="" class="highlight-div-header"><div _ngcontent-ege-c106="" class="highlight-div-header-left"><div _ngcontent-ege-c106="" class="handle-button expand-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ege-c106="" class="highlight-div-header-right"><div _ngcontent-ege-c106="" class="handle-button ai-button"></div><div _ngcontent-ege-c106="" class="handle-button line-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ege-c106="" class="handle-button theme-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ege-c106="" class="handle-button copy-button"><div _ngcontent-ege-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ege-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/view/CityView.ets#L131-L146" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// CityView.ets</span></li><li><span class="hljs-title function_">AlphabetIndexer</span>({ <span class="hljs-variable">arrayValue</span>: <span class="hljs-title class_">TAB_VALUE</span>, <span class="hljs-variable">selected</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">stabIndex</span> })</li><li>  .<span class="hljs-title function_">height</span>(<span class="hljs-variable">CommonConstants</span>.<span class="hljs-variable">FULL_PERCENT</span>)</li><li>  .<span class="hljs-title function_">selectedColor</span>($<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.color.alphabet_select_color'</span>))</li><li>  .<span class="hljs-title function_">popupColor</span>($<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.color.alphabet_pop_color'</span>))</li><li>  .<span class="hljs-title function_">selectedBackgroundColor</span>($<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.color.alphabet_selected_bgc'</span>))</li><li>  .<span class="hljs-title function_">popupBackground</span>($<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.color.alphabet_pop_bgc'</span>))</li><li>  .<span class="hljs-title function_">popupPosition</span>({ <span class="hljs-variable">x</span>: $<span class="hljs-title class_">r</span>('<span class="hljs-title class_">app</span>.<span class="hljs-title class_">integer</span>.<span class="hljs-title class_">pop_position_x</span>'), <span class="hljs-variable">y</span>: $<span class="hljs-title class_">r</span>('<span class="hljs-title class_">app</span>.<span class="hljs-title class_">integer</span>.<span class="hljs-title class_">pop_position_y</span>') })</li><li>  .<span class="hljs-title function_">usingPopup</span>(<span class="hljs-keyword">true</span>)</li><li>  .<span class="hljs-title function_">selectedFont</span>({ <span class="hljs-variable">size</span>: $<span class="hljs-title class_">r</span>('<span class="hljs-title class_">app</span>.<span class="hljs-title class_">integer</span>.<span class="hljs-title class_">select_font</span>'), <span class="hljs-variable">weight</span>: <span class="hljs-title class_">FontWeight</span>.<span class="hljs-title class_">Bolder</span> })</li><li>  .<span class="hljs-title function_">popupFont</span>({ <span class="hljs-variable">size</span>: $<span class="hljs-title class_">r</span>('<span class="hljs-title class_">app</span>.<span class="hljs-title class_">integer</span>.<span class="hljs-title class_">pop_font</span>'), <span class="hljs-variable">weight</span>: <span class="hljs-title class_">FontWeight</span>.<span class="hljs-title class_">Bolder</span> })</li><li>  .<span class="hljs-title function_">alignStyle</span>(<span class="hljs-variable">IndexerAlign</span>.<span class="hljs-variable">Right</span>)</li><li>  .<span class="hljs-title function_">itemSize</span>(<span class="hljs-variable">CommonConstants</span>.<span class="hljs-variable">ITEM_SIZE</span>)</li><li>  .<span class="hljs-title function_">onSelect</span>((<span class="hljs-variable">tabIndex</span>: <span class="hljs-title class_">number</span>) =&gt; {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">scroller</span>.<span class="hljs-title function_">scrollToIndex</span>(<span class="hljs-variable">tabIndex</span>);</li><li>  })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/fluent-news-homepage/blob/master/entry/src/main/ets/view/CityView.ets#L131-L146" target="_blank">CityView.ets</a></div></div></div></div> </li></ul> <div class="tiledSection"><h2 id="section1955154265716">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section1955154265716" tips="复制节点链接"></i></h2></div> <ul><li><a href="https://gitee.com/harmonyos_samples/fluent-news-homepage" target="_blank">体验流畅的首页信息流</a></li></ul> </div> <div></div></div>